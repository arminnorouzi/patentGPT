<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230004768A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230004768</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17850063</doc-number><date>20220627</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><priority-claims><priority-claim sequence="01" kind="national"><country>JP</country><doc-number>2021-110121</doc-number><date>20210701</date></priority-claim></priority-claims><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>06</class><subclass>K</subclass><main-group>15</main-group><subgroup>02</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>06</class><subclass>K</subclass><main-group>15</main-group><subgroup>1823</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc></classifications-cpc><invention-title id="d2e61">IMAGE PROCESSING APPARATUS, IMAGE PROCESSING METHOD, AND STORAGE MEDIUM</invention-title><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>CANON KABUSHIKI KAISHA</orgname><address><city>Tokyo</city><country>JP</country></address></addressbook><residence><country>JP</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>KUBO</last-name><first-name>Hideki</first-name><address><city>Kanagawa</city><country>JP</country></address></addressbook></inventor></inventors></us-parties></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">An image processing apparatus including: a first obtaining unit configured to obtain first image data to be printed; a second obtaining unit configured to obtain second image data indicating a subject identical to that of the first image data and expressed by a geometric condition different from that of the first image data; and a first determination unit configured to determine ink amounts of respective inks including a first ink which reflects light in a normal reflection and a second ink which is different from the first ink and has a ratio of an intensity of light reflected in the normal reflection direction to an intensity of light reflected in the diffuse direction smaller than that of the first ink in a case where light based on brightness at each position of the first image data and the second image data.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="52.15mm" wi="158.75mm" file="US20230004768A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="199.47mm" wi="156.38mm" file="US20230004768A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="162.22mm" wi="150.71mm" file="US20230004768A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="166.79mm" wi="156.55mm" file="US20230004768A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="156.63mm" wi="148.17mm" file="US20230004768A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00005" num="00005"><img id="EMI-D00005" he="189.91mm" wi="101.18mm" orientation="landscape" file="US20230004768A1-20230105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00006" num="00006"><img id="EMI-D00006" he="234.27mm" wi="105.41mm" orientation="landscape" file="US20230004768A1-20230105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00007" num="00007"><img id="EMI-D00007" he="202.35mm" wi="145.80mm" file="US20230004768A1-20230105-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00008" num="00008"><img id="EMI-D00008" he="197.10mm" wi="157.90mm" orientation="landscape" file="US20230004768A1-20230105-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00009" num="00009"><img id="EMI-D00009" he="198.20mm" wi="100.33mm" file="US20230004768A1-20230105-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00010" num="00010"><img id="EMI-D00010" he="169.16mm" wi="87.63mm" file="US20230004768A1-20230105-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00011" num="00011"><img id="EMI-D00011" he="234.70mm" wi="89.66mm" orientation="landscape" file="US20230004768A1-20230105-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00012" num="00012"><img id="EMI-D00012" he="182.12mm" wi="93.47mm" file="US20230004768A1-20230105-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0001" level="1">BACKGROUND OF THE INVENTION</heading><heading id="h-0002" level="1">Field of the Invention</heading><p id="p-0002" num="0001">The present invention relates to an image processing technique to perform image formation with an ink having brightness differing according to an observation condition.</p><heading id="h-0003" level="1">Description of the Related Art</heading><p id="p-0003" num="0002">A metallic ink or gloss ink containing metal particles and capable of providing a metallic luster on a print medium has been recently used for printing with a printing apparatus or the like. The metallic ink or gloss ink is also used together with a color ink and there are presented various printing methods of adding a metallic luster to high-definition color printing.</p><p id="p-0004" num="0003">For example, in Japanese Patent Laid-Open No. 2013-123809 (hereinafter referred to as Patent Literature 1), a three-dimensional appearance is given to a printed product by a difference in gloss between portions with and without a metallic ink. Patent Literature 1 also discloses a method of giving a three-dimensional appearance to a printed product by gradation printing with a metallic ink.</p><heading id="h-0004" level="1">SUMMARY OF THE INVENTION</heading><p id="p-0005" num="0004">However, gradation to be given is selected from predetermined patterns or set by a user. Accordingly, there is a case where it is impossible to understand what gradation expression is suitable for giving a three-dimensional appearance to an object or subject to be reproduced as an image, with the result that a suitable three-dimensional appearance cannot be provided.</p><p id="p-0006" num="0005">An image processing apparatus according to an aspect of the present invention is an image processing apparatus generating data for forming an image on a print medium, the image processing apparatus comprising: a first obtaining unit configured to obtain first image data to be printed; a second obtaining unit configured to obtain second image data indicating a subject identical to that of the first image data and expressed by a geometric condition different from that of the first image data; and a first determination unit configured to determine ink amounts of respective inks including a first ink and a second ink based on brightness at each position of the first image data and the second image data, wherein the image is printed using the first ink which reflects light in a normal reflection direction at an intensity different from an intensity of light reflected in a diffuse direction in a case where light is made incident at a predetermined angle on the first ink provided on the medium, and the second ink which is different from the first ink and has a ratio of an intensity of light reflected in the normal reflection direction to an intensity of light reflected in the diffuse direction smaller than that of the first ink in a case where light is made incident at the predetermined angle on the second ink provided on the medium.</p><p id="p-0007" num="0006">Further features of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached drawings.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0005" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p-0008" num="0007"><figref idref="DRAWINGS">FIG. <b>1</b></figref> is a diagram showing a hardware configuration of an image processing apparatus;</p><p id="p-0009" num="0008"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a conceptual diagram illustrating a principle concerning a three-dimensional appearance perception;</p><p id="p-0010" num="0009"><figref idref="DRAWINGS">FIG. <b>3</b></figref> is a schematic diagram showing an effect of image processing;</p><p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. <b>4</b></figref> is a schematic diagram illustrating gonio-spectral reflection characteristics of a printed product;</p><p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is a schematic diagram illustrating a mechanism to obtain a three-dimensional appearance perception effect;</p><p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is a diagram showing a logical configuration of the image processing apparatus;</p><p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. <b>7</b></figref> is a configuration diagram of an image forming apparatus;</p><p id="p-0015" num="0014"><figref idref="DRAWINGS">FIGS. <b>8</b>A to <b>8</b>E</figref> are diagrams illustrating operation of the image forming apparatus;</p><p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. <b>9</b></figref> is a schematic diagram showing expression of images controlled by an area coverage modulation method;</p><p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. <b>10</b></figref> is a flowchart of determination of an amount of ink;</p><p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. <b>11</b></figref> is a diagram showing a logical configuration of the image processing apparatus; and</p><p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. <b>12</b></figref> is a flowchart of determination of an amount of ink.</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><heading id="h-0006" level="1">DESCRIPTION OF THE EMBODIMENTS</heading><p id="p-0020" num="0019">Embodiments of the present invention will be hereinafter described with reference to the drawings. The following embodiments do not necessarily limit the present invention. Further, not all combinations of the features described in the embodiments are necessarily essential for means to solve the problem to be solved by the present invention.</p><heading id="h-0007" level="1">First Embodiment</heading><heading id="h-0008" level="2">Hardware Configuration of Image Processing Apparatus <b>1</b></heading><p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. <b>1</b></figref> is a diagram showing a hardware configuration of an image processing apparatus <b>1</b>. For example, the image processing apparatus <b>1</b> is a computer. The image processing apparatus <b>1</b> comprises a CPU <b>101</b>, a ROM <b>102</b>, a RAM <b>103</b>, a video card (VC) <b>104</b>, a general purpose interface (I/F) <b>105</b>, a serial ATA (SATA) I/F <b>106</b>, and a network interface card (NIC) <b>107</b>.</p><p id="p-0022" num="0021">The CPU <b>101</b> executes an operating system (OS) or various programs stored in the ROM <b>102</b>, a hard disk drive (HDD) <b>113</b>, or the like using the RAM <b>103</b> as a work memory. The CPU <b>101</b> also controls each element via a system bus <b>108</b>. Incidentally, in the processing of flowcharts to be described later, a program code stored in the ROM <b>102</b>, HDD <b>113</b>, or the like is loaded into the RAM <b>103</b> and executed by the CPU <b>101</b>. The VC <b>104</b> is connected to a display <b>115</b>. The general purpose I/F <b>105</b> is connected to an input device <b>110</b> such as a mouse or keyboard or an image forming apparatus <b>111</b> via a serial bus <b>109</b>. The SATA I/F <b>106</b> is connected to the HDD <b>113</b> or a general purpose drive <b>114</b> which performs reading and writing of various recording media via a serial bus <b>112</b>. The NIC <b>107</b> performs input/output of information to an external apparatus. The CPU <b>101</b> uses the HDD <b>113</b> or various recording media mounted on the general purpose drive <b>114</b> as a storage location of various kinds of data. The CPU <b>101</b> displays a user interface (UI) screen provided by a program on the display <b>115</b> and receives input of a user instruction or the like accepted via the input device <b>110</b>.</p><heading id="h-0009" level="2">Principle of Three-Dimensional Appearance Perception</heading><p id="p-0023" num="0022">In the present embodiment, a printed product to which image processing has been applied exhibits different brightness distributions according to observation conditions, which is utilized to allow an observer to perceive a three-dimensional appearance.</p><p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a conceptual diagram illustrating a principle concerning a three-dimensional appearance perception. A plan view of <figref idref="DRAWINGS">FIG. <b>2</b>(<i>a</i>)</figref> indicates the relationship among a light source, a subject, and a camera. Here, the subject is a quadrangular prism and normals of surfaces A and B of the subject are inclined 45&#xb0; with respect to a direction of the light source and camera. At this time, in a case where the surfaces A and B have the same reflectance, the brightness of the surfaces A and B is the same as shown in a camera image of <figref idref="DRAWINGS">FIG. <b>2</b>(<i>b</i>)</figref>. A plan view of <figref idref="DRAWINGS">FIG. <b>2</b>(<i>c</i>)</figref> shows that the light source has moved in the direction of an arrow from the position shown in the plan view of <figref idref="DRAWINGS">FIG. <b>2</b>(<i>a</i>)</figref>. At this time, an image captured by the camera is as shown in a camera image of <figref idref="DRAWINGS">FIG. <b>2</b>(<i>d</i>)</figref>. Since the light source has moved closer to an orientation facing the surface B, the surface B looks bright and the surface A contrarily looks dark as compared with the camera image <figref idref="DRAWINGS">FIG. <b>2</b>(<i>b</i>)</figref>.</p><p id="p-0025" num="0024">In conventional two-dimensional printing, a surface normal is identical to a direction orthogonal to a printed product at any position of an image. Accordingly, even in a case where the position of the light source is changed at the time of observation, the brightness of the surfaces A and B varies in the same manner and it is impossible to recognize a three-dimensional shape by a change of brightness as described above. In the present embodiment, the reproduction of a change of brightness according to a normal of a subject made by a difference of position of the light source is treated as one of factors for recognizing a three-dimensional shape in a printed product.</p><p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. <b>3</b></figref> is a schematic diagram showing an effect of image processing. In the present embodiment, as illustrated in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, two scenes different in a geometric condition such as a light source position are input as target images. As shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>, a printed product reproduces a target image <b>1</b> in one observation environment and a target image <b>2</b> in the other observation environment, thereby simulating a change of the geometric condition of the scenes and providing a three-dimensional appearance. More specifically, the target image <b>1</b> reproduces a normal image observation environment, that is, an observation environment in which the main light source is not reflected in the printed product. The target image <b>2</b> intentionally reproduces an observation environment in which the main light source is reflected in the printed product.</p><p id="p-0027" num="0026">In a case where light is made incident at a predetermined angle on a metallic ink provided on a medium such as a printed product, the intensity of light reflected in a normal reflection direction is different from the intensity of light reflected in a diffuse direction. In short, the metallic ink has high directivity in a direction in which light is reflected and reflects more light in the normal reflection direction. Thus, the appearance of a printed product using a metallic ink is largely influenced by the brightness of what is reflected in the normal reflection direction. In the present embodiment, the amount of reflection light in the normal reflection direction at each position of a printed product is controlled by changing the amount of metallic ink. An observer observes a printed product while tilting the printed product to reflect and evade the light source, thereby perceiving a change of brightness between the respective positions of the printed product. This enables the printed product to be perceived as if the illumination of the subject in the printed product is changed and give the printed product with a three-dimensional appearance. In contrast, in a case where light is made incident at a predetermined angle on a color ink such as a C, M, Y, or K ink provided on a medium, a ratio of the intensity of light reflected in the normal reflection direction to the intensity of light reflected in the diffuse direction is small. The characteristics of the metallic and color inks will be described below with reference to <figref idref="DRAWINGS">FIG. <b>4</b></figref>.</p><p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. <b>4</b></figref> is a schematic diagram showing gonio-spectral reflection characteristics in a printed product using the color ink and the metallic ink. The gonio-spectral reflection characteristic is a characteristic indicating a difference in brightness between different geometric conditions. Patterns of <figref idref="DRAWINGS">FIGS. <b>4</b>(<i>a</i>) to <b>4</b>(<i>i</i>)</figref> show gonio-spectral reflection characteristics in a case where different amounts of color and metallic inks are used. The patterns of <figref idref="DRAWINGS">FIGS. <b>4</b>(<i>a</i>) to <b>4</b>(<i>i</i>)</figref> show that the amount of color ink increases toward the right in the direction of the arrow and that the amount of metallic ink increases downward in the direction of the arrow. A dashed line arrow indicates light incident on the printed product and a shape on the printed product indicates the intensity of light reflected from the incident point of the light to each angle. The upper left pattern of <figref idref="DRAWINGS">FIG. <b>4</b>(<i>a</i>)</figref> shows a gonio-spectral reflection characteristic of a blank sheet with no ink printed thereon. In this distribution, the reflection or the like has a small bias toward a specific direction and a change of brightness is small when viewed from any angle. The pattern of <figref idref="DRAWINGS">FIG. <b>4</b>(<i>c</i>)</figref> indicates a gonio-spectral reflection characteristic in the case of printing only with the color ink. Although a bias per angle is small like the pattern of <figref idref="DRAWINGS">FIG. <b>4</b>(<i>a</i>)</figref>, since the color ink absorbs light, the amount of reflection decreases as the amount of color ink increases. The pattern of <figref idref="DRAWINGS">FIG. <b>4</b>(<i>g</i>)</figref> indicates a gonio-spectral reflection characteristic in the case of printing only with the metallic ink. The metallic ink has high directivity and reflects strong light in the normal reflection direction. Due to the above characteristics, in a case where an observation angle is changed by the same amount from the normal reflection light to the diffuse direction, a change of brightness of the metallic ink is larger than that of the color ink. As a result, in a case where the metallic ink is observed with the light source reflected, it looks bright according to the brightness of the light source. However, since the metallic ink includes few components diffusing in directions other than the normal reflection direction, it looks dark in a case where the light source is not reflected.</p><p id="p-0029" num="0028">Both of the color ink and the metallic ink can generate intermediate characteristics by area coverage modulation like the patterns of <figref idref="DRAWINGS">FIGS. <b>4</b>(<i>b</i>) and <b>4</b>(<i>d</i>)</figref>. In a case where the color ink and the metallic ink are mixed like the patterns of <figref idref="DRAWINGS">FIGS. <b>4</b>(<i>e</i>), <b>4</b>(<i>f</i>), <b>4</b>(<i>h</i>), and <b>4</b>(<i>i</i>)</figref>, characteristics can be generated by combining the respective gonio-spectral reflection characteristics. Incidentally, in actuality, printing only with the color ink generally exhibits slightly strong reflection in the normal reflection direction as compared with the other directions, but the amount of reflection is smaller than that of the metallic ink and is therefore neglected for ease of explanation. Such a difference in gonio-spectral reflection characteristics is modeled as the bidirectional reflectance distribution function and the like and can be measured by a commercially available BRDF measurement device.</p><p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is a schematic diagram illustrating a mechanism to give a three-dimensional appearance to a printed product using the gonio-spectral reflection characteristics of the metallic ink. <figref idref="DRAWINGS">FIG. <b>5</b></figref> shows an example of a two-dimensional printed product in which an area expressing the surface A is printed with only the color ink and an area expressing the surface B is printed with both of the color and metallic inks. In the case of observation from an angle &#x3b8;<b>1</b>, the surfaces A and B are substantially equal in brightness. In contrast, in the case of observation from an angle &#x3b8;<b>2</b>, the surface B printed with the metallic ink makes a strong reflection in the normal reflection direction and is therefore perceived as being brighter than the surface A. In this manner, by associating a change of brightness with the amount of printing of the metallic ink, a change of brightness in the case of reflecting the light source simulates a change of geometric condition of the actual scene and the three-dimensional appearance can be perceived.</p><heading id="h-0010" level="2">Logical Configuration of Image Processing Apparatus <b>1</b></heading><p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is a diagram showing a logical configuration of the image processing apparatus <b>1</b>. The CPU <b>101</b> of the image processing apparatus <b>1</b> comprises a first image obtaining unit <b>601</b>, a second image obtaining unit <b>602</b>, a color conversion unit <b>603</b>, a gonio-spectral reflection characteristic determination unit <b>604</b>, a metallic ink amount determination unit <b>605</b>, a color ink amount determination unit <b>606</b>, and an output unit <b>607</b>.</p><p id="p-0032" num="0031">The first image obtaining unit <b>601</b> obtains first image data indicating a scene of a subject under a geometric condition. The second image obtaining unit <b>602</b> obtains second image data. The second image data is image data indicating a scene of the same subject as that of the first image data under a geometric condition different from that of the first image data. The color conversion unit <b>603</b> converts color information of the first image data and second image data into tristimulus values XYZ. The gonio-spectral reflection characteristic determination unit <b>604</b> determines a difference in brightness between the two images from the tristimulus values of the first image data and second image data. The metallic ink amount determination unit <b>605</b> determines the amount of metallic ink from the difference in brightness between the first image data and the second image data. The color ink amount determination unit <b>606</b> determines the amount of color ink based on the first image data and the amount of metallic ink. The output unit <b>607</b> outputs the determined amounts of metallic and color inks to the image forming apparatus <b>111</b>.</p><heading id="h-0011" level="2">Configuration of Image Forming Apparatus <b>111</b></heading><p id="p-0033" num="0032"><figref idref="DRAWINGS">FIG. <b>7</b></figref> is a configuration diagram of the image forming apparatus <b>111</b>. The image forming apparatus <b>111</b> in the present embodiment is, for example, an inkjet printer which forms an image by performing printing on a print medium with ink.</p><p id="p-0034" num="0033">The image forming apparatus <b>111</b> comprises a head cartridge <b>701</b>, a carriage <b>702</b>, a guide shaft <b>703</b>, a main scanning motor <b>704</b>, a motor pulley <b>705</b>, a driven pulley <b>706</b>, a timing belt <b>707</b>, a print medium <b>708</b>, and a conveying roller <b>709</b>. The image forming apparatus <b>111</b> also comprises an auto sheet feeder (hereinafter referred to as an ASF) <b>710</b>, a paper feed motor <b>711</b>, pickup rollers <b>712</b>, a line feed motor (hereinafter referred to as an LF motor) <b>713</b>, a sheet end sensor <b>714</b>, and a control unit <b>720</b>.</p><p id="p-0035" num="0034">The head cartridge <b>701</b> comprises a print head including a plurality of ejection ports and an ink tank which supplies ink to the print head. The head cartridge <b>701</b> is also equipped with a connector for receiving a signal or the like driving each ejection port of the print head. The ink tank is independently filled with five inks in total: color inks (cyan, magenta, yellow, and black) and a metallic ink.</p><p id="p-0036" num="0035">The head cartridge <b>701</b> is exchangeably mounted on the carriage <b>702</b> and the carriage <b>702</b> is provided with a connector holder for transferring a drive signal or the like to the head cartridge <b>701</b> via the connector. The carriage <b>702</b> is capable of reciprocal movement along the guide shaft <b>703</b>. More specifically, the carriage <b>702</b> is driven and its position and movement are controlled by drive mechanisms such as the motor pulley <b>705</b>, driven pulley <b>706</b>, and timing belt <b>707</b> using the main scanning motor <b>704</b> as a drive source. Incidentally, in the preset embodiment, the movement of the carriage <b>702</b> along the guide shaft <b>703</b> is referred to as &#x201c;main scan&#x201d; and the direction of the movement is referred to as &#x201c;main scanning direction.&#x201d;</p><p id="p-0037" num="0036">The print medium <b>708</b> such as a print sheet is placed on the ASF <b>710</b>. In image forming, the pickup rollers <b>712</b> are rotated via a gear by drive of the paper feed motor <b>711</b> and the print medium <b>708</b> is separated and fed from the ASF <b>710</b> one by one. The print medium <b>708</b> is further conveyed by rotation of the conveying roller <b>709</b> to a print start position facing an ejection port surface of the head cartridge <b>701</b> on the carriage <b>702</b>. The conveying roller <b>709</b> is driven via a gear using the LF motor <b>713</b> as a drive source. Whether the print medium <b>708</b> is fed is determined and a feeding position is defined at the time when the print medium <b>708</b> passes by the sheet end sensor <b>714</b>. The head cartridge <b>701</b> mounted on the carriage <b>702</b> is held such that the ejection port surface projects downward from the carriage <b>702</b> and is parallel to the print medium <b>708</b>. The control unit <b>720</b> includes a CPU, a storage unit, or the like. The control unit <b>720</b> receives data externally to form each of the layers described above and controls the operation of each part of the image forming apparatus <b>111</b> based on the data.</p><heading id="h-0012" level="2">Operation of Image Forming Apparatus <b>111</b></heading><p id="p-0038" num="0037">Image forming operation in the image forming apparatus <b>111</b> will be described below. In the present embodiment, an inkjet sheet in general use is used as the print medium <b>708</b>. First, in a case where the print medium <b>708</b> is conveyed to a predetermined print start position, the carriage <b>702</b> moves over the print medium <b>708</b> along the guide shaft <b>703</b>. During the movement, the metallic and color inks are ejected from the ejection ports of the print head. After the carriage <b>702</b> moves to one end of the guide shaft <b>703</b>, the conveying roller <b>709</b> conveys the print medium <b>708</b> by a predetermined amount in a direction orthogonal to the main scanning direction of the carriage <b>702</b>. In the present embodiment, the conveyance of the print medium <b>708</b> is referred to as &#x201c;sheet feeding&#x201d; or &#x201c;sub-scan&#x201d; and the direction of the conveyance is referred to as &#x201c;sheet feeding direction&#x201d; or &#x201c;sub-scanning direction.&#x201d; After the conveyance of the print medium <b>708</b> by the predetermined amount is finished, the carriage <b>702</b> moves again along the guide shaft <b>703</b>. In this manner, the scan and sheet feeding are repeated by the carriage <b>702</b> of the print head, whereby an image is formed on the print medium <b>708</b>.</p><p id="p-0039" num="0038"><figref idref="DRAWINGS">FIGS. <b>8</b>A to <b>8</b>E</figref> are diagrams illustrating operation of forming an image by the print head scanning the print medium <b>708</b>. In the present embodiment, as shown in <figref idref="DRAWINGS">FIGS. <b>8</b>A and <b>8</b>B</figref>, the carriage <b>702</b> performs a main scan to form a layer by a width L of the print head. Each time the printing of one line is finished, the print medium <b>708</b> is conveyed by the distance L in the sub-scanning direction.</p><p id="p-0040" num="0039">Incidentally, there is a case where so-called multi-pass printing is performed in order to suppress deterioration in image quality such as periodic unevenness caused by drive accuracy of the print head. <figref idref="DRAWINGS">FIGS. <b>8</b>C to <b>8</b>E</figref> show an example of dual-pass printing. In this example, the carriage <b>702</b> performs a main scan to form a layer by the width L of the print head and the print medium <b>708</b> is conveyed by a distance L/2 in the sub-scanning direction each time the printing of one line is finished. An area A is printed by the m<sup>th </sup>main scan (<figref idref="DRAWINGS">FIG. <b>8</b>C</figref>) and (m+1)<sup>th </sup>main scan (<figref idref="DRAWINGS">FIG. <b>8</b>D</figref>) of the print head. An area B is printed by the (m+1)<sup>th </sup>main scan (<figref idref="DRAWINGS">FIG. <b>8</b>D</figref>) and (m+2)<sup>th </sup>main scan (<figref idref="DRAWINGS">FIG. <b>8</b>E</figref>) of the print head.</p><p id="p-0041" num="0040">Although the operation of dual-pass printing is described, the number of passes used for printing can be changed according to desired accuracy. For example, in the case of performing n-pass printing, the print medium <b>708</b> is conveyed by a distance L/n in the sub-scanning direction each time the printing of one line is finished. Incidentally, the print medium <b>708</b> is not limited to paper and various materials can be used as long as a layer can be formed by the print head.</p><p id="p-0042" num="0041"><figref idref="DRAWINGS">FIG. <b>9</b></figref> is a schematic diagram showing expression of images controlled by an area coverage modulation method. In the present embodiment, it is assumed for ease of explanation that the print head is controlled by two values: ejection and non-ejection of an ink droplet. In the present embodiment, it is also assumed that on/off of ink is controlled for each pixel defined by an output resolution of the image forming apparatus <b>111</b> and that a state in which all pixels of a unit area are turned on is treated as an ink printing amount 100%. Incidentally, &#x201c;on&#x201d; indicates ejection of ink and &#x201c;off&#x201d; indicates non-ejection of ink. In such a binary printer, since a single pixel can express an ink printing amount only by 100% or 0%, a middle tone is expressed by a group of pixels.</p><p id="p-0043" num="0042">In the example shown in <figref idref="DRAWINGS">FIG. <b>9</b></figref>, instead of expressing a middle tone at a density of 25% as shown in the lower left of the drawing, ink is ejected to four pixels out of 16 pixels (4&#xd7;4 pixels) as shown in the lower right of the drawing to express 25% (4/16) in terms of an area. Other tones can also be expressed in the same manner. It should be noted that the total number of pixels, the pattern of pixels to be turned on, and the like to express a middle tone are not limited to those in the above example. The pattern of pixels to be turned on can be determined using periodic screen processing called halftone or error diffusion processing. It should also be noted that the above binarization processing can be expanded to multi-level quantization processing into modulable multiple levels and thereby applied to a print head capable of modulating an ink ejection amount and is not limited to binarization.</p><heading id="h-0013" level="2">Flowchart Executed by Image Processing Apparatus <b>1</b></heading><p id="p-0044" num="0043">As stated above, one of factors for enabling perception of a three-dimensional appearance in a printed product is the reproduction of a change of brightness caused by a change of a geometric condition such as a light source position or a camera posture. A description will be given of a method of determining a suitable amount of metallic ink used to reproduce a change of the geometric condition.</p><p id="p-0045" num="0044"><figref idref="DRAWINGS">FIG. <b>10</b></figref> is a flowchart showing the procedure for the image processing apparatus <b>1</b> outputting data for forming an image on a print medium to the image forming apparatus <b>111</b> in the present embodiment. Processing in each step of <figref idref="DRAWINGS">FIG. <b>10</b></figref> is performed by the CPU <b>101</b> of the image processing apparatus <b>1</b> loading a program code stored in the ROM <b>102</b> into the RAM <b>103</b> and executing the program code. Sign &#x201c;S&#x201d; in the description of the processing indicates a step in the flowchart.</p><p id="p-0046" num="0045">In S<b>1001</b>, the first image obtaining unit <b>601</b> first obtains, from an external device such as the HDD <b>113</b>, an image to be formed on a print medium, that is, first image data to be printed. A pixel value of a pixel position (x, y) is RGB<sub>1 </sub>(x, y). The first image data is an image having color information of 16 bits for each of red (R), green (G), and blue (B) values, 48 bits in total for each pixel. Pixel values of the first image data in the present embodiment are RGB values defined in a sRGB space. It is also possible to use other generally used images such as an RGB image defined by Adobe RGB, a Lab image conforming to CIELAB, and an HSV image consisting of hue, saturation, and brightness. Incidentally, the pixel position (x, y) indicates a pixel position in an image in a case where a horizontal coordinate of a pixel is x and a vertical coordinate of a pixel is y.</p><p id="p-0047" num="0046">In S<b>1002</b>, the second image obtaining unit <b>602</b> obtains, from an external device such as the HDD <b>113</b>, second image data RGB<sub>2 </sub>(x, y) indicating an image to be formed on a print medium. Like the first image data, the second image data also has 16-bit RGB values for each color defined in the sRGB space. As described above, the first image data and the second image data are images indicating scenes of the same subject under different geometric conditions. More specifically, one image shows a condition that light in the normal reflection direction is reflected and the other is an image in which light in the diffuse direction is reflected.</p><p id="p-0048" num="0047">In S<b>1003</b>, the color conversion unit <b>603</b> converts each of the first image data obtained by the first image obtaining unit <b>601</b> and the second image data obtained by the second image obtaining unit <b>602</b> into a tristimulus value XYZ. The color conversion unit <b>603</b> converts the pixel values RGB<sub>1 </sub>(x, y) and RGB<sub>2 </sub>(x, y), which are RGB values, into tristimulus values (XYZ values) defined in a CIE 1913 XYZ color space. More specifically, the converted pixel values XYZ<sub>1 </sub>(x, y) and XYZ<sub>2 </sub>(x, y) are calculated based on the following formulas (1) and (2):</p><p id="p-0049" num="0000"><maths id="MATH-US-00001" num="00001"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <mrow>      <msub>       <mi>R</mi>       <mi>L</mi>      </msub>      <mo>=</mo>      <mrow>       <mi>degamma</mi>       <mo>&#x2062;</mo>       <mtext>   </mtext>       <mrow>        <mo>(</mo>        <mi>R</mi>        <mo>)</mo>       </mrow>      </mrow>     </mrow>     <mo>&#x2062;</mo>     <mtext></mtext>     <mrow>      <msub>       <mi>G</mi>       <mi>L</mi>      </msub>      <mo>=</mo>      <mrow>       <mi>degamma</mi>       <mo>&#x2062;</mo>       <mtext>   </mtext>       <mrow>        <mo>(</mo>        <mi>G</mi>        <mo>)</mo>       </mrow>      </mrow>     </mrow>     <mo>&#x2062;</mo>     <mtext></mtext>     <mrow>      <msub>       <mi>B</mi>       <mi>L</mi>      </msub>      <mo>=</mo>      <mrow>       <mi>degamma</mi>       <mo>&#x2062;</mo>       <mtext>   </mtext>       <mrow>        <mo>(</mo>        <mi>B</mi>        <mo>)</mo>       </mrow>      </mrow>     </mrow>    </mrow>   </mtd>   <mtd>    <mrow>     <mi>Formula</mi>     <mo>&#x2062;</mo>     <mtext>   </mtext>     <mrow>      <mo>(</mo>      <mn>1</mn>      <mo>)</mo>     </mrow>    </mrow>   </mtd>  </mtr> </mtable></math></maths><maths id="MATH-US-00001-2" num="00001.2"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <mrow>      <mo>(</mo>      <mtable>       <mtr>        <mtd>         <mi>X</mi>        </mtd>       </mtr>       <mtr>        <mtd>         <mi>Y</mi>        </mtd>       </mtr>       <mtr>        <mtd>         <mi>Z</mi>        </mtd>       </mtr>      </mtable>      <mo>)</mo>     </mrow>     <mo>=</mo>     <mrow>      <mi>M</mi>      <mo>&#x2061;</mo>      <mo>(</mo>      <mtable>       <mtr>        <mtd>         <msub>          <mi>R</mi>          <mi>L</mi>         </msub>        </mtd>       </mtr>       <mtr>        <mtd>         <msub>          <mi>G</mi>          <mi>L</mi>         </msub>        </mtd>       </mtr>       <mtr>        <mtd>         <msub>          <mi>B</mi>          <mi>L</mi>         </msub>        </mtd>       </mtr>      </mtable>      <mo>)</mo>     </mrow>    </mrow>   </mtd>   <mtd>    <mrow>     <mi>Formula</mi>     <mo>&#x2062;</mo>     <mtext>   </mtext>     <mrow>      <mo>(</mo>      <mn>2</mn>      <mo>)</mo>     </mrow>    </mrow>   </mtd>  </mtr> </mtable></math></maths></p><p id="p-0050" num="0048">In the above formulas, R, G, and B are R, G, and B values constituting RGB<sub>1 </sub>(x, y) and RGB<sub>2 </sub>(x, y). The gamma characteristics corresponding to standard display characteristics are applied to a RGB value defined in the sRGB space. Degamma is a function to transform the R, G, and B values into linear R, G, and B values R<sub>L</sub>, G<sub>L</sub>, and B<sub>L </sub>linear with respect to X, Y, and Z values to be described later. X, Y, and Z are X, Y, and Z values constituting XYZ<sub>1 </sub>(x, y) and XYZ<sub>2 </sub>(x, y). M is a transformation matrix which transforms linear R, G, and B values defined in the sRGB space into X, Y, and Z values defined in the CIE 1913 XYZ color space.</p><p id="p-0051" num="0049">In S<b>1004</b>, the gonio-spectral reflection characteristic determination unit <b>604</b> determines a gonio-spectral reflection characteristic using a Y value indicating brightness out of the X, Y, and Z values of each of the first image data and the second image data. In the present embodiment, a difference in brightness in the case of a change from the first image data to the second image data is calculated. Accordingly, a gonio-spectral reflection characteristic &#x394;Y can be calculated by obtaining a difference between the Y value of the first image data and the Y value of the second image data as shown in the following formula (3):</p><p id="p-0052" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?>&#x394;<i>Y=Y</i><sub>1</sub><i>&#x2212;Y</i><sub>2</sub>&#x2003;&#x2003;Formula (3)<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0053" num="0050">In S<b>1005</b>, the metallic ink amount determination unit <b>605</b> calculates a metallic ink amount Me (x, y) based on Y<sub>1 </sub>(x, y), Y<sub>2 </sub>(x, y), and the gonio-spectral reflection characteristic &#x394;Y obtained by the formula (3), using the formula (4):</p><p id="p-0054" num="0000"><maths id="MATH-US-00002" num="00002"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <mrow>      <mi>Me</mi>      <mo>&#x2061;</mo>      <mo>(</mo>      <mrow>       <mi>x</mi>       <mo>,</mo>       <mi>y</mi>      </mrow>      <mo>)</mo>     </mrow>     <mo>=</mo>     <mfrac>      <mrow>       <mrow>        <mi>&#x394;</mi>        <mo>&#x2062;</mo>        <mrow>         <mi>Y</mi>         <mo>&#x2061;</mo>         <mo>(</mo>         <mrow>          <mi>x</mi>          <mo>,</mo>          <mi>y</mi>         </mrow>         <mo>)</mo>        </mrow>       </mrow>       <mo>-</mo>       <mrow>        <mi>&#x394;</mi>        <mo>&#x2062;</mo>        <msub>         <mi>Y</mi>         <mi>min</mi>        </msub>       </mrow>      </mrow>      <mrow>       <mrow>        <mi>&#x394;</mi>        <mo>&#x2062;</mo>        <msub>         <mi>Y</mi>         <mi>max</mi>        </msub>       </mrow>       <mo>-</mo>       <mrow>        <mi>&#x394;</mi>        <mo>&#x2062;</mo>        <msub>         <mi>Y</mi>         <mi>min</mi>        </msub>       </mrow>      </mrow>     </mfrac>    </mrow>   </mtd>   <mtd>    <mrow>     <mi>Formula</mi>     <mo>&#x2062;</mo>     <mtext>   </mtext>     <mrow>      <mo>(</mo>      <mn>4</mn>      <mo>)</mo>     </mrow>    </mrow>   </mtd>  </mtr> </mtable></math></maths></p><p id="p-0055" num="0051">In the above formula, &#x394;Y<sub>max </sub>is a maximum value of &#x394;Y (x, y) and &#x394;Y<sub>min </sub>is a minimum value of &#x394;Y (x, y). The formula (4) is general normalization processing, where the maximum value of Me is 1 and the minimum value thereof is 0. The maximum value 1 corresponds to an area ratio 100% and the minimum value 0 corresponds to an area ratio 0% in the area coverage modulation shown in <figref idref="DRAWINGS">FIG. <b>9</b></figref>. That is, in the case of a change from the first image data to the second image data, the processing increases the amount of metallic ink for use along with the brightness for each coordinate. In short, the large amount of metallic ink is applied to coordinates to be bright and no metallic ink is applied to coordinates to be dark. Although the relationship between &#x394;Y and the metallic ink amount Me is linear in the present embodiment, it is also possible to use an appropriate function or lookup table (LUT) process to adjust tone characteristics or the maximum and minimum values of the metallic ink amount Me.</p><p id="p-0056" num="0052">In S<b>1006</b>, the color ink amount determination unit <b>606</b> determines color ink amounts C, M, Y, and K based on XYZ<sub>1</sub>, which is the XYZ value of the first image data determined by the color conversion unit <b>603</b>, and the metallic ink amount Me determined by the metallic ink amount determination unit <b>605</b>. Here, the first image is treated as a target value in an observation environment under little influence of normal reflection light and the color ink amounts are determined in consideration of the influence of a diffuse color of the metallic ink determined in advance. First, XYZ<sub>color</sub>, which is an XYZ value in the color ink, is determined by the following formula (5):</p><p id="p-0057" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>XYZ</i><sub>color</sub><i>=XYZ</i><sub>1</sub><i>/XYZ</i><sub>Me</sub>&#x2003;&#x2003;Formula (5)<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0058" num="0053">In the above formula, XYZ<sub>Me </sub>is an XYZ value indicating the diffuse color of the metallic ink. XYZ<sub>Me </sub>can be determined by, for example, storing the relationship between the metallic ink amount Me and a colorimetric value as a LUT in advance by a 0&#xb0;/45&#xb0; colorimeter excluding the influence of normal reflection light. In a case where a color development model capable of obtaining an XYZ value of a printed product by multiplying the XYZ value of the metallic ink by the XYZ value of the color ink is established, a necessary XYZ value in the color ink can be obtained by dividing the target value XYZ<sub>1 </sub>by XYZ<sub>Me</sub>. Incidentally, this step is performed to adjust the amount of color ink because the brightness of the diffusion light is reduced by the amount of metallic ink applied. In order to determine the color ink values C, M, Y, and K from XYZ<sub>color</sub>, various general methods such as a method of using a LUT prepared in advance can be used. In a case where the determined XYZ<sub>color </sub>cannot be reproduced, it is only necessary to put it in the reproducible range by clipping or the like. Alternatively, a method of adjusting the amount of metallic ink can also be considered in order to put XYZ<sub>color </sub>in the reproducible range.</p><p id="p-0059" num="0054">In S<b>1007</b>, the output unit <b>607</b> outputs, to the external image forming apparatus <b>111</b>, the metallic ink amount Me determined by the metallic ink amount determination unit <b>605</b> and the color ink amounts C, M, Y, and K determined by the color ink amount determination unit <b>606</b>, and finishes the processing.</p><p id="p-0060" num="0055">As described above, according to the present embodiment, a three-dimensional appearance can be suitably given to an object or subject to be reproduced as an image. More specifically, a change of brightness of light reflected on the subject due to a difference in light source position can be reproduced by printing a printed product using the metallic ink based on the above flowchart. This makes it possible to form such a printed product that the first image data is reproduced like a conventional printed product in an observation environment in which a main light source is not reflected and the amount of change of brightness is controlled for each position of the image in an observation environment in which the main light source is intentionally reflected. As a result, a change of brightness of a three-dimensional object according to the geometric condition can be simulated in a two-dimensional image and a suitable three-dimensional appearance can be given to an object or subject to be reproduced as an image.</p><p id="p-0061" num="0056">Incidentally, each of the ink amounts C, M, Y, K, and Me may be determined at the stage of calculation of XYZ<sub>1 </sub>and XYZ<sub>2 </sub>by the formula (2) by referring to a preset LUT describing correspondence between X<sub>1</sub>, Y<sub>1</sub>, Z<sub>1</sub>, and Y<sub>2 </sub>and each of the ink amounts C, M, Y, K, and Me.</p><heading id="h-0014" level="1">Second Embodiment</heading><p id="p-0062" num="0057">In the first embodiment, an example of inputting two types of image data and determining the amount of metallic ink applied from a difference in brightness between the two types of image data has been described. In the present embodiment, a description will be given of an example of determining an ink amount by generating virtual second image data different in geometric condition from first image data.</p><p id="p-0063" num="0058">The description of commonalities with the first embodiment will be omitted or simplified and differences will be mainly described below.</p><heading id="h-0015" level="2">Logical Configuration of Image Processing Apparatus <b>1</b></heading><p id="p-0064" num="0059"><figref idref="DRAWINGS">FIG. <b>11</b></figref> is a diagram showing a logical configuration of an image processing apparatus <b>1</b> in the present embodiment. The image processing apparatus <b>1</b> comprises a first image obtaining unit <b>1101</b>, a normal information obtaining unit <b>1102</b>, a light source setting unit <b>1103</b>, a reflectance determination unit <b>1104</b>, a second image determination unit <b>1105</b>, a color conversion unit <b>1106</b>, an ink amount determination unit <b>1107</b>, and an output unit <b>1108</b>.</p><p id="p-0065" num="0060">The first image obtaining unit <b>1101</b> obtains first image data indicating a scene of a subject under a geometric condition. The normal information obtaining unit <b>1102</b> obtains normal information on the subject in the first image data. The normal information is information indicating a direction of a microfacet of a three-dimensional subject reproduced by each coordinate of the first image. The light source setting unit <b>1103</b> sets light source information on scenes indicated by the first image data and second image data to be described later. The light source information is information indicating a direction of a light source toward the subject. The reflectance determination unit <b>1104</b> determines a reflectance of the subject from the first image data, the normal information, and the light source information. The second image determination unit <b>1105</b> generates second image data from the normal information, the light source information, and the reflectance of the subject. The color conversion unit <b>1106</b> converts color information of the first image data and second image data into tristimulus values XYZ. The ink amount determination unit <b>1107</b> determines ink amount data on each color from the tristimulus values of the first image data and second image data. The output unit <b>1108</b> outputs the determined ink amount data to the image forming apparatus <b>111</b>.</p><heading id="h-0016" level="2">Flowchart Executed by Image Processing Apparatus <b>1</b></heading><p id="p-0066" num="0061"><figref idref="DRAWINGS">FIG. <b>12</b></figref> is a flowchart showing the procedure for the image processing apparatus <b>1</b> outputting data for forming an image on a print medium to the image forming apparatus <b>111</b> in the present embodiment. Processing in each step of <figref idref="DRAWINGS">FIG. <b>12</b></figref> is performed by the CPU <b>101</b> of the image processing apparatus <b>1</b> loading a program code stored in the ROM <b>102</b> into the RAM <b>103</b> and executing the program code. Sign &#x201c;S&#x201d; in the description of the processing indicates a step in the flowchart.</p><p id="p-0067" num="0062">In S<b>1201</b>, the first image obtaining unit <b>1101</b> first obtains first image data RGB<sub>1 </sub>(x, y). Since the first image obtaining unit <b>1101</b> is identical to the first image obtaining unit <b>601</b> in the first embodiment, a detailed explanation thereof is omitted.</p><p id="p-0068" num="0063">In S<b>1202</b>, the normal information obtaining unit <b>1102</b> obtains, from an external device such as the HDD <b>113</b>, a normal vector corresponding to the first image data: {right arrow over (n)}(x, y)</p><p id="p-0069" num="0064">In the description below, the vector will be denoted as n (x, y) omitting the arrow (except for the formulas).</p><p id="p-0070" num="0065">Here, the normal n is a three-dimensional vector indicating a direction of a microfacet of the three-dimensional subject reproduced in each of coordinates x, y of the first image. Accordingly, the normal information can be obtained by the use of a stereo camera or the like simultaneously with the capturing of the first image. Alternatively, the normal information can be obtained from a 3D CG model together with a rendered image.</p><p id="p-0071" num="0066">In S<b>1203</b>, the light source setting unit <b>1103</b> sets a light source vector in the scene indicated by the first image:</p><p id="p-0072" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?>{right arrow over (<i>L</i><sub>1</sub>)}<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0073" num="0067">In the description below, the vector will be denoted as L<sub>1 </sub>omitting the arrow (except for the formulas). The light source vector L<sub>1 </sub>is a three-dimensional vector indicating a direction from which a light source illuminates the subject. For example, like the normal information, the direction of the main light source can be acquired by obtaining an omnidirectional luminance distribution of the scene by the use of a fish-eye lens or the like at the time of capturing. Alternatively, as mentioned in S<b>1202</b>, the information can be obtained from a 3D CG model. A method of providing an arbitrary value by a user is also considered. In the present embodiment, the information does not necessarily have to be precise as long as a change of brightness under different geometric conditions can be reproduced and a three-dimensional appearance can be perceived. For example, the light source direction may be set in advance at the same position as the camera, that is, a direction orthogonal to the captured two-dimensional image.</p><p id="p-0074" num="0068">In S<b>1204</b>, the reflectance determination unit <b>1104</b> calculates a reflectance Ref (x, y) of the subject of the first image using the following formula (6):</p><p id="p-0075" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?>Ref=<i>I</i><sub>1</sub>/({right arrow over (<i>L</i><sub>1</sub>)}&#xb7;<i>{right arrow over (n)}</i>)&#x2003;&#x2003;Formula (6)<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0076" num="0069">In the above formula, I<sub>1 </sub>indicates the brightness of the first image and consists of linear R, G, and B values R<sub>L</sub>, G<sub>L</sub>, and B<sub>L </sub>obtained by converting RGB<sub>1 </sub>based on the formula (1). The reflectance Ref consists of reflectances R<sub>RL</sub>, R<sub>GL</sub>, and R<sub>BL </sub>for the respective three channels of the linear R, G, and B values R<sub>L</sub>, G<sub>L</sub>, and B<sub>L </sub>of the brightness I<sub>1 </sub>of the image. L<sub>1</sub>&#xb7;n indicates the inner product of the light source vector L<b>1</b> and the normal vector n. This means that the reflectance is calculated backward using a model in which the brightness of the first image is determined by reflection light in a so-called diffuse direction obtained from &#x201c;an angle between a light source and a normal&#x201d; and &#x201c;a reflectance of a subject.&#x201d;</p><p id="p-0077" num="0070">In S<b>1205</b>, the light source setting unit <b>1103</b> arbitrarily sets a light source vector L<sub>2 </sub>of second image data. Since the light source vector L<sub>2 </sub>does not necessarily have to be precise information like the light source vector L<sub>1 </sub>explained above, it is also possible to preset a vector at a predetermined angle with the light source vector L<sub>1</sub>.</p><p id="p-0078" num="0071">In S<b>1206</b>, the second image determination unit <b>1105</b> calculates second image data I<sub>2 </sub>using the following formula (7):</p><p id="p-0079" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>I</i><sub>2</sub>=Ref&#xb7;{right arrow over (<i>L</i><sub>2</sub>)}&#xb7;<i>{right arrow over (n)};</i>&#x2003;&#x2003;Formula (7)<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0080" num="0072">In the above formula, I<sub>2 </sub>indicates the brightness of the second image and consists of linear R, G, and B values R<sub>L</sub>, G<sub>L</sub>, and B<sub>L</sub>.</p><p id="p-0081" num="0073">In <b>51207</b>, the ink amount determination unit <b>1107</b> determines color ink amounts C, M, Y, and K and a metallic ink amount Me. More specifically, the color conversion unit <b>1106</b> first converts the brightness I<sub>1 </sub>of the first image and the brightness I<sub>2 </sub>of the second image into XYZ<sub>1 </sub>and XYZ<sub>2</sub>, respectively, based on the formula (2). In the present embodiment, the ink amounts C, M, Y, K, and Me are determined by referring to a preset LUT describing the correspondence between X<sub>1</sub>, Y<sub>1</sub>, Z<sub>1</sub>, and Y<sub>2 </sub>and each of the ink amounts C, M, Y, K, and Me. The ink amounts may be determined by the same method as the first embodiment using XYZ<sub>1 </sub>and XYZ<sub>2</sub>.</p><p id="p-0082" num="0074">In S<b>1208</b>, the output unit <b>1108</b> outputs the ink amounts C, M, Y, K, and Me to the external image forming apparatus <b>111</b>.</p><p id="p-0083" num="0075">As described above, according to the present embodiment, a suitable three-dimensional appearance can be given without inputting two types of image data by generating virtual second image data different in geometric condition from first image data.</p><heading id="h-0017" level="1">Other Embodiments</heading><p id="p-0084" num="0076">In the embodiments described above, the metallic ink is used as an ink having a bias in gonio-spectral reflection characteristics. The same advantageous result can also be produced by using a so-called gloss-controlled ink such as a clear ink which smooths the surface of a print and strengthens normal reflection light or a high refractive ink which obtains strong normal reflection light using a material having a high refractive index.</p><p id="p-0085" num="0077">In the first embodiment, in the step of determining color ink amounts, the XYZ value for the color ink is determined according to the color development model combining XYZ values. Other color development models or simulations suitable for an image forming apparatus in use can also be used.</p><p id="p-0086" num="0078">In the second embodiment, a simple model using a light source vector, a normal vector, and a reflectance is described as a model for determining reflection light. As a different method, it is also possible to use a different model using specular reflection light used in computer graphics, environment light called ambient light, or the like.</p><p id="p-0087" num="0079">In the step of ink amount determination in the second embodiment, X<sub>1</sub>, Y<sub>1</sub>, Z<sub>1</sub>, and Y<sub>2 </sub>are input to the LUT. However, Y<sub>2 </sub>can be replaced with &#x394;Y, norm&#x394;Y obtained by normalizing &#x394;Y, or the like. In addition, a method of using a LUT to which X<sub>1</sub>, Y<sub>1</sub>, Z<sub>1</sub>, X<sub>2</sub>, Y<sub>2</sub>, and Z<sub>2 </sub>are input in consideration of the tint of the second image instead of the change of brightness information is also considered. Alternatively, it is also possible to use a Lab value, HSV value, or RGB value obtained by color conversion of the above values.</p><p id="p-0088" num="0080">Embodiment(s) of the present invention can also be realized by a computer of a system or apparatus that reads out and executes computer executable instructions (e.g., one or more programs) recorded on a storage medium (which may also be referred to more fully as a &#x2018;non-transitory computer-readable storage medium&#x2019;) to perform the functions of one or more of the above-described embodiment(s) and/or that includes one or more circuits (e.g., application specific integrated circuit (ASIC)) for performing the functions of one or more of the above-described embodiment(s), and by a method performed by the computer of the system or apparatus by, for example, reading out and executing the computer executable instructions from the storage medium to perform the functions of one or more of the above-described embodiment(s) and/or controlling the one or more circuits to perform the functions of one or more of the above-described embodiment(s). The computer may comprise one or more processors (e.g., central processing unit (CPU), micro processing unit (MPU)) and may include a network of separate computers or separate processors to read out and execute the computer executable instructions. The computer executable instructions may be provided to the computer, for example, from a network or the storage medium. The storage medium may include, for example, one or more of a hard disk, a random-access memory (RAM), a read only memory (ROM), a storage of distributed computing systems, an optical disk (such as a compact disc (CD), digital versatile disc (DVD), or Blu-ray Disc (BD)&#x2122;), a flash memory device, a memory card, and the like.</p><p id="p-0089" num="0081">While the present invention has been described with reference to exemplary embodiments, it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.</p><p id="p-0090" num="0082">This application claims the benefit of Japanese Patent Application No. 2021-110121, filed Jul. 1, 2021, which is hereby incorporated by reference wherein in its entirety.</p><?detailed-description description="Detailed Description" end="tail"?></description><us-math idrefs="MATH-US-00001 MATH-US-00001-2" nb-file="US20230004768A1-20230105-M00001.NB"><img id="EMI-M00001" he="20.07mm" wi="76.20mm" file="US20230004768A1-20230105-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00002" nb-file="US20230004768A1-20230105-M00002.NB"><img id="EMI-M00002" he="6.01mm" wi="76.20mm" file="US20230004768A1-20230105-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-claim-statement>What is claimed is:</us-claim-statement><claims id="claims"><claim id="CLM-00001" num="00001"><claim-text><b>1</b>. An image processing apparatus generating data for forming an image on a print medium,<claim-text>the image processing apparatus comprising:</claim-text><claim-text>a first obtaining unit configured to obtain first image data to be printed;</claim-text><claim-text>a second obtaining unit configured to obtain second image data indicating a subject identical to that of the first image data and expressed by a geometric condition different from that of the first image data; and</claim-text><claim-text>a first determination unit configured to determine ink amounts of respective inks including a first ink and a second ink based on brightness at each position of the first image data and the second image data,</claim-text><claim-text>wherein the image is printed using the first ink which reflects light in a normal reflection direction at an intensity different from an intensity of light reflected in a diffuse direction in a case where light is made incident at a predetermined angle on the first ink provided on the medium, and the second ink which is different from the first ink and has a ratio of an intensity of light reflected in the normal reflection direction to an intensity of light reflected in the diffuse direction smaller than that of the first ink in a case where light is made incident at the predetermined angle on the second ink provided on the medium.</claim-text></claim-text></claim><claim id="CLM-00002" num="00002"><claim-text><b>2</b>. The image processing apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising a second determination unit configured to determine a gonio-spectral reflection characteristic indicating an intensity of brightness of each position of an image based on the first image data and the second image data,<claim-text>wherein the first determination unit determines the ink amounts of the respective inks using the gonio-spectral reflection characteristic determined by the second determination unit.</claim-text></claim-text></claim><claim id="CLM-00003" num="00003"><claim-text><b>3</b>. The image processing apparatus according to <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein the gonio-spectral reflection characteristic includes information on brightness of at least two types of image data expressed by different geometric conditions.</claim-text></claim><claim id="CLM-00004" num="00004"><claim-text><b>4</b>. The image processing apparatus according to <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein the second determination unit determines information on brightness in the normal reflection direction from one of the first image data and the second image data and determines information on brightness in the diffuse direction from the other of the first image data and the second image data.</claim-text></claim><claim id="CLM-00005" num="00005"><claim-text><b>5</b>. The image processing apparatus according to <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein the second determination unit determines the gonio-spectral reflection characteristic from a difference in brightness between the first image data and the second image data.</claim-text></claim><claim id="CLM-00006" num="00006"><claim-text><b>6</b>. The image processing apparatus according to <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein the first determination unit determines an ink amount of the first ink based on the gonio-spectral reflection characteristic and determines an ink amount of the second ink based on the first image data or the second image data and the determined ink amount of the first ink.</claim-text></claim><claim id="CLM-00007" num="00007"><claim-text><b>7</b>. The image processing apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein in a case of a change from the first image data to the second image data, the first determination unit increases a use amount of the first ink according to brightness of each coordinate.</claim-text></claim><claim id="CLM-00008" num="00008"><claim-text><b>8</b>. The image processing apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the second obtaining unit obtains second image data in which a light source is set at an arbitrary position different from a position of the light source in the first image data using a reflectance which can be expressed by information on brightness included in the first image data and light source information and normal information corresponding to the first image data.</claim-text></claim><claim id="CLM-00009" num="00009"><claim-text><b>9</b>. The image processing apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the first determination unit determines the respective ink amounts using a lookup table having a function which receives input of information on brightness of the first image data and the second image data and outputs the respective ink amounts.</claim-text></claim><claim id="CLM-00010" num="00010"><claim-text><b>10</b>. The image processing apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the first ink includes at least one of a metallic ink, a gross-controlled ink, and a high refractive ink.</claim-text></claim><claim id="CLM-00011" num="00011"><claim-text><b>11</b>. The image processing apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the second ink is a color ink including CMYK.</claim-text></claim><claim id="CLM-00012" num="00012"><claim-text><b>12</b>. An image processing method of generating data for forming an image on a print medium,<claim-text>the image processing method comprising:</claim-text><claim-text>obtaining first image data to be printed;</claim-text><claim-text>obtaining second image data indicating a subject identical to that of the first image data and expressed by a geometric condition different from that of the first image data; and</claim-text><claim-text>determining ink amounts of respective inks including a first ink and a second ink based on brightness at each position of the first image data and the second image data,</claim-text><claim-text>wherein the image is printed using the first ink which reflects light in a normal reflection direction at an intensity different from an intensity of light reflected in a diffuse direction in a case where light is made incident at a predetermined angle on the first ink provided on the medium, and the second ink which is different from the first ink and has a ratio of an intensity of light reflected in the normal reflection direction to an intensity of light reflected in the diffuse direction smaller than that of the first ink in a case where light is made incident at the predetermined angle on the second ink provided on the medium.</claim-text></claim-text></claim><claim id="CLM-00013" num="00013"><claim-text><b>13</b>. The image processing method according to <claim-ref idref="CLM-00012">claim 12</claim-ref>, further comprising determining a gonio-spectral reflection characteristic indicating an intensity of brightness of each position of an image based on the first image data and the second image data,<claim-text>wherein determining the ink amounts of the respective inks determines the ink amounts of the respective inks by using the gonio-spectral reflection characteristic determined by determining the gonio-spectral reflection characteristic.</claim-text></claim-text></claim><claim id="CLM-00014" num="00014"><claim-text><b>14</b>. The image processing method according to <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein the gonio-spectral reflection characteristic includes information on brightness of at least two types of image data expressed by different geometric conditions.</claim-text></claim><claim id="CLM-00015" num="00015"><claim-text><b>15</b>. The image processing method according to <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein determining the gonio-spectral reflection characteristic determines information on brightness in the normal reflection direction from one of the first image data and the second image data and determines information on brightness in the diffuse direction from the other of the first image data and the second image data.</claim-text></claim><claim id="CLM-00016" num="00016"><claim-text><b>16</b>. The image processing method according to <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein determining the gonio-spectral reflection characteristic determines the gonio-spectral reflection characteristic from a difference in brightness between the first image data and the second image data.</claim-text></claim><claim id="CLM-00017" num="00017"><claim-text><b>17</b>. The image processing method according to <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein determining the ink amounts of the respective inks determines an ink amount of the first ink based on the gonio-spectral reflection characteristic and determines an ink amount of the second ink based on the first image data or the second image data and the determined ink amount of the first ink.</claim-text></claim><claim id="CLM-00018" num="00018"><claim-text><b>18</b>. The image processing method according to <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein in a case of a change from the first image data to the second image data, determining the ink amounts of the respective inks increases a use amount of the first ink according to brightness of each coordinate.</claim-text></claim><claim id="CLM-00019" num="00019"><claim-text><b>19</b>. The image processing method according to <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein determining the gonio-spectral reflection characteristic obtains second image data in which a light source is set at an arbitrary position different from a position of the light source in the first image data using a reflectance which can be expressed by information on brightness included in the first image data and light source information and normal information corresponding to the first image data.</claim-text></claim><claim id="CLM-00020" num="00020"><claim-text><b>20</b>. A non-transitory computer-readable storage medium storing a program which causes a computer to function as an image processing apparatus generating data for forming an image on a print medium,<claim-text>the program causing the computer to function as:</claim-text><claim-text>a first obtaining unit configured to obtain first image data to be printed;</claim-text><claim-text>a second obtaining unit configured to obtain second image data indicating a subject identical to that of the first image data and expressed by a geometric condition different from that of the first image data; and</claim-text><claim-text>a first determination unit configured to determine ink amounts of respective inks including a first ink and a second ink based on brightness at each position of the first image data and the second image data,</claim-text><claim-text>wherein the image is printed using the first ink which reflects light in a normal reflection direction at an intensity different from an intensity of light reflected in a diffuse direction in a case where light is made incident at a predetermined angle on the first ink provided on the medium, and the second ink which is different from the first ink and has a ratio of an intensity of light reflected in the normal reflection direction to an intensity of light reflected in the diffuse direction smaller than that of the first ink in a case where light is made incident at the predetermined angle on the second ink provided on the medium.</claim-text></claim-text></claim></claims></us-patent-application>