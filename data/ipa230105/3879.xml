<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230003880A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230003880</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17364011</doc-number><date>20210630</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>01</class><subclass>S</subclass><main-group>15</main-group><subgroup>04</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>01</class><subclass>S</subclass><main-group>15</main-group><subgroup>04</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc></classifications-cpc><invention-title id="d2e43">Ultrasonic Equalization and Gain Control for Smart Speakers</invention-title><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="obligated-assignee"><addressbook><orgname>Texas Instruments Incorporated</orgname><address><city>Dallas</city><state>TX</state><country>US</country></address></addressbook><residence><country>US</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>Ding</last-name><first-name>Lei</first-name><address><city>Plano</city><state>TX</state><country>US</country></address></addressbook></inventor><inventor sequence="01" designation="us-only"><addressbook><last-name>Ramaswamy</last-name><first-name>Srinath Mathur</first-name><address><city>Murphy</city><state>TX</state><country>US</country></address></addressbook></inventor><inventor sequence="02" designation="us-only"><addressbook><last-name>Burk</last-name><first-name>Brian</first-name><address><city>Dallas</city><state>TX</state><country>US</country></address></addressbook></inventor><inventor sequence="03" designation="us-only"><addressbook><last-name>Haroun</last-name><first-name>Baher</first-name><address><city>Allen</city><state>TX</state><country>US</country></address></addressbook></inventor></inventors></us-parties></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">Ultrasonic audio processing circuitry and a method useful in ultrasonic presence detection. An ultrasonic burst generator produces an ultrasonic burst signal at one or more ultrasonic frequencies, and an equalizer equalizes that ultrasonic burst signal according to frequency response characteristics of the speaker and microphone at those ultrasonic frequencies. Driver circuitry drives a speaker with the ultrasonic burst signal, which may be combined with an audible audio signal. An ultrasonic separation filter separates an ultrasonic portion from a signal received at a microphone, and processing circuitry is provided to determine a delay time of an echo corresponding to the ultrasonic burst signal in that separated ultrasonic portion of the received signal. In another aspect, the equalizer equalizes an ultrasonic portion of the signal received at a microphone, according to frequency response characteristics of the speaker and microphone at the ultrasonic frequencies of the burst.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="107.61mm" wi="158.75mm" file="US20230003880A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="206.93mm" wi="161.88mm" orientation="landscape" file="US20230003880A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="208.11mm" wi="150.28mm" orientation="landscape" file="US20230003880A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="223.35mm" wi="89.24mm" orientation="landscape" file="US20230003880A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="141.65mm" wi="158.50mm" orientation="landscape" file="US20230003880A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00005" num="00005"><img id="EMI-D00005" he="238.34mm" wi="168.74mm" orientation="landscape" file="US20230003880A1-20230105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00006" num="00006"><img id="EMI-D00006" he="118.62mm" wi="134.20mm" orientation="landscape" file="US20230003880A1-20230105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00007" num="00007"><img id="EMI-D00007" he="147.32mm" wi="171.28mm" orientation="landscape" file="US20230003880A1-20230105-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00008" num="00008"><img id="EMI-D00008" he="216.15mm" wi="56.64mm" orientation="landscape" file="US20230003880A1-20230105-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00009" num="00009"><img id="EMI-D00009" he="165.18mm" wi="160.53mm" orientation="landscape" file="US20230003880A1-20230105-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00010" num="00010"><img id="EMI-D00010" he="248.67mm" wi="179.07mm" orientation="landscape" file="US20230003880A1-20230105-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00011" num="00011"><img id="EMI-D00011" he="242.99mm" wi="168.74mm" orientation="landscape" file="US20230003880A1-20230105-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0001" level="1">BACKGROUND</heading><p id="p-0002" num="0001">This relates to presence and motion detection, and is more specifically directed to ultrasonic presence and motion detection.</p><p id="p-0003" num="0002">Various technologies have been used to detect the presence and motion of objects, including human occupants of a room or other space. These technologies include those relying on two-way radio communication, such as those using radio frequency (RF) radar techniques, RF identification (RFID) tags or mobile devices, camera sensors, and infrared detection.</p><p id="p-0004" num="0003">Ultrasonic acoustic sensing and detection has recently been applied to user presence detection, for example as implemented in occupancy-adaptive lighting systems. Examples of such ultrasonic presence detection systems include a broad-beam ultrasonic transmitter transmitting bursts of sinusoidal pulses and an array of receivers that detect reflections of those bursts from objects in the vicinity of the transmitter. Distance, direction, and motion of the objects in the room are derivable from the ultrasonic echoes at the various receivers in the array.</p><p id="p-0005" num="0004">Ultrasonic proximity sensing has now been implemented in the NEST HUB line of &#x201c;smart&#x201d; speakers available from Google. These speakers are &#x201c;smart&#x201d; in the sense that built-in microphones receive voice commands from the user for controlling lighting, audio, security, heating and cooling, and other &#x201c;smart home&#x201d; functions. The ultrasonic sensing feature in these smart speakers operates by emitting ultrasonic acoustic waves from the speakers, and sensing reflections via the built-in microphones to detect the presence of a user. This user proximity is used to enable additional interaction between the user and the device, for example by changing the contents of a video display.</p><p id="p-0006" num="0005">The use of ultrasonic acoustic signals as a communication technology, for example between intelligent devices in proximity with one another, has also been proposed. For example, such ultrasonic communication can be used for identification and authentication of a user device that is in proximity of audio/video display systems, lighting systems, or smart home devices.</p><heading id="h-0002" level="1">BRIEF SUMMARY</heading><p id="p-0007" num="0006">According to one aspect, a method for performing ultrasonic detection by emitting an ultrasonic burst from a speaker and detecting an echo at a microphone is provided. The method includes the generation of an ultrasonic burst signal at one or more ultrasonic frequencies followed by the equalization of that ultrasonic burst signal according to frequency response characteristics of the speaker and microphone at those ultrasonic frequencies, and driving of the speaker with the equalized ultrasonic burst. A delay time of an echo corresponding to the ultrasonic burst signal in an ultrasonic portion of a signal received from a microphone is then determined.</p><p id="p-0008" num="0007">According to another aspect, a method for performing ultrasonic detection by emitting an ultrasonic burst from a speaker and detecting an echo at a microphone is provided. The method includes the generation of an ultrasonic burst signal at one or more ultrasonic frequencies and driving a speaker with the ultrasonic burst signal. An ultrasonic portion of a signal received at a microphone is then separated, and this separated ultrasonic portion is equalized according to frequency response characteristics of the speaker and microphone at those ultrasonic frequencies. A delay time of an echo corresponding to the ultrasonic burst signal in the equalized ultrasonic portion of that received signal is then determined.</p><p id="p-0009" num="0008">According to another aspect, audio processing circuitry is provided that includes an ultrasonic burst generator that produces an ultrasonic burst signal at one or more ultrasonic frequencies, and an equalizer that equalizes that ultrasonic burst signal according to frequency response characteristics of the speaker and microphone at those ultrasonic frequencies. Driver circuitry drives a speaker with the ultrasonic burst signal. An ultrasonic separation filter separates an ultrasonic portion from a signal received at a microphone, and processing circuitry is provided to determine a delay time of an echo corresponding to the ultrasonic burst signal in that separated ultrasonic portion of the received signal.</p><p id="p-0010" num="0009">According to another aspect, audio processing circuitry is provided that includes an ultrasonic burst generator that produces an ultrasonic burst signal at one or more ultrasonic frequencies. Driver circuitry drives a speaker with the ultrasonic burst signal. An ultrasonic separation filter separates an ultrasonic portion from a signal received at a microphone, and an equalizer equalizes that ultrasonic portion according to frequency response characteristics of the speaker and microphone at those ultrasonic frequencies. Processing circuitry is provided to determine a delay time of an echo corresponding to the ultrasonic burst signal in that equalized ultrasonic portion of the received signal.</p><p id="p-0011" num="0010">Technical advantages enabled by one or more of these aspects include improved spatial resolution in presence detection and other operations based on received ultrasonic echoes, and in efficient hardware and computational realization of the ultrasonic processing system.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE SEVERAL VIEWS OF THE DRAWING</heading><p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. <b>1</b></figref> is a plan view of a room in which an audio/video system, shown in the form of a block diagram, in which one or more of the described embodiments may be implemented.</p><p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is an electrical diagram, in block and schematic form, of an audio/video system such as shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref> and in which one or more of the described embodiments may be implemented.</p><p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. <b>3</b>A</figref> is a plot of the ultrasonic frequency response of a conventional speaker.</p><p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. <b>3</b>B</figref> is a plot of the ultrasonic frequency response of a conventional microphone.</p><p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. <b>3</b>C</figref> illustrates a plot of time-domain correlation of an ultrasonic chirp from the conventional speaker of <figref idref="DRAWINGS">FIG. <b>3</b>A</figref> as received by the conventional microphone of <figref idref="DRAWINGS">FIG. <b>3</b>B</figref>, relative to a plot of time-domain correlation for the chirp over an ideal channel.</p><p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. <b>4</b></figref> is an electrical diagram, in block and schematic form, of an ultrasonic processing function in a digital audio amplifier according to an example embodiment.</p><p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is an example plot of time-domain correlation versus a threshold map in the operation of the ultrasonic processing function of the example embodiment of <figref idref="DRAWINGS">FIG. <b>4</b></figref>.</p><p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is a flow diagram illustrating a process of defining coefficients for an equalizer for the ultrasonic processing function according to example embodiments.</p><p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. <b>7</b></figref> is a frequency plot illustrating in-band and out-of-band frequencies as used in the process of <figref idref="DRAWINGS">FIG. <b>6</b></figref> according to example embodiments.</p><p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. <b>8</b></figref> illustrates a plot of time-domain correlation of an ultrasonic chirp according to an example embodiment relative to the plots of time-domain correlation for shown in <figref idref="DRAWINGS">FIG. <b>3</b>C</figref> for the unequalized channel and an ideal channel.</p><p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. <b>9</b></figref> is an electrical diagram, in block and schematic form, of an ultrasonic processing function in a digital audio amplifier according to another example embodiment.</p><p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. <b>10</b></figref> is an electrical diagram, in block and schematic form, of an ultrasonic processing function in a digital audio amplifier according to another example embodiment.</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><p id="p-0024" num="0023">The same reference numbers are used in the drawings to illustrate the same or similar (by function and/or structure) features.</p><heading id="h-0004" level="1">DETAILED DESCRIPTION</heading><p id="p-0025" num="0024">The one or more embodiments described in this specification are implemented into home audio and video systems, as it is contemplated that such implementation is particularly advantageous in that context. However, it is contemplated that aspects of these embodiments may be beneficially applied in other applications, for example in industrial, commercial, and environmental systems and settings.</p><p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. <b>1</b></figref> illustrates an example of an audio/video environment in which the described embodiments may be implemented. In this example, audio/video system <b>100</b> is deployed in a room R, and is constructed to include digital processor system <b>102</b> coupled to display <b>104</b> and audio system <b>106</b> by way of a wired or wireless connection. Digital processor system <b>102</b> provides some level of computing capacity to audio/video system <b>100</b> such as control of content presented at display <b>104</b> and audio system <b>106</b>, and for purposes of this description, the generation and processing of ultrasonic signals via audio system <b>106</b> for presence or motion detection, such as the detection of the presence or movement of one or more humans H within room R. The generation and processing of ultrasonic signals via audio system <b>106</b> according to these implementations may additionally or alternatively be used in applications such as gesture recognition and short distance user interface technologies as finger or hand tracking.</p><p id="p-0027" num="0026">The physical realization of audio/video system <b>100</b> can vary widely. For example, digital processor system <b>102</b> may be realized within the same physical enclosure as display <b>104</b>, for example in a so-called &#x201c;smart&#x201d; television, or alternatively may be a digital receiver, set top box, computer, or other such device that is physically separate from display <b>104</b> and coupled to display <b>104</b> by an appropriate external wired or wireless connection. Audio system <b>106</b> in this example includes one or more speakers <b>108</b> and one or more microphones <b>109</b>. Audio system <b>106</b> may similarly be realized within the same physical enclosure as display <b>104</b> (along with or separate from digital processor system <b>102</b>). Speakers <b>108</b> and microphone <b>109</b> may be contained within the same physical enclosure, such as in a &#x201c;sound bar,&#x201d;, or alternatively may be physically distributed around room R by way of multiple speakers (e.g., as &#x201c;5.1 surround sound&#x201d; and the like). Furthermore, microphone <b>109</b> may be realized within the same enclosure as display <b>104</b> but separate from speakers <b>108</b>. As such, <figref idref="DRAWINGS">FIG. <b>1</b></figref> illustrates audio/video system <b>100</b> arranged logically, rather than strictly in a physical arrangement.</p><p id="p-0028" num="0027">According to the implementations described in this specification, audio/video system <b>100</b> is constructed and adapted to use ultrasonic acoustic energy to perform one or more operational functions. One such function is presence detection, carried out by digital processor system <b>102</b> causing one or more of speakers <b>108</b> to emit ultrasonic sound in the form of a burst of sinusoidal pulses, such as a &#x201c;chirp&#x201d; over varying frequency, and detecting the arrival of echoes or reflections of that ultrasonic chirp from the environment of room R, including objects in room R such as human H. Such user presence detection can be used by digital processor system <b>102</b> itself, or through other devices in the home or building, to play a program from display <b>104</b> and audio system <b>106</b> when human H enters room R and pause the program when human H leaves room R. User presence can also be used for other functions, such as security functions (e.g., intruder detection).</p><p id="p-0029" num="0028">Examples of other operational functions that may be carried out through ultrasonic detection by audio/video system <b>100</b> in the arrangement of <figref idref="DRAWINGS">FIG. <b>1</b></figref> include gesture detection, by way of which human H can control the operation of audio/video system <b>100</b>. Ultrasonic detection can also be used by audio/video system <b>100</b> in directivity control of its audible audio output, for example by &#x201c;beam-forming&#x201d; or otherwise adjusting output from speakers <b>108</b> to optimize the audio experience according to the shape and contents of room R, the number and locations of humans H within room R, and the like. Ultrasonic communication may be implemented by audio/video system <b>100</b>, for example in the identification and authentication of users in room R by communication between user handheld devices and audio system <b>106</b> via ultrasonic signals. For purposes of this description, the term &#x201c;presence detection&#x201d; is considered to encompass these and other similar operational functions enabled by audio/video system <b>100</b> according to the implementations described in this specification.</p><p id="p-0030" num="0029">Furthermore, while audio/video system <b>100</b> is illustrated in <figref idref="DRAWINGS">FIG. <b>1</b></figref> as including display <b>104</b>, it is further contemplated that the ultrasonic operation described in these implementations may be realized by audio-only systems, such as smart speaker systems.</p><p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a block diagram illustrating the architecture of audio system <b>106</b> and its cooperation with digital processor system <b>102</b> according to an example implementation. As described above relative to <figref idref="DRAWINGS">FIG. <b>1</b></figref>, audio system <b>106</b> in this example includes two speakers <b>108</b>, two microphones <b>109</b>, and digital audio amplifier <b>200</b>. More or fewer speakers or microphones may be implemented in or with audio system <b>106</b>, as desired for particular implementations.</p><p id="p-0032" num="0031">Digital audio amplifier <b>200</b> in this implementation may be realized as a closed-loop Class-D multiple channel audio amplifier that includes, in the same integrated circuit, an integrated audio processor <b>204</b>. For example, audio processor <b>204</b> may be a programmable digital signal processor capable of supporting multiple channel and frequency band operation, and advanced functions and features as desired; memory (not shown) may be provided within or in combination with audio processor <b>204</b> for storage of program instructions executable by digital logic and processing units in audio processor <b>204</b>. In this example, as illustrated in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, audio processor <b>204</b> includes audible audio processing function <b>210</b> for the processing of data into signals for generating signals at human-audible frequencies, and ultrasonic audio processing function <b>220</b> for generating and receiving signals at ultrasonic frequencies, at upper frequencies within and beyond those generally audible by humans. Digital audio amplifier <b>200</b> in this example is a Class-D amplifier, and as such includes pulse-width-modulation circuitry <b>224</b>, including such circuitry as digital-to-PWM conversion, H bridge and gate driver circuitry, and the like. Other support circuitry may be included in digital audio amplifier <b>200</b> according to this implementation, for example the appropriate clock circuitry (e.g., phase-locked loop circuitry, low dropout oscillators (LDO)), modulator and demodulator circuitry, and various input/output circuitry for communicating with digital processor system <b>102</b> to carry out the functions described below and other functions useful to the overall system.</p><p id="p-0033" num="0032">Examples of audio amplifiers suitable for implementing digital audio amplifier <b>200</b> according to this implementation include the TAS5805M and TAS5825M families of digital audio amplifiers available from Texas Instruments Incorporated, such audio amplifiers constructed, programmed, or otherwise configured or adapted to perform the functions and operations described in this specification.</p><p id="p-0034" num="0033">As shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, digital audio amplifier <b>200</b> is coupled to digital processor system <b>102</b> to receive digital signals according to which speakers <b>108</b> are to be driven. These digital signals include signals audio_sig corresponding to digital data representing the audio output at human-audible frequencies, and signals US_sig corresponding to digital data representing the audio output at ultrasonic frequencies. For purposes of this description, ultrasonic frequencies are considered as those frequencies sufficiently high in frequency as to be generally inaudible by most humans. For example, frequencies of at least 18 kHz are commonly considered as ultrasonic frequencies. In one example, signals US_sig from digital processor system <b>102</b> may correspond to the ultrasonic burst itself (e.g., as a sample stream at the ultrasonic frequency. Alternatively, in another example, signals US_sig from digital processor system <b>102</b> may include data representing parameters of the ultrasonic burst, such parameters including frequency, burst duration, trigger burst, and the like; in this alternative example, digital audio amplifier <b>200</b> operates to generate the ultrasonic burst according to the parameters communicated by signals US_sig. In any event, the data represented by signals US_sig in this implementation are not considered to bear information that is to be perceived by humans in audible range of speakers <b>108</b>, but rather is intended for use in presence detection as described herein.</p><p id="p-0035" num="0034">Microphones <b>109</b> are coupled to digital audio amplifier <b>200</b> and digital processor system <b>102</b> according to the implementation of <figref idref="DRAWINGS">FIG. <b>2</b></figref>. As will be described in further detail below, microphones <b>109</b> are provided to capture ultrasonic acoustic signals, including reflections or echoes of ultrasonic acoustic waves emitted by speakers <b>108</b> under the control of digital audio amplifier <b>200</b>. Microphones <b>109</b> may also be constructed to capture audible frequencies, such as may be useful to receive voice commands from a human user in a &#x201c;smart&#x201d; speaker implementation. As such, microphones <b>109</b> transduce the received acoustic energy to electrical signals that are forwarded to either or both of digital audio amplifier <b>200</b> and digital processor system <b>102</b> in this implementation.</p><p id="p-0036" num="0035">As mentioned above, many modern audio/video systems are implemented as a combination of various components, primarily as selected by the end user of the system. For example, a smart television set may serve as display <b>104</b> in the reference arrangement of <figref idref="DRAWINGS">FIG. <b>1</b></figref>, while a separate audio system <b>106</b> with speakers <b>108</b> and perhaps microphone <b>109</b> is provided for audio input and output. In some cases, microphone <b>109</b> may be implemented within display <b>104</b>, or alternatively in a remote control device that communicates with a streaming device plugged into a port of display <b>104</b>. In any case, a wide variety of speakers <b>108</b>, microphones <b>109</b>, and displays <b>104</b> may be combined into audio/video system <b>100</b>. Digital processor system <b>102</b>, whether implemented as a stand-alone function or within the same physical enclosure as either display <b>104</b> or audio system <b>106</b>, can thus be called upon to operate and control these various selected devices.</p><p id="p-0037" num="0036">It has been observed, according to these embodiments, that the wide variety of speakers <b>108</b> and microphone <b>109</b> that may be used in audio/video system <b>100</b> presents challenges to the implementation of ultrasonic presence detection. Specifically, the frequency response of speakers and microphones can vary widely among various models and types, especially for ultrasonic frequencies as many speakers and microphones are primarily designed and optimized for audible frequencies. <figref idref="DRAWINGS">FIG. <b>3</b>A</figref> illustrates an example of the frequency response, expressed as sound pressure level (SPL), of a conventional loudspeaker over frequencies ranging from over frequencies ranging from high audible frequencies (e.g., above 10 kHz) well into the ultrasonic range (e.g., up to 45 kHz). As evident from this plot, the output of this speaker varies by as much as 15 dB within the ultrasonic range. <figref idref="DRAWINGS">FIG. <b>3</b>B</figref> similarly illustrates an example of the frequency response of a conventional microphone, expressed as a normalized amplitude relative to amplitude at 1 kHz) over frequencies ranging from 10 kHz to beyond 70 kHz, and also shows amplitude variations of as much as 15 dB over ultrasonic frequencies up to around 40 kHz, but with a different frequency dependence (e.g., a single peak at about 25 kHz) from that of the speaker plot of <figref idref="DRAWINGS">FIG. <b>3</b>A</figref> (e.g., two peaks between 20 kHz and 40 kHz). Furthermore, while these frequency response characteristics may be typical for speakers and microphones of those particular models, the response characteristics of both loudspeakers and microphones varies among model and type.</p><p id="p-0038" num="0037">Referring back to <figref idref="DRAWINGS">FIG. <b>1</b></figref>, these non-ideal and widely varying frequency response characteristics of speakers <b>108</b> and microphones <b>109</b> complicate the ability of digital processor system <b>102</b> to execute ultrasonic presence detection in heterogeneous systems such as audio/video system <b>100</b>. As mentioned above relative to <figref idref="DRAWINGS">FIG. <b>1</b></figref>, detection of an object using acoustic energy can be performed by stimulating speakers <b>108</b> to emit ultrasonic sound in the form of a burst of sinusoidal pulses, such as a &#x201c;chirp&#x201d; over varying ultrasonic frequencies, and detecting the time at which echoes or reflections of that ultrasonic burst are sensed by microphone <b>109</b>, for example by time-domain correlation of a chirp output from speakers <b>108</b> with the signal received from microphone <b>109</b> to determine the delay time at maximum correlation. It has been observed, in connection with these embodiments, that the non-ideal frequency response characteristics of speakers <b>108</b> and microphones <b>109</b> can hamper the resolution of this correlation.</p><p id="p-0039" num="0038"><figref idref="DRAWINGS">FIG. <b>3</b>C</figref> plots the normalized output of time-domain correlation (in dB) of a 1 msec ultrasonic &#x201c;chirp&#x201d; of 20 kHz bandwidth centered at 30 kHz (i.e., the chirp varies in frequency from 20 kHz to 40 kHz), as expressed in numbers of samples at a 96 kHz sampling rate. Plot <b>302</b> in <figref idref="DRAWINGS">FIG. <b>3</b>C</figref> illustrates the correlation for a theoretical speaker and microphone that both have ideal frequency response characteristics (i.e., flat over 20 kHz to 40 kHz). This ideal plot <b>302</b> has a clearly identifiable correlation peak at about 1000 samples, with sidelobes with amplitudes at least 25 dB lower amplitude from the correlation peak. In contrast, plot <b>304</b> illustrates the correlation for the same 1 msec chirp output by speaker <b>108</b> with a frequency response as shown in <figref idref="DRAWINGS">FIG. <b>3</b>A</figref>, with the echo detected by microphone <b>108</b> with a frequency response as shown in <figref idref="DRAWINGS">FIG. <b>3</b>B</figref>. As evident from plot <b>304</b>, while the correlation peak is still evident at about 1000 samples, significant sidelobes are present on either side of this correlation peak, particularly for the sidelobe immediately after the correlation peak, which is less than 10 dB lower than the correlation peak. This non-ideal speaker and microphone frequency response effectively widens the detected echo, which greatly limits the spatial resolution at which ultrasonic detection may be performed.</p><p id="p-0040" num="0039"><figref idref="DRAWINGS">FIG. <b>4</b></figref> illustrates the construction and functional arrangement of a portion of digital audio amplifier <b>200</b> in audio system <b>106</b> including ultrasonic audio processing function <b>220</b>, according to an example embodiment. Other circuitry and functions, for example digital filters and other circuitry for processing audible audio signals, may also be provided within digital audio amplifier <b>200</b>. While this description may indicate that certain functions in <figref idref="DRAWINGS">FIG. <b>4</b></figref> are realized within digital audio amplifier <b>200</b> in the architecture of <figref idref="DRAWINGS">FIG. <b>2</b></figref>, it is contemplated that some or all of these functions may alternatively be realized in digital processor system <b>102</b>, depending on the application or system implementation. It is also contemplated that some of the functions shown in <figref idref="DRAWINGS">FIG. <b>4</b></figref> may be implemented using programmable logic circuitry in audio processor <b>204</b>, such as a digital signal processor, in which case memory that stores executable program instructions for carrying out these functions and operations will also be provided in audio processor <b>204</b> or elsewhere in digital audio amplifier <b>200</b> or another appropriate device. Alternatively, some or all of these functions may be realized in custom or semi-custom logic circuitry, as desired for the particular implementation.</p><p id="p-0041" num="0040">Referring to <figref idref="DRAWINGS">FIG. <b>4</b></figref>, burst generation function <b>400</b> is provided in ultrasonic audio processing function <b>220</b> to generate an ultrasonic burst or &#x201c;chirp&#x201d; signal at its output for use in in ultrasonic presence detection according to this implementation. In one example, burst generation function <b>400</b> may generate a &#x201c;chirp&#x201d; in the form of a short series or burst of sinusoidal pulses at varying ultrasonic frequencies; this variation in frequency over the chirp can facilitate detection and correlation of a received echo signal with the transmitted signal. In this chirp approach, the frequency may vary linearly, nonlinearly, or according to a frequency or phase modulation such as an orthogonal frequency division multiplexing (OFDM), binary frequency shift keyed (BFSK) scheme, binary phase shift keyed (BPSK) scheme, or the like. Alternatively, burst generation function <b>400</b> may instead generate a burst of sinusoidal pulses at a constant ultrasonic frequency at its output. For purposes of this description, the term &#x201c;burst&#x201d; is intended to refer to any of these and similar examples of the ultrasonic signal generated by burst generation function <b>400</b>, including those at a single frequency or at varying frequencies.</p><p id="p-0042" num="0041">Additional control logic (not shown) may be provided in digital audio amplifier <b>200</b> for controlling the time at which burst generation function <b>400</b> issues the burst signal. For example, the presence detection operation may be performed continuously or periodically. Alternatively, burst generation function <b>400</b> may be controlled to issue the burst in response to an event or condition, such as in response to the audible audio content being at a low amplitude. The burst signal issued by burst generation function <b>400</b> may be in the form of an analog signal in the time domain, or a discrete time sample stream. In any of these forms, the burst generated by burst generation function <b>400</b> is applied to discrete time equalizer <b>402</b>.</p><p id="p-0043" num="0042">Equalizer <b>402</b> in this example implementation is implemented in digital audio amplifier <b>200</b> to pre-compensate the burst signal for the non-ideal frequency response characteristics of both speaker <b>108</b> and microphone <b>109</b> over the frequencies of interest. Equalizer <b>402</b> may be realized by way of a discrete-time equalizer, such as a continuous-time discrete-time linear equalizer, for the case in which burst generation function <b>400</b> generates the burst as a discrete-time sample stream, as in this architecture in which ultrasonic audio processing function <b>220</b> is realized by digital signal processor in audio processor <b>204</b>. Alternatively, if burst generation function <b>400</b> generates the burst as an analog signal, equalizer <b>402</b> may be realized by way of a continuous-time equalizer, or as a continuous-time equalizer in combination with a discrete-time equalizer, as desired. In this implementation, equalizer <b>402</b> is a bandlimited equalizer in that it is arranged to operate on signal frequencies within a relatively narrow band of interest, namely ultrasonic frequencies including those of the burst signal. Accordingly, equalizer <b>402</b> can be efficiently realized from a hardware standpoint as compared with equalizers covering a full frequency range including both audible and ultrasonic frequencies. The construction and adaptation of equalizer <b>402</b> according to example implementations will be described in further detail below.</p><p id="p-0044" num="0043">Equalizer <b>402</b> produces at its output an equalized signal, for example an equalized discrete-time sample stream, which is applied to gain stage <b>405</b>. Gain stage <b>405</b> applies, to this equalized ultrasonic signal from equalizer <b>402</b>, a gain that is selected or otherwise controlled by amplitude control function <b>404</b>. In this example implementation, amplitude control function <b>404</b> operates to adjust the gain applied by gain stage <b>405</b>, and thus adjust the amplitude of the equalized ultrasonic signal, according to the amplitude level of the audible audio signal received from audible audio processing function <b>210</b>. For example, amplitude control function <b>404</b> may control gain stage <b>405</b> to reduce the amplitude of the equalized ultrasonic signal during those times in which the amplitude of the audible audio signal is at a high level, such as above a threshold level or according to a linear or other function. Alternatively or in addition, amplitude control function <b>404</b> may control burst generation function <b>400</b> to block the ultrasonic signal entirely (as suggested in <figref idref="DRAWINGS">FIG. <b>4</b></figref>) if the amplitude of the audible audio signal is above a threshold level. This gain control serves to avoid clipping in the driving of speakers <b>108</b>. Alternatively, amplitude control function <b>404</b> may receive a different or additional control signal, for example from digital processor system <b>102</b>, in order to control the gain applied by gain stage <b>405</b> for other reasons. For example, amplitude control function <b>404</b> may be controlled by digital processor system <b>102</b> to ramp up and ramp down the amplitude of the equalized ultrasonic signal to avoid audible artifacts, or to adjust the amplitude of the equalized ultrasonic signal according to the desired detection distance (e.g., at 1 meter vs. 5 meters from speaker <b>108</b>) and thus reduce power consumption when sensing at shorter distances. Further in the alternative, amplitude control function <b>404</b> may be omitted in some implementations.</p><p id="p-0045" num="0044">The output of gain stage <b>405</b> is coupled to one input of signal adder <b>407</b>, which produces a signal corresponding to the sum of the amplified ultrasonic signal from gain stage <b>405</b> with an audio signal representative of audible audio content from audible audio processing function <b>210</b>. Audible audio processing function <b>210</b> may itself include an equalizer function as common in modern audio systems, by way of which the amplitude of the audio output over frequency can be adjusted according to the user's taste for the type of audio content being played, in which case the audio signal from audible audio processing function <b>210</b> as applied to signal adder <b>407</b> will itself have been equalized accordingly. Signal adder <b>407</b> overlays the audible audio to be output by audio system <b>106</b> with the ultrasonic burst produced by burst generation function <b>400</b> for purposes of ultrasonic presence detection. For the example in which both the audio signal from audible audio processing function <b>210</b> and the ultrasonic burst are discrete-time sample streams, either as generated by burst generation function <b>400</b> or by equalizer <b>402</b>, the summing performed by signal adder <b>407</b> may be realized by simply summing the samples at each sample period, with interpolation or other processing applied as necessary if the sampling rates differ.</p><p id="p-0046" num="0045">The summed audio signals from signal adder <b>407</b> are applied to PWM generation circuitry <b>224</b>. In this example, PWM generation circuitry <b>224</b> may be a speaker driver circuit that generates the appropriate pulse-width-modulated Class-D output signals to drive speaker <b>108</b> to produce audible and ultrasonic sound according to the summed audio signals from signal adder <b>407</b>. If multiple speakers <b>108</b> are present in audio system <b>106</b>, the speakers <b>108</b> may be driven simultaneously, typically with different drive signals for the audible content to attain a stereo or surround effect. The drive signals for the ultrasonic frequencies may be simultaneously driven at all speakers <b>108</b>, or alternatively speakers <b>108</b> may be driven with the ultrasonic signals at different times (perhaps as different chirps) to facilitate triangulation or other 2D or 3D locating as part of the ultrasonic presence detection operation.</p><p id="p-0047" num="0046">On the receive side of the implementation of <figref idref="DRAWINGS">FIG. <b>4</b></figref>, signals received from microphone <b>109</b> are received at an input of interface <b>420</b>, which in this example includes and other typical filtering and amplification circuitry (not shown) as generally provided in microphone and other audio interfaces. In this example, interface <b>420</b> includes low noise amplifier (LNA) <b>421</b>, which amplifies the received microphone signals and applies the amplified signal to analog-to-digital converter (ADC) <b>422</b> for conversion from analog to digital, for example a discrete-time sample stream corresponding to audio received at microphone <b>109</b>. This discrete-time sample stream from ADC <b>422</b> is applied to upstream separation function <b>424</b> in ultrasonic audio processing function <b>220</b>, for filtering by one or more discrete-time or digital filters, to separate the portion of the received signal at ultrasonic frequencies from the portion of the received signal at other frequencies, including audible frequencies. Separation of the ultrasonic signal by ultrasonic signal separation function <b>424</b> may of course be performed by way of a high-pass digital filter, for example realized by a digital filter function executed by digital signal processor in audio processor <b>204</b>. In some embodiments, audio received by microphone <b>109</b> at audible frequencies may not be of interest, in which case ultrasonic signal separation function <b>424</b> may include only a high-pass filter. Alternatively, if the received audio at audible frequencies is of interest (e.g., if audio system <b>106</b> is capable of receiving voice commands), the portion of the received signal at audible frequencies may be itself filtered from the audio signal as received, and then forwarded by ultrasonic signal separation function <b>424</b> to audible audio processing function <b>210</b> as indicated in <figref idref="DRAWINGS">FIG. <b>4</b></figref>.</p><p id="p-0048" num="0047">The ultrasonic portion of the received audio signal is forwarded by ultrasonic signal separation function <b>424</b> to correlator <b>426</b>, which also receives a template of the ultrasonic burst as generated by burst generation function <b>400</b>. This template of the generated burst may be a copy of the burst as generated, or alternatively may be a stored representation of the burst. A timestamp or other time base indication of the time at which the ultrasonic burst is generated by burst generation function <b>400</b>, and for the time of receipt of the ultrasonic signal, are preserved to enable determination of a delay time between the two signals. Correlator <b>426</b> operates to correlate the received ultrasonic signal with the ultrasonic burst to determine the time-of-flight, or two-way travel time, of the ultrasonic burst from speaker <b>108</b> to a reflecting object and back to microphone <b>109</b>. For example, this correlation may be performed in the time domain to produce a discrete-time correlation signal over time.</p><p id="p-0049" num="0048">Alternatively, for the case in which the ultrasonic burst signal generated by burst generation function <b>400</b> and output at speaker <b>108</b> is a single ultrasonic tone, a band-pass discrete-time filter could serve to perform both of the functions of ultrasonic signal separation function <b>424</b> and correlator <b>426</b> to extract the received signal components at and near the frequency of the generated ultrasonic tone.</p><p id="p-0050" num="0049">As shown in <figref idref="DRAWINGS">FIG. <b>4</b></figref>, output from ultrasonic signal separation function <b>424</b> may also be provided to equalizer <b>402</b> for use in adapting equalizer <b>402</b> to compensate for the frequency response characteristics of speaker <b>108</b> and microphone <b>109</b>, as will be described below. Such adaptation may be performed as part of a configuration routine, and also updated after or during operation if desired.</p><p id="p-0051" num="0050">Envelope calculation function <b>428</b> receives the correlation signal from correlator <b>426</b> (or the band-pass discrete-time filter, for the single ultrasonic tone case) and derives a time-domain envelope of that correlation signal to exclude the carrier frequencies and thus facilitate identification of the two-way transit time. This envelope signal generated by envelope calculation function <b>428</b> is applied to comparator <b>430</b> for comparison with a threshold level to detect a delay time at which the correlation between the received audio signal and the ultrasonic burst output by speaker <b>108</b>. According to this implementation, the threshold level against which comparator <b>430</b> compares the correlation signal envelope is in the form of a time-varying threshold map, to exclude direct coupling of the burst from speaker <b>108</b> to microphone <b>109</b>, as would be evident at short delay times. Comparator <b>430</b> in this example generates at its output a discrete-time signal representative of the results of comparisons of the envelope of the correlation signal with the threshold level or map over the relevant time period. This comparator result sample stream is applied to time-of-flight calculation function <b>432</b> in ultrasonic audio processing function <b>220</b> as shown in <figref idref="DRAWINGS">FIG. <b>4</b></figref>, which in turn calculates a time-of-flight, or two-way travel time, of the ultrasonic burst to and from the detected object. This calculated time-of-flight can then be communicated to digital processor system <b>102</b> or other appropriate processing logic for use in calculating distance of motion of the reflecting object or objects as useful in presence detection, motion detection, gesture detection, directivity control of audible audio output, or such other operational functions of audio/video system <b>100</b> as desired.</p><p id="p-0052" num="0051"><figref idref="DRAWINGS">FIG. <b>5</b></figref> illustrates an example of an envelope of a correlation signal produced by an example of correlator <b>426</b> and envelope calculation function <b>428</b> in performing ultrasonic presence detection according to this example implementation. The example of <figref idref="DRAWINGS">FIG. <b>5</b></figref> results from the detection of an object at a distance of 5 m from speaker <b>108</b> (and microphone <b>109</b>). Plot <b>500</b> in <figref idref="DRAWINGS">FIG. <b>5</b></figref> represents an envelope of the correlation signal which, in this example, exhibits significant variation over time, including variations that do not represent receipt of an echo from a detected object. <figref idref="DRAWINGS">FIG. <b>5</b></figref> also illustrates threshold map <b>502</b> against which comparator <b>430</b> compares envelope <b>500</b> for purpose of presence detection. This threshold map <b>502</b> is designed to vary over time to exclude peaks of envelope <b>500</b> unrelated to an echo. It is contemplated that threshold map <b>502</b> may be experimentally or otherwise empirically derived in advance and stored in memory of digital audio amplifier <b>200</b>. In the example of <figref idref="DRAWINGS">FIG. <b>5</b></figref>, a distinct echo from an object is indicated by peak <b>505</b> in envelope <b>500</b> that extends above threshold map <b>502</b> at a time of about 31 msec. As such, comparator <b>430</b> would issue, in this example, a signal stream including indications corresponding to the samples at about 2 msec and about 31 msec, at which envelope <b>500</b> exceed threshold map <b>502</b>. These indications are then used by time-of-flight calculation function <b>432</b> to derive the appropriate two-way travel time, from which the distance of the reflecting object can be derived. This travel time may then be used in the appropriate higher level presence detection function, such as may be implemented in digital processor system <b>102</b> for example.</p><p id="p-0053" num="0052">As described above, the receive side of the example implementation of <figref idref="DRAWINGS">FIG. <b>4</b></figref> is described as provided within audio processor <b>204</b> of digital audio amplifier <b>200</b>. Alternatively, these receive side functions, including one or more of ultrasonic signal separation function <b>424</b>, correlator <b>426</b>, envelope calculation function <b>428</b>, comparator <b>430</b>, and time-of-flight calculation function <b>432</b> may be realized outside of audio processor <b>204</b>, or outside of digital audio amplifier <b>200</b>. For example, each of these functions may be implemented in digital processor system <b>102</b>, in which case interface <b>420</b> would be provided for digital processor system <b>102</b> to receive signals from microphone <b>109</b>, such that the determination of the two-way travel time is performed by digital processor system <b>102</b> directly. Alternatively, audio processor <b>204</b> may receive signals from microphone <b>109</b> as described above and perform some of the receive side functions, with the remainder of the functions performed within digital processor system <b>102</b>.</p><p id="p-0054" num="0053">Referring now to <figref idref="DRAWINGS">FIG. <b>6</b></figref>, a process of selecting the appropriate coefficients and other parameters to be applied by ultrasonic equalizer <b>402</b> in audio digital amplifier <b>200</b> for a particular combination of speaker <b>108</b> and microphone <b>109</b> according to an example implementation will be described. It is contemplated that this process may be performed by processing logic in audio digital amplifier <b>200</b>, for example by digital signal processor circuitry in audio processor <b>204</b> or other computational logic executing program instructions stored in memory accessible to that processing logic, or alternatively by processing logic elsewhere in audio/video system <b>100</b>, for example digital processor system <b>102</b>.</p><p id="p-0055" num="0054">In process <b>602</b>, the channel response of speaker <b>108</b> and microphone <b>109</b> is acquired. It is contemplated that process <b>602</b> may be performed in any one of a number of ways. According to one example, burst generation function <b>400</b> may generate an output representative of periodically repeated random noise, with energy either limited to the ultrasonic band of interest or as wideband noise including the ultrasonic band of interest, for output via speaker <b>108</b>. Ultrasonic frequency signals corresponding to that periodic random noise as output by speaker <b>108</b> and received by microphone <b>109</b> can then be analyzed, for example by digital signal processor circuitry in audio processor <b>204</b> applying a discrete Fourier transform calculation to derive a spectrum of the random noise as output by speaker <b>108</b> and received via microphone <b>109</b>, including both magnitude and phase response. From this determination of the channel response in the frequency domain, a minimum-phase time domain response can be extracted in this process <b>602</b>. Alternatively, the response characteristics of particular makes and models of speaker <b>108</b> and microphone <b>109</b> may be stored in memory of audio/video system <b>100</b> or is otherwise available (e.g., available online), in which case process <b>602</b> may be performed by retrieving those stored characteristics for either or both of speaker <b>108</b> and microphone <b>109</b>. In either case, process <b>602</b> determines a time domain response of the combination of speaker <b>108</b> and microphone <b>109</b>.</p><p id="p-0056" num="0055">In process <b>604</b>, a convolved response of the channel response determined in process <b>602</b> with equalizer <b>402</b> according to a selected design is derived. In this example implementation, the design of equalizer <b>402</b> applied in process <b>604</b> includes selection of its type, for example as an infinite impulse response (IIR) or a finite impulse response (FIR) digital equalizer, as well as its number of taps, or coefficients. Mathematically, for an FIR equalizer a(k) for taps k=0, 1, . . . , K<sub>a</sub>-1, the convolved response of the channel and equalizer <b>402</b> can be expressed as:</p><p id="p-0057" num="0000"><maths id="MATH-US-00001" num="00001"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <mrow>      <mrow>       <mi>c</mi>       <mo>&#x2061;</mo>       <mo>(</mo>       <mi>k</mi>       <mo>)</mo>      </mrow>      <mo>=</mo>      <mrow>       <mrow>        <munderover>         <mo>&#x2211;</mo>         <mrow>          <mi>l</mi>          <mo>=</mo>          <mn>0</mn>         </mrow>         <mrow>          <msub>           <mi>K</mi>           <mi>a</mi>          </msub>          <mo>-</mo>          <mn>1</mn>         </mrow>        </munderover>        <mrow>         <mrow>          <mi>h</mi>          <mo>&#x2061;</mo>          <mo>(</mo>          <mrow>           <mi>k</mi>           <mo>-</mo>           <mi>l</mi>          </mrow>          <mo>)</mo>         </mrow>         <mo>&#x2062;</mo>         <mrow>          <mi>a</mi>          <mo>&#x2061;</mo>          <mo>(</mo>          <mi>l</mi>          <mo>)</mo>         </mrow>         <mo>&#x2062;</mo>         <mtext>   </mtext>         <mi>for</mi>         <mo>&#x2062;</mo>         <mrow>          <mtext>  </mtext>          <mpadded>           <mtext> </mtext>          </mpadded>         </mrow>         <mo>&#x2062;</mo>         <mpadded>          <mtext>  </mtext>         </mpadded>         <mi>k</mi>        </mrow>       </mrow>       <mo>=</mo>       <mn>0</mn>      </mrow>     </mrow>     <mo>,</mo>     <mn>1</mn>     <mo>,</mo>     <mtext>   </mtext>     <mo>&#x2026;</mo>     <mtext>   </mtext>     <mo>,</mo>     <mrow>      <msub>       <mi>K</mi>       <mi>a</mi>      </msub>      <mo>+</mo>      <mi>K</mi>      <mo>-</mo>      <mn>2</mn>     </mrow>    </mrow>   </mtd>   <mtd>    <mrow>     <mo>[</mo>     <mi>l</mi>     <mo>]</mo>    </mrow>   </mtd>  </mtr> </mtable></math></maths></p><p id="p-0058" num="0000">This convolved response will have a length K<sub>c</sub>=K<sub>a</sub>+K&#x2212;1.</p><p id="p-0059" num="0056">Using this expression for the convolution of the channel response determined in process <b>602</b> with equalizer <b>402</b> as designed, a cost function is identified in process <b>606</b>. In process <b>608</b>, optimization of this cost function is then performed to arrive at the coefficient values to be applied by equalizer <b>402</b> in ultrasonic audible audio processing function <b>210</b>. According to an example implementation, a cost function J identified in process <b>606</b> involves two terms:</p><p id="p-0060" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>J=J</i><sub>1</sub>+<i>wJ</i><sub>2</sub>&#x2003;&#x2003;(2)<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0061" num="0000">where J<sub>1 </sub>expresses an in-band cost function based on the equalized performance in the ultrasonic band of interest, and J<sub>2 </sub>expresses an out-of-band cost function based on equalization energy outside of the ultrasonic band of interest; weighting factor w is applied to provide the system designer with a tradeoff between in-band performance and out-of-band performance.</p><p id="p-0062" num="0057">In this example implementation, the in-band cost function can be expressed mathematically as:</p><p id="p-0063" num="0000"><maths id="MATH-US-00002" num="00002"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <msub>      <mi>J</mi>      <mn>1</mn>     </msub>     <mo>=</mo>     <mrow>      <mrow>       <msubsup>        <mo>&#x222b;</mo>        <msub>         <mi>&#x3c9;</mi>         <mn>1</mn>        </msub>        <msub>         <mi>&#x3c9;</mi>         <mn>2</mn>        </msub>       </msubsup>       <mrow>        <msup>         <mrow>          <mrow>           <mo>[</mo>           <mrow>            <mrow>             <munderover>              <mo>&#x2211;</mo>              <mrow>               <msub>                <mi>k</mi>                <mn>1</mn>               </msub>               <mo>=</mo>               <mn>0</mn>              </mrow>              <mrow>               <msub>                <mi>K</mi>                <mi>c</mi>               </msub>               <mo>-</mo>               <mn>1</mn>              </mrow>             </munderover>             <mrow>              <mi>c</mi>              <mo>&#x2062;</mo>              <mrow>               <mo>(</mo>               <msub>                <mi>k</mi>                <mn>1</mn>               </msub>               <mo>)</mo>              </mrow>              <mo>&#x2062;</mo>              <msup>               <mi>e</mi>               <mrow>                <mrow>                 <mo>-</mo>                 <mi>j</mi>                </mrow>                <mo>&#x2062;</mo>                <mi>&#x3c9;</mi>                <mo>&#x2062;</mo>                <msub>                 <mi>k</mi>                 <mn>1</mn>                </msub>               </mrow>              </msup>             </mrow>            </mrow>            <mo>-</mo>            <msup>             <mi>e</mi>             <mrow>              <mrow>               <mo>-</mo>               <mi>j</mi>              </mrow>              <mo>&#x2062;</mo>              <msub>               <mi>&#x3c9;n</mi>               <mn>0</mn>              </msub>             </mrow>            </msup>           </mrow>           <mo>]</mo>          </mrow>          <mo>[</mo>          <mrow>           <mrow>            <munderover>             <mo>&#x2211;</mo>             <mrow>              <msub>               <mi>k</mi>               <mn>2</mn>              </msub>              <mo>=</mo>              <mn>0</mn>             </mrow>             <mrow>              <msub>               <mi>K</mi>               <mi>c</mi>              </msub>              <mo>-</mo>              <mn>1</mn>             </mrow>            </munderover>            <mrow>             <mrow>              <mi>c</mi>              <mo>&#x2061;</mo>              <mo>(</mo>              <msub>               <mi>k</mi>               <mn>2</mn>              </msub>              <mo>)</mo>             </mrow>             <mo>&#x2062;</mo>             <msup>              <mi>e</mi>              <mrow>               <mrow>                <mo>-</mo>                <mi>j</mi>               </mrow>               <mo>&#x2062;</mo>               <mi>&#x3c9;</mi>               <mo>&#x2062;</mo>               <msub>                <mi>k</mi>                <mn>2</mn>               </msub>              </mrow>             </msup>            </mrow>           </mrow>           <mo>-</mo>           <msup>            <mi>e</mi>            <mrow>             <mrow>              <mo>-</mo>              <mi>j</mi>             </mrow>             <mo>&#x2062;</mo>             <mi>&#x3c9;</mi>             <mo>&#x2062;</mo>             <msub>              <mi>n</mi>              <mn>0</mn>             </msub>            </mrow>           </msup>          </mrow>          <mo>]</mo>         </mrow>         <mo>&#x22c6;</mo>        </msup>        <mo>&#x2062;</mo>        <mrow>         <mi>d</mi>         <mo>&#x2062;</mo>         <mi>&#x3c9;</mi>        </mrow>       </mrow>      </mrow>      <mo>+</mo>      <mtext></mtext>      <mrow>       <msubsup>        <mo>&#x222b;</mo>        <mrow>         <mo>-</mo>         <msub>          <mi>&#x3c9;</mi>          <mn>2</mn>         </msub>        </mrow>        <mrow>         <mo>-</mo>         <msub>          <mi>&#x3c9;</mi>          <mn>1</mn>         </msub>        </mrow>       </msubsup>       <mrow>        <msup>         <mrow>          <mrow>           <mo>[</mo>           <mrow>            <mrow>             <munderover>              <mo>&#x2211;</mo>              <mrow>               <msub>                <mi>k</mi>                <mn>1</mn>               </msub>               <mo>=</mo>               <mn>0</mn>              </mrow>              <mrow>               <msub>                <mi>K</mi>                <mi>c</mi>               </msub>               <mo>-</mo>               <mn>1</mn>              </mrow>             </munderover>             <mrow>              <mrow>               <mi>c</mi>               <mo>&#x2061;</mo>               <mo>(</mo>               <msub>                <mi>k</mi>                <mn>1</mn>               </msub>               <mo>)</mo>              </mrow>              <mo>&#x2062;</mo>              <msup>               <mi>e</mi>               <mrow>                <mrow>                 <mo>-</mo>                 <mi>j</mi>                </mrow>                <mo>&#x2062;</mo>                <mi>&#x3c9;</mi>                <mo>&#x2062;</mo>                <msub>                 <mi>k</mi>                 <mn>1</mn>                </msub>               </mrow>              </msup>             </mrow>            </mrow>            <mo>-</mo>            <msup>             <mi>e</mi>             <mrow>              <mrow>               <mo>-</mo>               <mi>j</mi>              </mrow>              <mo>&#x2062;</mo>              <msub>               <mi>&#x3c9;n</mi>               <mn>0</mn>              </msub>             </mrow>            </msup>           </mrow>           <mo>]</mo>          </mrow>          <mo>[</mo>          <mrow>           <mrow>            <munderover>             <mo>&#x2211;</mo>             <mrow>              <msub>               <mi>k</mi>               <mn>2</mn>              </msub>              <mo>=</mo>              <mn>0</mn>             </mrow>             <mrow>              <msub>               <mi>K</mi>               <mi>c</mi>              </msub>              <mo>-</mo>              <mn>1</mn>             </mrow>            </munderover>            <mrow>             <mrow>              <mi>c</mi>              <mo>&#x2061;</mo>              <mo>(</mo>              <msub>               <mi>k</mi>               <mn>2</mn>              </msub>              <mo>)</mo>             </mrow>             <mo>&#x2062;</mo>             <msup>              <mi>e</mi>              <mrow>               <mrow>                <mo>-</mo>                <mi>j</mi>               </mrow>               <mo>&#x2062;</mo>               <mi>&#x3c9;</mi>               <mo>&#x2062;</mo>               <msub>                <mi>k</mi>                <mn>2</mn>               </msub>              </mrow>             </msup>            </mrow>           </mrow>           <mo>-</mo>           <msup>            <mi>e</mi>            <mrow>             <mrow>              <mo>-</mo>              <mi>j</mi>             </mrow>             <mo>&#x2062;</mo>             <mi>&#x3c9;</mi>             <mo>&#x2062;</mo>             <msub>              <mi>n</mi>              <mn>0</mn>             </msub>            </mrow>           </msup>          </mrow>          <mo>]</mo>         </mrow>         <mo>&#x22c6;</mo>        </msup>        <mo>&#x2062;</mo>        <mrow>         <mi>d</mi>         <mo>&#x2062;</mo>         <mi>&#x3c9;</mi>        </mrow>       </mrow>      </mrow>     </mrow>    </mrow>   </mtd>   <mtd>    <mrow>     <mo>[</mo>     <mn>3</mn>     <mo>]</mo>    </mrow>   </mtd>  </mtr> </mtable></math></maths></p><p id="p-0064" num="0000">wherein k<sub>1 </sub>and k<sub>2 </sub>represent discrete sample indices, and where the term e<sup>&#x2212;j&#x3c9;n</sup><sub>0 </sub>represents the ideal response of the equalized channel (e.g., a flat response). The frequencies &#xb1;&#x3c9;<sub>1 </sub>and &#xb1;&#x3c9;<sub>2 </sub>are the frequencies defining the in-band and out-of-band frequency ranges, as shown in <figref idref="DRAWINGS">FIG. <b>7</b></figref>. As shown in that <figref idref="DRAWINGS">FIG. <b>7</b></figref>, the frequency band of interest is between &#x3c9;<sub>1 </sub>and &#x3c9;<sub>2</sub>, which appears on both side of DC=0 in the complex plane. As such, cost function J<sub>1 </sub>expresses the difference between the equalized channel c(k) and the ideal channel response in the band of interest. The out-of-band cost function J<sub>2 </sub>in this example implementation can be expressed mathematically as:</p><p id="p-0065" num="0000"><maths id="MATH-US-00003" num="00003"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <msub>      <mi>J</mi>      <mn>2</mn>     </msub>     <mo>=</mo>     <mrow>      <mrow>       <msubsup>        <mo>&#x222b;</mo>        <mrow>         <mo>-</mo>         <mi>&#x3c0;</mi>        </mrow>        <mrow>         <mo>-</mo>         <msub>          <mi>&#x3c9;</mi>          <mn>2</mn>         </msub>        </mrow>       </msubsup>       <mrow>        <msup>         <mrow>          <mrow>           <mo>[</mo>           <mrow>            <munderover>             <mo>&#x2211;</mo>             <mrow>              <mi>l</mi>              <mo>=</mo>              <mn>0</mn>             </mrow>             <msub>              <mi>K</mi>              <mi>a</mi>             </msub>            </munderover>            <mrow>             <mrow>              <mi>a</mi>              <mo>&#x2061;</mo>              <mo>(</mo>              <mi>l</mi>              <mo>)</mo>             </mrow>             <mo>&#x2062;</mo>             <msup>              <mi>e</mi>              <mrow>               <mrow>                <mo>-</mo>                <mi>j</mi>               </mrow>               <mo>&#x2062;</mo>               <mi>&#x3c9;</mi>               <mo>&#x2062;</mo>               <mi>l</mi>              </mrow>             </msup>            </mrow>           </mrow>           <mo>]</mo>          </mrow>          <mo>[</mo>          <mrow>           <munderover>            <mo>&#x2211;</mo>            <mrow>             <mi>k</mi>             <mo>=</mo>             <mn>0</mn>            </mrow>            <msub>             <mi>K</mi>             <mi>a</mi>            </msub>           </munderover>           <mrow>            <mrow>             <mi>a</mi>             <mo>&#x2061;</mo>             <mo>(</mo>             <mi>k</mi>             <mo>)</mo>            </mrow>            <mo>&#x2062;</mo>            <msup>             <mi>e</mi>             <mrow>              <mrow>               <mo>-</mo>               <mi>j</mi>              </mrow>              <mo>&#x2062;</mo>              <mi>&#x3c9;</mi>              <mo>&#x2062;</mo>              <mi>k</mi>             </mrow>            </msup>           </mrow>          </mrow>          <mo>]</mo>         </mrow>         <mo>*</mo>        </msup>        <mo>&#x2062;</mo>        <mi>d</mi>        <mo>&#x2062;</mo>        <mi>&#x3c9;</mi>       </mrow>      </mrow>      <mo>+</mo>      <mrow>       <msubsup>        <mo>&#x222b;</mo>        <msub>         <mi>&#x3c9;</mi>         <mn>2</mn>        </msub>        <mi>&#x3c0;</mi>       </msubsup>       <mrow>        <msup>         <mrow>          <mrow>           <mo>[</mo>           <mrow>            <munderover>             <mo>&#x2211;</mo>             <mrow>              <mi>l</mi>              <mo>=</mo>              <mn>0</mn>             </mrow>             <msub>              <mi>K</mi>              <mi>a</mi>             </msub>            </munderover>            <mrow>             <mrow>              <mi>a</mi>              <mo>&#x2061;</mo>              <mo>(</mo>              <mi>l</mi>              <mo>)</mo>             </mrow>             <mo>&#x2062;</mo>             <msup>              <mi>e</mi>              <mrow>               <mrow>                <mo>-</mo>                <mi>j</mi>               </mrow>               <mo>&#x2062;</mo>               <mi>&#x3c9;</mi>               <mo>&#x2062;</mo>               <mi>l</mi>              </mrow>             </msup>            </mrow>           </mrow>           <mo>]</mo>          </mrow>          <mo>[</mo>          <mrow>           <munderover>            <mo>&#x2211;</mo>            <mrow>             <mi>k</mi>             <mo>=</mo>             <mn>0</mn>            </mrow>            <msub>             <mi>K</mi>             <mi>a</mi>            </msub>           </munderover>           <mrow>            <mrow>             <mi>a</mi>             <mo>&#x2061;</mo>             <mo>(</mo>             <mi>k</mi>             <mo>)</mo>            </mrow>            <mo>&#x2062;</mo>            <msup>             <mi>e</mi>             <mrow>              <mrow>               <mo>-</mo>               <mi>j</mi>              </mrow>              <mo>&#x2062;</mo>              <mi>&#x3c9;</mi>              <mo>&#x2062;</mo>              <mi>k</mi>             </mrow>            </msup>           </mrow>          </mrow>          <mo>]</mo>         </mrow>         <mo>*</mo>        </msup>        <mo>&#x2062;</mo>        <mi>d</mi>        <mo>&#x2062;</mo>        <mi>&#x3c9;</mi>       </mrow>      </mrow>      <mo>+</mo>      <mrow>       <msubsup>        <mo>&#x222b;</mo>        <mrow>         <mo>-</mo>         <msub>          <mi>&#x3c9;</mi>          <mn>1</mn>         </msub>        </mrow>        <msub>         <mi>&#x3c9;</mi>         <mn>1</mn>        </msub>       </msubsup>       <mrow>        <msup>         <mrow>          <mrow>           <mo>[</mo>           <mrow>            <munderover>             <mo>&#x2211;</mo>             <mrow>              <mi>l</mi>              <mo>=</mo>              <mn>0</mn>             </mrow>             <msub>              <mi>K</mi>              <mi>a</mi>             </msub>            </munderover>            <mrow>             <mrow>              <mi>a</mi>              <mo>&#x2061;</mo>              <mo>(</mo>              <mi>l</mi>              <mo>)</mo>             </mrow>             <mo>&#x2062;</mo>             <msup>              <mi>e</mi>              <mrow>               <mrow>                <mo>-</mo>                <mi>j</mi>               </mrow>               <mo>&#x2062;</mo>               <mi>&#x3c9;</mi>               <mo>&#x2062;</mo>               <mi>l</mi>              </mrow>             </msup>            </mrow>           </mrow>           <mo>]</mo>          </mrow>          <mo>[</mo>          <mrow>           <munderover>            <mo>&#x2211;</mo>            <mrow>             <mi>k</mi>             <mo>=</mo>             <mn>0</mn>            </mrow>            <msub>             <mi>K</mi>             <mi>a</mi>            </msub>           </munderover>           <mrow>            <mrow>             <mi>a</mi>             <mo>&#x2061;</mo>             <mo>(</mo>             <mi>k</mi>             <mo>)</mo>            </mrow>            <mo>&#x2062;</mo>            <msup>             <mi>e</mi>             <mrow>              <mrow>               <mo>-</mo>               <mi>j</mi>              </mrow>              <mo>&#x2062;</mo>              <mi>&#x3c9;</mi>              <mo>&#x2062;</mo>              <mi>k</mi>             </mrow>            </msup>           </mrow>          </mrow>          <mo>]</mo>         </mrow>         <mo>*</mo>        </msup>        <mo>&#x2062;</mo>        <mi>d</mi>        <mo>&#x2062;</mo>        <mi>&#x3c9;</mi>       </mrow>      </mrow>     </mrow>    </mrow>   </mtd>   <mtd>    <mrow>     <mo>(</mo>     <mn>4</mn>     <mo>)</mo>    </mrow>   </mtd>  </mtr> </mtable></math></maths></p><p id="p-0066" num="0000">As evident from this equation [4], the cost function J<sub>2 </sub>is intended to express the energy of equalizer <b>402</b> outside of the band of interest, namely at frequencies higher than &#x3c9;<sub>2 </sub>and lower than &#x3c9;<sub>1</sub>.</p><p id="p-0067" num="0058">In process <b>608</b>, as noted above, the total cost function J of equation [2] is then optimized. In this example implementation, this optimization process <b>408</b> is a minimization of the total cost function J, namely a minimization of a weighted sum of cost function J<sub>1 </sub>expressing deviation of the equalized channel from the ideal response plus cost function J<sub>2 </sub>expressing the out-of-band energy of equalizer <b>402</b>, with the sum weighted by a parameter w that may be selected according to a design or system constraints, for example as determined by experimentation or characterization. Such a minimization of cost function J with equalizer coefficient vector &#xe2; can be derived from taking the partial derivative of cost function J with respect to coefficient conjugates a*(k), and setting that derivative to zero:</p><p id="p-0068" num="0000"><maths id="MATH-US-00004" num="00004"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <mrow>      <mfrac>       <mrow>        <mo>&#x2202;</mo>        <mi>J</mi>       </mrow>       <mrow>        <mo>&#x2202;</mo>        <mrow>         <msup>          <mi>a</mi>          <mo>*</mo>         </msup>         <mo>(</mo>         <mi>k</mi>         <mo>)</mo>        </mrow>       </mrow>      </mfrac>      <mo>=</mo>      <mrow>       <mrow>        <mfrac>         <mrow>          <mo>&#x2202;</mo>          <msub>           <mi>J</mi>           <mn>1</mn>          </msub>         </mrow>         <mrow>          <mo>&#x2202;</mo>          <mrow>           <msup>            <mi>a</mi>            <mo>*</mo>           </msup>           <mo>(</mo>           <mi>k</mi>           <mo>)</mo>          </mrow>         </mrow>        </mfrac>        <mo>+</mo>        <mrow>         <mi>w</mi>         <mo>&#x2062;</mo>         <mfrac>          <mrow>           <mo>&#x2202;</mo>           <msub>            <mi>J</mi>            <mn>2</mn>           </msub>          </mrow>          <mrow>           <mo>&#x2202;</mo>           <mrow>            <msup>             <mi>a</mi>             <mo>*</mo>            </msup>            <mo>(</mo>            <mi>k</mi>            <mo>)</mo>           </mrow>          </mrow>         </mfrac>        </mrow>       </mrow>       <mo>=</mo>       <mn>0</mn>      </mrow>     </mrow>     <mo>,</mo>     <mtext>    </mtext>     <mrow>      <mi>k</mi>      <mo>=</mo>      <mn>0</mn>     </mrow>     <mo>,</mo>     <mn>1</mn>     <mo>,</mo>     <mtext>   </mtext>     <mo>&#x2026;</mo>     <mtext>   </mtext>     <mo>,</mo>     <mrow>      <msub>       <mi>K</mi>       <mi>a</mi>      </msub>      <mo>-</mo>      <mn>1</mn>     </mrow>    </mrow>   </mtd>   <mtd>    <mrow>     <mo>[</mo>     <mn>5</mn>     <mo>]</mo>    </mrow>   </mtd>  </mtr> </mtable></math></maths></p><p id="p-0069" num="0000">A solution for an optimal a vector can be derived from:</p><p id="p-0070" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?>(<i>R</i><sub>1</sub>+<i>wR</i><sub>2</sub>)<i>a=h</i><sub>p</sub>&#x2003;&#x2003;(6)<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0071" num="0000">where a=[a(0) . . . a(K<sub>a</sub>&#x2212;1)]<sup>T</sup>, and the elements of matrices R<sub>1 </sub>, R<sub>2</sub>, and h are defined as:</p><p id="p-0072" num="0000"><maths id="MATH-US-00005" num="00005"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <mrow>      <msub>       <mi>R</mi>       <mn>1</mn>      </msub>      <mo>(</mo>      <mrow>       <mi>l</mi>       <mo>,</mo>       <mi>k</mi>      </mrow>      <mo>)</mo>     </mrow>     <mo>=</mo>     <mrow>      <munderover>       <mo>&#x2211;</mo>       <mrow>        <msub>         <mi>k</mi>         <mn>1</mn>        </msub>        <mo>=</mo>        <mn>0</mn>       </mrow>       <mrow>        <msub>         <mi>K</mi>         <mi>c</mi>        </msub>        <mo>-</mo>        <mn>1</mn>       </mrow>      </munderover>      <mrow>       <munderover>        <mo>&#x2211;</mo>        <mrow>         <msub>          <mi>k</mi>          <mn>2</mn>         </msub>         <mo>=</mo>         <mn>0</mn>        </mrow>        <mrow>         <msub>          <mi>K</mi>          <mi>c</mi>         </msub>         <mo>-</mo>         <mn>1</mn>        </mrow>       </munderover>       <mrow>        <mrow>         <mi>h</mi>         <mo>&#x2061;</mo>         <mo>(</mo>         <mrow>          <msub>           <mi>k</mi>           <mn>1</mn>          </msub>          <mo>-</mo>          <mi>k</mi>         </mrow>         <mo>)</mo>        </mrow>        <mo>&#x2062;</mo>        <mrow>         <msup>          <mi>h</mi>          <mo>*</mo>         </msup>         <mo>(</mo>         <mrow>          <msub>           <mi>k</mi>           <mn>2</mn>          </msub>          <mo>-</mo>          <mi>k</mi>         </mrow>         <mo>)</mo>        </mrow>        <mo>&#x2062;</mo>        <mn>2</mn>        <mo>&#x2062;</mo>        <mrow>         <mo>{</mo>         <mrow>          <mrow>           <msub>            <mi>&#x3c9;</mi>            <mn>2</mn>           </msub>           <mo>&#x2062;</mo>           <mi>s</mi>           <mo>&#x2062;</mo>           <mrow>            <mi>inc</mi>            <mtext> </mtext>            <mo>[</mo>            <mfrac>             <mrow>              <msub>               <mi>&#x3c9;</mi>               <mn>2</mn>              </msub>              <mo>(</mo>              <mrow>               <msub>                <mi>k</mi>                <mn>1</mn>               </msub>               <mo>-</mo>               <msub>                <mi>k</mi>                <mn>2</mn>               </msub>              </mrow>              <mo>)</mo>             </mrow>             <mi>&#x3c0;</mi>            </mfrac>            <mo>]</mo>           </mrow>          </mrow>          <mo>-</mo>          <mspace linebreak="newline"/>          <mrow>           <msub>            <mi>&#x3c9;</mi>            <mn>1</mn>           </msub>           <mo>&#x2062;</mo>           <mi>s</mi>           <mo>&#x2062;</mo>           <mi>i</mi>           <mo>&#x2062;</mo>           <mi>n</mi>           <mo>&#x2062;</mo>           <mrow>            <mi>c</mi>            <mo>[</mo>            <mfrac>             <mrow>              <msub>               <mi>&#x3c9;</mi>               <mn>1</mn>              </msub>              <mo>(</mo>              <mrow>               <msub>                <mi>k</mi>                <mn>1</mn>               </msub>               <mo>-</mo>               <msub>                <mi>k</mi>                <mn>2</mn>               </msub>              </mrow>              <mo>)</mo>             </mrow>             <mi>&#x3c0;</mi>            </mfrac>            <mo>]</mo>           </mrow>          </mrow>         </mrow>         <mo>}</mo>        </mrow>       </mrow>      </mrow>     </mrow>    </mrow>   </mtd>   <mtd>    <mrow>     <mo>[</mo>     <mn>7</mn>     <mo>]</mo>    </mrow>   </mtd>  </mtr> </mtable></math></maths><maths id="MATH-US-00005-2" num="00005.2"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <mrow>      <msub>       <mi>R</mi>       <mn>2</mn>      </msub>      <mo>(</mo>      <mrow>       <mi>l</mi>       <mo>,</mo>       <mi>k</mi>      </mrow>      <mo>)</mo>     </mrow>     <mo>=</mo>     <mrow>      <mrow>       <mn>2</mn>       <mo>&#x2062;</mo>       <mi>&#x3c0;</mi>       <mo>&#x2062;</mo>       <mi>s</mi>       <mo>&#x2062;</mo>       <mi>i</mi>       <mo>&#x2062;</mo>       <mi>n</mi>       <mo>&#x2062;</mo>       <mrow>        <mi>c</mi>        <mo>&#x2061;</mo>        <mo>(</mo>        <mrow>         <mi>l</mi>         <mo>-</mo>         <mi>k</mi>        </mrow>        <mo>)</mo>       </mrow>      </mrow>      <mo>-</mo>      <mrow>       <mn>2</mn>       <mo>&#x2062;</mo>       <msub>        <mi>&#x3c9;</mi>        <mn>2</mn>       </msub>       <mo>&#x2062;</mo>       <mi>s</mi>       <mo>&#x2062;</mo>       <mi>i</mi>       <mo>&#x2062;</mo>       <mi>n</mi>       <mo>&#x2062;</mo>       <mrow>        <mi>c</mi>        <mo>[</mo>        <mfrac>         <mrow>          <msub>           <mi>&#x3c9;</mi>           <mn>2</mn>          </msub>          <mo>(</mo>          <mrow>           <mi>l</mi>           <mo>-</mo>           <mi>k</mi>          </mrow>          <mo>)</mo>         </mrow>         <mi>&#x3c0;</mi>        </mfrac>        <mo>]</mo>       </mrow>      </mrow>      <mo>+</mo>      <mrow>       <mn>2</mn>       <mo>&#x2062;</mo>       <msub>        <mi>&#x3c9;</mi>        <mn>1</mn>       </msub>       <mo>&#x2062;</mo>       <mi>s</mi>       <mo>&#x2062;</mo>       <mi>i</mi>       <mo>&#x2062;</mo>       <mi>n</mi>       <mo>&#x2062;</mo>       <mrow>        <mi>c</mi>        <mo>[</mo>        <mfrac>         <mrow>          <msub>           <mi>&#x3c9;</mi>           <mn>1</mn>          </msub>          <mo>(</mo>          <mrow>           <mi>l</mi>           <mo>-</mo>           <mi>k</mi>          </mrow>          <mo>)</mo>         </mrow>         <mi>&#x3c0;</mi>        </mfrac>        <mo>]</mo>       </mrow>      </mrow>     </mrow>    </mrow>   </mtd>   <mtd>    <mrow>     <mo>[</mo>     <mn>8</mn>     <mo>]</mo>    </mrow>   </mtd>  </mtr> </mtable></math></maths><maths id="MATH-US-00005-3" num="00005.3"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <mrow>      <msub>       <mi>h</mi>       <mi>p</mi>      </msub>      <mo>(</mo>      <mi>k</mi>      <mo>)</mo>     </mrow>     <mo>=</mo>     <mrow>      <munderover>       <mo>&#x2211;</mo>       <mrow>        <msub>         <mi>k</mi>         <mn>2</mn>        </msub>        <mo>=</mo>        <mn>0</mn>       </mrow>       <mrow>        <msub>         <mi>K</mi>         <mi>c</mi>        </msub>        <mo>-</mo>        <mn>1</mn>       </mrow>      </munderover>      <mrow>       <mrow>        <msup>         <mi>h</mi>         <mo>*</mo>        </msup>        <mo>(</mo>        <mrow>         <msub>          <mi>k</mi>          <mn>2</mn>         </msub>         <mo>-</mo>         <mi>k</mi>        </mrow>        <mo>)</mo>       </mrow>       <mo>&#x2062;</mo>       <mn>2</mn>       <mo>&#x2062;</mo>       <mrow>        <mo>{</mo>        <mrow>         <mrow>          <msub>           <mi>&#x3c9;</mi>           <mn>2</mn>          </msub>          <mo>&#x2062;</mo>          <mi>s</mi>          <mo>&#x2062;</mo>          <mi>i</mi>          <mo>&#x2062;</mo>          <mi>n</mi>          <mo>&#x2062;</mo>          <mrow>           <mi>c</mi>           <mo>[</mo>           <mfrac>            <mrow>             <msub>              <mi>&#x3c9;</mi>              <mn>2</mn>             </msub>             <mo>(</mo>             <mrow>              <msub>               <mi>n</mi>               <mn>0</mn>              </msub>              <mo>-</mo>              <msub>               <mi>k</mi>               <mn>2</mn>              </msub>             </mrow>             <mo>)</mo>            </mrow>            <mi>&#x3c0;</mi>           </mfrac>           <mo>]</mo>          </mrow>         </mrow>         <mo>-</mo>         <mrow>          <msub>           <mi>&#x3c9;</mi>           <mn>1</mn>          </msub>          <mo>&#x2062;</mo>          <mi>s</mi>          <mo>&#x2062;</mo>          <mi>i</mi>          <mo>&#x2062;</mo>          <mi>n</mi>          <mo>&#x2062;</mo>          <mrow>           <mi>c</mi>           <mo>[</mo>           <mfrac>            <mrow>             <msub>              <mi>&#x3c9;</mi>              <mn>1</mn>             </msub>             <mo>(</mo>             <mrow>              <msub>               <mi>n</mi>               <mn>0</mn>              </msub>              <mo>-</mo>              <msub>               <mi>k</mi>               <mn>2</mn>              </msub>             </mrow>             <mo>)</mo>            </mrow>            <mi>&#x3c0;</mi>           </mfrac>           <mo>]</mo>          </mrow>         </mrow>        </mrow>        <mo>}</mo>       </mrow>      </mrow>     </mrow>    </mrow>   </mtd>   <mtd>    <mrow>     <mo>[</mo>     <mn>9</mn>     <mo>]</mo>    </mrow>   </mtd>  </mtr> </mtable></math></maths></p><p id="p-0073" num="0000">Because R<sub>1 </sub>and R<sub>2 </sub>are Toeplitz matrices, only the first row and first column of those matrices need be calculated. Following this calculation, the optimal equalizer coefficient vector &#xe2; that minimizes cost function J is given by:</p><p id="p-0074" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>&#xe2;</i>=(<i>R</i><sub>1</sub>+<i>wR</i><sub>2</sub>)<sup>&#x2212;1</sup><i>h</i><sub>p</sub>&#x2003;&#x2003;(10)<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0075" num="0000">The tap weights, or coefficients, of equalizer <b>402</b> can then be set according to this vector optimal equalizer coefficient vector &#xe2; as determined from the minimization of cost function J in process <b>608</b>.</p><p id="p-0076" num="0059"><figref idref="DRAWINGS">FIG. <b>8</b></figref> illustrates the performance of an example of equalizer <b>402</b> according to an example implementation of the architecture of <figref idref="DRAWINGS">FIG. <b>4</b></figref>, in the form of the normalized output of time-domain correlation (in dB) over time of a 1 msec ultrasonic &#x201c;chirp&#x201d; of 20 kHz bandwidth centered at 30 kHz (i.e., the chirp varies in frequency from 20 kHz to 40 kHz), as expressed in numbers of samples at a 96 kHz sampling rate. Plots <b>302</b> and <b>304</b> are the same correlation plots as shown in <figref idref="DRAWINGS">FIG. <b>3</b>C</figref>, with plot <b>302</b> illustrating the correlation for a theoretical speaker and microphone that both have ideal frequency response characteristics (i.e., flat over 20 kHz to 40 kHz). Plot <b>304</b> illustrates the correlation for the same chirp by speaker <b>108</b> and microphone <b>108</b> with the frequency responses shown in <figref idref="DRAWINGS">FIG. <b>3</b>A</figref> and <figref idref="DRAWINGS">FIG. <b>3</b>B</figref>, respectively, with no equalization performed on the ultrasonic signal. In contrast, plot <b>806</b> of <figref idref="DRAWINGS">FIG. <b>8</b></figref> illustrates the correlation performance of the same speaker and microphone <b>108</b> with an equalizer <b>402</b> pre-compensating the ultrasonic chirp in an architecture as shown in <figref idref="DRAWINGS">FIG. <b>4</b></figref>, where the equalizer <b>402</b> is realized as a 51-tap (K<sub>a</sub>=51) FIR equalizer with coefficients as defined by equations [1] through [10] and implemented by the process of <figref idref="DRAWINGS">FIG. <b>6</b></figref>. As evident from <figref idref="DRAWINGS">FIG. <b>8</b></figref>, the side lobe echoes of plot <b>806</b> are substantially attenuated from those of the no-equalizer plot <b>304</b>, and for the echoes close to the peak lobe, approach the performance of the ideal channel response of plot <b>302</b>. As such, the width in time of the main echo of the ultrasonic chirp from a detected object is much reduced, facilitating the ability of the ultrasonic presence detection to separate multiple objects from one another and thus increase spatial resolution. While equalized plot <b>806</b> indicates some later sidelobes that have a higher amplitude (e.g., the sidelobe at about 1060 samples), it is contemplated that these later echoes can be readily filtered out or otherwise ignored in the presence determination process.</p><p id="p-0077" num="0060">According to another implementation, equalization to compensate for channel response non-idealities may be applied to ultrasonic signals as received from microphone <b>109</b>, rather than prior to output by speaker <b>108</b>. <figref idref="DRAWINGS">FIG. <b>9</b></figref> illustrates the construction and functional arrangement of ultrasonic processing function <b>920</b> as may be implemented in digital audio amplifier <b>200</b> in audio system <b>106</b> according to an example of this other implementation. Those components of ultrasonic processing function <b>920</b> and digital audio amplifier <b>200</b> in <figref idref="DRAWINGS">FIG. <b>9</b></figref> that are the same as in the architecture of <figref idref="DRAWINGS">FIG. <b>4</b></figref> are indicated by the same reference numerals.</p><p id="p-0078" num="0061">In the arrangement of <figref idref="DRAWINGS">FIG. <b>9</b></figref>, the ultrasonic burst generated by burst generation function <b>400</b> is applied without equalization to gain stage <b>405</b>. Optional amplitude control function <b>404</b> is coupled to gain stage <b>405</b> and also to burst generation function <b>400</b> itself, as described above, to reduce the gain of the ultrasonic signal from burst generation function <b>400</b> or to block generation of the ultrasonic signal altogether, for example to reduce clipping at the output if the amplitude of the audible audio signal is high. The ultrasonic and audible audio signals are summed at signal adder <b>407</b> and converted by PWM generation circuitry <b>224</b> to a PWM signal for driving speaker <b>108</b>.</p><p id="p-0079" num="0062">On the receive side of ultrasonic processing function <b>920</b> shown in <figref idref="DRAWINGS">FIG. <b>9</b></figref>, as in the implementation of <figref idref="DRAWINGS">FIG. <b>4</b></figref>, signals received from microphone <b>109</b> are amplified by LNA <b>420</b>, converted from analog to digital by ADC <b>422</b>, and applied to upstream separation function <b>424</b> for separation of the ultrasonic portion of the received signal from the audible frequency portion of that signal, for example by way of a digital filter function executed by digital signal processor <b>220</b>.</p><p id="p-0080" num="0063">In the example implementation of <figref idref="DRAWINGS">FIG. <b>9</b></figref>, ultrasonic processing function <b>920</b> includes equalizer <b>902</b> to compensate the ultrasonic signal as received according to the frequency response characteristics of both speaker <b>108</b> and microphone <b>109</b> over the ultrasonic frequencies of interest. Since the received signals have been converted to the digital domain by ADC <b>422</b>, equalizer <b>902</b> may be realized by way of a discrete-time equalizer, such as a continuous-time discrete-time linear equalizer, for example as executed by digital signal processor circuitry in audio processor <b>204</b>. As in the case of the transmit side equalizer <b>402</b>, equalizer <b>902</b> on the receive side of ultrasonic audio processing function <b>220</b> is operating only on signal frequencies within a relatively narrow band of interest, and such that it can be efficiently realized as compared with equalizers covering a full frequency range including both audible and ultrasonic frequencies. Equalizer <b>902</b> may also be arranged according to the same or similar process of selecting the appropriate coefficients and other parameters for a particular combination of speaker <b>108</b> and microphone <b>109</b> as described above relative to <figref idref="DRAWINGS">FIG. <b>6</b></figref>. For example, it is contemplated that the determination of the digital filter coefficients for the equalizer as described above relative to equations [1] through [10] similarly applies to the definition of coefficients for equalizer <b>902</b>.</p><p id="p-0081" num="0064">In this example implementation of <figref idref="DRAWINGS">FIG. <b>9</b></figref>, the equalized signal, for example in the form of an equalized discrete-time sample stream, is forwarded by equalizer <b>902</b> to correlator <b>426</b>, which correlates this equalized signal with a copy or template of the ultrasonic burst generated by burst generation function <b>400</b> to determine the time relationship between the generation of the ultrasonic burst by burst generation function <b>400</b> and the receipt of the separated equalized received signal and thus determine a delay time between the two signals, for example by performing a time domain correlation. Envelope calculation function <b>428</b> receives the correlation signal from correlator <b>426</b>, derives a time-domain envelope of that correlation signal to exclude the carrier frequencies, and applies the correlation envelope signal to comparator <b>430</b> for comparison with a threshold level or threshold map, as described above, to detect a delay time at the peak correlation. A discrete-time signal representative of the results of comparisons of the envelope of the correlation signal with the threshold level or map over the relevant time period produced by comparator <b>430</b> is applied to time-of-flight calculation function <b>432</b>, which in turn calculates a time-of-flight, or two-way travel time, of the ultrasonic burst to and from the detected object. As in the implementation of <figref idref="DRAWINGS">FIG. <b>4</b></figref>, this calculated time-of-flight can then be communicated to digital processor system <b>102</b> or other appropriate processing logic for use in calculating distance of motion of the reflecting object or objects as useful in presence detection, motion detection, gesture detection, directivity control of audible audio output, or such other operational functions of audio/video system <b>100</b> as desired.</p><p id="p-0082" num="0065">Whether realized at the generation of the ultrasonic presence detection signal, or applied to the received ultrasonic echo, the equalization of the ultrasonic signal according to these examples accurately reduces the width of received echoes upon correlation with the ultrasonic burst, thus improving the spatial resolution of presence detection. Furthermore, the band-limited equalization performed according to these examples can be optimized for the ultrasonic frequencies of interest without consideration of frequencies outside of the detection signal such as audible frequencies, enabling efficient implementation of the equalizer from the standpoints of hardware and computational complexity.</p><p id="p-0083" num="0066">According to another implementation, one or more speakers are provided for ultrasonic audio signals, separate from the speakers for the audible audio signals. <figref idref="DRAWINGS">FIG. <b>10</b></figref> illustrates the construction and functional arrangement of ultrasonic processing function <b>1020</b> as may be implemented in digital audio amplifier <b>1000</b> in audio system <b>106</b> according to an example of this other implementation. Those components of ultrasonic processing function <b>1020</b> and digital audio amplifier <b>1000</b> in <figref idref="DRAWINGS">FIG. <b>10</b></figref> that are the same as in the architecture of <figref idref="DRAWINGS">FIG. <b>4</b></figref> are indicated by the same reference numerals.</p><p id="p-0084" num="0067">In the arrangement of <figref idref="DRAWINGS">FIG. <b>10</b></figref>, the ultrasonic burst generated by burst generation function <b>400</b> is equalized by equalizer <b>402</b> and applied to gain stage <b>405</b>, with optional amplitude control function <b>404</b> (if present) coupled to gain stage <b>405</b> and burst generation function <b>400</b>, as described above, to reduce the gain of or block the ultrasonic signal from burst generation function <b>400</b> in response to the amplitude of the audible audio signal being high. Alternatively, amplitude control function <b>404</b> may receive another control signal, for example from digital processor system <b>102</b>, for adjusting the amplitude of the ultrasonic burst as described above in connection with <figref idref="DRAWINGS">FIG. <b>4</b></figref>. In any case, according to this implementation, the audible audio signals from audio processing function <b>210</b> are applied directly to PWM generation circuitry <b>1024</b>A, and the ultrasonic audio signals from gain stage <b>405</b> are applied directly to separate PWM generation circuitry <b>1024</b>U, with no combining of the audible and ultrasonic audio signals as in the implementations described above relative to <figref idref="DRAWINGS">FIG. <b>4</b></figref> and <figref idref="DRAWINGS">FIG. <b>9</b></figref>. Ultrasonic PWM generation circuitry <b>1024</b>U drives speaker <b>1028</b>U, while audible PWM generation circuitry <b>1024</b>A drives separate speaker <b>1028</b>A.</p><p id="p-0085" num="0068">The receive side of ultrasonic processing function <b>1020</b> shown in <figref idref="DRAWINGS">FIG. <b>10</b></figref> in this implementation may be constructed and operate the same as described above for the implementation of <figref idref="DRAWINGS">FIG. <b>4</b></figref>.</p><p id="p-0086" num="0069">Alternatively, the implementation described above relative to <figref idref="DRAWINGS">FIG. <b>10</b></figref>, with separate speakers <b>1028</b>A, <b>1028</b>U for the audible and ultrasonic audio signals, respectively, may be applied to the architecture described above relative to <figref idref="DRAWINGS">FIG. <b>9</b></figref> in which equalization of ultrasonic signals is performed on the receive side, for example after separation of the ultrasonic and audible audio signals.</p><p id="p-0087" num="0070">In any case, the use of separate speakers for the ultrasonic and audible audio output may provide additional flexibility and accuracy in ultrasonic presence detection. For example, according to this implementation the placement of separate ultrasonic speakers <b>1028</b>U is not constrained to the placement of speakers <b>1028</b>A for the audible audio. This allows the placement of audible speakers <b>1028</b>A to be defined for a pleasing audio experience, while ultrasonic speakers <b>1028</b>U can be separately placed to obtain the desired effectiveness and accuracy of presence detection, especially considering that the physical size of speakers <b>1028</b>U for ultrasonic output can be significantly smaller than that of audible speakers <b>1028</b>A outputting the lower frequency audible audio output.</p><p id="p-0088" num="0071">The term &#x201c;couple&#x201d;, as used herein, may cover connections, communications, or signal paths that enable a functional relationship consistent with this description. For example, if device A generates a signal to control device B to perform an action, in a first example device A is coupled to device B, or in a second example device A is coupled to device B through intervening component C if intervening component C does not substantially alter the functional relationship between device A and device B such that device B is controlled by device A via the control signal generated by device A. A device that is &#x201c;configured to&#x201d; perform a task or function may be configured (e.g., programmed and/or hardwired) at a time of manufacturing by a manufacturer to perform the function and/or may be configurable (or re-configurable) by a user after manufacturing to perform the function and/or other additional or alternative functions. The configuring may be through firmware and/or software programming of the device, through a construction and/or layout of hardware components and interconnections of the device, or a combination thereof</p><p id="p-0089" num="0072">As used herein, the terms &#x201c;terminal&#x201d;, &#x201c;node&#x201d;, &#x201c;interconnection&#x201d; and &#x201c;pin&#x201d; are used interchangeably. Unless specifically stated to the contrary, these terms are generally used to mean an interconnection between or a terminus of a device element, a circuit element, an integrated circuit, a device, or other electronics or semiconductor component.</p><p id="p-0090" num="0073">Unless otherwise stated, &#x201c;about,&#x201d; &#x201c;approximately,&#x201d; or &#x201c;substantially&#x201d; preceding a value means +/&#x2212;10 percent of the stated value. Modifications are possible in the described examples, and other examples are possible within the scope of the claims.</p><?detailed-description description="Detailed Description" end="tail"?></description><us-math idrefs="MATH-US-00001" nb-file="US20230003880A1-20230105-M00001.NB"><img id="EMI-M00001" he="8.47mm" wi="76.20mm" file="US20230003880A1-20230105-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00002" nb-file="US20230003880A1-20230105-M00002.NB"><img id="EMI-M00002" he="19.73mm" wi="76.20mm" file="US20230003880A1-20230105-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00003" nb-file="US20230003880A1-20230105-M00003.NB"><img id="EMI-M00003" he="28.53mm" wi="76.20mm" file="US20230003880A1-20230105-M00003.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00004" nb-file="US20230003880A1-20230105-M00004.NB"><img id="EMI-M00004" he="6.01mm" wi="76.20mm" file="US20230003880A1-20230105-M00004.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00005 MATH-US-00005-2 MATH-US-00005-3" nb-file="US20230003880A1-20230105-M00005.NB"><img id="EMI-M00005" he="32.77mm" wi="76.20mm" file="US20230003880A1-20230105-M00005.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-claim-statement>What is claimed is:</us-claim-statement><claims id="claims"><claim id="CLM-00001" num="00001"><claim-text><b>1</b>. A method of performing ultrasonic detection, comprising:<claim-text>generating an ultrasonic burst signal at one or more ultrasonic frequencies;</claim-text><claim-text>equalizing the ultrasonic burst signal according to frequency response characteristics of a speaker and a microphone at the one or more ultrasonic frequencies;</claim-text><claim-text>driving one or more speakers according to the equalized ultrasonic burst signal;</claim-text><claim-text>receiving a signal corresponding to audio detected by at least one microphone; and</claim-text><claim-text>determining a delay time of an echo corresponding to the ultrasonic burst signal in an ultrasonic portion of the received signal.</claim-text></claim-text></claim><claim id="CLM-00002" num="00002"><claim-text><b>2</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the equalizing step comprises:<claim-text>applying the ultrasonic burst signal to a discrete-time filter, the discrete-time filter having a plurality of coefficients;</claim-text><claim-text>and wherein the method further comprises:</claim-text><claim-text>determining the plurality of coefficients according to a cost function comprising a weighted sum of an in-band portion for a frequency range including the one or more ultrasonic frequencies and an out-of-band portion for frequencies outside of the frequency range.</claim-text></claim-text></claim><claim id="CLM-00003" num="00003"><claim-text><b>3</b>. The method of <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein the determining step comprises:<claim-text>acquiring a channel response according to the frequency response characteristics of the speaker and the microphone;</claim-text><claim-text>determining the in-band portion of the cost function as a difference between a convolution of the channel response with the discrete-time filter and a desired response for the frequency range;</claim-text><claim-text>determining the out-of-band portion of the cost function as a measure of energy of the discrete-time filter for frequencies outside of the frequency range;</claim-text><claim-text>determining the coefficients of the discrete-time filter from a minimization of a weighted sum of the cost function.</claim-text></claim-text></claim><claim id="CLM-00004" num="00004"><claim-text><b>4</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:<claim-text>adjusting an amplitude of the equalized ultrasonic burst signal responsive to an amplitude of an audio signal at audio frequencies.</claim-text></claim-text></claim><claim id="CLM-00005" num="00005"><claim-text><b>5</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the ultrasonic burst signal comprises a burst of sinusoidal pulses at a plurality of ultrasonic frequencies.</claim-text></claim><claim id="CLM-00006" num="00006"><claim-text><b>6</b>. The method of <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein the step of determining a delay time comprises:<claim-text>filtering the received signal to separate an ultrasonic portion including the one or more ultrasonic frequencies of the ultrasonic burst signal;</claim-text><claim-text>correlating over time the ultrasonic portion of the received signal with a template of the ultrasonic burst signal;</claim-text><claim-text>comparing an envelope of the correlated signals with a threshold to identify the delay time.</claim-text></claim-text></claim><claim id="CLM-00007" num="00007"><claim-text><b>7</b>. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein the threshold comprises a time-varying threshold map.</claim-text></claim><claim id="CLM-00008" num="00008"><claim-text><b>8</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the ultrasonic burst signal comprises a burst of sinusoidal pulses at a single ultrasonic frequency.</claim-text></claim><claim id="CLM-00009" num="00009"><claim-text><b>9</b>. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the step of determining a delay time comprises:<claim-text>band-pass filtering the received signal to extract a portion at the ultrasonic frequency of the ultrasonic burst signal.</claim-text><claim-text>comparing an envelope of the extracted portion of the received signal with a threshold to identify the delay time.</claim-text></claim-text></claim><claim id="CLM-00010" num="00010"><claim-text><b>10</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:<claim-text>combining the equalized ultrasonic burst signal with an audio signal at audible frequencies;</claim-text><claim-text>and wherein the driving step comprises:</claim-text><claim-text>driving the one or more speakers according to the combined signal.</claim-text></claim-text></claim><claim id="CLM-00011" num="00011"><claim-text><b>11</b>. Audio processor circuitry, comprising:<claim-text>an ultrasonic burst generator, having an output presenting an ultrasonic burst signal at one or more ultrasonic frequencies;</claim-text><claim-text>an equalizer coupled to the ultrasonic burst generator, and arranged to equalize the ultrasonic burst signal according to frequency response characteristics of a speaker and a microphone at the one or more ultrasonic frequencies;</claim-text><claim-text>a speaker driver, having an output presenting a drive signal according to the equalized ultrasonic signal;</claim-text><claim-text>an interface having an input for receiving a signal from at least one microphone; and</claim-text><claim-text>an ultrasonic separation filter adapted to separate an ultrasonic portion from the received signal; and</claim-text><claim-text>processing circuitry adapted to determine a delay time of an echo corresponding to the ultrasonic burst signal in the ultrasonic portion of the received signal.</claim-text></claim-text></claim><claim id="CLM-00012" num="00012"><claim-text><b>12</b>. The circuitry of <claim-ref idref="CLM-00011">claim 11</claim-ref>, further comprising:<claim-text>a gain stage having an input coupled to an output of the equalizer, and having an output coupled to the speaker driver; and</claim-text><claim-text>an amplitude control, coupled to the gain stage, for controlling a gain applied by the gain stage responsive to an amplitude of an audio signal at audible frequencies.</claim-text></claim-text></claim><claim id="CLM-00013" num="00013"><claim-text><b>13</b>. The circuitry of <claim-ref idref="CLM-00011">claim 11</claim-ref>, further comprising:<claim-text>a signal adder coupled to the equalizer, and having an output presenting a signal combining the equalized ultrasonic burst signal with an audio signal at audible frequencies;</claim-text><claim-text>and wherein the speaker driver presents, at its output, a signal combining the equalized ultrasonic burst signal with the audio signal at audible frequencies.</claim-text></claim-text></claim><claim id="CLM-00014" num="00014"><claim-text><b>14</b>. The circuitry of <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein the ultrasonic burst signal comprises a burst of sinusoidal pulses at a plurality of ultrasonic frequencies.</claim-text></claim><claim id="CLM-00015" num="00015"><claim-text><b>15</b>. The circuitry of <claim-ref idref="CLM-00014">claim 14</claim-ref>, wherein the processing circuitry comprises:<claim-text>a correlator adapted to correlate over time the separated ultrasonic portion of the received signal with a template of the ultrasonic burst signal;</claim-text><claim-text>an envelope calculation function adapted to calculate an envelope of the correlated signals; and</claim-text><claim-text>a comparator adapted to compare the envelope of the correlated signals with a threshold.</claim-text></claim-text></claim><claim id="CLM-00016" num="00016"><claim-text><b>16</b>. The circuitry of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the threshold comprises a time-varying threshold map.</claim-text></claim><claim id="CLM-00017" num="00017"><claim-text><b>17</b>. The circuitry of <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein the ultrasonic burst signal comprises a burst of sinusoidal pulses at a single ultrasonic frequency.</claim-text></claim><claim id="CLM-00018" num="00018"><claim-text><b>18</b>. The circuitry of <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein the equalizer comprises a discrete-time filter having a plurality of selected coefficients;<claim-text>wherein the plurality of coefficients are selected according to a cost function comprising a weighted sum of an in-band portion for a frequency range including the one or more ultrasonic frequencies and an out-of-band portion for frequencies outside of the frequency range.</claim-text></claim-text></claim><claim id="CLM-00019" num="00019"><claim-text><b>19</b>. Audio processor circuitry, comprising:<claim-text>an ultrasonic burst generator, having an output presenting an ultrasonic burst signal at one or more ultrasonic frequencies;</claim-text><claim-text>a speaker driver, having an output presenting a drive signal according to the ultrasonic burst signal;</claim-text><claim-text>an interface having an input for receiving a signal from at least one microphone; and</claim-text><claim-text>an ultrasonic separation filter adapted to separate an ultrasonic portion from the received signal;</claim-text><claim-text>an equalizer coupled to the ultrasonic separation filter, and arranged to equalize the ultrasonic portion of the received signal according to frequency response characteristics of a speaker and a microphone at the one or more ultrasonic frequencies; and</claim-text><claim-text>processing circuitry adapted to determine a delay time of an echo corresponding to the ultrasonic burst signal in the equalized ultrasonic portion of the received signal.</claim-text></claim-text></claim><claim id="CLM-00020" num="00020"><claim-text><b>20</b>. The circuitry of <claim-ref idref="CLM-00019">claim 19</claim-ref>, wherein the equalizer comprises a discrete-time filter having a plurality of selected coefficients;<claim-text>wherein the plurality of coefficients are selected according to a cost function comprising a weighted sum of an in-band portion for a frequency range including the one or more ultrasonic frequencies and an out-of-band portion for frequencies outside of the frequency range.</claim-text></claim-text></claim><claim id="CLM-00021" num="00021"><claim-text><b>21</b>. The circuitry of <claim-ref idref="CLM-00019">claim 19</claim-ref>, further comprising:<claim-text>a signal adder coupled to the equalizer, and having an output presenting a signal combining the ultrasonic burst signal with an audio signal at audible frequencies;</claim-text><claim-text>and wherein the speaker driver presents, at its output, a drive signal according to the combined signal.</claim-text></claim-text></claim><claim id="CLM-00022" num="00022"><claim-text><b>22</b>. A method of performing ultrasonic detection, comprising:<claim-text>generating an ultrasonic burst signal at one or more ultrasonic frequencies;</claim-text><claim-text>driving one or more speakers according to the ultrasonic burst signal;</claim-text><claim-text>receiving a signal corresponding to audio detected by at least one microphone;</claim-text><claim-text>equalizing an ultrasonic portion of the received signal according to frequency response characteristics of a speaker and a microphone at the one or more ultrasonic frequencies; and</claim-text><claim-text>determining a delay time of an echo corresponding to the ultrasonic burst signal in an ultrasonic portion of the received signal.</claim-text></claim-text></claim><claim id="CLM-00023" num="00023"><claim-text><b>23</b>. The method of <claim-ref idref="CLM-00022">claim 22</claim-ref>, wherein the equalizing step comprises:<claim-text>applying the ultrasonic portion of the received signal to a discrete-time filter, the discrete-time filter having a plurality of coefficients;</claim-text><claim-text>and wherein the method further comprises:</claim-text><claim-text>determining the plurality of coefficients according to a cost function comprising a weighted sum of an in-band portion for a frequency range including the one or more ultrasonic frequencies and an out-of-band portion for frequencies outside of the frequency range.</claim-text></claim-text></claim><claim id="CLM-00024" num="00024"><claim-text><b>24</b>. The method of <claim-ref idref="CLM-00022">claim 22</claim-ref>, wherein the determining step comprises:<claim-text>acquiring a channel response according to the frequency response characteristics of the speaker and the microphone;</claim-text><claim-text>determining the in-band portion of the cost function as a difference between a convolution of the channel response with the discrete-time filter and a desired response for the frequency range;</claim-text><claim-text>determining the out-of-band portion of the cost function as a measure of energy of the discrete-time filter for frequencies outside of the frequency range;</claim-text><claim-text>determining the coefficients of the discrete-time filter from a minimization of a weighted sum of the cost function.</claim-text></claim-text></claim></claims></us-patent-application>