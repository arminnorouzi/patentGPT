<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230007472A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230007472</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17867939</doc-number><date>20220719</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><priority-claims><priority-claim sequence="01" kind="national"><country>CN</country><doc-number>201910351464.X</doc-number><date>20190428</date></priority-claim></priority-claims><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>W</subclass><main-group>12</main-group><subgroup>033</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>W</subclass><main-group>76</main-group><subgroup>19</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>W</subclass><main-group>12</main-group><subgroup>0431</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>W</subclass><main-group>12</main-group><subgroup>041</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>W</subclass><main-group>12</main-group><subgroup>10</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20210101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>W</subclass><main-group>12</main-group><subgroup>033</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc><further-cpc><classification-cpc><cpc-version-indicator><date>20180201</date></cpc-version-indicator><section>H</section><class>04</class><subclass>W</subclass><main-group>76</main-group><subgroup>19</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20210101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>W</subclass><main-group>12</main-group><subgroup>0431</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20210101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>W</subclass><main-group>12</main-group><subgroup>041</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>W</subclass><main-group>12</main-group><subgroup>10</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></further-cpc></classifications-cpc><invention-title id="d2e61">Communication Method and Communications Apparatus</invention-title><us-related-documents><continuation><relation><parent-doc><document-id><country>US</country><doc-number>17513021</doc-number><date>20211028</date></document-id><parent-grant-document><document-id><country>US</country><doc-number>11445365</doc-number></document-id></parent-grant-document></parent-doc><child-doc><document-id><country>US</country><doc-number>17867939</doc-number></document-id></child-doc></relation></continuation><continuation><relation><parent-doc><document-id><country>US</country><doc-number>PCT/CN2020/087600</doc-number><date>20200428</date></document-id><parent-status>PENDING</parent-status></parent-doc><child-doc><document-id><country>US</country><doc-number>17513021</doc-number></document-id></child-doc></relation></continuation></us-related-documents><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>Huawei Technologies Co., Ltd.</orgname><address><city>Shenzhen</city><country>CN</country></address></addressbook><residence><country>CN</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>Li</last-name><first-name>He</first-name><address><city>Shanghai</city><country>CN</country></address></addressbook></inventor><inventor sequence="01" designation="us-only"><addressbook><last-name>Hu</last-name><first-name>Li</first-name><address><city>Shanghai</city><country>CN</country></address></addressbook></inventor><inventor sequence="02" designation="us-only"><addressbook><last-name>Wu</last-name><first-name>Rong</first-name><address><city>Shenzhen</city><country>CN</country></address></addressbook></inventor></inventors></us-parties></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">A communication method and a communications apparatus, where the method includes: after receiving an RRC resume request message from a UE, determining, by a target access network device, a first user plane security protection method between the target access network device and the UE based on a context information obtaining response from a source access network device; determining a first user plane security key between the target access network device and the UE; when receiving first uplink user plane data from the UE, performing user plane security deprotection on the first uplink user plane data based on the first user plane security key and the first user plane security protection method, to obtain uplink user plane data; and sending the uplink user plane data.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="94.06mm" wi="146.98mm" file="US20230007472A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="147.07mm" wi="152.06mm" file="US20230007472A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="102.62mm" wi="149.01mm" file="US20230007472A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="197.02mm" wi="141.48mm" file="US20230007472A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="195.75mm" wi="141.90mm" file="US20230007472A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00005" num="00005"><img id="EMI-D00005" he="148.51mm" wi="163.15mm" file="US20230007472A1-20230105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00006" num="00006"><img id="EMI-D00006" he="141.14mm" wi="157.99mm" file="US20230007472A1-20230105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00007" num="00007"><img id="EMI-D00007" he="202.01mm" wi="142.49mm" file="US20230007472A1-20230105-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00008" num="00008"><img id="EMI-D00008" he="188.98mm" wi="149.18mm" file="US20230007472A1-20230105-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00009" num="00009"><img id="EMI-D00009" he="204.55mm" wi="154.77mm" file="US20230007472A1-20230105-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00010" num="00010"><img id="EMI-D00010" he="170.94mm" wi="136.31mm" file="US20230007472A1-20230105-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00011" num="00011"><img id="EMI-D00011" he="201.51mm" wi="147.40mm" file="US20230007472A1-20230105-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00012" num="00012"><img id="EMI-D00012" he="205.91mm" wi="143.17mm" file="US20230007472A1-20230105-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00013" num="00013"><img id="EMI-D00013" he="156.80mm" wi="140.97mm" file="US20230007472A1-20230105-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00014" num="00014"><img id="EMI-D00014" he="184.83mm" wi="130.81mm" file="US20230007472A1-20230105-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00015" num="00015"><img id="EMI-D00015" he="126.32mm" wi="155.62mm" file="US20230007472A1-20230105-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00016" num="00016"><img id="EMI-D00016" he="142.24mm" wi="155.79mm" file="US20230007472A1-20230105-D00016.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00017" num="00017"><img id="EMI-D00017" he="173.23mm" wi="118.87mm" file="US20230007472A1-20230105-D00017.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="lead"?><heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATIONS</heading><p id="p-0002" num="0001">This application is a continuation of U.S. patent application Ser. No. 17/513,021, filed on Oct. 28, 2021, which is a continuation of International Patent Application No. PCT/CN2020/087600, filed on Apr. 28, 2020, which claims priority to Chinese Patent Application No. 201910351464.X, filed on Apr. 28, 2019. All of the afore-mentioned patent applications are hereby incorporated by reference in their entireties.</p><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="tail"?><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0002" level="1">TECHNICAL FIELD</heading><p id="p-0003" num="0002">Embodiments of this application relate to the field of communications technologies, and for example, to a communication method and a communications apparatus.</p><heading id="h-0003" level="1">BACKGROUND</heading><p id="p-0004" num="0003">As communications technologies develop, a 5th generation (5G) mobile communications system emerges. In addition to user plane encryption protection in a Long-Term Evolution (LTE) system, user plane integrity protection is further introduced into the 5G system. The user plane integrity protection is to protect integrity of data in a user plane transmission process. Moreover, whether to enable the user plane encryption protection and the user plane integrity protection in the 5G system is determined as required.</p><p id="p-0005" num="0004">The 5G system further proposes a new status, namely, an inactive state, which is different from an idle state and a connected state. The inactive state is also referred to as a deactivated state, a third state, an inactive state, or the like. In the idle state, a user equipment (UE), a base station, and a core network all enter the idle state, access stratum (AS) security contexts previously used by the UE and the base station are all deleted, the base station deletes context information of the UE, and the context information of the UE includes an AS security context used by the UE. In the connected state, the UE, the base station, and the core network are all in the connected state. In this case, the UE and the base station are using the AS security context. In the inactive state, the base station connected to the UE stores context information of the UE, where the context information includes an AS security context of the UE. For the core network, even if the UE is in the inactive state, it is still considered that the UE is in the connected state. Therefore, after the UE enters the inactive state from the connected state, the base station also enters the inactive state, but the core network is still in the connected state. An advantage of entering the inactive state by the UE is that the UE can quickly resume to the connected state, thereby reducing a delay caused by a communication interruption.</p><p id="p-0006" num="0005">An inactive scenario may relate to two processes: The UE and the base station may enter the inactive state from the connected state, and this process may be referred to as a suspend process. The UE and the base station may enter the connected state from the inactive state, and this process may be referred to as a resume process.</p><p id="p-0007" num="0006">Although user plane security protection, namely the user plane encryption protection and the user plane integrity protection, is introduced into the 5G system, the user plane security protection is applicable to the connected state. In the inactive scenario, the user plane security protection is not involved, and moreover, user plane on-demand security protection is not involved. Therefore, how to ensure user plane security in the inactive scenario is an urgent technical problem to be resolved.</p><heading id="h-0004" level="1">SUMMARY</heading><p id="p-0008" num="0007">Embodiments of this application provide a communication method and a communications apparatus, to ensure user plane security in an inactive scenario, thereby ensuring user plane data transmission security in the inactive scenario.</p><p id="p-0009" num="0008">A first aspect of the embodiments of this application provides a communication method, including: after receiving a radio resource control (RRC) resume message from user equipment, determining, by a target access network device, a first user plane security protection method between the target access network device and the user equipment based on a context information obtaining response from a source access network device; determining a first user plane security key between the target access network device and the user equipment; when receiving first uplink user plane data from the user equipment, performing user plane security deprotection on the first uplink user plane data based on the first user plane security key and the first user plane security protection method, to obtain uplink user plane data; and sending the uplink user plane data, for example, to a user plane function in a core network.</p><p id="p-0010" num="0009">The target access network device is an access network device that is to establish an RRC connection to the user equipment in a process in which the user equipment enters a connected state from a third state. The source access network device is an access network device that sends an RRC release message to the user equipment to enable the user equipment to enter the third state from the connected state, that is, an access network device that has established an RRC connection to the user equipment before the user equipment enters the third state.</p><p id="p-0011" num="0010">According to the first aspect of the embodiments of this application, when the target access network device receives an RRC resume message, it indicates that the user equipment is to enter the connected state from the third state and is to establish an RRC connection to the target access network device. In this case, the target access network device determines the first user plane security protection method based on information carried in the context information obtaining response, determines the first user plane security key, performs security deprotection on the first uplink user plane data based on the first user plane security protection method and the first user plane security key, and performs user plane security protection on downlink user plane data, to ensure user plane data transmission security in a resume process.</p><p id="p-0012" num="0011">In a possible implementation, the context information obtaining response includes a user plane security policy of the user equipment. The target access network device directly determines the first user plane security protection method between the target access network device and the user equipment based on the user plane security policy, and for example, may determine the first user plane security protection method based on the user plane security policy and a status of the target access network device. The target access network device may activate user plane security according to the first user plane security protection method. The first user plane security protection method is determined based on the user plane security policy and the status of the target access network device. Therefore, the activated user plane security not only meets a requirement of the user plane security policy, but also meets a requirement of a current environment.</p><p id="p-0013" num="0012">In a possible implementation, the context information obtaining response includes a user plane security policy of the user equipment and first indication information. The first indication information is used to indicate a second user plane security protection method used before the user equipment and the source access network device enter the third state from the connected state. The target access network device directly determines the second user plane security protection method indicated by the first indication information as the first user plane security protection method, or determines the second user plane security protection method as the first user plane security protection method when determining that the second user plane security protection method can be supported. The second user plane security protection method is used before the user equipment and the source access network device enter the third state from the connected state. The second user plane security protection method is used as a user plane security protection method between the target access network device and the user equipment, such that the user plane security protection method used before the user equipment and the source access network device enter the third state from the connected state is consistent with the user plane security protection method used after the user equipment and the source access network device enter the connected state from the third state.</p><p id="p-0014" num="0013">In a possible implementation, the context information obtaining response includes a user plane security policy of the user equipment and first indication information. When determining that the second user plane security protection method cannot be supported or that the second user plane security protection method is not used, the target access network device determines the first user plane security protection method based on the user plane security policy, such that activated user plane security not only meets a requirement of the user plane security policy, but also meets a requirement of a current environment. Alternatively, in this case, the target access network device sends an RRC message to the user equipment, where the RRC message is used to trigger the user equipment to re-establish an RRC connection to the target access network device. In a process of re-establishing the RRC connection, the target access network device re-negotiates a user plane security protection method with the user equipment to determine the first user plane security protection method. In this way, the first user plane security protection method can be compatible with other approaches to a maximum extent.</p><p id="p-0015" num="0014">In a possible implementation, after activating user security, the target access network device may notify a session management network element of an activation result. As such, the session management network element learns of the used first user plane security protection method.</p><p id="p-0016" num="0015">In a possible implementation, after determining the first user plane security protection method, the target access network device may determine the first user plane security key between the target access network device and the user equipment according to the first user plane security protection method. As such, the target access network device performs user plane security deprotection on the first uplink user plane data based on the first user plane security protection method and the first user plane security key, and performs user plane security protection on downlink user plane data.</p><p id="p-0017" num="0016">In a possible implementation, the target access network device may send second indication information to the user equipment using an RRC resume message, that is, the second indication information is carried in the RRC resume message. The second indication information is used to indicate the first user plane security protection method determined by the target access network device. The user equipment activates user plane security based on the second indication information.</p><p id="p-0018" num="0017">If the target access network device determines the first user plane security protection method based on the first indication information, when the user equipment stores the first indication information in a suspend process, the RRC resume message may not carry the second indication information, and the user equipment directly activates the user plane security based on the first indication information.</p><p id="p-0019" num="0018">The target access network device may activate the user plane security before, after, or when sending the RRC resume message.</p><p id="p-0020" num="0019">A second aspect of the embodiments of this application provides a target access network device. The target access network device has a function of implementing the method provided in the first aspect. The function may be implemented by hardware, or may be implemented by hardware executing corresponding software. The hardware or the software includes one or more modules corresponding to the foregoing function.</p><p id="p-0021" num="0020">In a possible implementation, the target access network device includes a transceiver unit and a processing unit. The processing unit is configured to: after the transceiver unit receives an RRC resume message from user equipment, determine a first user plane security protection method between the target access network device and the user equipment based on a context information obtaining response from a source access network device; determine a first user plane security key between the target access network device and the user equipment; and when the transceiver unit receives first uplink user plane data from the user equipment, perform user plane security deprotection on the first uplink user plane data based on the first user plane security key and the first user plane security protection method, to obtain uplink user plane data. The transceiver unit is configured to send the uplink user plane data, for example, send the uplink user plane data to a user plane function in a core network.</p><p id="p-0022" num="0021">In a possible implementation, the target access network device includes a processor, a transceiver, and a memory. The transceiver is configured to receive and send information. The memory stores a computer program, and the computer program includes a program instruction. The processor is connected to the memory and the transceiver using a bus, and the processor executes the program instruction stored in the memory, such that user equipment performs the following operations: after the transceiver receives an RRC resume message from the user equipment, determining a first user plane security protection method between the target access network device and the user equipment based on a context information obtaining response from a source access network device; determining a first user plane security key between the target access network device and the user equipment; when the transceiver receives first uplink user plane data from the user equipment, performing user plane security deprotection on the first uplink user plane data based on the first user plane security key and the first user plane security protection method, to obtain uplink user plane data; and controlling the transceiver to send the uplink user plane data, for example, by sending the uplink user plane data to a user plane function in a core network.</p><p id="p-0023" num="0022">Based on a same concept, for a problem-resolving principle and beneficial effects of the target access network device, refer to the method and beneficial effects brought by the method in the first aspect. Therefore, for implementation of the apparatus, refer to the implementation of the method. Repeated parts are not described again.</p><p id="p-0024" num="0023">A third aspect of the embodiments of this application provides a computer-readable storage medium. The computer-readable storage medium stores a computer program, the computer program includes a program instruction, and when the program instruction is executed by a processor, the processor is enabled to perform the method according to the first aspect.</p><p id="p-0025" num="0024">A fourth aspect of the embodiments of this application provides a computer program product including an instruction. When the computer program product runs on a computer, the computer is enabled to perform the method according to the first aspect.</p><p id="p-0026" num="0025">A fifth aspect of the embodiments of this application provides a communication method, including: after sending an RRC resume request to a target access network device, determining, by user equipment, a first user plane security protection method between the user equipment and the target access network device; determining a first user plane security key between the user equipment and the target access network device; performing user plane security protection on uplink user plane data based on the first user plane security protection method and the first user plane security key, to obtain first uplink user plane data; and sending the first uplink user plane data to the target access network device.</p><p id="p-0027" num="0026">For downlink transmission, when receiving first downlink user plane data from the target access network device, the user equipment performs user plane security deprotection on the first downlink user plane data based on the first user plane security protection method and the first user plane security key, to obtain downlink user plane data.</p><p id="p-0028" num="0027">According to the fifth aspect of the embodiments of this application, after determining the first user plane security protection method and the first user plane security key, the user equipment performs user plane security protection on the uplink user plane data based on the first user plane security protection method and the first user plane security key, and performs user plane security deprotection on the downlink user plane data, to ensure user plane data transmission security in a resume process.</p><p id="p-0029" num="0028">In a possible implementation, the user equipment receives an RRC resume message from the target access network device, where the RRC resume message includes second indication information, and where the second indication information is used to indicate the first user plane security protection method. The user equipment directly determines the first user plane security protection method between the user equipment and the target access network device based on the second indication information, to activate user plane security according to the first user plane security protection method.</p><p id="p-0030" num="0029">In a possible implementation, after receiving the RRC resume message carrying the second indication information, the user equipment releases an RRC connection. The user equipment may release the RRC connection by reporting an error to the target access network device, or the target access network device may actively initiate an RRC connection release procedure or initiate an RRC connection re-establishment procedure.</p><p id="p-0031" num="0030">In a possible implementation, after receiving an RRC release message from the target access network device, the user equipment enters a third state from a connected state, and stores first indication information. The first indication information is used to indicate a second user plane security protection method used before the user equipment and a source access network device enter the third state from the connected state. The user equipment stores the first indication information, such that the same user plane security protection method is used before the user equipment enters the third state from the connected state and after the user equipment enters the connected state from the third state.</p><p id="p-0032" num="0031">In a possible implementation, when the user equipment stores the first indication information, the user equipment may directly determine the second user plane security protection method indicated by the first indication information as the first user plane security protection method, such that the same user plane security protection method is used before the user equipment enters the third state from the connected state and after the user equipment enters the connected state from the third state.</p><p id="p-0033" num="0032">In a possible implementation, the user equipment receives an RRC resume message from the target access network device, where the RRC resume message does not include second indication information, and the second indication information is used to indicate a user plane security protection method determined by the target access network device. The RRC resume message does not carry the second indication information. By default, the user equipment and the target access network device determine the first user plane security protection method based on the first indication information and activate user plane security. When the user equipment stores the first indication information, the target access network device does not need to notify the user equipment, thereby reducing signaling overheads.</p><p id="p-0034" num="0033">In a possible implementation, when the first user plane security protection method is determined, the user equipment determines the first user plane security key according to the first user plane security protection method. There may be two cases. In the first case, after sending the RRC resume request, the user equipment generates all user plane security keys, and then determines the first user plane security key in all the user plane security keys according to the first user plane security protection method. In the second case, the user equipment directly determines the first user plane security key according to the first user plane security protection method.</p><p id="p-0035" num="0034">In a possible implementation, after receiving an RRC release message from the target access network device, the user equipment stores a second user plane security key, where the second user plane security key is used before the user equipment and a source access network device enter a third state from a connected state. The user equipment stores the second user plane security key, such that after sending the RRC resume request, the user equipment can immediately or quickly perform user plane security protection on the uplink user plane data using a second user plane security key and a second user plane security protection method.</p><p id="p-0036" num="0035">In a possible implementation, when the user equipment stores the second user plane security key, after determining the first user plane security key in a resume process, the user equipment deletes the second user plane security key, to prevent the user equipment from not knowing which user plane security key is to be used.</p><p id="p-0037" num="0036">In a possible implementation, before receiving an RRC resume message from the target access network device, the user equipment may activate user plane security, and send first uplink user plane data to the target access network device. In this manner, the user equipment may perform user plane security protection on the uplink user plane data using a second user plane security protection method and a second user plane security key. As such, the user equipment can quickly perform user plane security protection on the user plane data when the user equipment is to send the uplink user plane data.</p><p id="p-0038" num="0037">In a possible implementation, after receiving an RRC resume message from the target access network device, the user equipment may activate user plane security, and send first uplink user plane data to the target access network device. In this manner, the user equipment may perform user plane security protection on the uplink user plane data using a newly determined user plane security protection method and a newly determined user plane security key.</p><p id="p-0039" num="0038">A sixth aspect of the embodiments of this application provides user equipment. The user equipment has a function of implementing the method provided in the fifth aspect. The function may be implemented by hardware, or may be implemented by hardware executing corresponding software. The hardware or the software includes one or more modules corresponding to the foregoing function.</p><p id="p-0040" num="0039">In a possible implementation, the user equipment includes a transceiver unit and a processing unit. The processing unit is configured to: after the transceiver unit sends an RRC resume request to a target access network device, determine a first user plane security protection method between the user equipment and the target access network device; determine a first user plane security key between the user equipment and the target access network device; and perform user plane security protection on uplink user plane data based on the first user plane security protection method and the first user plane security key, to obtain first uplink user plane data. The transceiver unit is configured to send the first uplink user plane data to the target access network device.</p><p id="p-0041" num="0040">In a possible implementation, the user equipment includes a processor, a transceiver, and a memory. The transceiver is configured to receive and send information. The memory stores a computer program, and the computer program includes a program instruction. The processor is connected to the memory and the transceiver using a bus, and the processor executes the program instruction stored in the memory, such that user equipment performs the following operations: after controlling the transceiver to send an RRC resume request to a target access network device, determining a first user plane security protection method between the user equipment and the target access network device; determining a first user plane security key between the user equipment and the target access network device; performing user plane security protection on uplink user plane data based on the first user plane security protection method and the first user plane security key, to obtain first uplink user plane data; and controlling the transceiver to send the first uplink user plane data to the target access network device.</p><p id="p-0042" num="0041">Based on a same concept, for a problem-resolving principle and beneficial effects of the user equipment, refer to the method and beneficial effects brought by the method in the fifth aspect. Therefore, for implementation of the apparatus, refer to implementation of the method. Repeated parts are not described again.</p><p id="p-0043" num="0042">A seventh aspect of the embodiments of this application provides a computer-readable storage medium. The computer-readable storage medium stores a computer program, the computer program includes a program instruction, and when the program instruction is executed by a processor, the processor is enabled to perform the method according to the fifth aspect.</p><p id="p-0044" num="0043">An eighth aspect of the embodiments of this application provides a computer program product including an instruction. When the computer program product runs on a computer, the computer is enabled to perform the method according to the fifth aspect.</p><p id="p-0045" num="0044">A ninth aspect of the embodiments of this application provides a communications system, including the target access network device provided in the first aspect and the user equipment provided in the second aspect.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0005" level="1">BRIEF DESCRIPTION OF DRAWINGS</heading><p id="p-0046" num="0045">To describe technical solutions in embodiments of this application or in the background more clearly, the following briefly describes the accompanying drawings for describing the embodiments of this application or the background.</p><p id="p-0047" num="0046"><figref idref="DRAWINGS">FIG. <b>1</b></figref> is a schematic flowchart of a user plane on-demand security process;</p><p id="p-0048" num="0047"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a schematic flowchart of a current suspend process;</p><p id="p-0049" num="0048"><figref idref="DRAWINGS">FIG. <b>3</b></figref> is a schematic flowchart of a current resume process;</p><p id="p-0050" num="0049"><figref idref="DRAWINGS">FIG. <b>4</b></figref> is a schematic diagram of a network architecture to which an embodiment of this application is applied;</p><p id="p-0051" num="0050"><figref idref="DRAWINGS">FIG. <b>5</b>A</figref> is a schematic flowchart of a communication method according to Embodiment 1 of this application;</p><p id="p-0052" num="0051"><figref idref="DRAWINGS">FIG. <b>5</b>B</figref> is a schematic flowchart of a communication method according to Embodiment 2 of this application;</p><p id="p-0053" num="0052"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is a schematic flowchart of a communication method according to Embodiment 3 of this application;</p><p id="p-0054" num="0053"><figref idref="DRAWINGS">FIG. <b>7</b>A</figref> is a schematic flowchart of a communication method according to Embodiment 4 of this application;</p><p id="p-0055" num="0054"><figref idref="DRAWINGS">FIG. <b>7</b>B</figref> is a schematic flowchart of a communication method according to Embodiment 5 of this application;</p><p id="p-0056" num="0055"><figref idref="DRAWINGS">FIG. <b>7</b>C</figref> is a schematic flowchart of a communication method according to Embodiment 6 of this application;</p><p id="p-0057" num="0056"><figref idref="DRAWINGS">FIG. <b>8</b>A</figref> is a schematic flowchart of a communication method according to Embodiment 7 of this application;</p><p id="p-0058" num="0057"><figref idref="DRAWINGS">FIG. <b>8</b>B</figref> is a schematic flowchart of a communication method according to Embodiment 8 of this application;</p><p id="p-0059" num="0058"><figref idref="DRAWINGS">FIG. <b>9</b>A</figref> and <figref idref="DRAWINGS">FIG. <b>9</b>B</figref> are a schematic flowchart of a communication method according to Embodiment 9 of this application;</p><p id="p-0060" num="0059"><figref idref="DRAWINGS">FIG. <b>10</b>A</figref> and <figref idref="DRAWINGS">FIG. <b>10</b>B</figref> are a schematic flowchart of a communication method according to Embodiment 10 of this application;</p><p id="p-0061" num="0060"><figref idref="DRAWINGS">FIG. <b>11</b></figref> is a schematic diagram of a path switch procedure according to an embodiment of this application;</p><p id="p-0062" num="0061"><figref idref="DRAWINGS">FIG. <b>12</b></figref> is a schematic diagram of a logical structure of a communications apparatus according to an embodiment of this application; and</p><p id="p-0063" num="0062"><figref idref="DRAWINGS">FIG. <b>13</b></figref> is a simplified schematic diagram of a physical structure of a communications apparatus according to an embodiment of this application.</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><heading id="h-0006" level="1">DESCRIPTION OF EMBODIMENTS</heading><p id="p-0064" num="0063">The following describes technical solutions in embodiments of this application with reference to the accompanying drawings in the embodiments of this application. In the description of this application, &#x201c;I&#x201d; represents an &#x201c;or&#x201d; relationship between associated objects unless otherwise specified. For example, A/B may represent A or B. The term &#x201c;and/or&#x201d; in this application indicates only an association relationship for describing associated objects and represents that three relationships may exist. For example, A and/or B may represent the following three cases: Only A exists, both A and B exist, and only B exists, where A and B may be singular or plural. In addition, unless otherwise specified, &#x201c;a plurality of&#x201d; in the description of this application means two or more than two. &#x201c;At least one item (piece) of the following&#x201d; or a similar expression thereof refers to any combination of these items, including any combination of singular items (pieces) or plural items (pieces). For example, at least one (piece) of a, b, or c may represent: a, b, c, a-b, a-c, b-c, or a-b-c, where a, b, and c may be singular or plural. In addition, to clearly describe the technical solutions in the embodiments of this application, terms such as &#x201c;first&#x201d; and &#x201c;second&#x201d; are used in the embodiments of this application to distinguish between same items or similar items that have basically same functions and purposes. A person skilled in the art may understand that the terms such as &#x201c;first&#x201d; and &#x201c;second&#x201d; do not limit a quantity or an execution sequence, and that the terms such as &#x201c;first&#x201d; and &#x201c;second&#x201d; do not indicate a definite difference.</p><p id="p-0065" num="0064">In addition, a network architecture and a service scenario that are described in the embodiments of this application are intended to describe the technical solutions in the embodiments of this application more clearly, and do not constitute a limitation on the technical solutions provided in the embodiments of this application. A person of ordinary skill in the art may learn that as network architectures evolve and new service scenarios emerge, the technical solutions provided in the embodiments of this application are also applicable to similar technical problems.</p><p id="p-0066" num="0065">The following describes names or terms used in the embodiments of this application.</p><p id="p-0067" num="0066">A user plane security policy includes a user plane encryption protection policy and a user plane integrity protection policy. The user plane encryption protection policy has three possible values: NOT NEEDED, PREFERRED, and REQUIRED; and the user plane integrity protection policy has three possible values: NOT NEEDED, PREFERRED, and REQUIRED, where NOT NEEDED indicates that the policy does not need to be enabled, PREFERRED indicates that the policy can be enabled or disabled, and REQUIRED indicates that the policy needs to be enabled. The foregoing three possible values each may be indicated using two bits (bit). For example, 00 indicates that the policy does not need to be enabled, 01 indicates that the policy may be enabled or may not be enabled, and 11 indicates that the policy needs to be enabled. A specific manner in which the three possible values are indicated for the user plane encryption protection policy and the user plane integrity protection policy is not limited in the embodiments of this application.</p><p id="p-0068" num="0067">User plane encryption protection is to protect the confidentiality of data during transmission. Therefore, user plane encryption protection can also be referred to as user plane confidentiality protection. Confidentiality means that the actual content cannot be directly seen. User plane integrity protection is to protect integrity of data during transmission on a user plane. Integrity means that the data is original and has not been tampered with.</p><p id="p-0069" num="0068">A user plane security protection method refers to whether to enable user plane encryption protection and/or user plane integrity protection on a user equipment side or a base station side.</p><p id="p-0070" num="0069">A security algorithm may include a user plane security algorithm (that is, a security algorithm used on a user plane) and a signaling plane security algorithm (that is, a security algorithm used on a signaling plane). The security algorithm used on the user plane is used to protect user plane data, and may include a user plane encryption algorithm and a user plane integrity algorithm. The security algorithm used on the signaling plane is used to protect signaling, and may include a signaling plane encryption algorithm and a signaling plane integrity algorithm. The security algorithm used on the user plane and the security algorithm used on the signaling plane may be the same or may be different. A meaning of being the same is that if the user plane integrity protection is enabled, an integrity algorithm used on the user plane is the same as an integrity algorithm used on the signaling plane. Alternatively, if the user plane encryption protection is enabled, an encryption algorithm used on the user plane is the same as an encryption algorithm used on the signaling plane. The security algorithm used on the signaling plane is different from the security algorithm used on the user plane provided that the security algorithms includes different algorithms. For example, an encryption algorithm used on the user plane is an encryption algorithm A, an encryption algorithm used on the signaling plane is an encryption algorithm B, and both the user plane and the signaling plane use an integrity algorithm C. In this case, the security algorithm used on the user plane is different from the security algorithm used on the signaling plane.</p><p id="p-0071" num="0070">A security key may include a user plane security key and a signaling plane security key. The user plane security key is used to protect user plane data, and may include a user plane encryption key and a user plane integrity protection key. The signaling plane security key is used to protect signaling, and may be, for example, a key for protecting radio resource control (RRC) signaling, namely, an RRC key. The RRC key may include an RRC encryption key and an RRC integrity protection key.</p><p id="p-0072" num="0071">Security protection: For a node that performs a security function, a user plane/signaling plane security algorithm and a user plane/signaling plane security key are used together to protect user plane data. For example, encryption protection is performed on the user plane/signaling plane data using an encryption key and an encryption algorithm. Integrity protection is performed on the user plane/signaling plane data using an integrity protection key and an integrity protection algorithm. A sequential relationship between the encryption protection and the integrity protection is not limited in the embodiments of this application. To be more specific, the encryption protection may be first performed on the user plane/signaling plane data, and then the integrity protection is performed. Alternatively, the integrity protection may be first performed on the user plane/signaling plane data, and then the encryption protection is performed on the user plane/signaling plane data. Certainly, the user plane and the signaling plane may not use a same execution sequence.</p><p id="p-0073" num="0072">Security deprotection: For a node that performs a security function, a user plane/signaling plane security algorithm and a user plane/signaling plane security key are used together to obtain original user plane data. For example, encrypted user plane/signaling plane data is decrypted using an encryption key and an encryption algorithm. Integrity protection verification is performed on the user plane data using an integrity protection key and an integrity protection algorithm. A sequence of the decryption and the integrity protection verification is not limited in the embodiments of the present disclosure. However, it should be understood that, if encryption protection is first performed on the user plane/signaling plane data and then integrity protection is performed on the user plane/signaling plane data, in security deprotection, the integrity protection is first verified, and then the encrypted user plane data is decrypted. Alternatively, if integrity protection is first performed on the user plane/signaling plane data and then the user plane/signaling plane data is encrypted, a sequence of the security deprotection is first decrypting the encrypted data, and then performing integrity protection verification.</p><p id="p-0074" num="0073">Activating user plane/signaling plane security means that when a user plane/signaling plane security protection method is determined, the user plane/signaling plane security may start to be activated using a user plane/signaling plane security algorithm and a user plane/signaling plane security key. That is, security protection may start to be performed on to-be-transmitted user plane data/signaling using the user plane/signaling plane security protection method, the user plane/signaling plane security algorithm, and the user plane/signaling plane security key. For example, if a determined user plane security protection method is to enable user plane encryption protection and disable user plane integrity protection, a user plane encryption algorithm is an encryption algorithm A, and a user plane encryption key is a key K, user plane encryption protection is performed on to-be-transmitted user plane data using the encryption algorithm A and the key K. An effect that can be achieved by activating a user plane security protection method is that a node that activates user plane security may start to perform security protection on user plane data and may start to perform security deprotection on user plane data. It should be understood that security protection and security deprotection may further be separately activated. For example, after sending a security activation message, a base station activates security deprotection; and after receiving a security activation acknowledgment message, the base station activates security protection.</p><p id="p-0075" num="0074"><figref idref="DRAWINGS">FIG. <b>1</b></figref> is a schematic flowchart of a user plane on-demand security process. The process may include the following steps.</p><p id="p-0076" num="0075">Step <b>101</b>. A UE sends a protocol data unit (PDU) session establishment request message to a base station. Correspondingly, the base station receives the PDU session establishment request message from the UE.</p><p id="p-0077" num="0076">The PDU session establishment request message includes information such as a PDU session identity (ID), a data network name (DNN), and network slice selection auxiliary information or network slice selection assistance information (NSSAI).</p><p id="p-0078" num="0077">Step <b>102</b>. The base station sends a PDU session establishment request message to a session management function (SMF) using an access and mobility management function (AMF).</p><p id="p-0079" num="0078">For example, the base station first sends the PDU session establishment request message to the AMF, and then the AMF sends the PDU session establishment request message to the SMF. The AMF between the base station and the SMF is omitted in <figref idref="DRAWINGS">FIG. <b>1</b></figref>.</p><p id="p-0080" num="0079">Step <b>103</b>. The SMF obtains a user plane security policy.</p><p id="p-0081" num="0080">The SMF may obtain the user plane security policy from a unified data management (UDM) function, or may obtain the user plane security policy from local configuration information of the SMF.</p><p id="p-0082" num="0081">The user plane security policy obtained by the SMF is a user plane security policy of the UE, and may be a user plane security policy for a PDU session of the UE.</p><p id="p-0083" num="0082">Step <b>104</b>. The SMF sends the user plane security policy to the base station, to be more specific, the SMF sends the user plane security policy obtained by the SMF to the base station. Correspondingly, the base station receives the user plane security policy from the SMF.</p><p id="p-0084" num="0083">The SMF sends the user plane security policy to the AMF, and the AMF may send the user plane security policy to the base station using an N2 message, that is, the user plane security policy is carried in the N2 message.</p><p id="p-0085" num="0084">After receiving the user plane security policy, the base station may store the user plane security policy. When storing the user plane security policy, the base station further stores a PDU session identity corresponding to the user plane security policy, namely, a PDU session ID.</p><p id="p-0086" num="0085">Step <b>105</b>. The base station activates user plane security according to the user plane security policy.</p><p id="p-0087" num="0086">The base station activates user plane security between the base station and the UE according to the user plane security policy. For example, if a user plane encryption protection policy included in the user plane security policy is required, and a user plane integrity protection policy is required, the base station enables user plane encryption protection and user plane integrity protection, and uses a user plane encryption key, a user plane integrity protection key, and a user plane security algorithm to perform encryption protection and integrity protection, or perform decryption and verification on user plane data between the base station and the UE. For another example, if a user plane encryption protection policy included in the user plane security policy is REQUIRED, and a user plane integrity protection policy is NOT NEEDED, the base station enables user plane encryption protection, does not enable user plane integrity protection, and uses a user plane encryption key and a user plane security algorithm to perform encryption protection or decryption on user plane data between the base station and the UE.</p><p id="p-0088" num="0087">Optionally, when the user plane encryption protection policy or the user plane integrity protection policy is PREFERRED, the base station sends a user plane security activation result (or a security result for short) to the SMF. If the base station generates a security result, the base station stores the security result.</p><p id="p-0089" num="0088">Step <b>106</b>. The base station sends an RRC connection reconfiguration message to the UE. Correspondingly, the UE receives the RRC connection reconfiguration message from the base station.</p><p id="p-0090" num="0089">The RRC connection reconfiguration message includes user plane activation indication information. The user plane activation indication information includes user plane encryption protection activation indication information and/or user plane integrity protection activation indication information. The user plane encryption protection activation indication information is used to indicate whether to enable user plane encryption protection. The user plane integrity protection activation indication information is used to indicate whether to enable user plane integrity protection. For example, if the user plane integrity protection activation indication information included in the user plane activation indication information is &#x201c;enable&#x201d;, and the user plane activation indication information does not include the user plane encryption protection activation indication information, the UE may determine to enable user plane encryption protection and user plane integrity protection. If the user plane encryption protection activation indication information included in the user plane activation indication information is &#x201c;disable&#x201d;, and the user plane activation indication information does not include the user plane integrity protection activation indication information, the UE may determine not to enable user plane encryption protection and user plane integrity protection. If the user plane integrity protection activation indication information included in the user plane activation indication information is &#x201c;enable&#x201d;, and the user plane encryption protection activation indication information included in the user plane activation indication information is &#x201c;disable&#x201d;, the UE may determine not to enable user plane encryption protection and determine to enable user plane integrity protection. If the user plane activation indication information does not include the user plane integrity protection activation indication information or the user plane encryption protection activation indication information, the UE may determine not to enable user plane integrity protection and determine to enable user plane encryption protection.</p><p id="p-0091" num="0090">Step <b>107</b>. The UE activates user plane security. The UE activates the user plane security between the UE and the base station based on the user plane activation indication information carried in step <b>106</b>, to perform security protection or security deprotection on the user plane data between the UE and the base station.</p><p id="p-0092" num="0091">Step <b>108</b>. The UE sends an RRC connection reconfiguration acknowledgment (ACK) message to the base station. Correspondingly, the base station receives the RRC connection reconfiguration acknowledgment message from the UE.</p><p id="p-0093" num="0092">In the procedure shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref>, in a connected state scenario, the base station obtains the user plane security policy from the SMF, activates user plane security between the base station and the UE, and sends an indication to the UE. As such, the UE activates user plane security between the UE and the base station according to the indication to ensure confidentiality and integrity of user plane data between the UE and the base station.</p><p id="p-0094" num="0093"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a schematic flowchart of a current suspend process. The process may include the following steps.</p><p id="p-0095" num="0094">Step <b>201</b>. A base station obtains and stores a user plane security policy of a UE. The user plane security policy of the UE obtained and stored in step <b>201</b> may be a user plane security policy that is obtained by the base station for a PDU session from an SMF in a process of establishing the PDU session, that is, the user plane security policy transmitted in step <b>104</b> in the procedure shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref>; or may be obtained by the base station from a switch procedure.</p><p id="p-0096" num="0095">Optionally, the base station further stores a security result. A function of the security result is to indicate whether the user plane security policy is performed when a user plane encryption protection policy and/or a user plane integrity protection policy in the user plane security policy are/is PREFERRED (the description in 3rd Generation Partnership Project (3GPP) Technical Specification (TS) 38.413 Release f30 is: indicates whether the security policy indicated as PREFERRED in the Security Indication information element (IE) is performed or not.). Generation and use of the security result are optional. The security result needs to be generated only when the user plane encryption protection policy and/or the user plane integrity protection policy in the user plane security policy are/is PREFERRED. The security result is optionally used in some procedures. For example, the security result is used when the base station needs to send the security result to the SMF or when the base station needs to send the security result to a target base station in a switch procedure. Therefore, storage of the security result is optional. The security result includes a user plane integrity protection result (or integrity protection result for short) and a user plane confidentiality protection result (or confidentiality protection result for short). A value range of the security result is ENUMERATED (performed, not performed, . . . ). The security result is used to indicate whether user plane encryption protection and user plane integrity protection are performed on a current PDU connection.</p><p id="p-0097" num="0096">Step <b>202</b>. The base station sends an RRC release message to the UE. Correspondingly, the UE receives the RRC release message from the base station.</p><p id="p-0098" num="0097">When the base station and the UE need to enter an inactive state from a connected state, the base station sends an RRC release message to the UE. The RRC release message includes indication information, and the indication information is used to indicate the UE to release an RRC connection, and not to enter an idle mode, but to enter the inactive mode. The indication information includes suspend configuration information. The RRC release message further includes an inactive-radio network temporary identifier (I-RNTI) and a next hop (NH) chaining counter (NCC) value. The I-RNTI is used to identify the UE in the inactive state on a base station side, such that when the UE enters the connected state from the inactive state, context information of the UE can be searched for based on the I-RNTI. The NCC value is used to generate a new base station key such as a new radio (NR) or next generation (NG) node B (gNB) key (KgNB*) when the UE returns to the connected state.</p><p id="p-0099" num="0098">Step <b>203</b>. After sending the RRC release message, the base station deletes an RRC encryption key, a user plane encryption key, and a user plane integrity protection key, and stores an RRC integrity protection key. In other words, after sending the RRC release message, the base station deletes a user plane security key and the RRC encryption key, and stores only the RRC integrity protection key.</p><p id="p-0100" num="0099">In addition, the base station further stores the I-RNTI included in the RRC release message, such that when the UE enters the connected state from the inactive state, the base station may search for the context information of the UE based on the I-RNTI. The base station also stores the user plane security policy, and optionally stores the security result.</p><p id="p-0101" num="0100">Step <b>204</b>. After receiving the RRC release message, the UE verifies integrity protection of the RRC release message, and verifies the RRC release message using the RRC integrity protection key. If the verification succeeds, the UE stores the NCC value included in the RRC release message, deletes the RRC encryption key, the user plane encryption key, and the user plane integrity protection key, and stores only the RRC integrity protection key. In other words, when the verification succeeds, the UE deletes the user plane security key and the RRC encryption key, and stores only the RRC integrity protection key. The UE determines whether to retain the currently used KgNB based on the NCC value. A specific determining method may not relate to this embodiment of this application. Therefore, details are not described herein.</p><p id="p-0102" num="0101">In addition, the UE further stores the I-RNTI included in the RRC release message.</p><p id="p-0103" num="0102">Processing of a security key in the current suspend process shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref> is not very clear, and processing of a user plane security protection method on the base station side is not very clear either. Generation, use, and storage of the security result are optional. Processing of the user plane security protection method is not involved on a UE side. In this process, both the base station and the UE have deleted the user plane encryption key and the user plane integrity protection key. In view of this, how to process the user plane security protection method in the suspend process is clearly described in this embodiment of this application. For details, refer to Embodiment 1 to Embodiment 3.</p><p id="p-0104" num="0103"><figref idref="DRAWINGS">FIG. <b>3</b></figref> is a schematic flowchart of a current resume process. A base station involved in a suspend process of the UE and a base station to which the UE establishes an RRC connection in the resume process may be the same base station or may be different base stations. In <figref idref="DRAWINGS">FIG. <b>3</b></figref>, an example in which the base stations are different is used. It is assumed that a base station involved when the UE enters an inactive state from a connected state is a source base station, and a base station that enters the connected state from the inactive state and that establishes the RRC connection to the UE is a target base station. The procedure shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref> may include the following steps.</p><p id="p-0105" num="0104">Step <b>301</b>. The UE calculates a resume message authentication code (MAC) identifier (MAC-I) using an RRC integrity protection key stored in the suspend process.</p><p id="p-0106" num="0105">Step <b>302</b>. The UE sends an RRC resume request to the target base station. Correspondingly, the target access network device receives the RRC resume request from the UE.</p><p id="p-0107" num="0106">The RRC resume request includes an I-RNTI and a resume MAC-I. The I-RNTI may be stored in the UE in the suspend process.</p><p id="p-0108" num="0107">After sending the RRC resume request, the UE generates a new KgNB*, and generates an RRC key using the new KgNB*. The RRC key includes an RRC encryption key and an RRC integrity protection key. Optionally, the UE further generates a user plane security key. The user plane security key includes a user plane encryption key and a user plane integrity protection key. It should be noted herein that in other approaches, it is described that the user plane security key is optionally generated. Neither a case in which the user plane security key is generated nor a case in which the user plane security key is used is described.</p><p id="p-0109" num="0108">Step <b>303</b>. After receiving the RRC resume request, the target base station initiates an Xn-application protocol (AP) retrieve procedure, and sends a context information obtaining request to the source base station to request to obtain context information of the UE. Correspondingly, the source base station receives the context information obtaining request from the target base station. Xn is an interface between base stations.</p><p id="p-0110" num="0109">The context information obtaining request includes the I-RNTI, the resume MAC-I, and a target cell identity (ID). The I-RNTI and the resume MAC-I are sent by the UE to the target base station. The target cell identifier is an identifier of a cell that is within coverage of the target base station and that provides a service for the UE.</p><p id="p-0111" num="0110">After receiving the context information obtaining request, the source base station searches for the context information of the UE based on the I-RNTI, and calculates a resume MAC-I using the RRC integrity protection key stored in the suspend process. If the resume MAC-I calculated by the source base station is the same as the resume MAC-I sent by the UE, the source base station generates a new KgNB*.</p><p id="p-0112" num="0111">Step <b>304</b>. The source base station sends a context information obtaining response to the target base station. Correspondingly, the target base station receives the context information obtaining response from the source base station.</p><p id="p-0113" num="0112">The context information obtaining response includes the new KgNB* generated by the source base station, an NCC value corresponding to the KgNB*, a 5G security capability of the UE, an encryption algorithm and an integrity protection algorithm that are used by a source cell, a user plane security policy, and an optional security result.</p><p id="p-0114" num="0113">Step <b>305</b>. If the target base station supports the encryption algorithm and the integrity protection algorithm that are used by the source cell, the target base station generates an RRC key and a user plane security key using the KgNB* included in the context information obtaining response.</p><p id="p-0115" num="0114">The RRC key includes the RRC encryption key and the RRC integrity protection key, and the user plane security key includes the user plane encryption key and the user plane integrity protection key.</p><p id="p-0116" num="0115">Step <b>306</b>. The target base station sends an RRC resume message to the UE. Correspondingly, the UE receives the RRC resume message from the target base station.</p><p id="p-0117" num="0116">The RRC resume message is encryption protected and integrity protected by the RRC key newly generated by the target base station, namely, the newly generated RRC encryption key and RRC integrity protection key.</p><p id="p-0118" num="0117">Step <b>307</b>. The UE verifies the RRC resume message using the RRC key newly generated by the UE, to be more specific, the UE decrypts and verifies the RRC resume message using the RRC encryption key and the RRC integrity protection key that are generated by the UE in step <b>302</b>. If decoding and verification succeed, the UE deletes the RRC integrity protection key stored in the suspend process.</p><p id="p-0119" num="0118">Step <b>308</b>: The UE sends an RRC resume complete message to the target base station. Correspondingly, the target base station receives the RRC resume complete message from the UE.</p><p id="p-0120" num="0119">The UE performs encryption protection and integrity protection on the RRC resume complete message using the newly generated RRC key.</p><p id="p-0121" num="0120">Step <b>309</b>. The target base station and a target AMF perform a path switch (path switch) procedure.</p><p id="p-0122" num="0121">If the UE enters the connected state from the inactive state, and the base station establishing the RRC connection to the UE is the source base station, step <b>303</b> and step <b>304</b> in <figref idref="DRAWINGS">FIG. <b>3</b></figref> may be omitted. In this case, the following may be included: The UE directly sends the RRC resume request to the source base station; the source base station searches for the context information of the UE based on the I-RNTI, and calculates the resume MAC-I using the RRC integrity protection key stored in the suspend process; if the resume MAC-I calculated by the source base station is the same as the resume MAC-I sent by the UE, the source base station generates a new KgNB*, and generates an RRC key and a user plane security key based on the new KgNB*; the source base station performs encryption protection and integrity protection on the RRC resume message using the newly generated RRC key, and sends the protected RRC resume message to the UE; and the UE deprotects the RRC resume message using the RRC key newly generated by the UE, and sends the RRC resume complete message to the source base station, where the RRC resume complete message is protected by the RRC key.</p><p id="p-0123" num="0122">Although the current resume process shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref> relates to the user plane security key, when and how to use the user plane security key are not described. In view of this, when and how to use the user plane security key in the resume process, and when to send user plane data are specified in the embodiments of this application.</p><p id="p-0124" num="0123">The procedures shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref> and <figref idref="DRAWINGS">FIG. <b>3</b></figref> are summarized from 3GPP TS 33.501 Release F30. For more details, refer to related content.</p><p id="p-0125" num="0124"><figref idref="DRAWINGS">FIG. <b>4</b></figref> is a schematic diagram of a network architecture to which an embodiment of this application is applied. The network architecture includes a user terminal <b>10</b> and a source access network device <b>20</b>.</p><p id="p-0126" num="0125">The user terminal <b>10</b> may include various handheld devices, vehicle-mounted devices, wearable devices, or computing devices that have a wireless communication function, or other processing devices connected to a wireless modem; or may include a UE, a subscriber unit, a cellular phone, a smartphone, a wireless data card, a personal digital assistant (PDA) computer, a tablet computer, a modem or wireless modem, a handheld device, a laptop computer, a cordless phone, a wireless local loop (WLL) station, a machine type communication (MTC) terminal, UE, a mobile station (MS), a terminal device, relay user equipment, or the like. The relay user equipment may be, for example, a 5G residential gateway (RG). For ease of description, in the embodiments of this application, the devices mentioned above are collectively referred to as user terminals, and an example in which the user terminal is a UE is used for description.</p><p id="p-0127" num="0126">The access network device may be, for example, an evolved node base station (e.g., an evolved Node B (eNB or eNodeB)) in an LTE system, an upgraded eNB, that is, a next generation evolved node base station (ng-eNB), a next generation node base station (gNB) in a 5G mobile communications system, or an access network device in a future communications system.</p><p id="p-0128" num="0127">In this embodiment of this application, a base station involved in a suspend process in which the user terminal <b>10</b> enters an inactive state from a connected state is used as the source access network device <b>20</b>. The source access network device <b>20</b> may be the base station in <figref idref="DRAWINGS">FIG. <b>2</b></figref>. The base station may be a 5G base station, a 4G base station, or a future evolved base station. If the base station is a 4G base station, the other approaches described above should include an RRC suspend process and an RRC resume process corresponding to 4G. In this embodiment of this application, the 5G base station is used as an example for description. If the user terminal <b>10</b> enters the connected state from the inactive state, and a base station establishing an RRC connection to the user terminal <b>10</b> is not the source access network device <b>20</b>, the network architecture shown in <figref idref="DRAWINGS">FIG. <b>4</b></figref> further includes a target access network device <b>30</b>. The target access network device <b>30</b> is the base station that establishes the RRC connection to the user terminal <b>10</b> when the user terminal <b>10</b> enters the connected state from the inactive state. In this case, the source access network device <b>20</b> may be the source base station in <figref idref="DRAWINGS">FIG. <b>3</b></figref>, and the target access network device may be the target base station in <figref idref="DRAWINGS">FIG. <b>3</b></figref>. It should be noted that the source access network device and the target access network device do not constitute a limitation on the embodiments of this application. For example, the source access network device may also be referred to as a source base station or the like, and the target access network device may also be referred to as a target base station or the like. When a resume process is described in this embodiment of this application, an example in which an access network device involved in the suspend process is different from an access network device that establishes an RRC connection to the UE in the resume process is used. In other words, an example in which the network architecture shown in <figref idref="DRAWINGS">FIG. <b>4</b></figref> includes user equipment, a source access network device, and a target access network device is used.</p><p id="p-0129" num="0128">The following describes in detail a communication method provided in the embodiments of this application. Correspondences between names in the embodiments and names in the claims may include: The first user plane security protection method in the claims is the new user plane security protection method in the embodiments, the second user plane security protection method is the old user plane security protection method or the user plane security protection method indicated by the first indication information in the embodiments, the first user plane security key is the new user plane security key or the to-be-used user plane security key in the embodiments, and the second user plane security key is the old user plane security key or the user plane security key stored in the suspend process in the embodiments.</p><p id="p-0130" num="0129">It should be noted that in the following embodiments of this application, names of messages between network elements, names of parameters in messages, or the like are merely examples, and there may be other names during other implementations. This is not specifically limited in the embodiments of this application.</p><p id="p-0131" num="0130"><figref idref="DRAWINGS">FIG. <b>5</b>A</figref> is a schematic flowchart of a communication method according to Embodiment 1 of this application. This embodiment mainly describes how to process a user plane security policy in a suspend process. In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>, step <b>505</b>-<b>1</b> is added based on the schematic procedure shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>. The source access network device stores first indication information. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref> may include but is not limited to the following steps.</p><p id="p-0132" num="0131">Step <b>501</b>-<b>1</b>. The source access network device obtains and stores a user plane security policy of UE.</p><p id="p-0133" num="0132">The source access network device obtains and stores the user plane security policy of the UE, to be more specific, when the source access network device is in a connected state, the source access network device obtains and stores the user plane security policy for the UE from an SMF or obtains the user plane security policy from another base station in a switch procedure. An advantage of storing the user plane security policy by the source access network device is that the source access network device conveniently determines a user plane security protection method between the source access network device and the UE. When the source access network device does not perform step <b>505</b>-<b>1</b>, the source access network device may determine the user plane security protection method between the source access network device and the UE based on the user plane security policy.</p><p id="p-0134" num="0133">When storing the user plane security policy, the source access network device may further store granularity information corresponding to the user plane security policy. The granularity information refers to an applicable scope of the user plane security protection method. The granularity information may be a PDU session ID, that is, different PDU sessions may correspond to different user plane security policies; or may be a radio bearer identity (e.g., a data radio bearer identity (DRB) identity (ID)), a network slice identifier, a data network name, or the like. For example, different DRB may correspond to different user plane security policies. The granularity information may further include a plurality of types of the PDU session ID, the DRB ID, the network slice identifier, the data network name, and the like. For example, the granularity information includes the PDU session ID and the DRB ID. It should be noted that when the granularity information is bound to the user plane security policy, a correspondence may be a one-to-one correspondence or a one-to-many correspondence. For example, one PDU session corresponds to one user plane security policy, or a plurality of PDU sessions may correspond to a same user plane security policy. For another example, one DRB ID corresponds to one user plane security policy, or a plurality of DRB IDs correspond to a same user plane security policy. Currently, one PDU session corresponds to a plurality of DRB IDs, and the plurality of DRB IDs corresponding to the PDU session may correspond to a same user plane security policy, that is, the user plane security policy corresponding to the PDU session.</p><p id="p-0135" num="0134">An advantage of storing the user plane security policy and the corresponding granularity information by the source access network device is that when the source access network device enters the connected state from an inactive state, and learns of granularity information of uplink user plane data sent by the UE, the source access network device may determine a corresponding user plane security policy based on the granularity information, then determine the user plane security protection method, and further perform security deprotection on the uplink user plane data.</p><p id="p-0136" num="0135">If the source access network device generates and uses a user plane security activation result (or a security result), the source access network device stores the security result.</p><p id="p-0137" num="0136">Step <b>502</b>-<b>1</b>. The source access network device sends an RRC release message to the UE. Correspondingly, the UE receives the RRC release message from the source access network device.</p><p id="p-0138" num="0137">Step <b>503</b>-<b>1</b>. After sending the RRC release message, the source access network device deletes an RRC encryption key, a user plane encryption key, and a user plane integrity protection key, stores an RRC integrity protection key, and stores an I-RNTI.</p><p id="p-0139" num="0138">Further, the source access network device deactivates user plane security. Activation and deactivation of user plane security are associated with a user plane key. Because the source access network device deletes the user plane security key, the source access network device needs to deactivate user plane security. A specific implementation method is not limited herein. In other words, the source access network device may delete the user plane security key because the source access network device determines to deactivate user plane security.</p><p id="p-0140" num="0139">Step <b>504</b>-<b>1</b>. After receiving the RRC release message, the UE verifies integrity protection of the RRC release message. If the verification succeeds, the UE stores an NCC value, deletes the RRC encryption key, the user plane encryption key, and the user plane integrity protection key, and stores the RRC integrity protection key.</p><p id="p-0141" num="0140">For implementation processes of step <b>502</b>-<b>1</b> to step <b>504</b>-<b>1</b>, refer to the descriptions of step <b>202</b> to step <b>204</b> in the procedure shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>. Details are not described herein again.</p><p id="p-0142" num="0141">It also should be emphasized herein that the UE deactivates user plane security. For example, an activation state of the user plane security of the UE is bound to a user plane security key of the UE. Because the UE deletes the user plane key, the UE deactivates user plane security. A specific implementation method is not limited herein. In other words, the UE may delete the user plane security key because the UE determines to deactivate user plane security.</p><p id="p-0143" num="0142">Step <b>505</b>-<b>1</b>. The source access network device stores the first indication information, where the first indication information includes user plane security activation method indication information and/or user plane security protection method indication information.</p><p id="p-0144" num="0143">The user plane security activation method indication information is used to indicate whether to enable user plane encryption protection and user plane integrity protection; is sent, using an RRC message, by the source access network device to the UE when the UE and the source access network device are in the connected state; and is used to indicate a user plane security protection method to be activated. A specific indication depends on a user plane security protection method activated by the source access network device when the source access network device and the UE are in the connected state. The user plane security activation method indication information may be the user plane activation indication information carried in the RRC connection reconfiguration message in step <b>106</b> in <figref idref="DRAWINGS">FIG. <b>1</b></figref>. The source access network device stores the user plane security activation method indication information, such that the source access network device can use the user plane security activation method indication information in a resume process.</p><p id="p-0145" num="0144">The user plane security protection method indication information is indication information newly generated by the source access network device based on a user plane security protection method currently used by the UE to protect data, and is used to indicate whether user plane encryption protection is enabled and whether user plane integrity protection is enabled. The source access network device stores the user plane security protection method indication information, such that the source access network device can use the user plane security protection method indication information in the resume process.</p><p id="p-0146" num="0145">The first indication information may alternatively be an enhancement of the security result. In other approaches, the security result is optionally generated and optionally used. The security result may be generated only when the user plane security policy includes PREFERRED. It may further be stipulated in this embodiment of this application that a security result needs to be generated regardless of whether the user plane security policy includes PREFERRED. An existing format may be used for the security result, or the format of the security result may be updated to ENUMERATED (enabled, disabled . . . ).</p><p id="p-0147" num="0146">Both the user plane security activation method indication information and the user plane security protection method indication information may indicate, when the source access network device enters the inactive state, a user plane security protection method used before the source access network device and the UE enter the inactive state from the connected state. The user plane security activation method indication information is transmitted by the access network device to the UE. It may be understood that the UE does not need to generate the user plane security activation method indication information, but only needs to receive the user plane security activation method indication information. The user plane security activation method indication information is transferred in an RRC message, and is transmitted in the RRC connection reconfiguration message (referring to step <b>106</b>). However, the user plane security protection method indication information does not need to be transferred, and needs to be separately generated by the access network device and the UE.</p><p id="p-0148" num="0147">An advantage of storing the first indication information by the source access network device is that it can be ensured that the user plane security protection method used before the source access network device enters the inactive state from the connected state is consistent with that used after the source access network device enters the inactive state from the connected state.</p><p id="p-0149" num="0148">In a possible implementation, when storing the first indication information, the source access network device further stores granularity information corresponding to the first indication information. The granularity information refers to an applicable scope of the user plane security protection method. The granularity information may be a PDU session ID. Different PDU sessions may correspond to different first indication information, DRB IDs, network slice identifiers, data network names, or the like. For example, different DRBs may correspond to different first indication information. The granularity information may further include a plurality of types of the PDU session ID, the DRB ID, the network slice identifier, the data network name, and the like. For example, the granularity information includes the PDU session ID and the DRB ID.</p><p id="p-0150" num="0149">It should be noted that when the granularity information is bound to the first indication information, a correspondence may be a one-to-one correspondence or a one-to-many correspondence. For example, one PDU session corresponds to one piece of first indication information, or a plurality of PDU sessions may correspond to same first indication information. For another example, one DRB ID corresponds to one piece of first indication information, or a plurality of DRB IDs correspond to same first indication information. Currently, one PDU session corresponds to a plurality of DRB IDs, and the plurality of DRB IDs corresponding to the PDU session may correspond to same first indication information, that is, the first indication information corresponding to the PDU session.</p><p id="p-0151" num="0150">An advantage of storing the first indication information and the granularity information corresponding to the first indication information by the source access network device is that when the source access network device enters the connected state from the inactive state, and learns of the granularity information of the uplink user plane data sent by the UE, the source access network device may determine a corresponding user plane security protection method based on the granularity information, and further perform security deprotection on the uplink user plane data.</p><p id="p-0152" num="0151">It should be noted that step <b>505</b>-<b>1</b> may be performed after step <b>503</b>-<b>1</b>, or may be performed between step <b>502</b>-<b>1</b> and step <b>503</b>-<b>1</b>, or may be performed in a process of performing step <b>503</b>-<b>1</b>. In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>, an example in which step <b>505</b>-<b>1</b> is performed after step <b>503</b>-<b>1</b> is used for description, and the example does not constitute a limitation on this embodiment of this application.</p><p id="p-0153" num="0152">In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>, the source access network device stores the first indication information after sending the RRC release message, such that it can be ensured that the user plane security protection method used before the source access network device enters the inactive state from the connected state is consistent with that used after the source access network device enters the inactive state from the connected state. Further, it may be convenient for the source access network device to determine, based on the first indication information, whether to store the user plane security key. Details are described in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>. The source access network device stores the first indication information, but the UE does not store the first indication information. After the UE sends an RRC resume request message, the source access network device may notify, after determining the user plane security protection method, the UE of the determined user plane security protection method using second indication information.</p><p id="p-0154" num="0153">Further, when the user plane security policy does not include PREFERRED, to be more specific, the user plane encryption protection policy is not PREFERRED or the user plane integrity protection policy is not PREFERRED, or neither the user plane encryption protection policy nor the user plane integrity protection policy is PREFERRED, the source access network device may store only the user plane security policy, that is, only performs step <b>501</b>-<b>1</b>. When the user plane security policy includes PREFERRED, to be more specific, the user plane encryption protection policy is PREFERRED or the user plane integrity protection policy is PREFERRED, or both the user plane encryption protection policy and the user plane integrity protection policy are PREFERRED, the source access network device needs to store the user plane security policy and the first indication information, that is, performs step <b>501</b>-<b>1</b> and step <b>505</b>-<b>1</b>. In this way, in a resume process, when an access network device cannot accurately determine a user plane security protection method between the access network device and the UE based on the user plane security policy includes PREFERRED, the access network device may determine the user plane security protection method between the access network device and the UE based on the first indication information. The access network device is a base station to which the UE resumes an RRC connection, and may be a source access network device or a target access network device.</p><p id="p-0155" num="0154"><figref idref="DRAWINGS">FIG. <b>5</b>B</figref> is a schematic flowchart of a communication method according to Embodiment 2 of this application. This embodiment mainly describes how to process a user plane security policy in a suspend process. Based on the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>, step <b>506</b>-<b>2</b> is added in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>B</figref>, to be more specific, UE stores first indication information. In other words, in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>B</figref>, both the UE and a source access network device store the first indication information, while in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>, only the source access network device stores the first indication information. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>B</figref> may include but is not limited to the following steps.</p><p id="p-0156" num="0155">Step <b>501</b>-<b>2</b>. The source access network device obtains and stores a user plane security policy of the UE.</p><p id="p-0157" num="0156">Step <b>502</b>-<b>2</b>. The source access network device sends an RRC release message to the UE. Correspondingly, the UE receives the RRC release message from the source access network device.</p><p id="p-0158" num="0157">Step <b>503</b>-<b>2</b>. After sending the RRC release message, the source access network device deletes an RRC encryption key, a user plane encryption key, and a user plane integrity protection key, stores an RRC integrity protection key, and stores an I-RNTI.</p><p id="p-0159" num="0158">Step <b>504</b>-<b>2</b>. After receiving the RRC release message, the UE verifies integrity protection of the RRC release message. If the verification succeeds, the UE stores an NCC value, deletes the RRC encryption key, the user plane encryption key, and the user plane integrity protection key, and stores the RRC integrity protection key.</p><p id="p-0160" num="0159">Step <b>505</b>-<b>2</b>. The source access network device stores the first indication information, where the first indication information includes user plane security activation method indication information and/or user plane security protection method indication information.</p><p id="p-0161" num="0160">For step <b>501</b>-<b>2</b> and step <b>505</b>-<b>2</b>, refer to the descriptions of step <b>501</b>-<b>1</b> and step <b>505</b>-<b>1</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>. For implementation processes of step <b>502</b>-<b>2</b> to step <b>504</b>-<b>2</b>, refer to the descriptions of step <b>202</b> to step <b>204</b> in the procedure shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref> and the descriptions of step <b>502</b>-<b>1</b> to step <b>504</b>-<b>1</b> in the procedure shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>. Details are not described herein again.</p><p id="p-0162" num="0161">Step <b>506</b>-<b>2</b>. The UE stores the first indication information, where the first indication information includes the user plane security activation method indication information and/or the user plane security protection method indication information.</p><p id="p-0163" num="0162">The user plane security activation method indication information is user plane activation indication information carried by the source access network device in step <b>106</b> in <figref idref="DRAWINGS">FIG. <b>1</b></figref> when the UE and the source access network device are in a connected state. For example, if the user plane integrity protection activation indication information included in the RRC connection reconfiguration message in step <b>106</b> in <figref idref="DRAWINGS">FIG. <b>1</b></figref> is &#x201c;enable&#x201d;, and the RRC connection reconfiguration message does not include the user plane encryption protection activation indication information, the UE may determine to enable user plane encryption protection and user plane integrity protection. After receiving the RRC release message, the UE records user plane integrity protection as &#x201c;enable&#x201d;. This record indicates that both user plane integrity protection and user plane encryption protection are enabled. In this case, the user plane security activation method indication information stored in the UE is used to indicate to enable user plane encryption protection and user plane integrity protection. For another example, if the user plane encryption protection activation indication information included in the RRC connection reconfiguration message in step <b>106</b> in <figref idref="DRAWINGS">FIG. <b>1</b></figref> is &#x201c;disable&#x201d;, and the RRC connection reconfiguration message does not include the user plane integrity protection activation indication information, the UE may determine not to enable user plane encryption protection and user plane integrity protection. After receiving the RRC release message, the UE records user plane integrity protection as &#x201c;disable&#x201d;. This record indicates that neither user plane integrity protection nor user plane encryption protection is enabled. In this case, the user plane security activation method indication information stored in the UE is used to indicate not to enable user plane encryption protection and user plane integrity protection. For another example, if the user plane integrity protection activation indication information included in the RRC connection reconfiguration message in step <b>106</b> in <figref idref="DRAWINGS">FIG. <b>1</b></figref> is &#x201c;enable&#x201d;, and the user plane encryption protection activation indication information is &#x201c;disable&#x201d;, the UE may determine not to enable user plane encryption protection and determine to enable user plane integrity protection. After receiving the RRC release message, the UE records user plane integrity protection as &#x201c;enable&#x201d; and user plane encryption protection as &#x201c;disable&#x201d;. This record indicates that user plane integrity protection is enabled and user plane encryption protection is not enabled. In this case, the user plane security activation method indication information stored in the UE is used to indicate not to enable user plane encryption protection and to enable user plane integrity protection.</p><p id="p-0164" num="0163">In the foregoing three examples, the information recorded by the UE indicates the user plane security activation method indication information. For example, if the information recorded by the UE is that user plane integrity protection is &#x201c;enable&#x201d; and user plane encryption protection is &#x201c;disable&#x201d;, the indicated user plane security activation method indication information is used to indicate not to enable user plane encryption protection and to enable user plane integrity protection. For another example, the information recorded by the UE is that user plane encryption protection is &#x201c;disabled&#x201d;, and the indicated user plane security activation method indication information is used to indicate that neither user plane encryption protection nor user plane integrity protection is enabled. In addition to this recording manner, the user plane security activation method indication information may further be recorded or indicated using two bits. For example, &#x201c;01&#x201d; indicates that user plane encryption protection is enabled and user plane integrity protection is disabled. A specific recording manner of the UE and a specific indication manner of the user plane security activation method indication information are not limited in this embodiment of this application.</p><p id="p-0165" num="0164">The user plane security protection method indication information is generated by the UE based on a user plane security protection method currently used by the UE to protect data, or is generated by the UE based on a user plane security protection method used by the UE to protect data before the UE enters an inactive state from the connected state. In other words, the user plane security protection method indication information is used to indicate the user plane security protection method currently used by the UE, or indicate the user plane security protection method used before the UE enters the inactive state from the connected state. For an example representation form of the user plane security protection method indication information, refer to a storage form of the user plane security activation method indication information recorded by the UE. The indication information may be explicitly stored on a source access network device side, or may be implicitly reflected by storing DRB configuration information. In other words, the first indication information may be related DRB configuration information. An access network device may know a to-be-used user plane security protection method based on the DRB configuration information.</p><p id="p-0166" num="0165">An advantage of storing the first indication information by the UE is that it can be ensured that the user plane security protection method used before the UE enters the inactive state from the connected state is consistent with that used after the UE enters the inactive state from the connected state.</p><p id="p-0167" num="0166">In a possible implementation, when storing the first indication information, the UE further stores granularity information corresponding to the first indication information. This process is the same as step <b>505</b>-<b>1</b> in which the source access network device stores the first indication information and the granularity information corresponding to the first indication information. An advantage of storing, by the UE, the first indication information and the granularity information corresponding to the first indication information is that after the UE enters the connected state from the inactive state, when the UE needs to send uplink user plane data, the UE may determine, based on granularity information of the to-be-sent uplink user plane data, a user plane security protection method corresponding to the granularity information, and then perform security protection on the uplink user plane data according to the user plane security protection method.</p><p id="p-0168" num="0167">It should be noted that step <b>506</b>-<b>2</b> may be performed after step <b>504</b>-<b>2</b>, or may be performed between step <b>502</b>-<b>2</b> and step <b>504</b>-<b>2</b>, or may be performed in a process of performing step <b>504</b>-<b>2</b>. In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>B</figref>, an example in which step <b>505</b>-<b>2</b> is performed after step <b>504</b>-<b>2</b> is used for description, and the example does not constitute a limitation on this embodiment of this application.</p><p id="p-0169" num="0168">In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>B</figref>, both the UE and the source access network device store the first indication information, such that it can be ensured that a user plane security protection method used before the UE and the source access network device enter the inactive state from the connected state is consistent with that used after the UE and the source access network device enter the inactive state from the connected state. Further, it may be convenient for the source access network device and the UE to determine, based on the first indication information, whether to store the user plane security key. Details are described in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>.</p><p id="p-0170" num="0169">When both the UE and the source access network device store the first indication information, the UE and the source access network device may store the user plane security protection method in different manners. This means that the first indication information stored in step <b>506</b>-<b>2</b> may be the same as or different from the first indication information stored in step <b>505</b>-<b>2</b>. For example, the first indication information stored in step <b>506</b>-<b>2</b> is the user plane activation indication information in step <b>106</b>, but the first indication information stored in step <b>505</b>-<b>2</b> is an enhanced security result. Therefore, a main objective of this embodiment is to describe that the UE side also stores indication information having a same function as the first indication information. For example, content of the indication information stored in the UE and the source access network device may be the same or may be different. This is not limited in the present disclosure. For example, the UE stores the user plane security activation method indication information, and the source access network device stores the user plane security protection method indication information. The user plane security protection method may also be stored in a same manner.</p><p id="p-0171" num="0170">Based on the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>B</figref>, another implementation method for implementing that the source access network device and the UE store the user plane security protection method is that the source access network device and the UE negotiate a user plane security protection method. The negotiated user plane security protection method is used to determine a user plane security protection method that should be used in a process in which the UE and the source access network device enter the connected state again. The negotiated user plane security protection method may be the same as or different from the current user plane security protection method.</p><p id="p-0172" num="0171">A feasible implementation method is that the RRC release message in step <b>502</b>-<b>2</b> may carry new user plane security activation method indication information and/or use indication information. The new user plane security activation method indication information indicates a user plane security protection method that should be used when the UE enters the connected state again. The use indication information indicates a case in which the UE can use the user plane security protection method indicated in step <b>502</b>-<b>2</b>. If there is no new user plane security activation method indication information in step <b>502</b>-<b>2</b>, the UE may protect early data transfer using a user plane security protection method used before the UE enters the inactive state, or the UE may protect early data transfer using a user plane security protection method obtained from a core network.</p><p id="p-0173" num="0172">For content of the carried new user plane security activation method indication information, refer to the user plane security activation method indication information. The use indication information may indicate, after the UE enters the connected state from the inactive state, whether the user plane security protection method can be used to protect only early data transfer, or can be used to protect user plane data transmission only after the UE enters the connected state, or can be used to protect both early data transfer and user plane data transmission after the UE enters the connected state. For example, this information can be transferred in an enumerable message format. Therefore, in step <b>504</b>-<b>2</b> and step <b>506</b>-<b>2</b>, the source access network device and the UE each only need to determine, based on the newly negotiated user plane security protection method, to store the first indication information.</p><p id="p-0174" num="0173">In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>B</figref>, both the UE and the source access network device store the first indication information. In a special case, neither the source access network device nor the UE stores the first indication information. In a process in which both the source access network device and the UE enter the inactive state from the connected state, there is a fixed user plane security protection method. In this case, when the source access network device and the UE enter the inactive state from the connected state, the fixed user plane security protection method may be directly used. For example, the fixed user plane security protection method is not enabling user plane encryption protection, but enabling user plane integrity protection. In this method, the source access network device may store a user plane security policy obtained from an SMF, such that after the UE returns to the connected state, the source access network device may activate user plane security between the source access network device and the UE according to the user plane security policy.</p><p id="p-0175" num="0174"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is a schematic flowchart of a communication method according to Embodiment 3 of this application. This embodiment mainly describes how to process a user plane security policy in a suspend process. Based on the procedure shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, a step of determining, by a source access network device and/or a UE, whether to store a user plane security key is added in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>. In other words, in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>, whether to delete the user plane encryption key and the user plane integrity protection key needs to be determined. However, in the procedure shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, the source access network device and the UE directly delete the user plane encryption key and the user plane integrity protection key. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref> may include but is not limited to the following steps.</p><p id="p-0176" num="0175">Step <b>601</b>. The source access network device obtains and stores a user plane security policy of the UE. For an implementation process of step <b>601</b>, refer to the description of step <b>501</b>-<b>1</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>. Details are not described herein again.</p><p id="p-0177" num="0176">Step <b>602</b>. The source access network device sends an RRC release message to the UE. Correspondingly, the UE receives the RRC release message from the source access network device. For an implementation process of step <b>602</b>, refer to the description of step <b>202</b> in the procedure shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>. Details are not described herein again.</p><p id="p-0178" num="0177">Step <b>603</b>. After sending the RRC release message, the source access network device deletes an RRC encryption key, stores an RRC integrity protection key, and stores an I-RNTI.</p><p id="p-0179" num="0178">Step <b>604</b>. The source access network device determines whether to store a user plane security key, to be more specific, determines whether to store the user plane encryption key and the user plane integrity protection key.</p><p id="p-0180" num="0179">The source access network device may determine, in the following several manners, whether to store the user plane security key.</p><p id="p-0181" num="0180">Manner 1: If a fixed user plane security protection method is used after the source access network device and the UE enter a connected state using a resume message, the source access network device determines, in a suspend process, to store the user plane security key corresponding to the method of the source access network device. The fixed user plane security protection method may be performing only user plane integrity protection, or performing only user plane encryption protection, or performing both user plane encryption protection and user plane integrity protection. Correspondingly, the source access network device stores only the user plane integrity protection key, or stores only the user plane encryption key, or stores both the user plane integrity protection key and the user plane encryption key. Correspondingly, after the UE enters the connected state using the RRC resume message, the source access network device uses only a user plane integrity protection key, or uses only a user plane encryption protection key, or uses both a user plane encryption protection key and a user plane integrity protection key to deprotect a received user plane message.</p><p id="p-0182" num="0181">Manner 2: When the source access network device stores only the user plane security policy, that is, performs execution according to the procedure shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, the source access network device further stores a currently used user plane security key in addition to the user plane security policy. As such, the source access network device can better determine the user plane security protection method after entering the connected state. An advantage of this method is that when both a user plane encryption protection policy and a user plane integrity protection policy that are included in the user plane security policy are PREFERRED, it is difficult to directly determine a previously used user plane security protection method based on the user plane security policy. Therefore, when the user plane security policy is stored, the currently used user plane security key is also stored, such that the source access network device can learn of the previous user plane security protection method. The user plane security key currently used by the source access network device is a user plane security key used by the source access network device and the UE to protect user plane security before the source access network device sends the RRC release message.</p><p id="p-0183" num="0182">Manner 3: When the source access network device stores first indication information, that is, when the source access network device performs step <b>505</b>-<b>1</b> or step <b>505</b>-<b>2</b>, the source access network device determines, based on the first indication information, whether to store the user plane security key, to be more specific, determines, according to the user plane security protection method indicated by the first indication information, whether to store the user plane encryption key and the user plane integrity protection key. For example, if the first indication information indicates that user plane encryption protection is enabled and user plane integrity protection is not enabled, the source access network device stores the user plane encryption key and deletes the user plane integrity protection key.</p><p id="p-0184" num="0183">Manner 4: If the source access network device stores a user plane resource related to granularity information, the source access network device may determine, based on a user plane security protection method corresponding to the user plane resource, whether to store the user plane encryption key and the user plane integrity protection key.</p><p id="p-0185" num="0184">Manner 5: If the source access network device and the UE newly negotiate a user plane security protection method, the source access network device may determine, based on the newly negotiated user plane security protection method, whether to store the user plane encryption key and the user plane integrity protection key.</p><p id="p-0186" num="0185">Because the source access network device stores the user plane security key, the source access network device retains related DRB configuration information of the user plane security activation method. It may be understood that the source access network device stores the related DRB configuration information of the user plane security activation method and the user plane security key together in the source access network device.</p><p id="p-0187" num="0186">Step <b>605</b>. After receiving the RRC release message, the UE verifies integrity protection of the RRC release message. If the verification succeeds, the UE stores an NCC value, deletes the RRC encryption key, and stores the RRC integrity protection key.</p><p id="p-0188" num="0187">Step <b>606</b>. The UE determines whether to store a user plane security key, to be more specific, determines whether to store the user plane encryption key and the user plane integrity protection key.</p><p id="p-0189" num="0188">The UE may determine, in the following several manners, whether to store the user plane security key.</p><p id="p-0190" num="0189">Manner 1: The UE stores the user plane security key regardless of a user plane security key used before the UE enters an inactive state. In this manner, the UE reactivates the user plane security protection method in an RRC resume process. A user plane security key used in the newly activated user plane security protection method may be the same as or different from that used before the UE enters the inactive state.</p><p id="p-0191" num="0190">Manner 2: The UE may determine to store only the user plane encryption key, or store only the user plane integrity protection key, or store both the user plane encryption key and the user plane integrity protection key. In addition, the stored content is consistent with that on a source access network device side. For example, both the UE and the source access network device store only the user plane encryption key. The user plane security key stored in this manner may be used to protect early data transfer.</p><p id="p-0192" num="0191">Manner 3: The UE may determine a to-be-stored key based on the current user plane security protection method. For example, before entering the inactive state, if the UE enables only user plane encryption protection, the UE needs to store the user plane encryption key, and may delete or store the user plane integrity protection key; if the UE enables only user plane integrity protection, the UE needs to store the user plane integrity protection key, and may store or delete the user plane encryption key; or if the UE enables both user plane integrity protection and user plane encryption protection, the UE needs to store both the user plane encryption key and the user plane integrity protection key.</p><p id="p-0193" num="0192">Manner 4: When the UE stores the first indication information, that is, when the UE performs step <b>506</b>-<b>2</b>, the UE determines a to-be-stored user plane security key based on the first indication information. For example, if the first indication information indicates that only user plane encryption protection is enabled, the user plane encryption key needs to be stored, and the user plane integrity protection key may be deleted or stored; if user plane security activation method indication information and/or user plane security protection method indication information indicate/indicates that only user plane integrity protection is enabled, the user plane integrity protection key needs to be stored, and the user plane encryption key may be stored or deleted; or if user plane security activation method indication information and/or user plane security protection method indication information indicate/indicates that both user plane integrity protection and user plane encryption protection are enabled, both the user plane encryption key and the user plane integrity protection need to be stored.</p><p id="p-0194" num="0193">For Manner 4, storing the first indication information and determining whether to store the user plane security key may be simultaneously performed; or the first indication information may be stored first, and then whether to store the user plane security key is determined; or whether to store the user plane security key may be determined first, and then the first indication information is stored.</p><p id="p-0195" num="0194">If storing the first indication information and determining whether to store the user plane security key are simultaneously performed, the UE determines, based on the user plane activation indication information carried in step <b>106</b> in <figref idref="DRAWINGS">FIG. <b>1</b></figref>, or the currently used user plane security protection method, or a user plane security protection method used when the UE enters the inactive state from the connected state, whether to store the user plane encryption key and the user plane integrity protection key; and generates and stores the user plane security activation method indication information and/or the user plane security protection method indication information. The simultaneous execution herein means that determining the user plane security key is not directly related to generating and storing the user plane security activation method indication information and/or the user plane security protection method indication information.</p><p id="p-0196" num="0195">If the first indication information is stored first, and then whether to store the user plane security key is determined, the UE generates and stores the user plane security activation method indication information based on the user plane activation indication information carried in step <b>106</b> in <figref idref="DRAWINGS">FIG. <b>1</b></figref>, and generates and stores the user plane security protection method indication information based on the currently used user plane security protection method or the user plane security protection method used when the UE enters the inactive state from the connected state. Then, the UE determines, based on the user plane security activation method indication information and/or the user plane security protection method indication information, whether to store the user plane encryption key and the user plane integrity protection key. It can be learned that in this case, the UE generates and stores the user plane security protection method indication information based on the user plane security protection method, and determines whether to store the to-be-protected user plane security key.</p><p id="p-0197" num="0196">If whether to store the user plane security key is determined first, and then the first indication information is stored, the UE determines, based on the user plane activation indication information carried in step <b>106</b> in <figref idref="DRAWINGS">FIG. <b>1</b></figref>, or the currently used user plane security protection method, or a user plane security protection method used when the UE enters the inactive state from the connected state, whether to store the user plane encryption key and the user plane integrity protection key; and further generates and stores the user plane security activation method indication information and/or the user plane security protection method indication information based on the determined stored user plane security key. It can be learned that in this case, the UE first determines the to-be-stored user plane security key, then further generates and stores the user plane security protection method indication information based on the stored key, and determines the to-be-protected user plane security key.</p><p id="p-0198" num="0197">Because the UE stores the user plane security key, the UE retains related DRB configuration information of the user plane security activation method. It may be understood that the UE stores the related DRB configuration information of the user plane security activation method and the user plane security key together in the UE.</p><p id="p-0199" num="0198">It should be noted that a sequence of performing step <b>605</b> and step <b>606</b> is not limited in this embodiment of this application. Step <b>605</b> and step <b>606</b> may be performed at a same time, or step <b>605</b> may be performed before step <b>606</b>, or step <b>606</b> may be performed before step <b>605</b>.</p><p id="p-0200" num="0199">It should be noted that determining, by the source access network device, whether to store the user plane security key may be synchronous with determining, by the UE, whether to store the user plane security key, in other words, step <b>604</b> and step <b>606</b> are performed, or step <b>604</b> and step <b>606</b> are not performed. Alternatively, determining, by the source access network device, whether to store the user plane security key may not be synchronous with determining, by the UE, whether to store the user plane security key, in other words, step <b>604</b> is performed but step <b>606</b> is not performed, to be more specific, the source access network device stores the user plane security key but the UE does not store the user plane security key; or step <b>606</b> is performed but step <b>604</b> is not performed, to be more specific, the UE stores the user plane security key but the source access network device does not store the user plane security key. If determining, by the source access network device, whether to store the user plane security key is not synchronous with determining, by the UE, whether to store the user plane security key, and backward compatibility of the UE and a base station is better considered, modification is minimized.</p><p id="p-0201" num="0200">In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>, a step of determining, by the UE and/or the source access network device, whether to store the user plane security key is added in the suspend process, such that security protection and security deprotection can be quickly performed on user plane data in the resume process.</p><p id="p-0202" num="0201">In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>, a step of whether to store the user plane security key may be added based on <figref idref="DRAWINGS">FIG. <b>2</b></figref>, or may be added based on <figref idref="DRAWINGS">FIG. <b>5</b>A</figref> or <figref idref="DRAWINGS">FIG. <b>5</b>B</figref>. For example, the UE determines, based on the stored first indication information, whether to store the user plane security key.</p><p id="p-0203" num="0202">The embodiments shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>, <figref idref="DRAWINGS">FIG. <b>5</b>B</figref>, and <figref idref="DRAWINGS">FIG. <b>6</b></figref> relate to the suspend process. The following describes the resume process. In the embodiments of this application, if the user plane security key is stored in the suspend process, the stored user plane security key is referred to as an old user plane security key, and the user plane security key generated in the resume process is referred to as a new user plane security key; and the user plane security protection method used in the suspend process is referred to as an old user plane security protection method, and the user plane security protection method re-determined in the resume process is referred to as a new user plane security protection method.</p><p id="p-0204" num="0203"><figref idref="DRAWINGS">FIG. <b>7</b>A</figref> is a schematic flowchart of a communication method according to Embodiment 4 of this application. This embodiment mainly describes how to perform security protection on user plane data in a resume process. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>A</figref> is based on the procedure shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, to be more specific, neither a UE nor a source access network device stores first indication information in a suspend process. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>A</figref> may include but is not limited to the following steps.</p><p id="p-0205" num="0204">Step <b>701</b>-<b>1</b>. The UE calculates a resume MAC-I using an RRC integrity protection key stored in the suspend process.</p><p id="p-0206" num="0205">Step <b>702</b>-<b>1</b>. The UE sends an RRC resume request to a target access network device. Correspondingly, the target access network device receives the RRC resume request from the UE.</p><p id="p-0207" num="0206">After sending the RRC resume request, the UE generates a new KgNB*, and generates a new RRC key using the new KgNB*. The new RRC key includes a new RRC encryption key and a new RRC integrity protection key.</p><p id="p-0208" num="0207">In a possible implementation, after sending the RRC resume request, the UE does not generate a user plane security key, that is, as shown in <figref idref="DRAWINGS">FIG. <b>7</b>A</figref>.</p><p id="p-0209" num="0208">In another possible implementation, after sending the RRC resume request, the UE generates a new user plane security key. Details are described in step <b>802</b>-<b>1</b><i>a </i>shown in <figref idref="DRAWINGS">FIG. <b>8</b>A</figref>.</p><p id="p-0210" num="0209">For implementation processes of step <b>701</b>-<b>1</b> and step <b>702</b>-<b>1</b>, refer to the descriptions of step <b>301</b> and step <b>302</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>. However, in step <b>702</b>-<b>1</b>, only the RRC key is generated, and the user plane security key is not generated.</p><p id="p-0211" num="0210">Step <b>703</b>-<b>1</b>. The target access network device sends a context information obtaining request to the source access network device. Correspondingly, the source access network device receives the context information obtaining request from the target access network device.</p><p id="p-0212" num="0211">Step <b>704</b>-<b>1</b>. The source access network device sends a context information obtaining response to the target access network device. Correspondingly, the target access network device receives the context information obtaining response from the source access network device.</p><p id="p-0213" num="0212">For implementation processes of step <b>703</b>-<b>1</b> and step <b>704</b>-<b>1</b>, refer to the descriptions of step <b>303</b> and step <b>304</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>.</p><p id="p-0214" num="0213">Step <b>705</b>-<b>1</b>. If the target access network device supports an encryption algorithm and an integrity protection algorithm that are used by a source cell, the target access network device generates the new RRC key (including the new RRC encryption key and the new RRC integrity protection key) using the KgNB*, determines a user plane security protection method according to a user plane security policy, and determines a to-be-used user plane security key based on the user plane security protection method.</p><p id="p-0215" num="0214">The target access network device determines the user plane security protection method between the target access network device and the UE based on the user plane security policy and a status of the target access network device. The status of the target access network device may include but is not limited to whether user plane encryption protection can be enabled, whether user plane integrity protection can be enabled, a current resource usage status, a current load status, a rate currently supported by the UE, and the like. For example, if a user plane encryption protection policy in the user plane security policy is REQUIRED, user plane integrity protection is PREFERRED, but the target access network device does not support enabling of user plane integrity protection, the user plane security protection method, determined by the target access network device, between the target access network device and the UE is to enable user plane encryption protection and not to enable user plane integrity protection. Correspondingly, the to-be-used user plane security key determined according to the user plane security protection method includes a user plane encryption key, and does not include a user plane integrity protection key.</p><p id="p-0216" num="0215">The determining, by the target access network device, the user plane security key may be combined with or separated from user plane security activation. If the determining, by the target access network device, the user plane security key is combined with user plane security activation, the target access network device generates a new user plane security key based on the user plane security protection method and the KgNB*, and activates user plane security using a new user plane security protection method and a new user plane security key. The new user plane security key is the to-be-used user plane security key. For example, if the user plane security protection method indicated by the first indication information is to enable user plane integrity protection, but the target access network device does not support enabling user plane integrity protection, the re-determined user plane security protection method includes not enabling user plane integrity protection. Correspondingly, the new user plane security key does not include the user plane integrity protection key. If the determining, by the target access network device, the user plane security key is separated from user plane security activation, the target access network device may generate all user plane security keys before or after the user plane security activation, and then determine a to-be-used user plane security key according to the user plane security activation method. For example, if only user plane encryption protection is activated and user plane integrity protection is not activated during user plane security activation, the target access network device uses only the user plane encryption key and does not use the user plane integrity protection key. In this case, the user plane integrity protection key may be deleted or retained. This is not specified in this embodiment of this application. When determining the user plane security protection method and the to-be-used user plane security key, the target access network device may perform security deprotection on uplink user plane data using the user plane security protection method, the user plane security key, and the user plane security algorithm, and perform security protection on downlink user plane data.</p><p id="p-0217" num="0216">After determining the user plane security protection method, the target access network device may activate user plane security using the user plane security protection method, and may activate the user plane security before sending an RRC resume message to the UE, or may activate the user plane security after sending an RRC resume message to the UE, for example, activate the user plane security between step <b>706</b>-<b>1</b> and step <b>708</b>-<b>1</b> or after step <b>708</b>-<b>1</b>.</p><p id="p-0218" num="0217">Optionally, after determining the user plane security protection method, the target access network device sends a user plane security activation result to an SMF. The user plane security activation result may be sent using a message in a path switch procedure, or may be sent using a message in another procedure, for example, using a handover request acknowledge transfer message. A specific bearer message is not limited in the present disclosure.</p><p id="p-0219" num="0218">Step <b>706</b>-<b>1</b>. The target access network device sends the RRC resume message to the UE, where the RRC resume message includes second indication information. Correspondingly, the UE receives the RRC resume message from the target access network device.</p><p id="p-0220" num="0219">The second indication information is used to indicate the user plane security protection method determined by the target access network device, and indicates whether to enable user plane encryption protection and user plane integrity protection, and includes user plane encryption protection activation indication information and/or user plane integrity protection activation indication information. In a possible implementation, for example, if the user plane integrity protection activation indication information included in the second indication information is &#x201c;enable&#x201d;, and the second indication information does not include the user plane encryption protection activation indication information, the second indication information is used to indicate to enable user plane integrity protection and user plane encryption protection. For another example, if the user plane integrity protection activation indication information included in the second indication information is &#x201c;disable&#x201d;, and the second indication information does not include the user plane encryption protection activation indication information, the second indication information is used to indicate not to enable user plane integrity protection and user plane encryption protection. In another possible implementation, for example, if the user plane integrity protection activation indication information included in the second indication information is &#x201c;enable&#x201d;, and the user plane encryption protection activation indication information included in the second indication information is &#x201c;enable&#x201d;, the second indication information is used to indicate to enable user plane integrity protection and user plane encryption protection. For another example, if the user plane integrity protection activation indication information included in the second indication information is &#x201c;disable&#x201d;, and the user plane encryption protection activation indication information included in the second indication information is &#x201c;disable&#x201d;, the second indication information is used to indicate not to enable user plane integrity protection and user plane encryption protection. In addition to the foregoing manners for indicating the second indication information, two bits may further be used to record or indicate the second indication information. For example, &#x201c;01&#x201d; indicates that user plane encryption protection is enabled and user plane integrity protection is disabled. A specific recording manner of the UE and a specific indication manner of the second indication information are not limited in this embodiment of this application.</p><p id="p-0221" num="0220">The target access network device includes the second indication information in the RRC resume message, such that the UE activates user plane security based on the second indication information.</p><p id="p-0222" num="0221">The RRC resume message is security protected and integrity protected by a new RRC key generated the target access network device, that is, signaling plane protection is performed on the RRC resume message.</p><p id="p-0223" num="0222">Step <b>707</b>-<b>1</b>. The UE activates user plane security based on the second indication information, and determines a to-be-used user plane security key.</p><p id="p-0224" num="0223">After receiving the RRC resume message, the UE verifies signaling plane security of the RRC resume message, generates all user plane security keys after the verification succeeds, and then further determines the to-be-used user plane security key based on a user plane security activation status or the second indication information. The user plane security activation status refers to how to activate user plane security before the UE enters a third state from a connected state. For example, if the UE generates the user plane encryption key and the user plane integrity protection key, and the user plane security activation status or the second indication information indicates that user plane encryption protection is enabled and user plane integrity protection is disabled, the UE uses only the user plane encryption key. The user plane integrity protection key may be deleted or retained. This is not limited in this embodiment of this application. Alternatively, the UE may directly determine the to-be-used user plane security key based on the user plane security activation status or the second indication information. For example, if the user plane security activation status or the second indication information indicates that user plane encryption protection is enabled and user plane integrity protection is disabled, the target access network device only needs to generate the user plane encryption key, and does not need to generate the user plane integrity protection key.</p><p id="p-0225" num="0224">If the UE generates a new user plane security key after sending the RRC resume request, that is, performs step <b>802</b>-<b>1</b><i>a</i>, correspondingly, the UE needs to perform step <b>807</b>-<b>1</b>.</p><p id="p-0226" num="0225">Step <b>708</b>-<b>1</b>. The UE sends an RRC resume complete message to the target access network device. Correspondingly, the target access network device receives the RRC resume complete message from the UE.</p><p id="p-0227" num="0226">The RRC resume complete message is security protected and integrity protected by the RRC key generated in step <b>702</b>-<b>1</b>, that is, signaling plane protection is performed on the RRC resume complete message.</p><p id="p-0228" num="0227">Step <b>709</b>-<b>1</b>. The UE sends first uplink user plane data to the target access network device. Correspondingly, the target access network device receives the first uplink user plane data from the UE.</p><p id="p-0229" num="0228">The UE performs security protection on the uplink user plane data using the user plane security protection method determined based on the second indication information, a new user plane security key, and a user plane security algorithm, to obtain the first uplink user plane data. In other words, the first uplink user plane data is protected by the new user plane security key. In this way, when receiving the first uplink user plane data, the target access network device performs security deprotection on the first uplink user plane data using the user plane security protection method, the new user plane security key, and the user plane security algorithm, to obtain the uplink user plane data.</p><p id="p-0230" num="0229">The user plane security algorithm may be stored in a suspend process, or may be negotiated by the UE and the target access network device in a resume process. A user plane security algorithm in which process is used is not limited in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>A</figref> and subsequent embodiments. The user plane security algorithm is omitted in a description process of a subsequent embodiment. Actually, the user plane security protection method, the user plane security key, and the user plane security algorithm are required to perform security protection on the uplink user plane data. The UE and the target access network device may negotiate a signaling plane security algorithm and/or a user plane security algorithm in the resume process, or a negotiated security algorithm may be used for both a signaling plane and a user plane.</p><p id="p-0231" num="0230">Step <b>709</b>-<b>1</b> is uplink transmission. For downlink transmission, when receiving downlink user plane data, the target access network device performs security protection on the downlink user plane data using the user plane security protection method, the new user plane security key, and the user plane security algorithm, to obtain first downlink user plane data; and sends the first downlink user plane data to the UE. In this way, when receiving the first downlink user plane data, the UE performs security deprotection on the first downlink user plane data using the user plane security protection method, the new user plane security key, and the user plane security algorithm, to obtain the downlink user plane data.</p><p id="p-0232" num="0231">In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>A</figref>, when neither the UE nor the source access network device stores the first indication information in the suspend process, and whether to store the user plane security key is not determined, the target access network device determines the user plane security protection method according to the user plane security policy, generates a new user plane security key, and sends the second indication information to the UE using the RRC resume message, such that the UE generates a new user plane security key and activates user plane security. In this embodiment, it is specified that when receiving the second indication information, the UE activates user plane security, and sends the uplink user plane data. After receiving the user plane security policy, the target access network device may activate user plane security, thereby ensuring user plane data transmission security in the resume process.</p><p id="p-0233" num="0232">It may be understood that the user plane security protection method determined by the target access network device according to the user plane security policy is a new user plane security protection method, and may be the same as or different from the user plane security protection method indicated by the first indication information. In a description process of a subsequent embodiment, the user plane security protection method indicated by the first indication information is referred to as an old user plane security protection method, and a user plane security protection method that is determined by the target access network device based on information other than the first indication information is referred to as a new user plane security protection method.</p><p id="p-0234" num="0233"><figref idref="DRAWINGS">FIG. <b>7</b>B</figref> is a schematic flowchart of a communication method according to Embodiment 5 of this application. This embodiment mainly describes how to perform security protection on user plane data in a resume process. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>B</figref> is based on the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>, to be more specific, a source access network device stores first indication information in a suspend process. Alternatively, the embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>B</figref> may be based on the procedure shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>. Even if the source access network device does not store the first indication information, the source access network device may determine the first indication information. For example, the source access network device determines a user plane security protection method based on a protection manner of user plane data before the source access network device enters an inactive state, and further determines the first indication information.</p><p id="p-0235" num="0234">The embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>B</figref> may include but is not limited to the following steps.</p><p id="p-0236" num="0235">Step <b>701</b>-<b>2</b>. A UE calculates a resume MAC-I using an RRC integrity protection key stored in the suspend process.</p><p id="p-0237" num="0236">Step <b>702</b>-<b>2</b>. The UE sends an RRC resume request to a target access network device. Correspondingly, the target access network device receives the RRC resume request from the UE.</p><p id="p-0238" num="0237">After sending the RRC resume request, the UE generates a new KgNB*, and generates a new RRC key using the new KgNB*. The new RRC key includes a new RRC encryption key and a new RRC integrity protection key.</p><p id="p-0239" num="0238">For implementation processes of step <b>701</b>-<b>2</b> and step <b>702</b>-<b>2</b>, refer to the descriptions of step <b>301</b> and step <b>302</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>, or refer to the descriptions of step <b>701</b>-<b>1</b> and step <b>702</b>-<b>1</b>.</p><p id="p-0240" num="0239">Step <b>703</b>-<b>2</b>. The target access network device sends a context information obtaining request to the source access network device. Correspondingly, the source access network device receives the context information obtaining request from the target access network device.</p><p id="p-0241" num="0240">Step <b>704</b>-<b>2</b>. The source access network device sends a context information obtaining response to the target access network device. Correspondingly, the target access network device receives the context information obtaining response from the source access network device.</p><p id="p-0242" num="0241">For implementation processes of step <b>703</b>-<b>2</b> and step <b>704</b>-<b>2</b>, refer to the descriptions of step <b>303</b> and step <b>304</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>. However, in addition to content included in the context information obtaining response in step <b>304</b>, the context information obtaining response in step <b>704</b>-<b>2</b> further includes the first indication information. The first indication information is the indication information included by the source access network device in step <b>505</b>-<b>1</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>.</p><p id="p-0243" num="0242">In a possible implementation, the source access network device may determine whether the first indication information needs to be carried. For example, if a base station changes, the source access network device may not send the first indication information. In this case, refer to the description of step <b>304</b>.</p><p id="p-0244" num="0243">Step <b>705</b>-<b>2</b>. If the target access network device supports an encryption algorithm and an integrity protection algorithm that are used by a source cell, the target access network device generates the new RRC key (including the new RRC encryption key and the new RRC integrity protection key) using the KgNB*, and determines a to-be-used user plane security key.</p><p id="p-0245" num="0244">In a possible implementation, the target access network device determines, based on the first indication information, whether a user plane security protection method indicated by the first indication information can be supported. If the user plane security protection method cannot be supported, the target access network device re-determines a user plane security protection method between the target access network device and the UE according to a user plane security policy, and activates user plane security. Alternatively, the target access network device re-determines a user plane security protection method between the target access network device and the UE using a method in which the target access network device sends an RRC message to enable the UE and the target access network device to re-establish an RRC connection, and activates user plane security. The target access network device sends the RRC message to the UE, and the RRC message is used to trigger the UE to re-access or re-establish a PDU session to re-establish the RRC connection. In a process of re-establishing the RRC connection, the target access network device and the UE may negotiate the user plane security protection method in an existing manner in which the UE and the base station negotiate the user plane security protection method. In other words, re-establishment of the RRC connection means that the UE needs to re-access the network and re-establish a PDU session connection. Therefore, the user plane security protection method may be renegotiated. In this way, although access efficiency is reduced, best compatibility with other approaches can be implemented. For details about re-determining the user plane security protection method by the target access network device according to the user plane security policy, refer to the description of step <b>705</b>-<b>1</b>. The target access network device determines a to-be-used user plane security key based on activated user plane security.</p><p id="p-0246" num="0245">In a possible implementation, the target access network device ignores the first indication information, directly determines the user plane security protection method according to the user plane security policy, and activates user plane security. The target access network device determines a to-be-used user plane security key based on activated user plane security.</p><p id="p-0247" num="0246">In a possible implementation, if the source access network device determines not to carry the first indication information, the target access network device determines the user plane security protection method according to the user plane security policy, and activates user plane security. The target access network device determines a to-be-used user plane security key based on activated user plane security.</p><p id="p-0248" num="0247">In a possible implementation, the target access network device directly generates a new user plane security key based on the first indication information and the KgNB*, and activates user plane security using the new user plane security key and the user plane security protection method that is indicated by the first indication information. <figref idref="DRAWINGS">FIG. <b>7</b>B</figref> corresponds to <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>, and the UE does not store the first indication information. Therefore, in this manner, the target access network device notifies the UE by including second indication information in an RRC resume message, such that the UE determines the user plane security protection method and activates user plane security. The target access network device may activate user plane security before sending the RRC resume message to the UE, or may activate user plane security after sending the RRC resume message to the UE, for example, activate the user plane security between step <b>706</b>-<b>2</b> and step <b>708</b>-<b>2</b> or after step <b>708</b>-<b>2</b>.</p><p id="p-0249" num="0248">Step <b>706</b>-<b>2</b>. The target access network device sends the RRC resume message to the UE, where the RRC resume message includes the second indication information. Correspondingly, the UE receives the RRC resume message from the target access network device.</p><p id="p-0250" num="0249">Step <b>707</b>-<b>2</b>. The UE activates user plane security based on the second indication information, and determines a to-be-used user plane security key.</p><p id="p-0251" num="0250">Step <b>708</b>-<b>2</b>. The UE sends an RRC resume complete message to the target access network device. Correspondingly, the target access network device receives the RRC resume complete message from the UE.</p><p id="p-0252" num="0251">For implementation processes of step <b>706</b>-<b>2</b> to step <b>708</b>-<b>2</b>, refer to the descriptions of step <b>706</b>-<b>1</b> to step <b>708</b>-<b>1</b> in <figref idref="DRAWINGS">FIG. <b>7</b>A</figref>. Details are not described herein again.</p><p id="p-0253" num="0252">In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>B</figref>, if the source access network device stores the first indication information in the suspend process, but the UE does not store the first indication information, when the target access network device determines that the user plane security protection method indicated by the first indication information cannot be supported, the target access network device re-determines a user plane security protection method according to the user plane security policy, and activates user plane security; or the target access network device directly activates user plane security according to the user plane security protection method indicated by the first indication information. In this embodiment, it is specified that when receiving the second indication information, the UE activates user plane security, and sends uplink user plane data. After receiving the user plane security policy and the first indication information, the target access network device may activate user plane security, thereby ensuring user plane data transmission security in the resume process.</p><p id="p-0254" num="0253"><figref idref="DRAWINGS">FIG. <b>7</b>C</figref> is a schematic flowchart of a communication method according to Embodiment 6 of this application. This embodiment mainly describes how to perform security protection on user plane data in a resume process. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>C</figref> is based on the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>B</figref>, to be more specific, both a source access network device and a UE store first indication information in a suspend process. Alternatively, the embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>C</figref> may be based on the procedure shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>. Even if the source access network device does not store the first indication information, the source access network device may determine the first indication information. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>C</figref> may include but is not limited to the following steps.</p><p id="p-0255" num="0254">Step <b>701</b>-<b>3</b>. The UE calculates a resume MAC-I using an RRC integrity protection key stored in the suspend process.</p><p id="p-0256" num="0255">Step <b>702</b>-<b>3</b>. The UE sends an RRC resume request to a target access network device. Correspondingly, the target access network device receives the RRC resume request from the UE.</p><p id="p-0257" num="0256">After sending the RRC resume request, the UE generates a new KgNB*, and generates an RRC key using the new KgNB*. The RRC key includes an RRC encryption key and an RRC integrity protection key.</p><p id="p-0258" num="0257">For implementation processes of step <b>701</b>-<b>3</b> and step <b>702</b>-<b>3</b>, refer to the descriptions of step <b>301</b> and step <b>302</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>, or refer to the descriptions of step <b>701</b>-<b>1</b> and step <b>702</b>-<b>1</b>.</p><p id="p-0259" num="0258">Step <b>703</b>-<b>3</b>. The target access network device sends a context information obtaining request to the source access network device. Correspondingly, the source access network device receives the context information obtaining request from the target access network device.</p><p id="p-0260" num="0259">Step <b>704</b>-<b>3</b>. The source access network device sends a context information obtaining response to the target access network device. Correspondingly, the target access network device receives the context information obtaining response from the source access network device. The context information obtaining response includes a user plane security policy and the first indication information. For details, refer to the description of step <b>704</b>-<b>2</b>.</p><p id="p-0261" num="0260">Step <b>705</b>-<b>3</b>. If the target access network device supports an encryption algorithm and an integrity protection algorithm that are used by a source cell, the target access network device generates the new RRC key (including the new RRC encryption key and the new RRC integrity protection key) using the KgNB*, and determines a to-be-used user plane security key based on the first indication information. For a process, refer to the description of determining the to-be-used user plane security key based on the first indication information in step <b>705</b>-<b>2</b>.</p><p id="p-0262" num="0261">The target access network device may activate user plane security before sending an RRC resume message to the UE, or may activate user plane security after sending an RRC resume message to the UE, for example, activate the user plane security between step <b>706</b>-<b>3</b> and step <b>708</b>-<b>3</b> or after step <b>708</b>-<b>3</b>.</p><p id="p-0263" num="0262">Step <b>706</b>-<b>3</b>. The target access network device sends the RRC resume message to the UE. Correspondingly, the UE receives the RRC resume message from the target access network device.</p><p id="p-0264" num="0263">Step <b>707</b>-<b>3</b>. The UE activates user plane security based on the first indication information, and determines a to-be-used user plane security key.</p><p id="p-0265" num="0264">After receiving the RRC resume message, the UE verifies signaling plane security of the RRC resume message, generates all user plane security keys after the verification succeeds, and then further determines the to-be-used user plane security key based on a user plane security activation status or the first indication information. The user plane security activation status refers to how to activate user plane security before the UE enters a third state from a connected state. For example, if the UE generates the user plane encryption key and the user plane integrity protection key, and the user plane security activation status or the first indication information indicates that user plane encryption protection is enabled and user plane integrity protection is disabled, the UE uses only the user plane encryption key. The user plane integrity protection key may be deleted or retained. This is not limited in this embodiment of this application. Alternatively, the UE may directly determine the to-be-used user plane security key based on the user plane security activation status or the first indication information. For example, if the user plane security activation status or the first indication information indicates that user plane encryption protection is enabled and user plane integrity protection is disabled, the target access network device only needs to generate the user plane encryption key, and does not need to generate the user plane integrity protection key. The step of generating, by the UE, a new user plane security key based on the first indication information and activating user plane security may be performed after the RRC resume message is received, in other words, step <b>707</b>-<b>3</b> is performed after step <b>706</b>-<b>3</b>. Alternatively, the step of generating, by the UE, a new user plane security key based on the first indication information and activating user plane security may be performed after the UE sends the RRC resume request to the target access network device, in other words, step <b>707</b>-<b>3</b> is performed after step <b>702</b>-<b>3</b>. If step <b>707</b>-<b>3</b> is performed after step <b>706</b>-<b>3</b> and second indication information is carried in step <b>706</b>-<b>3</b>, the UE needs to release an RRC connection. This is because if the second indication information is carried in step <b>706</b>-<b>3</b>, it means that the UE needs to re-determine the user plane security protection method based on the second indication information. Due to re-determining of the user plane security protection method, the UE may be unable to continue using the previous user plane security protection method. Therefore, the UE needs to release the RRC connection. Optionally, the UE may report an error to the target access network device, such that the target access network device actively initiates RRC connection release or an RRC connection re-establishment procedure.</p><p id="p-0266" num="0265">Step <b>708</b>-<b>3</b>. The UE sends an RRC resume complete message to the target access network device. Correspondingly, the target access network device receives the RRC resume complete message from the UE.</p><p id="p-0267" num="0266">A difference between <figref idref="DRAWINGS">FIG. <b>7</b>C</figref> and <figref idref="DRAWINGS">FIG. <b>7</b>B</figref> lies in that, in step <b>705</b>-<b>3</b>, the target access network device directly generates a new user plane security key based on the first indication information, and activates user plane security. Because the UE stores the first indication information, the target access network device does not need to include the second indication information in the RRC resume message. In this way, a user plane security protection method used before the UE and the source access network device enter an inactive state from a connected state is consistent with a user plane security protection method used after the UE and the source access network device enter the inactive state from the connected state, such that the UE and the source access network device can quickly perform security protection or security deprotection on user plane data.</p><p id="p-0268" num="0267">If the target access network device determines a new user plane security protection method according to a user plane security policy, the RRC resume message needs to carry the second indication information to indicate the user plane security protection method determined by the target access network device. The UE determines the user plane security protection method based on the second indication information, and activates corresponding user plane security.</p><p id="p-0269" num="0268">In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>C</figref>, both the UE and the source access network device store the first indication information in the suspend process, and both can generate a new user plane security key based on the first indication information. The UE may generate a new user plane security key before or after receiving the RRC resume message, and activate user plane security. The target access network device may generate a new user plane security key after sending the RRC resume message, and activate user plane security. In this way, user plane data transmission security in the resume process is ensured.</p><p id="p-0270" num="0269">In <figref idref="DRAWINGS">FIG. <b>7</b>A</figref>, <figref idref="DRAWINGS">FIG. <b>7</b>B</figref>, and <figref idref="DRAWINGS">FIG. <b>7</b>C</figref>, after sending the RRC resume request, the UE does not immediately generate a user plane security key. In the following <figref idref="DRAWINGS">FIG. <b>8</b>A</figref> and <figref idref="DRAWINGS">FIG. <b>8</b>B</figref>, after sending the RRC resume request, the UE immediately generates a user plane security key.</p><p id="p-0271" num="0270"><figref idref="DRAWINGS">FIG. <b>8</b>A</figref> is a schematic flowchart of a communication method according to Embodiment 7 of this application. This embodiment mainly describes how to perform security protection on user plane data in a resume process. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>8</b>A</figref> is based on the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>, or may be based on the procedure shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>. <figref idref="DRAWINGS">FIG. <b>7</b>B</figref> is also based on <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>. However, the user plane security key is not generated in step <b>702</b>-<b>2</b> in <figref idref="DRAWINGS">FIG. <b>7</b>B</figref>, but a new user plane security key is generated in step <b>802</b>-<b>1</b> in <figref idref="DRAWINGS">FIG. <b>8</b>A</figref>. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>8</b>A</figref> may include but is not limited to the following steps.</p><p id="p-0272" num="0271">Step <b>801</b>-<b>1</b>. A UE calculates a resume MAC-I using an RRC integrity protection key stored in a suspend process.</p><p id="p-0273" num="0272">Step <b>802</b>-<b>1</b>. The UE sends an RRC resume request to a target access network device. Correspondingly, the target access network device receives the RRC resume request from the UE.</p><p id="p-0274" num="0273">After sending the RRC resume request, the UE generates a new KgNB*, and generates a new RRC key using the new KgNB*. The new RRC key includes a new RRC encryption key and a new RRC integrity protection key. After sending the RRC resume request, the UE further generates a new user plane security key. The step of generating the new user plane security key by the UE is used as step <b>802</b>-<b>1</b><i>a. </i></p><p id="p-0275" num="0274">In step <b>802</b>-<b>1</b><i>a</i>, the new user plane security key generated by the UE is a user plane encryption key or a user plane integrity protection key, or a user plane encryption key and a user plane integrity protection key. It may be understood that the new user plane security key is a determined user plane security key.</p><p id="p-0276" num="0275">In a possible implementation, the UE directly generates a new user plane security key based on the new KgNB*, to be more specific, a new user plane encryption key and a new user plane integrity protection key. This manner is optional in step <b>302</b> in <figref idref="DRAWINGS">FIG. <b>3</b></figref>.</p><p id="p-0277" num="0276">In a possible implementation, when both the UE and the source access network device store the first indication information in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>B</figref>, the UE generates a new user plane security key based on the new KgNB* and the stored first indication information. In this case, a new user plane encryption key and/or a new user plane integrity protection key are/is generated. For example, if the first indication information indicates that user plane encryption protection is not enabled and user plane integrity protection is enabled, the UE generates a new user plane integrity protection key based on the new KgNB*, and does not need to generate a new user plane encryption key.</p><p id="p-0278" num="0277">If the UE stores a user plane security key in the suspend process, for example, the UE determines to store the user plane security key in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>, when the UE generates a new user plane security key and no early data transfer occurs, the user plane security key stored in the suspend process is deleted. In this embodiment of this application, the user plane security key stored in the suspend process is referred to as an old user plane security key, and the user plane security key newly generated in the resume process is referred to as a new user plane security key. In this case, when the new user plane security key is generated and no early data transfer occurs, the old user plane security key is deleted. When there is early data transfer, the old user plane security key is deleted at an appropriate time. For example, the UE deletes the old user plane security key after receiving the RRC resume message. For another example, the UE deletes the old user plane security key after determining that early data is successfully sent. In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>8</b>A</figref>, regardless of whether the UE stores the old user plane security key in the suspend process, the UE uses the new user plane security key after receiving the RRC resume message. Alternatively, if the UE does not store the old user plane security key in the suspend process, the UE uses the new user plane security key to protect and verify uplink and downlink user plane data after receiving the RRC resume message.</p><p id="p-0279" num="0278">When generating the new user plane security key, the UE may immediately activate user plane security, or may not immediately activate user plane security. In other words, user plane security activation may be performed in step <b>802</b>-<b>1</b><i>a </i>or after step <b>802</b>-<b>1</b><i>a</i>. An advantage of immediate activation lies in that user plane security helps the UE immediately send uplink user plane data, and the uplink user plane data can be security protected by the new user plane security key. An advantage of non-immediate activation lies in that the UE may send the uplink user plane data after determining that the UE successfully accesses the target access network device or the source access network device in the resume process. If the UE sends the uplink user plane data before determining an access success, the sent uplink user plane data may need to be sent again due to a resume process failure. In addition, if user plane security is not activated immediately, the UE cannot immediately send the uplink user plane data, or the sent uplink user plane data is not security protected. In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>8</b>A</figref>, an example in which user plane security is activated after step <b>806</b>-<b>1</b> is used.</p><p id="p-0280" num="0279">Whether user plane security is activated in step <b>802</b>-<b>1</b><i>a </i>may be determined by the UE based on whether the UE needs to immediately send the uplink user plane data. For example, if the UE needs to immediately send the uplink user plane data, user plane security may be immediately activated after the new user plane security key is generated. In step <b>802</b>-<b>1</b><i>a</i>, whether to activate user plane security may be determined by the UE based on a procedure pre-agreed on by the UE and an access network device. For example, as specified in the standard, after the access network device sends the RRC resume message (that is, after step <b>806</b>-<b>1</b>), the UE and the access network device activate user plane security. In this case, after generating the new user plane security key, the UE does not immediately activate user plane security, in other words, user plane security is not activated in step <b>802</b>-<b>1</b><i>a</i>. In other words, in this example, user plane security activation and user plane security key generation are decoupled. For another example, as specified in the standard, the UE may activate user plane security after or before the UE sends the RRC resume request. In this case, the UE may first activate user plane security, and then generate the new user plane security key based on the activated user plane security. Alternatively, the UE first generates all user plane security keys, and then determines a to-be-used user plane security key based on to-be-activated user plane security, that is, determines a new user plane security key (in this case, the user plane encryption key and the user plane integrity protection key are generated in step <b>802</b>-<b>1</b><i>a</i>, then the UE determines a key to be used in step <b>807</b>-<b>1</b>, and this is described in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>8</b>B</figref>).</p><p id="p-0281" num="0280">When the UE stores the old user plane security key and there is early data transfer, the UE and the access network device may activate user plane security twice. To be more specific, before sending early data, the UE first activates user plane security. In this case, a user plane security protection method may be a user plane security protection method (an on-demand user plane security protection method) used before the UE enters an inactive state, or may be a fixed user plane security protection method (for example, the fixed user plane security protection method is to enable only integrity protection) specified in the standard. The access network device performs same processing as the UE. To be more specific, when receiving early data, the access network device first activates user plane security. In this case, the user plane security protection method may be a user plane security protection method (an on-demand user plane security protection method) used before the UE enters the inactive state, or may be a fixed user plane security protection method (for example, the fixed user plane security protection method is to enable only integrity protection) specified in the standard. After the early data is sent, the UE and the access network device may reactivate user plane security. In this case, the activated user plane security is used after the UE and the access network device enter a connected state. The user plane security protection method may be the same as or different from that in the first time. Certainly, a feasible optimization method is that if the access network device determines that the user plane security protection method activated for the first time may continue to be used, the access network device and the UE continue to use the previous user plane security protection method. In this case, an explicit notification may be provided in step <b>806</b>-<b>1</b>, for example, may be provided by transferring the second indication information. Alternatively, an implicit notification may be provided, to be more specific, no indication information is transmitted, and the UE and the access network device continue to use the activated user plane security protection method by default. In this case, the UE and the access network device may continue to use the stored old user plane security key, or may use a newly generated user plane security key. An advantage of using the old user plane security key is that no additional user plane security key needs to be generated by occupying a resource. An advantage of using the new user plane security key is that compatibility with an existing user plane security protection method is good.</p><p id="p-0282" num="0281">That the UE activates user plane security means that the UE activates a user plane security protection method between the UE and the target access network device, and the user plane security protection method may be enabled to perform security protection on the uplink user plane data. If the target access network device does not exist, the UE activates a user plane security protection method between the UE and the source access network device.</p><p id="p-0283" num="0282">Step <b>803</b>-<b>1</b>. The target access network device sends a context information obtaining request to the source access network device. Correspondingly, the source access network device receives the context information obtaining request from the target access network device.</p><p id="p-0284" num="0283">Step <b>804</b>-<b>1</b>. The source access network device sends a context information obtaining response to the target access network device. Correspondingly, the target access network device receives the context information obtaining response from the source access network device.</p><p id="p-0285" num="0284">For implementation processes of step <b>803</b>-<b>1</b> and step <b>804</b>-<b>1</b>, refer to the descriptions of step <b>303</b> and step <b>304</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>. However, in addition to content included in the context information obtaining response in step <b>304</b>, the context information obtaining response in step <b>804</b>-<b>1</b> further optionally includes the first indication information. The first indication information is the indication information stored in the source access network device in step <b>505</b>-<b>1</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>. In another possible implementation, when the first indication information is generated, the source access network device may further determine whether to send the first indication information. If the source access network device sends a security context used in the resume process to the target access network device, the source access network device does not send the first indication information.</p><p id="p-0286" num="0285">Step <b>805</b>-<b>1</b>. If the target access network device supports an encryption algorithm and an integrity protection algorithm that are used by a source cell, the target access network device generates the new RRC key (including the new RRC encryption key and the new RRC integrity protection key) using the KgNB*, and determines a to-be-used user plane security key.</p><p id="p-0287" num="0286">In a possible implementation, if the context information obtaining response includes only the user plane security policy, the target access network device activates user plane security according to the user plane security policy, and determines the to-be-used user plane security key based on the activated user plane security. For details, refer to the description of step <b>705</b>-<b>1</b> in <figref idref="DRAWINGS">FIG. <b>7</b>A</figref>. As a supplement to the possible implementation of step <b>705</b>-<b>1</b>, the description of step <b>807</b>-<b>2</b> in <figref idref="DRAWINGS">FIG. <b>8</b>B</figref> may also be used for reference.</p><p id="p-0288" num="0287">In a possible implementation, if the context information obtaining response includes the user plane security policy and the first indication information, the target access network device may activate user plane security based on the user plane security policy when determining that the user plane security protection method indicated by the first indication information cannot be supported. Correspondingly, a to-be-used user plane security key is determined based on the activated user plane security. When determining that the user plane security protection method indicated by the first indication information can be supported, the target access network device may activate user plane security based on the first indication information. Correspondingly, the target access network device determines the to-be-used user plane security key based on the activated user plane security. For details, refer to the description of step <b>705</b>-<b>1</b> in <figref idref="DRAWINGS">FIG. <b>7</b>A</figref> or the description of step <b>807</b>-<b>2</b> in <figref idref="DRAWINGS">FIG. <b>8</b>B</figref>. Alternatively, the target access network device directly determines the to-be-used user plane security key based on the first indication information. For details, refer to the description of step <b>705</b>-<b>2</b> in <figref idref="DRAWINGS">FIG. <b>7</b>B</figref>.</p><p id="p-0289" num="0288">Particularly, if there is no target access network device, in other words, the UE sends the RRC resume request to the source access network device, generation of a user plane security key by the source access network device may be asynchronous with user plane security activation, to be more specific, the source access network device may first generate all user plane security keys, and then determine a to-be-used user plane security key based on to-be-activated user plane security. Alternatively, the source access network device may determine to continue to use the stored old user plane security key. If the old user plane security key continues to be used, the source access network device may include indication information in the RRC resume message, and the indication information is used to indicate that the old user plane security key continues to be used. In this case, the UE does not perform step <b>802</b>-<b>1</b><i>a</i>, to be more specific, does not generate a new user plane security key; or performs step <b>802</b>-<b>1</b><i>a</i>, but deletes the new user plane security key in step <b>807</b>-<b>1</b>.</p><p id="p-0290" num="0289">In another possible implementation, if there is no target access network device, the source access network device activates user plane security based on the first indication information; and then sends the second indication information to the UE. The UE activates user plane security based on the second indication information, and determines a to-be-used user plane security key.</p><p id="p-0291" num="0290">However, when there is a target access network device, the UE and the target access network device can use only a new user plane security key. Therefore, after receiving the RRC resume message, the UE needs to determine whether there is a target access network device. If there is a target access network device, the UE needs to delete the stored old user plane security key and start to use the new user plane security key. Because the target access network device does not have the old user plane security key, the target access network device can use only the new user plane security key. In this case, the source access network device deletes the old user plane security key. For example, the source access network device may delete the old user plane security key after step <b>804</b>-<b>1</b>.</p><p id="p-0292" num="0291">Step <b>806</b>-<b>1</b>. The target access network device sends the RRC resume message to the UE, where the RRC resume message includes the second indication information. Correspondingly, the UE receives the RRC resume message from the target access network device.</p><p id="p-0293" num="0292">Step <b>807</b>-<b>1</b>. The UE activates user plane security based on the second indication information.</p><p id="p-0294" num="0293">A difference from step <b>707</b>-<b>1</b> and step <b>707</b>-<b>2</b> lies in that user plane security is directly activated based on the second indication information in step <b>807</b>-<b>1</b>, that is, security protection may be performed on the uplink user plane data using the new user plane security key and the user plane security protection method that is indicated by the second indication information, and security deprotection may be performed on downlink user-plane data using the new user plane security key and the user plane security protection method that is indicated by the second indication information. After user plane security is activated, because the new user plane security key has been generated in step <b>802</b>-<b>1</b><i>a</i>, in step <b>807</b>-<b>1</b>, the new user plane security key may be directly used based on a user plane security activation status. In step <b>707</b>-<b>1</b> and step <b>707</b>-<b>2</b>, the UE determines the user plane security protection method between the UE and the target access network device based on the second indication information, and activates user plane security. In other words, in step <b>707</b>-<b>1</b> and step <b>707</b>-<b>2</b>, the new user plane security key is related to the second indication information, but in step <b>807</b>-<b>1</b>, the new user plane security key is unrelated to the second indication information.</p><p id="p-0295" num="0294">If the UE stores the old user plane security key, the UE deletes the old user plane security key after activating user plane security using the new user plane security key.</p><p id="p-0296" num="0295">Step <b>808</b>-<b>1</b>. The UE sends an RRC resume complete message to the target access network device. Correspondingly, the target access network device receives the RRC resume complete message from the UE.</p><p id="p-0297" num="0296">Step <b>809</b>-<b>1</b>. The UE sends first uplink user plane data to the target access network device. Correspondingly, the target access network device receives the first uplink user plane data from the UE.</p><p id="p-0298" num="0297">For implementation processes of step <b>808</b>-<b>1</b> and step <b>809</b>-<b>1</b>, refer to the descriptions of step <b>708</b>-<b>1</b> and step <b>709</b>-<b>1</b>.</p><p id="p-0299" num="0298">In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>8</b>A</figref>, when the source access network device stores the first indication information in the suspend process, but the UE does not store the first indication information, the target access network device notifies the UE of the user plane security protection method after determining the user plane security protection method. In this embodiment, it is specified that when receiving the second indication information, the UE activates user plane security, and sends uplink user plane data. After receiving the user plane security policy and the first indication information, the target access network device may activate user plane security, thereby ensuring user plane data transmission security in the resume process.</p><p id="p-0300" num="0299">If the UE stores the first indication information in the suspend process (as shown in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>B</figref>), in step <b>802</b>-<b>1</b><i>a</i>, the UE generates the new user plane security key based on the first indication information; in step <b>805</b>-<b>1</b>, the target access network device generates the new user plane security key based on the first indication information and activates user plane security; in step <b>806</b>-<b>1</b>, the RRC resume message does not carry the second indication information; in step <b>808</b>-<b>1</b>, the UE activates user plane security based on the first indication information; and in step <b>809</b>-<b>1</b>, the UE performs security protection on the uplink user plane data using the new user plane security key and the user plane security protection method that is indicated by the first indication information, to obtain the first uplink user plane data.</p><p id="p-0301" num="0300"><figref idref="DRAWINGS">FIG. <b>8</b>B</figref> is a schematic flowchart of a communication method according to Embodiment 8 of this application. This embodiment mainly describes how to perform security protection on user plane data in a resume process. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>8</b>B</figref> is based on the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>, or may be based on the procedure shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>. <figref idref="DRAWINGS">FIG. <b>8</b>B</figref> is also based on <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>. However, all user plane security keys are generated in step <b>802</b>-<b>2</b><i>a </i>in <figref idref="DRAWINGS">FIG. <b>8</b>B</figref>, and a new user plane security key, namely, a determined user plane security key, is generated in step <b>802</b>-<b>1</b><i>a </i>in <figref idref="DRAWINGS">FIG. <b>8</b>A</figref>. For a same part of the embodiment shown in <figref idref="DRAWINGS">FIG. <b>8</b>B</figref> and the embodiment shown in <figref idref="DRAWINGS">FIG. <b>8</b>A</figref>, refer to the description of <figref idref="DRAWINGS">FIG. <b>8</b>A</figref>. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>8</b>B</figref> may include but is not limited to the following steps.</p><p id="p-0302" num="0301">Step <b>801</b>-<b>2</b>. A UE calculates a resume MAC-I using an RRC integrity protection key stored in a suspend process.</p><p id="p-0303" num="0302">Step <b>802</b>-<b>2</b>. The UE sends an RRC resume request to a target access network device. Correspondingly, the target access network device receives the RRC resume request from the UE.</p><p id="p-0304" num="0303">Step <b>802</b>-<b>2</b><i>a</i>. The UE generates all user plane security keys, where all the user plane security keys include a user plane encryption key and a user plane integrity protection key, such that the UE determines a to-be-used user plane security key based on to-be-activated user plane security, that is, determines a new user plane security key. After receiving an RRC resume message, the UE may determine the to-be-used user plane security key based on second indication information. Alternatively, the UE may determine the to-be-used user plane security key based on first indication information when the UE stores the first indication information. In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>8</b>B</figref>, after receiving the RRC resume message, the UE determines the to-be-used user plane security key based on the second indication information.</p><p id="p-0305" num="0304">Step <b>803</b>-<b>2</b>. The target access network device sends a context information obtaining request to a source access network device. Correspondingly, the source access network device receives the context information obtaining request from the target access network device.</p><p id="p-0306" num="0305">Step <b>804</b>-<b>2</b>. The source access network device sends a context information obtaining response to the target access network device. Correspondingly, the target access network device receives the context information obtaining response from the source access network device.</p><p id="p-0307" num="0306">Step <b>805</b>-<b>2</b>. If the target access network device supports an encryption algorithm and an integrity protection algorithm that are used by a source cell, the target access network device generates a new RRC key (including a new RRC encryption key and a new RRC integrity protection key) using KgNB*, and determines a to-be-used user plane security key. For an implementation process of step <b>805</b>-<b>2</b>, refer to the description of step <b>805</b>-<b>1</b>.</p><p id="p-0308" num="0307">Step <b>806</b>-<b>2</b>. The target access network device sends the RRC resume message to the UE, where the RRC resume message includes the second indication information. Correspondingly, the UE receives the RRC resume message from the target access network device.</p><p id="p-0309" num="0308">Step <b>807</b>-<b>2</b>. The UE determines the to-be-used user plane security key based on the second indication information, and activates user plane security.</p><p id="p-0310" num="0309">The UE determines, based on the second indication information, the to-be-used user plane security key in all the user plane security keys generated in step <b>802</b>-<b>2</b><i>a</i>. For example, if the second indication information indicates that user plane encryption protection is enabled and user plane integrity protection is not enabled, and the user plane encryption key and the user plane integrity protection key are generated in step <b>802</b>-<b>2</b><i>a</i>, the determined to-be-used user plane security key is the user plane encryption key. A user plane security key that is not used may be deleted or retained.</p><p id="p-0311" num="0310">After determining the new user plane security key, the UE may perform security protection on uplink user plane data and security deprotection on downlink user plane data using the new user plane security key and a user plane security protection method that is indicated by the second indication information.</p><p id="p-0312" num="0311">Step <b>808</b>-<b>2</b>. The UE sends an RRC resume complete message to the target access network device. Correspondingly, the target access network device receives the RRC resume complete message from the UE.</p><p id="p-0313" num="0312">Step <b>809</b>-<b>2</b>. The UE sends first uplink user plane data to the target access network device. Correspondingly, the target access network device receives the first uplink user plane data from the UE.</p><p id="p-0314" num="0313">In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>8</b>A</figref>, when the source access network device stores the first indication information in the suspend process, but the UE does not store the first indication information, the UE first generates all the user plane security keys, determines the to-be-used user plane security key after receiving the RRC resume message, and activates user plane security; and the target access network device notifies the UE of the user plane security protection method after determining the user plane security protection method. In this embodiment, it is specified that when receiving the second indication information, the UE activates user plane security, and sends uplink user plane data. After receiving a user plane security policy and the first indication information, the target access network device may activate user plane security, thereby ensuring user plane data transmission security in the resume process.</p><p id="p-0315" num="0314">If the UE stores the first indication information in the suspend process (as shown in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>B</figref>), in step <b>805</b>-<b>2</b>, the target access network device determines the to-be-used user plane security key based on the first indication information; in step <b>806</b>-<b>2</b>, the RRC resume message does not carry the second indication information; in step <b>807</b>-<b>2</b>, the UE determines the to-be-used user plane security key based on the first indication information and activates user plane security; and in step <b>809</b>-<b>2</b>, the UE performs security protection on the uplink user plane data using the new user plane security key and the user plane security protection method that is indicated by the first indication information, to obtain the first uplink user plane data.</p><p id="p-0316" num="0315"><figref idref="DRAWINGS">FIG. <b>9</b>A</figref> and <figref idref="DRAWINGS">FIG. <b>9</b>B</figref> are a schematic flowchart of a communication method according to Embodiment 9 of this application. This embodiment mainly describes how to perform security protection on user plane data in a resume process. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>9</b>A</figref> and <figref idref="DRAWINGS">FIG. <b>9</b>B</figref> is based on the embodiment shown in <figref idref="DRAWINGS">FIG. <b>5</b>A</figref>, or may be based on the procedure shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>. For a same part of the embodiment shown in <figref idref="DRAWINGS">FIG. <b>9</b>A</figref> and <figref idref="DRAWINGS">FIG. <b>9</b>B</figref> and the embodiment shown in <figref idref="DRAWINGS">FIG. <b>8</b>A</figref>, refer to the description of <figref idref="DRAWINGS">FIG. <b>8</b>A</figref>. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>9</b>A</figref> and <figref idref="DRAWINGS">FIG. <b>9</b>B</figref> may include but is not limited to the following steps.</p><p id="p-0317" num="0316">Step <b>901</b>-<b>1</b>. A UE calculates a resume MAC-I using an RRC integrity protection key stored in a suspend process.</p><p id="p-0318" num="0317">Step <b>902</b>-<b>1</b>. The UE sends an RRC resume request to a target access network device. Correspondingly, the target access network device receives the RRC resume request from the UE.</p><p id="p-0319" num="0318">Step <b>902</b>-<b>1</b><i>a</i>. The UE generates a new user plane security key and activates user plane security.</p><p id="p-0320" num="0319">Step <b>902</b>-<b>1</b><i>b</i>. The UE sends first uplink user plane data to the target access network device. Correspondingly, the target access network device receives the first uplink user plane data from the UE.</p><p id="p-0321" num="0320">The UE performs security protection on uplink user plane data using the new user plane security key and a user plane security protection method that is indicated by first indication information, to obtain the first uplink user plane data. In other words, the UE performs security protection on the uplink user plane data using the old user plane security protection method and the new user plane security key, to obtain the first uplink user plane data.</p><p id="p-0322" num="0321">Step <b>903</b>-<b>1</b>. The target access network device sends a context information obtaining request to a source access network device. Correspondingly, the source access network device receives the context information obtaining request from the target access network device.</p><p id="p-0323" num="0322">Step <b>904</b>-<b>1</b>. The source access network device sends a context information obtaining response to the target access network device. Correspondingly, the target access network device receives the context information obtaining response from the source access network device.</p><p id="p-0324" num="0323">Step <b>905</b>-<b>1</b>. If the target access network device supports an encryption algorithm and an integrity protection algorithm that are used by a source cell, the target access network device generates a new RRC key (including a new RRC encryption key and a new RRC integrity protection key) using KgNB*, and determines a to-be-used user plane security key based on the first indication information.</p><p id="p-0325" num="0324">The target access network device activates user plane security based on the first indication information, and determines the to-be-used user plane security key based on the activated user plane security. For an implementation process of step <b>905</b>-<b>1</b>, refer to the description of step <b>705</b>-<b>3</b>.</p><p id="p-0326" num="0325">Step <b>905</b>-<b>1</b><i>a</i>. The target access network device performs security deprotection on the first uplink user plane data to obtain the uplink user plane data.</p><p id="p-0327" num="0326">The target access network device performs security deprotection on the first uplink user plane data using the old user plane security protection method and the new user plane security key, to obtain the uplink user plane data.</p><p id="p-0328" num="0327">Step <b>905</b>-<b>1</b><i>b</i>. The target access network device sends the uplink user plane data to a core network, and for example, sends the uplink user plane data to a user plane function (UPF).</p><p id="p-0329" num="0328">Step <b>905</b>-<b>1</b><i>c</i>. The target access network device determines not to use the old user plane security protection method, and determines a new user plane security protection method according to a user plane security policy.</p><p id="p-0330" num="0329">For details about determining the new user plane security protection method by the target access network device according to the user plane security policy, refer to the description of step <b>705</b>-<b>1</b> in <figref idref="DRAWINGS">FIG. <b>7</b>A</figref>.</p><p id="p-0331" num="0330">Step <b>906</b>-<b>1</b>. The target access network device sends an RRC resume message to the UE, where the RRC resume message includes second indication information. Correspondingly, the UE receives the RRC resume message from the target access network device.</p><p id="p-0332" num="0331">The second indication information is used to indicate the new user plane security protection method determined by the target access network device.</p><p id="p-0333" num="0332">Step <b>907</b>-<b>1</b>. The UE reactivates user plane security based on the second indication information.</p><p id="p-0334" num="0333">The UE reactivates user plane security using the new user plane security protection method and the new user plane security key. In other words, the UE may perform security protection on the uplink user plane data using the new user plane security protection method and the new user plane security key.</p><p id="p-0335" num="0334">Step <b>908</b>-<b>1</b>. The UE sends an RRC resume complete message to the target access network device. Correspondingly, the target access network device receives the RRC resume complete message from the UE.</p><p id="p-0336" num="0335">Step <b>909</b>-<b>1</b>. The UE sends second uplink user plane data to the target access network device. Correspondingly, the target access network device receives the second uplink user plane data from the UE.</p><p id="p-0337" num="0336">The UE performs security protection on the uplink user plane data using the new user plane security key and the new user plane security protection method that is indicated by the second indication information. In other words, the UE performs security protection on the uplink user plane data using the new user plane security protection method and the new user plane security key, to obtain the second uplink user plane data.</p><p id="p-0338" num="0337">In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>9</b>A</figref> and <figref idref="DRAWINGS">FIG. <b>9</b>B</figref>, user plane security activation is performed twice. The first user plane security activation is performed after the UE sends the RRC resume request, and in this case, the new user plane security key and the old user plane security protection method are used. The second user plane security activation is performed after the UE receives the second indication information, and in this case, the new user plane security key and the new user plane security protection method are used. If it is determined to continue to use the old user plane security protection method in step <b>905</b>-<b>1</b><i>c</i>, the RRC resume message in step <b>706</b> does not carry the second indication information, and step <b>907</b>-<b>1</b> and step <b>909</b>-<b>1</b> are not performed.</p><p id="p-0339" num="0338"><figref idref="DRAWINGS">FIG. <b>10</b>A</figref> and <figref idref="DRAWINGS">FIG. <b>10</b>B</figref> are a schematic flowchart of a communication method according to Embodiment 10 of this application. This embodiment mainly describes how to perform security protection on user plane data in a resume process. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>10</b>A</figref> and <figref idref="DRAWINGS">FIG. <b>10</b>B</figref> is based on the embodiment shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>. A UE and a source access network device each store a user plane security key. A user plane security key stored in a suspend process is referred to as an old user plane security key. The embodiment shown in <figref idref="DRAWINGS">FIG. <b>10</b>A</figref> and <figref idref="DRAWINGS">FIG. <b>10</b>B</figref> may include but is not limited to the following steps.</p><p id="p-0340" num="0339">Step <b>901</b>-<b>2</b>. The UE calculates a resume MAC-I using an RRC integrity protection key stored in the suspend process.</p><p id="p-0341" num="0340">Step <b>902</b>-<b>2</b>. The UE sends an RRC resume request to a target access network device. Correspondingly, the target access network device receives the RRC resume request from the UE.</p><p id="p-0342" num="0341">Step <b>902</b>-<b>2</b><i>a</i>. The UE sends first uplink user plane data to the target access network device. Correspondingly, the target access network device receives the first uplink user plane data from the UE.</p><p id="p-0343" num="0342">The UE performs security protection on uplink user plane data using an old user plane security key and a user plane security protection method that is indicated by first indication information, to obtain the first uplink user plane data. In other words, the UE performs security protection on the uplink user plane data using the old user plane security protection method and the old user plane security key, to obtain the first uplink user plane data.</p><p id="p-0344" num="0343">Step <b>903</b>-<b>2</b>. The target access network device sends a context information obtaining request to the source access network device. Correspondingly, the source access network device receives the context information obtaining request from the target access network device.</p><p id="p-0345" num="0344">Step <b>904</b>-<b>2</b>. The source access network device sends a context information obtaining response to the target access network device. Correspondingly, the target access network device receives the context information obtaining response from the source access network device.</p><p id="p-0346" num="0345">The context information obtaining response includes a user plane security policy and the first indication information, and further includes the old user plane security key.</p><p id="p-0347" num="0346">Step <b>905</b>-<b>2</b><i>a</i>. The target access network device performs security deprotection on the first uplink user plane data to obtain the uplink user plane data.</p><p id="p-0348" num="0347">The target access network device performs security deprotection on the first uplink user plane data using the old user plane security protection method and the old user plane security key, to obtain the uplink user plane data.</p><p id="p-0349" num="0348">Step <b>905</b>-<b>2</b><i>b</i>. The target access network device sends the uplink user plane data to a core network, and for example, sends the uplink user plane data to a UPF.</p><p id="p-0350" num="0349">Step <b>905</b>-<b>2</b>. If the target access network device supports an encryption algorithm and an integrity protection algorithm that are used by a source cell, the target access network device generates a new RRC key (including a new RRC encryption key and a new RRC integrity protection key) using KgNB*, and determines a to-be-used user plane security key.</p><p id="p-0351" num="0350">Step <b>906</b>-<b>2</b>. The target access network device sends an RRC resume message to the UE, where the RRC resume message includes second indication information. Correspondingly, the UE receives the RRC resume message from the target access network device.</p><p id="p-0352" num="0351">Step <b>907</b>-<b>2</b>. The UE activates user plane security based on the second indication information, and determines the to-be-used user plane security key.</p><p id="p-0353" num="0352">After generating the new user plane security key, the UE deletes the old user plane security key.</p><p id="p-0354" num="0353">Step <b>908</b>-<b>2</b>. The UE sends an RRC resume complete message to the target access network device. Correspondingly, the target access network device receives the RRC resume complete message from the UE.</p><p id="p-0355" num="0354">For implementation processes of step <b>905</b>-<b>2</b> to step <b>908</b>-<b>2</b>, refer to the descriptions of step <b>705</b>-<b>2</b> to step <b>708</b>-<b>2</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>B</figref>.</p><p id="p-0356" num="0355">Step <b>909</b>-<b>2</b>. The UE sends second uplink user plane data to the target access network device. Correspondingly, the target access network device receives the second uplink user plane data from the UE.</p><p id="p-0357" num="0356">The UE performs security protection on the uplink user plane data using the new user plane security key and the new user plane security protection method that is indicated by the second indication information. In other words, the UE performs security protection on the uplink user plane data using the new user plane security protection method and the new user plane security key, to obtain the second uplink user plane data.</p><p id="p-0358" num="0357">In the embodiment shown in <figref idref="DRAWINGS">FIG. <b>10</b>A</figref> and <figref idref="DRAWINGS">FIG. <b>10</b>B</figref>, user plane security activation is performed twice. The first user plane security activation is performed after the UE sends the RRC resume request, and in this case, the old user plane security key and the old user plane security protection method are used. The second user plane security activation is performed after the UE receives the second indication information, and in this case, the new user plane security key and the new user plane security protection method are used.</p><p id="p-0359" num="0358"><figref idref="DRAWINGS">FIG. <b>11</b></figref> is a schematic diagram of a path switch procedure according to an embodiment of this application. The path switch procedure may be combined with Embodiment 1 to Embodiment 10. <figref idref="DRAWINGS">FIG. <b>7</b>A</figref> is used as an example. The path switch procedure may be performed after step <b>704</b>-<b>1</b>, may be performed between step <b>704</b>-<b>1</b> and step <b>705</b>-<b>1</b>, or may be performed after step <b>709</b>-<b>1</b>.</p><p id="p-0360" num="0359">The embodiment shown in <figref idref="DRAWINGS">FIG. <b>11</b></figref> may include but is not limited to the following steps.</p><p id="p-0361" num="0360">Step <b>1001</b>. A target access network device sends a path switch request to an AMF. Correspondingly, the AMF receives the path switch request from the target access network device.</p><p id="p-0362" num="0361">The path switch request includes a user plane security policy, and the user plane security policy is sent by a source access network device to the target access network device. Optionally, the path switch request further includes granularity information corresponding to the user plane security policy.</p><p id="p-0363" num="0362">Step <b>1002</b>. The AMF sends a session management (SM) message to an SMF. Correspondingly, the SMF receives the SM message from the AMF.</p><p id="p-0364" num="0363">The SM message includes the user plane security policy, and optionally, further includes the granularity information corresponding to the user plane security policy.</p><p id="p-0365" num="0364">Step <b>1001</b> and step <b>1002</b> are that the target access network device sends the user plane security policy to the SMF through the AMF, and optionally, sends the granularity information corresponding to the user plane security policy.</p><p id="p-0366" num="0365">Step <b>1003</b>. The SMF determines whether a user plane security policy stored in the SMF is consistent with the user plane security policy carried in the path switch request.</p><p id="p-0367" num="0366">If the switch request includes the user plane security policy and the granularity information corresponding to the user plane security policy, the SMF searches, based on the granularity information, for the user plane security policy corresponding to the granularity information, and determines whether the found user plane security policy is consistent with the user plane security policy carried in the switch request.</p><p id="p-0368" num="0367">If the switch request does not include the granularity information corresponding to the user plane security policy, the switch request may further include an identifier of a UE. The SMF stores a user plane security policy corresponding to the identifier of the UE, and determines whether the user plane security policy corresponding to the identifier of the UE is consistent with the user plane security policy carried in the switch request.</p><p id="p-0369" num="0368">Step <b>1004</b>. If the user plane security policy corresponding to the identifier of the UE is inconsistent with the user plane security policy carried in the switch request, the SMF sends an SM acknowledgment (ACK) message to the AMF. Correspondingly, the AMF receives the SM acknowledgment message from the SMF.</p><p id="p-0370" num="0369">The SM acknowledgment message includes the user plane security policy stored in the SMF</p><p id="p-0371" num="0370">Step <b>1005</b>. The AMF sends a path switch response to the target access network device. Correspondingly, the target access network device receives the path switch response from the AMF.</p><p id="p-0372" num="0371">The path switch response includes the user plane security policy stored in the SMF.</p><p id="p-0373" num="0372">Step <b>1004</b> and step <b>1005</b> are that the SMF sends, to the target access network device using the AMF, the user plane security policy stored in the SMF.</p><p id="p-0374" num="0373">Step <b>1006</b>. The target access network device re-determines a user plane security protection method, and performs a handover procedure with the UE, where the handover procedure may be an intra-gNB-centralized unit (CU) handover (HO) procedure, such that the UE and the target access network device re-determine a user plane security protection method and activate user plane security.</p><p id="p-0375" num="0374">If the path switch procedure is performed after step <b>704</b>-<b>1</b>, or is performed between step <b>704</b>-<b>1</b> and step <b>705</b>-<b>1</b>, step <b>1006</b> may not be performed. In step <b>705</b>-<b>1</b>, the user plane security protection method is determined based on the user plane security policy obtained from the SMF. In this way, a delay can be shortened. If the path switch procedure is performed after step <b>709</b>-<b>1</b>, step <b>1006</b> needs to be performed. The UE and the target access network device re-determine a user plane security protection method to correct the previously determined user plane security protection method.</p><p id="p-0376" num="0375">The foregoing describes in detail the methods in the embodiments of this application. The following provides apparatuses in the embodiments of this application.</p><p id="p-0377" num="0376"><figref idref="DRAWINGS">FIG. <b>12</b></figref> is a schematic diagram of a logical structure of a communications apparatus according to an embodiment of this application. The communications apparatus <b>60</b> may include a transceiver unit <b>601</b> and a processing unit <b>602</b>. The communications apparatus <b>60</b> may be user equipment, a target access network device, or a source access network device.</p><p id="p-0378" num="0377">For a case in which the communications apparatus <b>60</b> is a user equipment: the processing unit <b>602</b> is configured to: after the transceiver unit <b>601</b> sends an RRC resume request to a target access network device, determine a first user plane security protection method between the user equipment and the target access network device; determine a first user plane security key between the user equipment and the target access network device; and perform user plane security protection on uplink user plane data based on the first user plane security protection method and the first user plane security key, to obtain first uplink user plane data. The transceiver unit <b>601</b> is configured to send the first uplink user plane data to the target access network device.</p><p id="p-0379" num="0378">When the communications apparatus <b>60</b> is a user equipment, the communications apparatus <b>60</b> may implement the functions of the UE in Embodiment 1 to Embodiment 10. For a detailed process of performing the functions by the units in the communications apparatus <b>60</b>, refer to the execution steps of the UE in Embodiment 1 to Embodiment 10. Details are not described herein again.</p><p id="p-0380" num="0379">For a case in which the communications apparatus <b>60</b> is a target access network device: the processing unit <b>602</b> is configured to: after the transceiver unit <b>601</b> receives an RRC resume message from a user equipment, determine a first user plane security protection method between the target access network device and the user equipment based on a context information obtaining response from a source access network device; determine a first user plane security key between the target access network device and the user equipment; and when the transceiver unit <b>601</b> receives first uplink user plane data from the user equipment, perform user plane security deprotection on the first uplink user plane data based on the first user plane security key and the first user plane security protection method, to obtain uplink user plane data. The transceiver unit <b>601</b> is configured to send the uplink user plane data, for example, send the uplink user plane data to a user plane function in a core network.</p><p id="p-0381" num="0380">When the communications apparatus <b>60</b> is a target access network device, the communications apparatus <b>60</b> may implement the functions of the target access network device in Embodiment 1 to Embodiment 10. For a detailed process of performing the functions by the units in the communications apparatus <b>60</b>, refer to the execution steps of the target access network device in Embodiment 1 to Embodiment 10. Details are not described herein again.</p><p id="p-0382" num="0381">When the communications apparatus <b>60</b> is a source access network device, the communications apparatus <b>60</b> may implement the functions of the source access network device in Embodiment 1 to Embodiment 10. For a detailed process of performing the functions by the units in the communications apparatus <b>60</b>, refer to the execution steps of the source access network device in Embodiment 1 to Embodiment 10. Details are not described herein again.</p><p id="p-0383" num="0382"><figref idref="DRAWINGS">FIG. <b>13</b></figref> is a simplified schematic diagram of a physical structure of a communications apparatus <b>70</b> according to an embodiment of this application. The communications apparatus <b>70</b> may be a user equipment, a target access network device, or a source access network device.</p><p id="p-0384" num="0383">The communications apparatus <b>70</b> includes a transceiver <b>701</b>, a processor <b>702</b>, and a memory <b>703</b>. The transceiver <b>701</b>, the processor <b>702</b>, and the memory <b>703</b> may be connected to each other through a bus <b>704</b>, or may be connected to each other in another manner. A related function implemented by the transceiver unit <b>601</b> shown in <figref idref="DRAWINGS">FIG. <b>12</b></figref> may be implemented by the transceiver <b>701</b>. A related function implemented by the processing unit <b>602</b> shown in <figref idref="DRAWINGS">FIG. <b>12</b></figref> may be implemented by one or more processors <b>702</b>.</p><p id="p-0385" num="0384">The memory <b>703</b> includes but is not limited to a random-access memory (RAM), a read-only memory (ROM), an erasable programmable read-only memory (EPROM), or a compact disc read-only memory (CD-ROM). The memory <b>703</b> is configured to store a related instruction and related data.</p><p id="p-0386" num="0385">The transceiver <b>701</b> is configured to send data and/or signaling, and receive data and/or signaling.</p><p id="p-0387" num="0386">If the communications apparatus <b>70</b> is the UE in Embodiment 1 to Embodiment 10, the transceiver <b>701</b> may be configured to communicate with the source access network device and the target access network device, for example, perform step <b>702</b>-<b>2</b>, step <b>706</b>-<b>2</b>, step <b>708</b>-<b>2</b>, and step <b>709</b>-<b>2</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>B</figref>.</p><p id="p-0388" num="0387">If the communications apparatus <b>70</b> is the target access network device in Embodiment 1 to Embodiment 10, the transceiver <b>701</b> may be configured to communicate with the UE, the source access network device, and the AMF, for example, perform step <b>702</b>-<b>2</b>, step <b>703</b>-<b>2</b>, step <b>704</b>-<b>2</b>, step <b>706</b>-<b>2</b>, and step <b>708</b>-<b>2</b> and step <b>709</b>-<b>2</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>B</figref>.</p><p id="p-0389" num="0388">If the communications apparatus <b>70</b> is the source access network device in Embodiment 1 to Embodiment 10, the transceiver <b>701</b> may be configured to communicate with the target access network device and the UE, for example, perform step <b>703</b>-<b>2</b> and step <b>704</b>-<b>2</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>B</figref>.</p><p id="p-0390" num="0389">The processor <b>702</b> may be one or more processors, for example, may be one or more central processing units (CPUs). When the processor <b>702</b> is one CPU, the CPU may be a single-core CPU or a multi-core CPU.</p><p id="p-0391" num="0390">If the communications apparatus <b>70</b> is the UE in Embodiment 1 to Embodiment 10, the processor <b>702</b> may be configured to perform and control an operation of the UE, for example, perform step <b>701</b>-<b>2</b> and step <b>707</b>-<b>2</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>B</figref>.</p><p id="p-0392" num="0391">If the communications apparatus <b>70</b> is the target access network device in Embodiment 1 to Embodiment 10, the processor <b>702</b> may be configured to perform and control an operation of the target access network device, for example, perform step <b>705</b>-<b>2</b> in the embodiment shown in <figref idref="DRAWINGS">FIG. <b>7</b>B</figref>.</p><p id="p-0393" num="0392">If the communications apparatus <b>70</b> is the source access network device in Embodiment 1 to Embodiment 10, the processor <b>702</b> may be configured to perform and control an operation of the source access network device.</p><p id="p-0394" num="0393">The memory <b>703</b> is configured to store program code and data of the communications apparatus <b>70</b>.</p><p id="p-0395" num="0394">For details of the steps performed by the processor <b>702</b> and the transceiver <b>701</b>, refer to the descriptions of Embodiment 1 to Embodiment 10. Details are not described herein again.</p><p id="p-0396" num="0395">It may be understood that <figref idref="DRAWINGS">FIG. <b>13</b></figref> merely shows a simplified design of the communications apparatus <b>70</b>. In actual application, the communications apparatus <b>70</b> may further include other necessary components, including but not limited to any quantity of transceivers, processors, controllers, memories, communications units, and the like. All devices capable of implementing this application fall within the protection scope of this application.</p><p id="p-0397" num="0396">An embodiment of this application further provides a communications system. The communications system may include a user equipment and a target access network device. The user equipment and the target access network device may be configured to implement the functions of the UE and the target access network device in Embodiment 1 to Embodiment 10. For details, refer to the implementation processes of the UE and the target access network device in Embodiment 1 to Embodiment 10.</p><p id="p-0398" num="0397">The communications system may further include a source access network device. The source access network device may be configured to implement the functions of the source access network device in Embodiment 1 to Embodiment 10. For details, refer to the implementation process of the source access network device in Embodiment 1 to Embodiment 10.</p><p id="p-0399" num="0398">A person of ordinary skill in the art may understand that all or some of the procedures of the methods in the foregoing embodiments may be implemented by a computer program instructing relevant hardware. The program may be stored in a computer-readable storage medium. When the program is executed, the procedures in the method embodiments may be performed. The foregoing storage medium includes any medium that can store program code, such as a ROM, a RAM, a magnetic disk, or an optical disc. Another embodiment of this application provides a computer-readable storage medium. The computer-readable storage medium stores an instruction. When the instruction is run on a computer, the computer is enabled to perform the methods in the foregoing aspects.</p><p id="p-0400" num="0399">Another embodiment of this application further provides a computer program product including an instruction. When the computer program product runs on a computer, the computer is enabled to perform the methods in the foregoing aspects.</p><p id="p-0401" num="0400">A person of ordinary skill in the art may be aware that, in combination with the examples described in the embodiments disclosed in this application, units and algorithm steps may be implemented by electronic hardware or a combination of computer software and electronic hardware. Whether the functions are performed by hardware or software depends on a particular application and a design constraint of the technical solutions. A person skilled in the art may use different methods to implement the described functions for each particular application, but it should not be considered that such an implementation goes beyond the scope of this application.</p><p id="p-0402" num="0401">A person skilled in the art may clearly understand that, for the purpose of convenient and brief description, for detailed working processes of the foregoing system, apparatus, and unit, refer to corresponding processes in the foregoing method embodiments, and details are not described herein again.</p><p id="p-0403" num="0402">In the several embodiments provided in this application, it should be understood that the disclosed system, apparatus, and method may be implemented in other manners. For example, the described apparatus embodiments are merely examples. For example, the division of units is merely logical function division and may be other division during actual implementation. For example, a plurality of units or components may be combined or integrated into another system, or some features may be ignored or not performed. In addition, the displayed or discussed mutual couplings or direct couplings or communication connections may be implemented using some interfaces. The indirect couplings or communication connections between the apparatuses or units may be implemented in electrical, mechanical, or another form.</p><p id="p-0404" num="0403">The units described as separate parts may or may not be physically separate, and parts displayed as units may or may not be physical units, may be located in one position, or may be distributed on a plurality of network units. Some or all of the units may be selected based on actual requirements to achieve the objectives of the solutions of the embodiments.</p><p id="p-0405" num="0404">In addition, functional units in the embodiments of this application may be integrated into one processing unit, or each of the units may exist alone physically, or two or more units are integrated into one unit.</p><p id="p-0406" num="0405">All or some of the foregoing embodiments may be implemented using software, hardware, firmware, or any combination thereof. When software is used to implement the embodiments, all or some of the embodiments may be implemented in a form of computer program product. The computer program product includes one or more computer instructions. When the computer program instructions are loaded and executed on a computer, the procedures or functions according to the embodiments of the present disclosure are all or partially generated. The computer may be a general-purpose computer, a special-purpose computer, a computer network, or another programmable apparatus. The computer instruction may be stored in a computer-readable storage medium, or may be transmitted using the computer-readable storage medium. The computer instruction may be transmitted from one website, computer, server, or data center to another website, computer, server, or data center in a wired (for example, a coaxial cable, an optical fiber, or a digital subscriber line (DSL)) or wireless (for example, infrared, radio, or microwave) manner. The computer-readable storage medium may be any usable medium accessible by a computer, or a data storage device, such as a server or a data center, integrating one or more usable media. The usable medium may be a magnetic medium (for example, a floppy disk, a hard disk, or a magnetic tape), an optical medium (for example, a DVD), a semiconductor medium (for example, a solid-state drive (SSD) or solid state disk), or the like.</p><?detailed-description description="Detailed Description" end="tail"?></description><claims id="claims"><claim id="CLM-00001" num="00001"><claim-text><b>1</b>. A method comprising:<claim-text>receiving, by an apparatus and from a source access network device, a radio resource control (RRC) release message comprising suspend configuration information, wherein the suspend configuration information indicates the apparatus to enter an inactive state;</claim-text><claim-text>performing, by the apparatus, verification of integrity protection of the RRC release message using an RRC integrity protection key;</claim-text><claim-text>retaining, by the apparatus when the verification succeeds, an inactive-radio network temporary identifier (I-RNTI) and first indication information, wherein the first indication information indicates a user plane security protection method used before the apparatus enters the inactive state from a connected state, and wherein the user plane security protection method indicates whether at least one of user plane encryption protection or user plane integrity protection is enabled;</claim-text><claim-text>sending, by the apparatus and to a target access network device, an RRC resume request; and</claim-text><claim-text>activating, by the apparatus using the user plane security protection method, user plane security between the apparatus and the target access network device when receiving an RRC resume message from the target access network device.</claim-text></claim-text></claim><claim id="CLM-00002" num="00002"><claim-text><b>2</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising deleting, by the apparatus when the verification succeeds, an RRC encryption key, a user plane encryption key, and a user plane integrity protection key.</claim-text></claim><claim id="CLM-00003" num="00003"><claim-text><b>3</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:<claim-text>determining, by the apparatus, a first user plane security key between the apparatus and the target access network device;</claim-text><claim-text>obtaining, by the apparatus, protected uplink user plane data by performing user plane security protection on uplink user plane data based on the user plane security protection method and the first user plane security key; and</claim-text><claim-text>sending, by the apparatus, the protected uplink user plane data to the target access network device.</claim-text></claim-text></claim><claim id="CLM-00004" num="00004"><claim-text><b>4</b>. The method of <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein determining the first user plane security key comprises determining, by the apparatus, the first user plane security key according to the user plane security protection method.</claim-text></claim><claim id="CLM-00005" num="00005"><claim-text><b>5</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:<claim-text>sending, by the source access network device, the RRC release message, wherein the RRC release message further comprises the I-RNTI, and wherein the I-RNTI identifies the apparatus; and</claim-text><claim-text>retaining, by the source access network device, the I-RNTI and the first indication information.</claim-text></claim-text></claim><claim id="CLM-00006" num="00006"><claim-text><b>6</b>. The method of <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein the RRC resume request comprises the I-RNTI, and wherein the method further comprises:<claim-text>receiving, by the target access network device, the RRC resume request from the apparatus;</claim-text><claim-text>sending, by the target access network device, a context information obtaining request comprising the I-RNTI;</claim-text><claim-text>receiving, by the source access network device, the context information obtaining request from the target access network device;</claim-text><claim-text>obtaining, by the source access network device, the first indication information based on the I-RNTI;</claim-text><claim-text>sending, by the source access network device and to the target access network device, a context information obtaining response comprising the first indication information;</claim-text><claim-text>receiving, by the target access network device, the context information obtaining response;</claim-text><claim-text>activating, by the target access network device using the user plane security protection method, user plane security between the target access network device and the apparatus when the user plane security protection method can be supported; and</claim-text><claim-text>sending, by the target access network device, the RRC resume message to the apparatus.</claim-text></claim-text></claim><claim id="CLM-00007" num="00007"><claim-text><b>7</b>. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein the context information obtaining response further comprises an encryption algorithm used by the source access network device, an integrity protection algorithm used by the source access network device, and a new access stratum key (KgNB*) generated by the source access network device, and wherein the method further comprises determining, by the target access network device, a first user plane security key between the target access network device and the apparatus based on the KgNB* when the target access network device supports the encryption algorithm and the integrity protection algorithm.</claim-text></claim><claim id="CLM-00008" num="00008"><claim-text><b>8</b>. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein the context information obtaining response further comprises a user plane security policy of the apparatus, and wherein the user plane security policy comprises at least one of a user plane encryption protection policy or a user plane integrity protection policy.</claim-text></claim><claim id="CLM-00009" num="00009"><claim-text><b>9</b>. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein the context information obtaining response further comprises a protocol data unit (PDU) session identifier (ID) corresponding to the first indication information.</claim-text></claim><claim id="CLM-00010" num="00010"><claim-text><b>10</b>. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref>, further comprising determining, by the target access network device, whether the user plane security protection method can be supported.</claim-text></claim><claim id="CLM-00011" num="00011"><claim-text><b>11</b>. An apparatus comprising:<claim-text>a processor coupled to a memory storing instructions and configured to execute the instructions to cause the apparatus to:</claim-text><claim-text>receive, from a source access network device, a radio resource control (RRC) release message comprising suspend configuration information, wherein the suspend configuration information indicates the apparatus to enter an inactive state;</claim-text><claim-text>perform verification of integrity protection of the RRC release message using an RRC integrity protection key;</claim-text><claim-text>retain, when the verification succeeds, an inactive-radio network temporary identifier (I-RNTI) and first indication information, wherein the first indication information indicates a user plane security protection method used before the apparatus enters the inactive state from a connected state, and wherein the user plane security protection method indicates whether at least one of user plane encryption protection or user plane integrity protection is enabled;</claim-text><claim-text>send an RRC resume request to a target access network device; and</claim-text><claim-text>activate, by using the user plane security protection method, user plane security between the apparatus and the target access network device when receiving an RRC resume message from the target access network device.</claim-text></claim-text></claim><claim id="CLM-00012" num="00012"><claim-text><b>12</b>. The apparatus of <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein the processor is further configured to execute the instructions to cause the apparatus to delete, when the verification succeeds, an RRC encryption key, a user plane encryption key, and a user plane integrity protection key.</claim-text></claim><claim id="CLM-00013" num="00013"><claim-text><b>13</b>. The apparatus of <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein the processor is further configured to execute the instructions to cause the apparatus to:<claim-text>determine a first user plane security key between the apparatus and the target access network device;</claim-text><claim-text>obtain protected uplink user plane data by performing user plane security protection on uplink user plane data based on the user plane security protection method and the first user plane security key; and</claim-text><claim-text>send the protected uplink user plane data to the target access network device.</claim-text></claim-text></claim><claim id="CLM-00014" num="00014"><claim-text><b>14</b>. The apparatus of <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein the processor is further configured to execute the instructions to cause the apparatus to further determine the first user plane security key according to the user plane security protection method.</claim-text></claim><claim id="CLM-00015" num="00015"><claim-text><b>15</b>. A communications system comprising:<claim-text>a user equipment (UE) configured to:<claim-text>receive, from a source access network device, a radio resource control (RRC) release message comprising suspend configuration information, wherein the suspend configuration information indicates the UE to enter an inactive state;</claim-text><claim-text>perform verification of integrity protection of the RRC release message using an RRC integrity protection key;</claim-text><claim-text>retain, when the verification succeeds, an inactive-radio network temporary identifier (I-RNTI) and first indication information, wherein the first indication information indicates a user plane security protection method used before the UE enters the inactive state from a connected state, and wherein the user plane security protection method indicates whether at least one of user plane encryption protection or user plane integrity protection is enabled;</claim-text><claim-text>send an RRC resume request; and</claim-text></claim-text><claim-text>a target access network device configured to:<claim-text>receive, from the UE, the RRC resume request;</claim-text><claim-text>send, to the source access network device, a context information obtaining request comprising the I-RNTI;</claim-text><claim-text>receive, from the source access network device, a context information obtaining response comprising the first indication information;</claim-text><claim-text>activate, using the user plane security protection method, user plane security between the target access network device and the UE when the user plane security protection method can be supported; and</claim-text><claim-text>send the RRC resume message to the UE,</claim-text></claim-text><claim-text>wherein the UE is further configured to activate, using the user plane security protection method, user plane security between the UE and the target access network device when receiving the RRC resume message from the target access network device.</claim-text></claim-text></claim><claim id="CLM-00016" num="00016"><claim-text><b>16</b>. The communications system of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the communications system further comprises the source access network device, and wherein the source access network device is configured to:<claim-text>send, to the UE, the RRC release message, wherein the RRC release message further comprises the I-RNTI, and wherein the I-RNTI identifies the UE;</claim-text><claim-text>retain the I-RNTI and the first indication information;</claim-text><claim-text>receive, from the target access network device, the context information obtaining request;</claim-text><claim-text>obtain the first indication information based on the I-RNTI; and</claim-text><claim-text>send, to the target access network device, the context information obtaining response.</claim-text></claim-text></claim><claim id="CLM-00017" num="00017"><claim-text><b>17</b>. The communications system of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the context information obtaining response further comprises an encryption algorithm used by the source access network device, an integrity protection algorithm used by the source access network device, and a new access stratum key (KgNB*) generated by the source access network device, and wherein the target access network device is further configured to determine a first user plane security key between the target access network device and the UE based on the KgNB* when the target access network device supports the encryption algorithm and the integrity protection algorithm.</claim-text></claim><claim id="CLM-00018" num="00018"><claim-text><b>18</b>. The communications system of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the context information obtaining response further comprises a user plane security policy of the UE, and wherein the user plane security policy comprises at least one of a user plane encryption protection policy or a user plane integrity protection policy.</claim-text></claim><claim id="CLM-00019" num="00019"><claim-text><b>19</b>. The communications system of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the context information obtaining response further comprises a protocol data unit (PDU) session identifier (ID) corresponding to the first indication information.</claim-text></claim><claim id="CLM-00020" num="00020"><claim-text><b>20</b>. The communications system of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the target access network device is further configured to determine whether the user plane security protection method can be supported.</claim-text></claim></claims></us-patent-application>