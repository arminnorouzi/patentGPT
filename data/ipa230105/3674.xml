<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230003675A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230003675</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17365832</doc-number><date>20210701</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>01</class><subclass>N</subclass><main-group>23</main-group><subgroup>2252</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>01</class><subclass>N</subclass><main-group>23</main-group><subgroup>20</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>01</class><subclass>N</subclass><main-group>23</main-group><subgroup>203</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>01</class><subclass>N</subclass><main-group>23</main-group><subgroup>04</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>01</class><subclass>N</subclass><main-group>23</main-group><subgroup>083</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>06</class><subclass>N</subclass><main-group>3</main-group><subgroup>02</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>01</class><subclass>N</subclass><main-group>23</main-group><subgroup>2252</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc><further-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>01</class><subclass>N</subclass><main-group>23</main-group><subgroup>20083</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>01</class><subclass>N</subclass><main-group>23</main-group><subgroup>203</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>01</class><subclass>N</subclass><main-group>23</main-group><subgroup>04</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>01</class><subclass>N</subclass><main-group>23</main-group><subgroup>083</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>06</class><subclass>N</subclass><main-group>3</main-group><subgroup>02</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>01</class><subclass>J</subclass><main-group>37</main-group><subgroup>28</subgroup><symbol-position>L</symbol-position><classification-value>A</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></further-cpc></classifications-cpc><invention-title id="d2e43">METHOD AND SYSTEM FOR DETERMINING SAMPLE COMPOSITION FROM SPECTRAL DATA</invention-title><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>FEI Company</orgname><address><city>Hillsboro</city><state>OR</state><country>US</country></address></addressbook><residence><country>US</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>KAPLENKO</last-name><first-name>Oleksii</first-name><address><city>Brno</city><country>CZ</country></address></addressbook></inventor><inventor sequence="01" designation="us-only"><addressbook><last-name>KLUSC&#xc1;EK</last-name><first-name>Jan</first-name><address><city>Brno</city><country>CZ</country></address></addressbook></inventor><inventor sequence="02" designation="us-only"><addressbook><last-name>T&#xdb;MA</last-name><first-name>Tom&#xe1;s</first-name><address><city>Brno</city><country>CZ</country></address></addressbook></inventor><inventor sequence="03" designation="us-only"><addressbook><last-name>KAPLENKO</last-name><first-name>Mykola</first-name><address><city>Brno</city><country>CZ</country></address></addressbook></inventor><inventor sequence="04" designation="us-only"><addressbook><last-name>MACHEK</last-name><first-name>Ondrej</first-name><address><city>Brno</city><country>CZ</country></address></addressbook></inventor></inventors></us-parties><assignees><assignee><addressbook><orgname>FEI Company</orgname><role>02</role><address><city>Hillsboro</city><state>OR</state><country>US</country></address></addressbook></assignee></assignees></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">Method and system are disclosed for determining sample composition from spectral data acquired by a charged particle microscopy system. Chemical elements in a sample are identified by processing the spectral data with a trained neural network (NN). If the identified chemical elements not matching with a known elemental composition of the sample, the trained NN is retrained with the spectral data and the known elemental composition of the sample. The retrained NN can then be used to identify chemical elements within other samples.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="109.73mm" wi="158.75mm" file="US20230003675A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="207.77mm" wi="162.05mm" file="US20230003675A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="219.79mm" wi="144.53mm" file="US20230003675A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="233.17mm" wi="140.21mm" file="US20230003675A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="206.67mm" wi="160.95mm" orientation="landscape" file="US20230003675A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00005" num="00005"><img id="EMI-D00005" he="225.04mm" wi="162.90mm" orientation="landscape" file="US20230003675A1-20230105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00006" num="00006"><img id="EMI-D00006" he="229.62mm" wi="148.25mm" file="US20230003675A1-20230105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0001" level="1">FIELD OF THE INVENTION</heading><p id="p-0002" num="0001">The present description relates generally to methods and systems for determining sample composition from spectral data, and more particularly, for determining the sample composition based on spectral data acquired responsive to irradiating the sample with a charged particle beam.</p><heading id="h-0002" level="1">BACKGROUND OF THE INVENTION</heading><p id="p-0003" num="0002">Charged particle microscopy is a well-known and increasingly important technique for imaging microscopic objects. Multiple types of emissions from a sample responsive to charged particle irradiation may provide structural and compositional information of the sample. For example, based on energy spectrum of an X-ray emission responsive to electron beam irradiation, energy-dispersive X-ray spectroscopy (EDS or EDX) can be used for elemental analysis or chemical characterization.</p><p id="p-0004" num="0003">One method for determining the chemical elements in the sample is to compare each detected energy spectrum with known spectra of chemical elements. For example, chemical elements may be identified by comparing peak locations in the detected spectrum with known peak locations of each chemical element. However, Applicant recognizes that the identified chemical elements may include a large number of false positives and/or false negatives, especially when the detected spectrum is sparse or have interfering peaks.</p><heading id="h-0003" level="1">SUMMARY</heading><p id="p-0005" num="0004">In one embodiment, a method comprises irradiating a first sample with a charged particle beam; detecting a first type emission from the first sample and forming one or more first spectra from the detected first type emission; identifying one or more first chemical elements within the first sample by processing the first spectra with a trained neural network; detecting a second type emission from the first sample and displaying a sample image generated based on the detected second type emission; selecting one or more pixels in the sample image; displaying one or more chemical elements corresponding to the selected pixels; responsive to the displayed chemical elements different from a known elemental composition, retraining the trained neural network with spectra corresponding to the selected pixels and the known elemental composition; irradiating one or more locations of a second sample with the charged particle beam; acquiring one or more second spectra by detecting the first type emission from the second sample; and identifying one or more second chemical elements within the second sample by processing the second spectra with the retrained neural network. In this way, chemical elements may be quickly identified with high accuracy.</p><p id="p-0006" num="0005">It should be understood that the summary above is provided to introduce in simplified form a selection of concepts that are further described in the detailed description. It is not meant to identify key or essential features of the claimed subject matter, the scope of which is defined uniquely by the claims that follow the detailed description. Furthermore, the claimed subject matter is not limited to implementations that solve any disadvantages noted above or in any part of this disclosure.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p-0007" num="0006"><figref idref="DRAWINGS">FIG. <b>1</b></figref> shows a charged particle microscope.</p><p id="p-0008" num="0007"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a flowchart of an example method for determining sample composition from spectral data.</p><p id="p-0009" num="0008"><figref idref="DRAWINGS">FIG. <b>3</b></figref> is a flowchart of an example method for retraining a trained neural network for elemental analysis.</p><p id="p-0010" num="0009"><figref idref="DRAWINGS">FIG. <b>4</b></figref> shows an example user interface for displaying elemental analysis result and retraining the trained neural network.</p><p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. <b>5</b></figref> illustrates an example dataflow of the method in <figref idref="DRAWINGS">FIG. <b>2</b></figref>.</p><p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is a flowchart of an example method for generating a trained neural network for elemental analysis.</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><p id="p-0013" num="0012">Like reference numerals refer to corresponding parts throughout the several views of the drawings.</p><heading id="h-0005" level="1">DETAILED DESCRIPTION</heading><p id="p-0014" num="0013">The following description relates to methods and systems for determining sample composition based on spectral data, such as energy spectra acquired by detecting emissions responsive to irradiating the sample with a charged particle beam. In U.S. Pat. No. 9,048,067, Owen discloses a method of identifying mineral by sequentially decomposing spectral data into elements from mineral definitions. The decomposition determines the proportion of chemical elements in the unknown mineral by fitting the known elemental spectra of an element list against the detected X-ray spectrum, wherein the element list is obtained by selecting mineral definitions in a mineral database. Applicant recognizes that accurate compositional analysis requires accurate element list. The element list may be inaccurate when the acquired X-ray spectrum of unknown sample is sparse (that is, total number of counts per spectrum is low). In sparse spectrum, it is hard to locate peak accurately or distinguish peaks that are close or interfering with each other. Increasing the number of x-ray counts (therefore having denser spectrum) can improve the elemental identification accuracy. However, it may also significantly increase the total data acquisition time. Moreover, because the detected X-ray spectrum of the same mineral may be different for different microscopes due to factors including detector aging and different operating conditions, the known elemental spectra may not fit the detected X-ray spectrum properly.</p><p id="p-0015" num="0014">In order to address the above issues, a trained neural network (NN) adapted to system operating conditions of a specific microscope is used to perform elemental analysis. In one example, after loading a first sample into a microscope, a charged particle beam irradiates one or more locations of the first sample. A first type emission, such as an X-ray, from each location is acquired in the form of energy spectra, wherein each energy spectrum corresponds to one sample location. A trained NN receives each of the acquired energy spectrum as input and outputs chemical elements identified in the spectrum and a probability of each identified chemical element. After processing the acquired energy spectra, a list of first chemical elements included in the first sample can be generated. A second type emission from the sample may be simultaneously or separately detected from one or more locations of the sample. A sample image may be generated based on the detected second type emission. The sample image shows structure of the sample. The sample image may be an optical image, scanning electron microscopy (SEM) image, backscattered electron (BSE) image, or transmission electron microscopy (TEM) image. In some examples, the sample image also includes chemical elemental information determined from the trained NN. One or more pixels are selected in the sample image. Chemical elements corresponding to the selected pixels are displayed. In some examples, the first sample is a reference sample with known elemental composition. If the displayed chemical elements do not match the known elemental composition at the corresponding sample locations, the trained NN is retrained with the spectra corresponding to the selected pixels. The retrained NN is then used for elemental analysis of spectral data acquired from the microscope from another sample. In this way, the retrained NN is adapted to microscope-specific parameters and operating conditions. For example, the retrained NN can be adapted to detector induced energy shifts in the spectral data. Further, the retrained NN is adapted to specific use case. For example, through the retraining, NN is adapted to distinguish interfering peaks characteristic to certain mineral, so that chemical elements may be more accurately identified.</p><p id="p-0016" num="0015">In another example, after loading a first sample into a microscope, a charged particle beam, such as an electron beam, irradiates one or more locations of a sample. A first type emission, such as an X-ray, from each location is detected and used to form of energy spectra. A second type emission, such as scattered electrons, is detected simultaneously or separately from the first type emission. A sample image is generated based on the second type emission. One or more pixels are selected, such as by an operator, from the sample image. In one example, one or more spectra corresponding to the selected pixels are selected from the energy spectra formed based on the first type emission. In another example, sample regions corresponding to the selected pixels are irradiated by the charged particle beam, and the spectra corresponding to the selected pixels are recollected. The recollected spectra may be denser than the first spectra. Chemical elements corresponding to the selected pixels are identified by processing the selected spectra or the recollected spectra using a trained NN. If the identified chemical elements are different from a known elemental composition at the selected sample region, the trained NN is retrained with the selected spectra and the known composition.</p><p id="p-0017" num="0016">In another example, a sample image, showing structure of the sample, is displayed to the operator. The sample image may be any one of the optical, SEM, BSE or TEM image. One or more pixels in the sample image are selected automatically or by an operator. Sample regions corresponding to the selected pixels are then irradiated by the charged particle beam, and spectral data are collected by detecting a first type of emission, such as an X-ray. Chemical elements corresponding to the selected pixels are identified by processing the collected spectral data using a trained NN. If the identified chemical elements are different from a known elemental composition at the selected sample region, the trained NN is retrained with the spectral data and the known composition.</p><p id="p-0018" num="0017">The retrained NN may be stored, such as in a non-transitory memory of the microscope from which the spectral data for retraining are acquired, for processing the spectral data acquired by the microscope. The retrained NN may replace the trained NN for future elemental analysis. In some examples, the trained NN and the retrained NN are both stored in a library. The NNs in the library may serve as a baseline trained NN for further retraining in the same or different microscope. The microscope may irradiate one or more locations of a second sample with the charged particle beam and acquire an energy spectrum from each of the sample locations. The retrained NN processes each of the acquired spectrum and outputs chemical elements and corresponding probability. Chemical elements with a probability higher than a threshold probability may be identified as second chemical elements of the second sample. Compositional map may be generated based on the second chemical elements. The compositional map shows spatial distribution of chemical element or component in the sample. In one example, the compositional map is an elemental map showing spatial distribution of second chemical elements. In another example, the acquired spectra of the sample are further decomposed into multiple spectral components and/or abundances based on the second chemical elements. Each component may correspond to a chemical element, a mixture of chemical elements, or a chemical phase. Each component corresponds to one spectral component and an abundance. The spectral component may be the spectrum of the component. The abundance may be the amount of the component. In on example, the abundance is the ratio of the component at a sample location. The compositional map may show spatial distribution of components in the sample.</p><p id="p-0019" num="0018">In some examples, a first spectra of multiple first locations of the sample may be acquired by scanning the sample with the charged particle beam. Chemical elements of the sample are identified based on the first spectra using the trained NN. The first spectra may then be decomposed into various components based on the identified chemical elements. Additionally, or alternatively, the abundance of each component may be determined through the decomposition process. In some example, after identifying chemical elements in the sample, a second spectra of multiple second locations of the sample are acquired by scanning the sample with the charged particle beam. The first spectra may be denser than the second spectra. That is, the number of counts is higher for each of the first spectrum than each of the second spectrum. Alternatively, the second sample locations may be different from the first sample locations. For example, the second sample locations cover larger area and/or have higher spatial resolution than the first sample locations. The second spectra can be decomposed based on the identified chemical elements to generate a compositional map.</p><p id="p-0020" num="0019">In some examples, after identifying the chemical elements of the reference sample with the trained NN, the identified chemical elements are displayed to an operator or user, for example, in a periodic table. The operator may input the known composition/chemical elements of the reference sample to the microscope for retraining the trained NN. In another example, a sample image is displayed simultaneously with the identified chemical elements. The sample image may show structure of the reference sample. Alternatively or additionally, the sample image may show the spatial distribution of the identified chemical elements in the reference sample. The sample image may include all scanned sample locations or a subset of sample locations. The operator may select one or more regions in the sample image and retrain the NN with integrated spectrum and known elemental composition of the selected region. The region may be a line, an area, or a point in the sample image. In yet another example, an integrated spectrum is displayed together with the sample image and the identified chemical elements, for example, in the same window. The integrated spectrum is the sum of all spectra in the selected region. By selecting a region of the sample and displaying the integrated spectrum, the operator can choose a region that can accurately reflect the known elemental composition. For example, the operator may choose a region without abrupt change in chemical element distribution, or a region excluding sample boundaries. In another example, the operator may choose a region with overlapping peaks, and retrain the NN to better identify or differentiate the peaks.</p><p id="p-0021" num="0020">In some examples, the trained NN may be automatically retrained with known elemental composition of a reference sample after acquiring spectral data from the reference sample. Instead of the operator selecting regions in the sample image, regions in the sample image are automatically selected. The trained NN may then be retrained based on the spectral data from the selected regions. In some examples, a sample image showing sample structure may be displayed to the operator. The operator may select the locations for collecting the spectral data in the sample image. The sample image may be optical image, SEM image, BSE image, or TEM image.</p><p id="p-0022" num="0021">In some examples, the trained NN is generated by training a na&#xef;ve NN with training data including simulated and/or experimental data. The simulated training data may be generated based on multiple chemical elements and their known spectra. The simulated training data may include individual chemical elements and its spectrum, as well as a combination of chemical elements and corresponding combined spectrum. For example, the combination of chemical elements are elements in a mineral and the combined spectrum is the spectrum of the mineral. The experimental data may be generated by imaging references samples with known composition using one or more microscopes. Different trained NNs may be generated for different microscopy operating conditions. The operating conditions may include one or more of accelerating voltage, beam current, take-off angle, working distance and detector setting (such as bias voltage).</p><p id="p-0023" num="0022">The NN may be trained off-line to identify many, such as 100, chemical elements or combinations of chemical elements. However, the trained NN may not be sensitive to a particular combination of chemical elements, especially when the peaks of individual chemical elements interfering with each other. Retraining the trained NN can adjust or adapt the NN to be more sensitive to, therefore more accurate to identify, a specific type of materials/minerals that are of interested by the operator.</p><p id="p-0024" num="0023">In some examples, the charged particle beam includes electron beam and ion beam. The energy spectrum includes X-ray spectrum and electron energy loss spectrum. In other examples, the chemical elemental analysis may be applied to analyzing other type of spectral data, such as Raman spectra.</p><p id="p-0025" num="0024">Turning to <figref idref="DRAWINGS">FIG. <b>1</b></figref>, <figref idref="DRAWINGS">FIG. <b>1</b></figref> is a highly schematic depiction of an embodiment of a charged particle microscope (CPM) in which the present invention is implemented; more specifically, it shows an embodiment of a scanning electron microscopy (SEM) system. System axes are shown as axes <b>110</b>. Microscope <b>100</b> comprises a particle-optical column <b>1</b>, which produces a beam <b>3</b> of charged particles (in this case, an electron beam) that propagates along a particle-optical axis <b>101</b>. Particle-optical axis <b>101</b> may be aligned with the Z axis of the system. The column <b>1</b> is mounted on a vacuum chamber <b>5</b>, which comprises a sample holder <b>7</b> and associated actuator(s) <b>8</b> for holding/positioning a sample <b>6</b>. The vacuum chamber <b>5</b> is evacuated using vacuum pumps (not depicted). Also depicted is a vacuum port <b>9</b>, which may be opened to introduce/remove items (components, samples) to/from the interior of vacuum chamber <b>5</b>. Microscope <b>100</b> may comprise a plurality of such ports <b>9</b>, if desired.</p><p id="p-0026" num="0025">The column <b>1</b> (in the present case) comprises an electron source <b>10</b> and an illuminator <b>2</b>. This illuminator <b>2</b> comprises lenses <b>11</b> and <b>13</b> to focus the electron beam <b>3</b> onto the sample <b>6</b>, and a deflection unit <b>15</b> (to perform beam steering/scanning of the beam <b>3</b>). The microscope <b>100</b> further comprises a controller/computer processing apparatus <b>26</b> for controlling inter alia the deflection unit <b>15</b>, lenses <b>11</b>, <b>13</b> and detectors <b>19</b>, <b>21</b>, and displaying information gathered from the detectors <b>19</b>, <b>21</b> on a display unit <b>27</b>. The display unit may also serve as an input unit for receiving operator inputs.</p><p id="p-0027" num="0026">The detectors <b>19</b> and <b>21</b> are chosen from a variety of possible detector types that can be used to examine different types of &#x201c;stimulated&#x201d; radiation emanating from the sample <b>6</b> in response to irradiation by the (impinging) beam <b>3</b>. Detector <b>19</b> may be a solid state detector (such as a photodiode) that is used to detect cathodoluminescence emanating from the sample <b>6</b>. It could alternatively be an X-ray detector, such as Silicon Drift Detector (SDD) or Silicon Lithium (Si(Li)) detector, for example. Detector <b>21</b> may be an electron detector in the form of a Solid State Photomultiplier (SSPM) or evacuated Photomultiplier Tube (PMT) for example. This can be used to detect backscattered and/or secondary electrons emanating from the sample <b>6</b>. The skilled artisan will understand that many different types of detector can be chosen in a set-up such as that depicted, including, for example, an annular/segmented detector. By scanning the beam <b>3</b> over the sample <b>6</b>, stimulated radiation&#x2014;comprising, for example, X-rays, infrared/visible/ultraviolet light, secondary electrons (SEs) and/or backscattered electrons (BSEs)&#x2014;emanates from the sample <b>6</b>. Since such stimulated radiation is position-sensitive (due to said scanning motion), the information obtained from the detectors <b>19</b> and <b>21</b> will also be position-dependent. This fact allows (for instance) the signal from detector <b>21</b> to be used to produce a BSE image of (part of) the sample <b>6</b>, which image is basically a map of said signal as a function of scan-path position on the sample <b>6</b>.</p><p id="p-0028" num="0027">The signals from the detectors <b>19</b> and <b>21</b> pass along control lines (buses) <b>25</b>, are processed by the controller <b>26</b>, and displayed on display unit <b>27</b>. Such processing may include operations such as combining, integrating, subtracting, false coloring, edge enhancing, and other processing known to the skilled artisan. In addition, automated recognition processes (e.g. as used for particle analysis) may be included in such processing. The controller includes a processor <b>28</b> and a non-transitory memory <b>29</b> for storing computer readable instructions. Methods disclosed herein may be implemented by executing the computer readable instructions stored in the non-transitory memory <b>29</b> in the processor <b>28</b>.</p><p id="p-0029" num="0028">It should be noted that many refinements and alternatives of such a setup will be known to the skilled artisan, such as the use of a controlled environment within (a relatively large volume of) the microscope <b>100</b>, e.g. maintaining a background pressure of several mbar (as used in an Environmental SEM or low-pressure SEM).</p><p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. <b>2</b></figref> shows method <b>200</b> for extracting sample composition from spectral data. In one example, the spectral data may be EDS spectra acquired using microscope <b>100</b> of <figref idref="DRAWINGS">FIG. <b>1</b></figref>. A trained NN performed elemental analysis to identify chemical elements in the sample. The trained NN may be adapted to microscope <b>100</b> and specific sample types by retraining (or updating) the trained NN with measurements from a sample with known elemental composition.</p><p id="p-0031" num="0030">At <b>202</b>, the sample is loaded into the microscope. At <b>204</b>, the system parameters are set. The system parameters include operating conditions such as one or more of accelerating voltage, beam current, working distance and detector setting. The detector setting may include integration time at each sample location. The system parameters may also include scan parameters such as the scan path and scan region.</p><p id="p-0032" num="0031">In some examples, a sample image showing structure or dimension of the sample may be displayed to the operator. The sample image may be an EM image. The operator may select a scan region in the sample image. The operator may also move the sample relative to the charged particle beam to move sample into the current field of view (FOV) to facilitate selecting the scan region.</p><p id="p-0033" num="0032">At <b>206</b>, one or more locations of the sample are scanned with the charged particle beam. The scanned sample locations are determined at <b>204</b>. At each sample location, one or more types of charged particles emitted from sample are acquired with one or more detectors. The acquired charged particles may include elections and X-rays. An energy spectrum, such as X-ray spectrum, is obtained for each sample location. The acquired charged particles may also include backscattered electrons or secondary electrons.</p><p id="p-0034" num="0033">At <b>208</b>, method <b>200</b> determines whether elemental analysis on the spectral data acquired at <b>206</b> needs to be performed. In one example, the elemental analysis is required if the current sample is a reference sample for retraining the trained NN. In another example, the elemental analysis is not required if the elemental analysis has been performed on the sample before. In yet another example, the elemental analysis is not required if the elemental composition of the sample is known, such as when the trained NN has been retrained with a reference sample with similar composition as the current sample. If elemental analysis is not required, method <b>200</b> moves to <b>216</b> and decompose spectral data based on the known elemental composition. If the elemental analysis is required, method <b>200</b> moves to <b>210</b> to perform elemental analysis on the spectral data.</p><p id="p-0035" num="0034">At <b>210</b>, chemical elements within the sample are optionally identified with a trained NN. The trained NN may be selected from a group of trained NNs, such as baseline NNs, based on the operating conditions set at <b>204</b>. The trained NN may be a convolutional NN or a network for natural language processing. The trained NN analyzes one or more of the acquired spectra and, for each spectrum, outputs a list of chemical elements and corresponding probabilities. Identified chemical elements at a particular sample location are the chemical elements with a probability equal or higher than a threshold probability. For example, the threshold probability is 0.75. In some examples, the threshold is any number between 0 and 1, including 1. In some examples, the elemental analysis may be performed on a subset of acquired spectra.</p><p id="p-0036" num="0035">At <b>212</b>, method <b>200</b> determines whether the NN requires retraining. Retraining may be required if the trained NN has not been retrained with spectral data acquired from the current microscope. Retraining may not be required when the trained NN has been retrained with spectral data acquired from the microscope with a reference sample of similar composition. If retraining is not required, method <b>200</b> proceeds to <b>216</b>. If retraining is required, method <b>200</b> proceeds to <b>214</b> to retrain the trained NN. Details of the retraining process are shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>.</p><p id="p-0037" num="0036">After retraining the trained NN at <b>214</b>, the retrained NN may be saved. The retrained NN may be used for analyzing sample with similar composition or spectral data acquired under similar operating conditions. In some examples, the spectral data used for retraining the trained NN may be further decomposed at <b>216</b>.</p><p id="p-0038" num="0037">At <b>216</b>, the spectral data acquired at <b>206</b> are decomposed based on the elemental information. The elemental information may be known or pre-determined and loaded into the controller based on the sample type. Alternatively, the elemental information may be the identified chemical elements at <b>210</b>. In one example, each of the acquired spectrum is decomposed into one or more spectral components and/or an abundance of each component. Each component corresponds to one spectral component and one abundance. Each component may be an element, a mixture of elements, or a chemical phase. The components may include various combinations of the known or identified elements. One way of decomposing the spectral data is shown in U.S. application Ser. No. 17/166,885, by Petr Hlavenka et al., filed on Feb. 3, 2021, and is herein incorporated by reference in its entirety.</p><p id="p-0039" num="0038">At <b>218</b>, one or more compositional images are generated. The compositional images include the elemental map showing distribution of identified chemical elements in the sample. The compositional images also include images generated based on the spectral components and/or abundance obtained at <b>216</b>. In the compositional image, the compositional data may be overlaid onto a structural image of the sample. The structural image can be generated based on scattered charged particles, such as scattered electrons, acquired at <b>206</b>.</p><p id="p-0040" num="0039">At <b>220</b>, method <b>200</b> determines whether additional scan of the sample is needed. Additional scan may be needed to acquire more spectral data for retraining. In some examples, in a first scan, multiple first sample locations may be scanned for determining the elemental composition and/or retraining the trained NN. The sample may be rescanned in a second scan, wherein multiple second sample locations may be scanned for generating the compositional image. The system parameters in the second scan may be different from the first scan. In one example, the second scan may have a higher spatial resolution than the first scan. In another example, the multiple first sample locations may be different from the second sample locations. The number of sample locations in the second scan may be greater than the number of sample locations in the first scan. In yet another example, the number of counts of each spectrum for the second scan may be less than the first scan. If additional scan is needed, method <b>200</b> proceeds to <b>204</b> to reset the system parameters. Otherwise, method <b>200</b> ends.</p><p id="p-0041" num="0040">In this way, elemental analysis is performed with a trained NN. The trained NN may be retrained specifically for the microscope, operating conditions and sample types based on measurement of one or more reference samples with known elemental composition using the microscope. Once the NN is retrained, it may be stored and used for elemental analysis of other similar samples. Based on the identified chemical elements from the elemental analysis, the spectral data can be decomposed to obtain the spectral components and the abundance at each sample location, which can be used to generate additional compositional images to provide more insights of sample composition.</p><p id="p-0042" num="0041"><figref idref="DRAWINGS">FIG. <b>3</b></figref> shows method <b>300</b> for retraining the trained NN. The trained NN may be retrained with an integrated spectrum generated from acquired spectral data, and the known elemental composition corresponding to the integrated spectrum. Method <b>300</b> may interact with the operator with a user interface to receive the known elements.</p><p id="p-0043" num="0042">At <b>302</b>, a sample image showing sample structure is displayed. The sample image may be generated based on scattered electrons acquired during the scan at <b>206</b> of <figref idref="DRAWINGS">FIG. <b>2</b></figref>. Alternatively, the sample image is acquired separately from the scan at <b>206</b> of <figref idref="DRAWINGS">FIG. <b>2</b></figref>. The sample image may be an optical image, a SEM image, a BSE image, or a TEM image. In one example, the sample image may be an elemental map showing spatial distribution of the identified chemical elements in the sample, if elemental analysis is performed in <b>210</b> of <figref idref="DRAWINGS">FIG. <b>2</b></figref>. The elemental map may be generated based on both the acquired spatially resolved scattered electrons and the identified chemical elements. For example, signals from scattered elections are displayed in grayscale to show structural information of the sample. The identified elements may be color-coded and overlay onto the grayscale image.</p><p id="p-0044" num="0043">In some examples, chemical elements identified at <b>210</b> of <figref idref="DRAWINGS">FIG. <b>2</b></figref> are displayed together with the sample image. In one example, the identified chemical elements may be displayed in a periodic table. In another example, the identified chemical elements are displayed as a list.</p><p id="p-0045" num="0044">At <b>304</b>, one or more regions in the sample image are selected. The regions may be selected by the operator after observing the elemental map. The regions may alternatively be selected automatically. For example, a center region of the sample is automatically selected. The selected region contains one or more pixels of the sample image. In one example, the selected region may be an area reflecting the known composition of the sample. In another example, the selected region corresponding to characteristic spectrum, such as spectrum with overlapping peaks.</p><p id="p-0046" num="0045">At <b>308</b>, the charged particle beam is optionally directed to sample regions corresponding to the selected region (or pixels) in the sample image for collecting additional spectral data, and the additional spectral data are analyzed using the trained NN to identify chemical elements in the selected region(s). The system parameters may be adjusted for collecting the additional spectral data. In one example, the integration time of the detector is longer comparing to the integration time at <b>206</b>, so that denser spectra are acquired. In another example, the scan step is adjusted.</p><p id="p-0047" num="0046">At <b>310</b>, chemical elements identified in the selected region are displayed at <b>310</b>. The chemical elements may be identified at either <b>210</b> or <b>310</b>. In one example, the chemical elements are displayed by updating the displayed identified chemical elements at <b>306</b>. In one example, the identified chemical elements at <b>310</b> may be displayed in a periodic table or as a list. One or more of the integrated spectra, identified chemical elements, and sample image may be selectively displayed individually or together on a display unit.</p><p id="p-0048" num="0047">At <b>312</b>, an integrated spectrum is generated based on acquired spectra within the selected regions. For example, one or more spectra acquired from sample locations within the selected regions are summed or averaged to generate the integrated spectrum. In some examples, the integrated spectrum is displayed to the operator.</p><p id="p-0049" num="0048">At <b>314</b>, identified chemical elements in the selected regions are compared with the known elemental composition in the selected regions. The comparison may be executed by the controller of the microscope or by the operator. If the identified chemical elements and the known elements do not match, method <b>300</b> proceeds to <b>316</b> to receive the known elemental composition from user input. Otherwise, method <b>300</b> proceeds to <b>322</b>.</p><p id="p-0050" num="0049">At <b>316</b>, known elemental compositions from the selected regions are received by user input. For example, the operator can select or deselect the displayed chemical elements at <b>310</b>.</p><p id="p-0051" num="0050">At <b>318</b>, the trained NN is retrained with the integrated spectrum and the received known composition information. In some examples, the retrained NN may be verified with spectra data not used for retraining the NN. In one example, the trained NN is replaced by the retrained NN and stored. In some examples, one or more retrained NNs are stored as baseline NNs. The baseline NN may be used as a starting point for retraining, for example, for different sample or different microscopy system.</p><p id="p-0052" num="0051">At <b>320</b>, the acquired spectral data may optionally be reprocessed with the retrained NN to generate an updated elemental map. The updated elemental map may be used for evaluating the accuracy of the retrained NN.</p><p id="p-0053" num="0052">At <b>322</b>, method <b>300</b> checks whether additional retraining of the NN with the current spectral data is needed. For example, an operator may determine whether or not to retrain the NN based on the updated elemental map. If retraining is needed, method <b>300</b> moves to <b>306</b>, and the NN may be retrained with spectral data from different regions of the sample. If no additional retraining is needed or if additional spectra data need to be required for retraining, method <b>300</b> ends.</p><p id="p-0054" num="0053">By receiving chemical elements selected the operator, new training data that has not been used for off-line training the NN may be obtained to fine-tune the NN to be more sensitive to specific user case and/or specific composition of interest.</p><p id="p-0055" num="0054"><figref idref="DRAWINGS">FIG. <b>4</b></figref> shows an example of user interface for displaying the results from elemental analysis and receiving user inputs for retraining the trained NN. The elemental map <b>402</b>, the periodic table <b>403</b> showing identified chemical elements, and the integrated spectrum <b>404</b> are simultaneously displayed in a window <b>401</b> on a display unit. The elemental map shows identified elements color-coded and overlaid on an electron microscopic image of the sample. The identified elements Fe, Zn, and Sn are highlighted in the periodic table. The integrated spectrum <b>404</b> may be generated based on all spectral data received in the sample region shown in the elemental map <b>402</b>. Peaks in the integrated spectrum that correspond to the identified elements may be indicated in the integrated spectrum.</p><p id="p-0056" num="0055">An operator may select one or more regions in elemental map <b>402</b>. The region may be a line, an area, or a point in the sample image. During or after the selection, the periodic table <b>402</b> and integrated spectrum <b>404</b> are updated with identified elements and updated integrated spectrum of the selected regions. If the identified elements are different from the known elemental composition, the operator may input the known elemental composition by selecting and/or deselecting elements in the periodic table <b>403</b>. The operator may then click the &#x201c;learn&#x201d; button <b>405</b> in the window to retrain the NN with the inputted information.</p><p id="p-0057" num="0056"><figref idref="DRAWINGS">FIG. <b>5</b></figref> illustrates an example data flow for extracting sample composition from spectral data with a trained NN. The acquired spectra <b>501</b> are processed by trained NN <b>502</b>. The trained NN generates a list of chemical elements <b>504</b> and the probability <b>505</b> for each chemical element for each processed spectrum. An example list of chemical elements and probabilities are shown in <b>503</b>. The list may contain all chemical elements in the periodic table. The value of probabilities ranges from 0 to 1. The chemical elements <b>506</b> in sample contain all chemical elements that identified from the spectra <b>501</b>. For example, chemical elements <b>506</b> includes chemical elements <b>504</b> that have a probability greater than a threshold probability. Each spectrum of spectra <b>501</b> may then be decomposed at <b>508</b> into spectral components and/or abundances based on the identified chemical elements <b>506</b>. An example of components and abundances at one sample location is shown in <b>511</b>. In this example, there are two components at the sample location. Each component is a combination of individual chemical elements. The first component contains Fe at concentration 0.4 and oxygen at concentration 0.6 and the second component contains Si at 0.33 and oxygen O at 0.66. Each component with an abundance 0.5. That is, the composition at the sample location is half first component and half second component. Elemental map <b>511</b> can be generated based on the identified chemical elements <b>506</b> at each sample location. Compositional image <b>510</b> can be generated based on the spectral components and/or abundances of scanned sample locations.</p><p id="p-0058" num="0057"><figref idref="DRAWINGS">FIG. <b>6</b></figref> shows method <b>600</b> for generating a trained NN off-line. The trained NN may then be retrained on-line as shown in method <b>200</b> of <figref idref="DRAWINGS">FIG. <b>2</b></figref>.</p><p id="p-0059" num="0058">At <b>602</b>, various operating conditions are defined. The operating conditions may include one or more of accelerating voltage, beam current, working distance and detector setting. A trained NN may be generated for each operating condition.</p><p id="p-0060" num="0059">At <b>604</b>, the training dataset are determined based on the operating conditions. The training dataset includes training spectra and corresponding elemental composition. The training spectra may include simulated data <b>606</b> and/or experimental data <b>608</b> acquired from one or more microscopes. The training spectra may include characteristic spectrum of a single chemical element and/or spectrum of combined chemical elements.</p><p id="p-0061" num="0060">At <b>610</b>, the training data are augmented by introducing noise, nonlinearities, and adjusted gains. In one example, the noise may be introduced to the training data by shifting one or more peaks within a specific energy range of the peak location. The energy range may be less than 100 eV. In one example, the energy range is less than 50 eV. In another example, noises may be added to the amplitude of the training spectra.</p><p id="p-0062" num="0061">At <b>612</b>, a na&#xef;ve NN is trained with the training dataset to generate the trained NN. In some examples, a trained NN is generated for each operating condition defined at <b>602</b>.</p><p id="p-0063" num="0062">At <b>614</b>, validation data include validation spectra and corresponding elemental composition are generated, and the trained NN is validated with the validation data. The validation spectra are different from the training spectra. For example, the validation spectra may include experimental spectra acquired from a different microscope. Elemental analysis is performed on the validation spectra with the trained NN. Performance of the trained NN is determined by comparing the elemental composition in the validation data and the identified chemical elements via trained NN.</p><p id="p-0064" num="0063">At <b>616</b>, if the performance of trained NN is acceptable, the trained NN is saved at <b>620</b>. Otherwise, additional training dataset is generated at <b>618</b> for continuing training the NN.</p><p id="p-0065" num="0064">The technical effect of using a NN for elemental analysis is that the NN can perform elemental analysis on spectral data, especially sparse spectral data, with high speed and accuracy. The technical effect of retraining the trained NN by measuring a reference sample is that the off-line trained NN can adapt to specific use case, system, and material. The technical effect of selecting a region of the reference sample for retraining is that sample regions reflecting the known elemental composition can be selected. The technical effect of performing elemental analysis before decomposing the spectra data is that sample components can be quickly and accurately identified.</p><p id="p-0066" num="0065">In a representation, a non-transitory computer readable media comprises instructions that, when executed by a processor of the controller, causes the controller to: irradiate one or more locations of a first sample with the charged particle beam; acquire one or more first spectra by detecting the first emission from the first sample responsive to the irradiation to the first sample; determine one or more first chemical elements within the first sample by processing the first spectra with a trained neural network stored in the computer readable media; display the one or more first chemical elements; receive a known chemical elemental composition of the first sample, retrain the trained neural network with one or more of the first spectra and the known elemental composition of the first sample; irradiate one or more locations of a second sample with the charged particle beam; acquire one or more second spectra by detecting the first emission from the second sample responsive to the irradiation to the second sample; determine one or more second chemical elements within the second sample by processing the second spectra with the retrained neural network; and generate a compositional map of the second sample based on the second chemical elements.</p><?detailed-description description="Detailed Description" end="tail"?></description><us-claim-statement>What is claimed is:</us-claim-statement><claims id="claims"><claim id="CLM-00001" num="00001"><claim-text><b>1</b>. A method, comprising:<claim-text>irradiating a first sample with a charged particle beam;</claim-text><claim-text>detecting a first type emission from the first sample and forming one or more first spectra from the detected first type emission;</claim-text><claim-text>identifying one or more first chemical elements within the first sample by processing the first spectra with a trained neural network;</claim-text><claim-text>detecting a second type emission from the first sample and displaying a sample image generated based on the detected second type emission;</claim-text><claim-text>selecting one or more pixels in the sample image;</claim-text><claim-text>displaying one or more chemical elements corresponding to the selected pixels;</claim-text><claim-text>responsive to the displayed chemical elements different from a known elemental composition, retraining the trained neural network with spectra corresponding to the selected pixels and the known elemental composition;</claim-text><claim-text>irradiating one or more locations of a second sample with the charged particle beam;</claim-text><claim-text>acquiring one or more second spectra by detecting the first type emission from the second sample; and</claim-text><claim-text>identifying one or more second chemical elements within the second sample by processing the second spectra with the retrained neural network.</claim-text></claim-text></claim><claim id="CLM-00002" num="00002"><claim-text><b>2</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein identifying one or more first chemical elements within the first sample by processing the first spectra with a trained neural network comprises:<claim-text>inputting one or more of the first spectra into the trained neural network;</claim-text><claim-text>outputting one or more chemical elements and probabilities from the trained neural network, wherein each chemical element corresponds to one probability; and</claim-text><claim-text>selecting the chemical elements with probability greater than a threshold probability as the first chemical elements.</claim-text></claim-text></claim><claim id="CLM-00003" num="00003"><claim-text><b>3</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising generating an elemental map showing a spatial distribution of the second chemical elements in the second sample.</claim-text></claim><claim id="CLM-00004" num="00004"><claim-text><b>4</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising decomposing each of the second spectra into one or more spectral components and abundances based on the second chemical elements, wherein each component corresponds to one abundance.</claim-text></claim><claim id="CLM-00005" num="00005"><claim-text><b>5</b>. The method of <claim-ref idref="CLM-00004">claim 4</claim-ref>, further comprising generating a compositional map of the second sample based on the spectral components and/or the abundances.</claim-text></claim><claim id="CLM-00006" num="00006"><claim-text><b>6</b>. The method of <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein each spectral component is a spectrum of a component including one or more of the second chemical elements.</claim-text></claim><claim id="CLM-00007" num="00007"><claim-text><b>7</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the sample image is displayed based further on the first chemical elements, and wherein the sample image shows a spatial distribution of the first chemical elements.</claim-text></claim><claim id="CLM-00008" num="00008"><claim-text><b>8</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising generating the trained neural network by training a neural network with training spectra of multiple chemical elements.</claim-text></claim><claim id="CLM-00009" num="00009"><claim-text><b>9</b>. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the training spectra include simulated spectra and/or experimental spectra.</claim-text></claim><claim id="CLM-00010" num="00010"><claim-text><b>10</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising receiving the known elemental composition of the first sample via user input.</claim-text></claim><claim id="CLM-00011" num="00011"><claim-text><b>11</b>. The method of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein retraining the trained neural network with spectra corresponding to the selected pixels and the known elemental composition includes: generating an integrated spectrum from the spectra corresponding to the selected pixels, and retraining the trained neural network with the integrated spectrum and the known elemental composition.</claim-text></claim><claim id="CLM-00012" num="00012"><claim-text><b>12</b>. The method of <claim-ref idref="CLM-00011">claim 11</claim-ref>, further comprising displaying the integrated spectrum simultaneously with the one or more chemical elements from the first chemical elements corresponding to the selected pixels.</claim-text></claim><claim id="CLM-00013" num="00013"><claim-text><b>13</b>. The method of <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein displaying the first chemical elements on a display includes displaying the first chemical elements in a periodic table, and wherein the user input includes selecting or deselecting the first chemical elements displayed in the periodic table.</claim-text></claim><claim id="CLM-00014" num="00014"><claim-text><b>14</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:<claim-text>after selecting one or more pixels in the sample image, directing the charged particle beam to one or more sample regions corresponding to the selected pixels and obtaining one or more spectra of the sample regions; and</claim-text><claim-text>identifying the one or more chemical elements corresponding to the selected pixels by processing the obtained spectra with the trained neural network.</claim-text></claim-text></claim><claim id="CLM-00015" num="00015"><claim-text><b>15</b>. A charged particle microscopy system, comprising:<claim-text>a sample holder for positioning a sample;</claim-text><claim-text>a charged particle source for irradiating a charged particle beam towards the sample;</claim-text><claim-text>a first detector for detecting a first type emission from the sample responsive to the charged particle beam irradiation;</claim-text><claim-text>a second detector for detecting a second type emission from the sample responsive to the charged particle beam irradiation; and</claim-text><claim-text>a controller includes a non-transitory computer readable media storing instructions that, when executed by a processor of the controller, causes the controller to:</claim-text><claim-text>irradiate a first sample with the charged particle beam;</claim-text><claim-text>detect the first type emission from the first sample and form one or more first spectra from the detected first type emission;</claim-text><claim-text>detect the second type emission from the first sample and displaying a sample image generated based on the detected second type emission;</claim-text><claim-text>receive selection of one or more pixels in the sample image;</claim-text><claim-text>obtain one or more spectra corresponding to the selected pixels;</claim-text><claim-text>identify one or more first chemical elements within the first sample by processing the obtained spectra with a trained neural network;</claim-text><claim-text>responsive to the first chemical elements different from a known elemental composition, retraining the trained neural network with the selected spectra and the known elemental composition; and</claim-text><claim-text>save the retrained neural network in the non-transitory computer readable media.</claim-text></claim-text></claim><claim id="CLM-00016" num="00016"><claim-text><b>16</b>. The charged particle microscopy system of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the non-transitory computer readable media includes further instructions that, when executed by the processor of the controller, causes the controller to:<claim-text>irradiate one or more locations of a second sample with the charged particle beam;</claim-text><claim-text>acquire one or more second spectra by detecting the first type emission from the second sample; and</claim-text><claim-text>identify one or more second chemical elements within the second sample by processing the second spectra with the retrained neural network.</claim-text></claim-text></claim><claim id="CLM-00017" num="00017"><claim-text><b>17</b>. The charged particle microscopy system of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the non-transitory computer readable media includes further instructions that, when executed by the processor of the controller, causes the controller to: detect the second type emission from the second sample; and generate a compositional map showing a distribution of the second chemical elements in the second sample based on the detected second type emission.</claim-text></claim><claim id="CLM-00018" num="00018"><claim-text><b>18</b>. The charged particle microscopy system of <claim-ref idref="CLM-00017">claim 17</claim-ref>, wherein generate a compositional map of the second sample based on the second chemical elements includes: decompose the second spectra into one or more multiple spectral components and an abundance of each spectral component based on the second chemical elements; and generate the compositional map of the second sample based on the spectral components and/or the abundances.</claim-text></claim><claim id="CLM-00019" num="00019"><claim-text><b>19</b>. The charged particle microscopy system of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the charged particle beam is an electron beam, the first type emission is an X-ray, and the second type emission is a scattered electron.</claim-text></claim><claim id="CLM-00020" num="00020"><claim-text><b>20</b>. The charged particle microscopy system of <claim-ref idref="CLM-00014">claim 14</claim-ref>, wherein the trained neural network receives a spectrum and outputs one or more chemical elements and a probability for each chemical element.</claim-text></claim><claim id="CLM-00021" num="00021"><claim-text><b>21</b>. The charged particle microscopy system of <claim-ref idref="CLM-00020">claim 20</claim-ref>, wherein determine one or more first chemical elements within the first sample by processing the first spectra with a trained neural network includes selecting the chemical elements output from the trained neural network with a probability higher than a threshold probability as the first chemical elements.</claim-text></claim><claim id="CLM-00022" num="00022"><claim-text><b>22</b>. The charged particle microscopy system of <claim-ref idref="CLM-00014">claim 14</claim-ref>, wherein obtaining one or more spectra corresponding to the selected pixels includes selecting the one or more spectra corresponding to the selected pixels in the first spectra.</claim-text></claim><claim id="CLM-00023" num="00023"><claim-text><b>23</b>. The charged particle microscopy system of <claim-ref idref="CLM-00014">claim 14</claim-ref>, wherein obtaining one or more spectra corresponding to the selected pixels includes: directing the charged particle beam to sample regions corresponding to the selected pixels; and acquiring the one or more spectra by detecting the first type emission from the sample regions.</claim-text></claim><claim id="CLM-00024" num="00024"><claim-text><b>24</b>. A non-transitory computer readable media, comprising instructions that, when executed by a processor, causes a computing device to:<claim-text>access first detector data that correspond to a first type emission from a sample, wherein the first detector data is obtained responsive to irradiation of the sample with a charged particle beam;</claim-text><claim-text>cause a display of a sample image generated based on the first detector data;</claim-text><claim-text>receive selection of one or more pixels in the sample image;</claim-text><claim-text>access second detector data that correspond to a second type emission from one or more sample regions corresponding to the selected pixels, wherein the second detector data is obtained responsive to irradiation of the sample regions with the charged particle beam;</claim-text><claim-text>identify one or more chemical elements within the sample by processing the second detector data with a trained neural network;</claim-text><claim-text>cause a display of the identified chemical elements;</claim-text><claim-text>responsive to the displayed chemical elements different from a known elemental composition, retrain the trained neural network with the second detector data and the known elemental composition; and</claim-text><claim-text>store the retrained network in the non-transitory computer readable media.</claim-text></claim-text></claim></claims></us-patent-application>