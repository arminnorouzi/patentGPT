<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230007054A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230007054</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17756590</doc-number><date>20201113</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><priority-claims><priority-claim sequence="01" kind="national"><country>CN</country><doc-number>201911190054.8</doc-number><date>20191128</date></priority-claim></priority-claims><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>L</subclass><main-group>65</main-group><subgroup>1016</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>L</subclass><main-group>65</main-group><subgroup>1073</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>W</subclass><main-group>60</main-group><subgroup>00</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>L</subclass><main-group>65</main-group><subgroup>1016</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc><further-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>L</subclass><main-group>65</main-group><subgroup>1073</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>W</subclass><main-group>60</main-group><subgroup>00</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>W</subclass><main-group>80</main-group><subgroup>08</subgroup><symbol-position>L</symbol-position><classification-value>A</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></further-cpc></classifications-cpc><invention-title id="d2e61">IMS REGISTRATION DURATION MANAGEMENT SYSTEM, TERMINAL DEVICE, AND CHIP</invention-title><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>Huawei Technologies Co., Ltd.</orgname><address><city>Shenzhen, Guangdong</city><country>CN</country></address></addressbook><residence><country>CN</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>HUANG</last-name><first-name>Wei</first-name><address><city>Shenzhen, Guangdong</city><country>CN</country></address></addressbook></inventor><inventor sequence="01" designation="us-only"><addressbook><last-name>QIU</last-name><first-name>Fengguang</first-name><address><city>Shenzhen, Guangdong</city><country>CN</country></address></addressbook></inventor></inventors></us-parties><pct-or-regional-filing-data><document-id><country>WO</country><doc-number>PCT/CN2020/128831</doc-number><date>20201113</date></document-id><us-371c12-date><date>20220527</date></us-371c12-date></pct-or-regional-filing-data></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">A terminal device comprising a transceiver, a memory, and a processor is provided. The terminal device may send in a network, an IMS registration request to a network device in the network, and may start an IMS timer corresponding to the network. If the terminal device does not receive a registration accept message from the network device when the IMS timer expires, the terminal device deactivates the network. The network may be one of a first network and a second network, the network device may be one of a first network device and a second network device, and each of the first network and the second network corresponds to an IMS timer with a different duration. In this way, different waiting durations may be provided for IMS registration processes in different networks, to improve user communication experience.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="187.20mm" wi="156.38mm" file="US20230007054A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="96.27mm" wi="105.49mm" file="US20230007054A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="191.26mm" wi="115.49mm" file="US20230007054A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="198.88mm" wi="158.41mm" file="US20230007054A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="212.34mm" wi="153.92mm" file="US20230007054A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00005" num="00005"><img id="EMI-D00005" he="116.42mm" wi="155.96mm" file="US20230007054A1-20230105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00006" num="00006"><img id="EMI-D00006" he="130.73mm" wi="151.72mm" file="US20230007054A1-20230105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00007" num="00007"><img id="EMI-D00007" he="119.21mm" wi="130.47mm" file="US20230007054A1-20230105-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00008" num="00008"><img id="EMI-D00008" he="120.48mm" wi="140.04mm" file="US20230007054A1-20230105-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00009" num="00009"><img id="EMI-D00009" he="212.26mm" wi="131.91mm" file="US20230007054A1-20230105-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00010" num="00010"><img id="EMI-D00010" he="179.66mm" wi="116.76mm" file="US20230007054A1-20230105-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00011" num="00011"><img id="EMI-D00011" he="199.05mm" wi="110.07mm" file="US20230007054A1-20230105-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00012" num="00012"><img id="EMI-D00012" he="199.14mm" wi="96.35mm" file="US20230007054A1-20230105-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00013" num="00013"><img id="EMI-D00013" he="219.20mm" wi="134.20mm" file="US20230007054A1-20230105-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00014" num="00014"><img id="EMI-D00014" he="186.27mm" wi="122.09mm" file="US20230007054A1-20230105-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00015" num="00015"><img id="EMI-D00015" he="204.30mm" wi="115.99mm" file="US20230007054A1-20230105-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00016" num="00016"><img id="EMI-D00016" he="207.26mm" wi="99.99mm" file="US20230007054A1-20230105-D00016.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00017" num="00017"><img id="EMI-D00017" he="109.05mm" wi="136.40mm" file="US20230007054A1-20230105-D00017.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00018" num="00018"><img id="EMI-D00018" he="220.22mm" wi="147.49mm" orientation="landscape" file="US20230007054A1-20230105-D00018.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="lead"?><heading id="h-0001" level="1">CROSS-REFERENCE OF RELATED APPLICATIONS</heading><p id="p-0002" num="0001">This application is a national stage of International Application No. PCT/CN2020/128831, filed on Nov. 13, 2020, which claims priority to Chinese Patent Application No. 201911190054.8, filed on Nov. 28, 2019. Both of the aforementioned applications are hereby incorporated by reference in their entireties.</p><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="tail"?><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0002" level="1">TECHNICAL FIELD</heading><p id="p-0003" num="0002">This application relates to the field of communication technologies, and in particular, to an IMS registration duration management system, a terminal device, and a chip.</p><heading id="h-0003" level="1">BACKGROUND</heading><p id="p-0004" num="0003">An Internet protocol (IP) multimedia subsystem (IMS) is a network system that is based on an IP network and used to provide a multimedia service, and a voice solution may be provided for 4G and 5G by using the IMS.</p><p id="p-0005" num="0004">After completing a 4G or 5G network attach (attach/registration) process, a terminal device may perform an IMS domain registration process. In the conventional technology, as shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref>, the IMS domain registration process mainly includes the following operations.</p><p id="p-0006" num="0005">Operation <b>101</b>: The terminal device sends an initial registration request to a proxy call session control function (P-CSCF), and starts a protection timer F (which is called Timer F), where timing duration (defined in 3GPP 24.229) that is set for the timer F is 128 seconds. The initial registration request may include user information, capability information of the terminal device, and the like.</p><p id="p-0007" num="0006">Operation <b>102</b>: The P-CSCF sends a 401 message to the terminal device, where the 401 message is used to request the terminal device to perform authentication, and includes authentication information.</p><p id="p-0008" num="0007">Operation <b>103</b>: The terminal device initiates a registration challenge request to the P-CSCF, and starts the protection timer F, where the timing duration (for example, the timing duration defined in 3GPP 24.229) that is set for the timer F is 128 seconds, and the registration challenge request includes the authentication information.</p><p id="p-0009" num="0008">Operation <b>104</b>: After a network side successfully authenticates the terminal device, the P-CSCF sends a 200 OK message to the terminal device, where the 200 OK message indicates that IMS domain registration is successful.</p><p id="p-0010" num="0009">In the foregoing IMS domain registration process, if the terminal device still does not receive the 401 message after 128 seconds since the timer F is started for the first time, the terminal device determines that the IMS domain registration fails. If the 401 message is received within 128 seconds since the timer F is started for the first time, but the terminal device still does not receive the 200 OK message after 128 seconds since the timer F is started for the second time, the terminal device also determines that the IMS domain registration fails. Only when the 401 message is received within 128 seconds since the timer F is started for the first time and the 200 OK message is received within 128 seconds since the timer F is started for the second time, the terminal device determines that the IMS domain registration succeeds. Therefore, maximum time of the IMS registration process that does not include an establishment process of an IMS default bearer may theoretically reach 256 s. This process is long, and affects a call completion rate of a voice call of the terminal device.</p><heading id="h-0004" level="1">SUMMARY</heading><p id="p-0011" num="0010">Embodiments of this application provide an IMS registration duration management system, a terminal device, and a chip, so that different waiting duration may be provided for IMS registration processes in different networks, to improve user communication experience.</p><p id="p-0012" num="0011">According to a first aspect, this application provides an IMS registration duration management system, including a terminal device, a first network device, and a second network device. The terminal device may be configured to send, in a first network to which the terminal device is attached, an Internet protocol multimedia subsystem IMS registration request to a first network device, and start an IMS timer corresponding to the first network. The first network device may be configured to: after receiving the IMS registration request, determine whether to send a registration accept message. The terminal device may be further configured to deactivate the first network if the registration accept message from the first network device is not received when timing duration of the IMS timer corresponding to the first network reaches first specified duration. The terminal device may be further configured to send, in a second network to which the terminal device is attached, an Internet protocol multimedia subsystem IMS registration request to a second network device, and start an IMS timer corresponding to the second network. The second network device may be configured to: after receiving the IMS registration request, determine whether to send a registration accept message. The terminal device may be further configured to deactivate the second network if the registration accept message from the second network device is not received when timing duration of the IMS timer corresponding to the second network reaches second specified duration. The first specified duration is different from the second specified duration.</p><p id="p-0013" num="0012">Based on this solution, when the terminal device is attached to different networks and initiates IMS registration, the terminal device starts the IMS timer corresponding to the first network, and deactivates the first network if the registration accept message from the first network device is not received when the timing duration of the IMS timer corresponding to the first network reaches the first specified duration. When the terminal device is attached to the second network, the terminal device starts the IMS timer corresponding to the second network, and deactivates the second network if the registration accept message from the second network device is not received when the timing duration of the IMS timer corresponding to the second network reaches the second specified duration. The first specified duration is different from the second specified duration. In this way, the specified duration of the IMS timers started when the IMS registration is initiated in different networks is different, and is configured independently based on features of the current network, so that different waiting duration may be provided for IMS registration processes in different networks, to improve user communication experience.</p><p id="p-0014" num="0013">In design embodiment, the first network is a 4G network, and the second network is a 5G network; or the first network is a 5G network, and the second network is a 4G network.</p><p id="p-0015" num="0014">In an embodiment, the IMS timer corresponding to the first network and the IMS timer corresponding to the second network may be a same timer, and different specified duration is set in different networks. Alternatively, the IMS timer corresponding to the first network and the IMS timer corresponding to the second network may be different timers.</p><p id="p-0016" num="0015">In an embodiment, if the first network is a 4G network, and the second network is a 5G network, the first specified duration is greater than the second specified duration. If the first network is a 5G network, and the second network is a 4G network, the first specified duration is less than the second specified duration. In other words, the specified duration of the timer corresponding to the 4G network is greater than the specified duration of the timer corresponding to the 5G network. In this way, the terminal device can improve voice call experience in the 4G network and improve a voice connection rate in the 5G network.</p><p id="p-0017" num="0016">In an embodiment, the first network is a 4G network, and the terminal device is further configured to deactivate the 4G network if the registration accept message from the first network device is not received when the timing duration of the IMS timer corresponding to the 4G network reaches the first specified duration. In this way, when the timing duration of the timer reaches the first specified duration, the 4G network may be deactivated in time, to search for 2G and 3G networks for voice communication.</p><p id="p-0018" num="0017">In an embodiment, the first network is a 4G network, the second network is a 5G network, and the terminal device is further configured to: deactivate the 5G network or perform IMS registration in the 4G network if the registration accept message from the second network device is not received when the timing duration of the IMS timer corresponding to the 5G network reaches the second specified duration. In this way, the voice call completion rate in the 5G network can be improved.</p><p id="p-0019" num="0018">In an embodiment, the first network is a 4G network, the second network is a 5G network, and the terminal device is further configured to: when the first network supports circuit switched fallback and a voice service, search for and fall back to the 2G or 3G network if the registration accept message from the first network device is not received when the timing duration of the IMS timer corresponding to the first network reaches the first specified duration, to access a voice service.</p><p id="p-0020" num="0019">In an embodiment, the terminal device further includes a display; the first network is a 5G network, and the terminal device is further configured to: when the terminal device is attached to the 5G network, display an identifier of the 5G network on the display; and when it is determined that the registration accept message from the second network device is not received when the timing duration of the IMS timer corresponding to the 5G network reaches the second specified duration, control the display to display information indicating that the 5G network is unavailable, or control the display to display an identifier of a 4G network when the 4G network is found. According to this design, a user can view an IMS registration result in the 5G network on the display.</p><p id="p-0021" num="0020">In an embodiment, the terminal device further includes a display, the first network is a 4G network, and the terminal device is further configured to: when the terminal device is attached to the 4G network, display an identifier of the 4G network on the display; and when it is determined that the registration accept message from the first network device is not received when the timing duration of the IMS timer corresponding to the 4G network reaches the first specified duration, control the display to display information indicating that the 4G network is unavailable, or control the display to display an identifier of the 2G or 3G network when the 2G or 3G network is found. According to this design, a user can view an IMS registration result in the 4G network on the display.</p><p id="p-0022" num="0021">In an embodiment, the network device is further configured to send a registration accept message to the terminal device. The terminal device is further configured to: if the registration accept message is received before the timing duration of the IMS timer corresponding to the first network reaches the first specified duration, determine that the IMS registration succeeds.</p><p id="p-0023" num="0022">In an embodiment, the first specified duration is less than 128 seconds, and the second specified duration is less than 128 seconds. Compared with a timer that is set to 128 seconds in the conventional technology, the timer in this design can reduce waiting duration of the IMS registration and improve user experience.</p><p id="p-0024" num="0023">According to a second aspect, this application provides a terminal device, including a transceiver, a memory, and a processor. The memory is configured to store instructions, and the transceiver is configured to send, in a first network to which the terminal device is attached, an Internet protocol multimedia subsystem IMS registration request to a first network device, or send, in a second network to which the terminal device is attached, an IMS registration request to a second network device. The processor is configured to execute the instructions stored in the memory, and when the processor executes the instructions stored in the memory, the terminal device is enabled to: when the Internet protocol multimedia subsystem IMS registration request is sent to the first network device in the first network to which the terminal device is attached, start an IMS timer corresponding to the first network, and deactivate the first network if a registration accept message from the first network device is not received when timing duration of the IMS timer corresponding to the first network reaches first specified duration; and when the Internet protocol multimedia subsystem IMS registration request is sent to the second network device in the second network to which the terminal device is attached, start an IMS timer corresponding to the second network, and deactivate the second network if a registration accept message from the second network device is not received when timing duration of the IMS timer corresponding to the second network reaches second specified duration. The first specified duration is different from the second specified duration.</p><p id="p-0025" num="0024">Based on this solution, when the terminal device is attached to different networks and initiates IMS registration, the terminal device starts the IMS timer corresponding to the first network, and deactivates the first network if the registration accept message from the first network device is not received when the timing duration of the IMS timer corresponding to the first network reaches the first specified duration. When the terminal device is attached to the second network, the terminal device starts the IMS timer corresponding to the second network, and deactivates the second network if the registration accept message from the second network device is not received when the timing duration of the IMS timer corresponding to the second network reaches the second specified duration. The first specified duration is different from the second specified duration. In this way, the specified duration of the IMS timers started when the IMS registration is initiated in different networks is different, and the timing duration of the IMS timer corresponding to different networks is configured independently based on features of the current network, so that different waiting duration may be provided for IMS registration processes in different networks, to improve user communication experience.</p><p id="p-0026" num="0025">In an embodiment, the first network is a 4G network, and the second network is a 5G network; or the first network is a 5G network, and the second network is a 4G network.</p><p id="p-0027" num="0026">In an embodiment, the IMS timer corresponding to the first network and the IMS timer corresponding to the second network may be a same timer, and different specified duration is set in different networks. Alternatively, the IMS timer corresponding to the first network and the IMS timer corresponding to the second network may be different timers.</p><p id="p-0028" num="0027">In an embodiment, when the first network is a 4G network, and the second network is a 5G network, the first specified duration is greater than the second specified duration. In other words, the specified duration of the timer corresponding to the 4G network is greater than the specified duration of the timer corresponding to the 5G network. In this way, the terminal device can improve voice call experience in the 4G network and improve a voice connection rate in the 5G network.</p><p id="p-0029" num="0028">In an embodiment, the first network is a 4G network, and the terminal device is further configured to deactivate the 4G network if the registration accept message from the first network device is not received when the timing duration of the IMS timer corresponding to the 4G network reaches the first specified duration. In this way, when the timing duration of the timer reaches the first specified duration, the 4G network may be deactivated in time, to search for 2G and 3G networks for voice communication.</p><p id="p-0030" num="0029">In an embodiment, the first network is a 4G network, the second network is a 5G network, and the terminal device is further configured to: deactivate the 5G network or perform IMS registration in the 4G network if the registration accept message from the second network device is not received when the timing duration of the IMS timer corresponding to the 5G network reaches the first specified duration. In this way, the voice call completion rate in the 5G network can be improved.</p><p id="p-0031" num="0030">In an embodiment, the first network is a 4G network, the second network is a 5G network, and the terminal device is further configured to: when the first network supports circuit switched fallback and a voice service, search for and fall back to the 2G or 3G network if the registration accept message from the first network device is not received when the timing duration of the IMS timer corresponding to the first network reaches the first specified duration, to access a voice service.</p><p id="p-0032" num="0031">In an embodiment, the terminal device further includes a display, the second network is a 5G network, and the terminal device is further configured to: when the terminal device is attached to the 5G network, display an identifier of the 5G network on the display; and when it is determined that the IMS registration in the 5G network fails, control the display to display information indicating that the 5G network is unavailable, or control the display to display an identifier of a 4G network when the 4G network is found. According to this design, a user can view an IMS registration result in the 5G network on the display.</p><p id="p-0033" num="0032">In an embodiment, the terminal device further includes a display, the first network is a 4G network, and the terminal device is further configured to: when the terminal device is attached to the 4G network, display an identifier of the 4G network on the display; and</p><p id="p-0034" num="0033">when it is determined that the IMS registration in the 4G network fails, control the display to display information indicating that the 4G network is unavailable, or control the display to display an identifier of a 2G or 3G network when the 2G or 3G network is found. According to this design, a user can view an IMS registration result in the 4G network on the display.</p><p id="p-0035" num="0034">In an embodiment, the terminal device is further configured to: if the registration accept message is received before the timing duration of the IMS timer corresponding to the first network reaches the first specified duration, determine that the IMS registration succeeds.</p><p id="p-0036" num="0035">In an embodiment, the terminal device is further configured to: if the registration accept message is received before the timing duration of the IMS timer corresponding to the second network reaches the second specified duration, determine that the IMS registration succeeds.</p><p id="p-0037" num="0036">In an embodiment, the first specified duration is less than 128 seconds, and the second specified duration is less than 128 seconds. Compared with a timer that is set to 128 seconds in the conventional technology, the timer in this design can reduce waiting duration of the IMS registration and improve user experience.</p><p id="p-0038" num="0037">According to a third aspect, this application provides an IMS registration duration management method, where the method includes: The terminal device sends, in a first network to which the terminal device is attached, an Internet protocol multimedia subsystem IMS registration request to a first network device, start an IMS timer corresponding to the first network, and determine, if a registration accept message from the first network device is not received when timing duration of the IMS timer corresponding to the first network reaches first specified duration, that IMS registration in the first network fails; or the terminal device sends, in a second network to which the terminal device is attached, an Internet protocol multimedia subsystem IMS registration request to a second network device, start an IMS timer corresponding to the second network, and determine, if a registration accept message from the second network device is not received when timing duration of the IMS timer corresponding to the second network reaches second specified duration, that IMS registration in the second network fails.</p><p id="p-0039" num="0038">In an embodiment, the first network is a 4G network, and the second network is a 5G network; or the first network is a 5G network, and the second network is a 4G network.</p><p id="p-0040" num="0039">In an embodiment, the IMS timer corresponding to the first network is different from the IMS timer corresponding to the second network.</p><p id="p-0041" num="0040">In an embodiment, if the first network is a 4G network, and the second network is a 5G network, the first specified duration is greater than second specified duration.</p><p id="p-0042" num="0041">In an embodiment, the first network is a 4G network, and the terminal device deactivates the 4G network when determining that the IMS registration fails.</p><p id="p-0043" num="0042">In an embodiment, the first network is a 5G network, and when determining that IMS registration in the 5G network fails, the terminal device deactivates the 5G network or performs IMS registration in the 4G network.</p><p id="p-0044" num="0043">In an embodiment, the terminal device further includes a display, and the second network is a 5G network. When the terminal device is attached to the 5G network, the terminal device displays an identifier of the 5G network on the display. When determining that the IMS registration in the 5G network fails, the terminal device controls the display to display information indicating that the 5G network is unavailable, or controls the display to display an identifier of a 4G network when the 4G network is found.</p><p id="p-0045" num="0044">In an embodiment, the terminal device further includes a display, and the second network is a 4G network. When the terminal device is attached to the 4G network, the terminal device displays an identifier of the 4G network on the display. When determining that the IMS registration in the 4G network fails, the terminal device controls the display to display information indicating that the 4G network is unavailable, or controls the display to display an identifier of the 2G or 3G network when the 2G or 3G network is found.</p><p id="p-0046" num="0045">In an embodiment, if the registration accept message is received before the timing duration of the IMS timer corresponding to the second network reaches the second specified duration, the terminal device determines that the IMS registration succeeds.</p><p id="p-0047" num="0046">In an embodiment, the first specified duration is less than 128 seconds, and the second specified duration is less than 128 seconds.</p><p id="p-0048" num="0047">For beneficial effects of the method in any one of the third aspect or the embodiments of the third aspect, refer to beneficial effects of the terminal device in any one of the second aspect or the embodiments of the second aspect. Details are not described herein again.</p><p id="p-0049" num="0048">According to a fourth aspect, this application provides an IMS registration duration management method, where the method includes: A network device receives an Internet protocol multimedia subsystem IMS registration request sent by a terminal device, and sends a registration accept message to the terminal device after successfully authenticating the terminal device.</p><p id="p-0050" num="0049">According to a fifth aspect, this application provides an IMS registration duration management apparatus. The apparatus may be an apparatus used in a communications system, or may be a chip or a chip group in the apparatus that is used in the communications system. The apparatus used in the communications system may be an access network device or a terminal device. The apparatus may include a processing unit and a transceiver unit. When the apparatus is an apparatus used in the communications system, the processing unit may be a processor, and the transceiver unit may be a transceiver. The apparatus may further include a storage unit, and the storage unit may be a memory. The storage unit is configured to store instructions, and the processing unit executes the instructions stored in the storage unit, so that the network device is enabled to perform a corresponding function in the third aspect, or the terminal device is enabled to perform a corresponding function in the fourth aspect. When the apparatus is a chip or a chip group in the network device, the processing unit may be a processor, and the transceiver unit may be an input/output interface, a pin, a circuit, or the like. The processing unit executes instructions stored in the storage unit, so that the network device is enabled to perform a corresponding function in the third aspect, or the terminal device is enabled to perform a corresponding function in the fourth aspect. The storage unit may be a storage unit (for example, a register or a cache) in the chip or the chip group, or may be a storage unit (for example, a read-only memory or a random access memory) that is in the apparatus used in the communications system and that is outside the chip or the chip group.</p><p id="p-0051" num="0050">According to a sixth aspect, this application further provides a computer-readable storage medium, where the computer-readable storage medium stores instructions, and when the instructions are run, the methods in the foregoing aspects are performed.</p><p id="p-0052" num="0051">According to a sixth aspect, this application further provides a computer program product including instructions. When the computer program product runs on a computer, the methods described in the foregoing aspects are performed.</p><p id="p-0053" num="0052">According to a seventh aspect, this application provides a chip. The chip includes a processor and a communications interface, and the communications interface is configured to receive code instructions, and transmit the code instructions to the processor. The processor is configured to invoke the code instructions transmitted by the communications interface, to perform the methods described in the foregoing aspects.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0005" level="1">BRIEF DESCRIPTION OF DRAWINGS</heading><p id="p-0054" num="0053"><figref idref="DRAWINGS">FIG. <b>1</b></figref> is a schematic diagram of a registration process in an IMS domain in the conventional technology;</p><p id="p-0055" num="0054"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a schematic diagram of a network architecture that is applied to an embodiment of this application;</p><p id="p-0056" num="0055"><figref idref="DRAWINGS">FIG. <b>3</b></figref> is a schematic diagram of an IMS registration process in a 4G network according to an embodiment of this application;</p><p id="p-0057" num="0056"><figref idref="DRAWINGS">FIG. <b>4</b></figref> is a schematic diagram of an IMS registration process in a 5G network according to an embodiment of this application;</p><p id="p-0058" num="0057"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is a schematic diagram of an IMS registration process in a call scenario in a 4G network according to an embodiment of this application;</p><p id="p-0059" num="0058"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is a schematic diagram of an IMS registration process in a call scenario in a 5G network according to an embodiment of this application;</p><p id="p-0060" num="0059"><figref idref="DRAWINGS">FIG. <b>7</b></figref> is a schematic diagram of a communications method according to an embodiment of this application;</p><p id="p-0061" num="0060"><figref idref="DRAWINGS">FIG. <b>8</b></figref> is a schematic diagram of a communications method according to an embodiment of this application;</p><p id="p-0062" num="0061"><figref idref="DRAWINGS">FIG. <b>9</b>(<i>a</i>)</figref> to <figref idref="DRAWINGS">FIG. <b>9</b>(<i>d</i>)</figref> are a schematic diagram of a group of interfaces according to an embodiment of this application;</p><p id="p-0063" num="0062"><figref idref="DRAWINGS">FIG. <b>10</b>(<i>a</i>)</figref> to <figref idref="DRAWINGS">FIG. <b>10</b>(<i>d</i>)</figref> are a schematic diagram of another group of interfaces according to an embodiment of this application;</p><p id="p-0064" num="0063"><figref idref="DRAWINGS">FIG. <b>11</b></figref> is a schematic diagram of a structure of a terminal device according to an embodiment of this application; and</p><p id="p-0065" num="0064"><figref idref="DRAWINGS">FIG. <b>12</b></figref> is a schematic diagram of an architecture of a baseband chip according to an embodiment of this application.</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><heading id="h-0006" level="1">DESCRIPTION OF EMBODIMENTS</heading><p id="p-0066" num="0065">To make objectives, technical solutions, and advantages of this application clearer, the following further describes this application in detail with reference to accompanying drawings.</p><p id="p-0067" num="0066">A communications method provided in this application may be applied to various communications systems, for example, a long term evolution (LTE) communications system, a 5th generation (5G) communications system, an LTE-5G hybrid architecture, a 5G new radio (NR) system, a new communications system emerging in future communications development, and the like. The communications method provided in embodiments of this application may be used provided that an IMS is used as a voice solution in a communications system.</p><p id="p-0068" num="0067"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a schematic diagram of a network architecture that is applied to this application. The network architecture includes one or more terminal devices, one or more access network devices, a core network device, and an IMS system.</p><p id="p-0069" num="0068">As shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, the network architecture includes a terminal device <b>201</b>, an access network device <b>202</b> that provides a 2 or 3G network for the terminal device, an access network device <b>203</b> that provides an LTE network for the terminal device, an access network device <b>204</b> that provides an NR network for the terminal device, a core network device <b>205</b>, and an IP multimedia subsystem (IMS) <b>206</b>.</p><p id="p-0070" num="0069">The terminal device <b>201</b> is configured to generate a registration request, send the generated registration request to a P-CSCF entity in the IMS <b>206</b> through the access network and the core network, and receive a registration accept message returned from the IMS <b>206</b> through the core network and the access network. For example, the registration request is an initial registration request, and the registration accept message is a 401 message. For another example, the registration request is a challenge registration request, and the registration accept message is a 200 OK message.</p><p id="p-0071" num="0070">The IP multimedia subsystem (IMS) <b>206</b> may include a proxy call session control function P-CSCF entity, an interrogating-call session control function (I-CSCF), a service call session control function (S-CSCF) entity, and a home subscriber server (HSS).</p><p id="p-0072" num="0071">The P-CSCF entity is a first connection point from the access network to the IMS, and all session messages initiated from a terminal device that supports the IMS and terminated at a terminal device that supports the IMS need to be forwarded by the P-CSCF entity. The P-CSCF entity may be configured to forward the registration request from the terminal device to the S-CSCF entity, and forward the registration accept message to the terminal device.</p><p id="p-0073" num="0072">The I-CSCF entity may be connected to the S-CSCF entity and the P-CSCF entity, and is configured to provide an entrance to a home network for the terminal device. In an IMS registration process, the P-CSCF entity may forward the registration request from the terminal device to the I-CSCF entity, and the I-CSCF entity may query the HSS in the IMS to select an S-CSCF entity for the terminal device. In a call process, a call message destined for an IMS network is first routed to the I-CSCF. The I-CSCF entity may query, for the terminal device through the HSS in the IMS, address information of the S-CSCF entity with which a user is registered, and then route the message to the S-CSCF.</p><p id="p-0074" num="0073">The S-CSCF entity is a control core of the IMS, and provides functions such as session control and registration for the terminal device. The S-CSCF entity is configured to receive the registration request of the terminal device forwarded by the P-CSCF entity, cooperate with the HSS to perform authentication on the terminal device, and obtain subscription information of the terminal device from the HSS after determining that the authentication succeeds. The S-CSCF entity is further configured to connect to each application server through an ISC interface. The S-CSCF entity is further configured to trigger the application server to perform an operation and route a request message of the terminal device to a corresponding application server.</p><p id="p-0075" num="0074">The HSS is a primary data memory that is in the IMS and that stores all data related to users and services. The data stored in the HSS includes a user identity, subscription information, access information, and the like.</p><p id="p-0076" num="0075">The terminal device <b>201</b> in this application may also be referred to as user equipment (UE). The terminal device <b>201</b> may be deployed on land, including an indoor device, an outdoor device, a handheld device, or a vehicle-mounted device, may be deployed on a water surface (for example, on a ship), or may be deployed in the air (for example, on an airplane, a balloon, or a satellite). The terminal device may be a mobile phone, a tablet computer (pad), a computer with a wireless receiving/sending function, a virtual reality (VR) device, an augmented reality (AR) device, a wireless device in industrial control, a wireless device in self-driving, a wireless device in remote medical, a wireless device in smart grid, a wireless device in transportation safety, a wireless device in smart city, a wireless device in smart home, and the like.</p><p id="p-0077" num="0076">It should be noted that, the term &#x201c;and/or&#x201d; in this specification describes only an association relationship between associated objects and represents that three relationships may exist. For example, A and/or B may represent the following three cases: Only A exists, both A and B exist, and only B exists. In addition, the character &#x201c;/&#x201d; in this specification generally indicates an &#x201c;or&#x201d; relationship between the associated objects unless specified otherwise. In the descriptions of embodiments of this application, terms such as &#x201c;first&#x201d; and &#x201c;second&#x201d; are only used for distinction and description, but cannot be understood as indication or implication of relative importance, and cannot be understood as an indication or implication of a sequence.</p><p id="p-0078" num="0077">In the conventional technology, default IMS registration time is excessively long. For example, a value of a timer (namely, a timer F) in a protocol is defined in 3GPP 24.229 (Table 7.7.1), and is 128 s by default. Therefore, one IMS registration does not include establishment of an IMS default bearer, and theoretically, a maximum time may reach 256 s. Because the default IMS registration time is excessively long, the user cannot have better communication experience.</p><p id="p-0079" num="0078">To reduce waiting duration of the IMS registration process and improve the user communication experience, a customized (that is, not defined in the 3GPP 24.229 protocol standard) IMS registration protection timer (which may also be referred to as an IMS timer for short) may be set. When the IMS registration fails due to timeout (or fails due to another reason), a voice solution policy of the UE is adjusted to ensure user experience.</p><p id="p-0080" num="0079">In some embodiments, duration of the customized IMS registration protection timer may be less than duration of the default timer (Timer F) specified in the protocol. In this application, an IMS registration protection timer may be set in the terminal device, and timing duration is set to 35 seconds. When the terminal device performs IMS registration in a 4G network or a 5G network, if a 200 OK message is not received when the timing duration of the IMS registration protection timer reaches 35 seconds, the terminal device determines that the IMS registration fails.</p><p id="p-0081" num="0080">The following separately describes IMS registration procedures in the 4G network and 5G network. To improve the user communication experience, the foregoing customized timer is used.</p><p id="p-0082" num="0081"><figref idref="DRAWINGS">FIG. <b>3</b></figref> is a schematic diagram of an IMS registration process in a 4G network according to an embodiment of this application. As shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>, the IMS registration process in the 4G network includes the following operations.</p><p id="p-0083" num="0082">Operation <b>301</b>: A registration control module in a terminal device sends a non-access stratum (NAS) registration request to a 4G non-access stratum module (LNAS) module in the terminal device.</p><p id="p-0084" num="0083">The LNAS module mainly includes a mobility management function and a session management function.</p><p id="p-0085" num="0084">Operation <b>302</b>: The LNAS module initiates a NAS registration process to a mobility management entity (MME).</p><p id="p-0086" num="0085">For example, the NAS registration process may include an authorization process, an authentication process, and the like. Signaling interaction between the LNAS module and the MME in the NAS registration process is shown in the following operations S<b>1</b> to S<b>6</b>.</p><p id="p-0087" num="0086">S<b>1</b>: The LNAS module sends a NAS registration request to the MME, where the NAS registration request is used to request registration with the 4G network.</p><p id="p-0088" num="0087">S<b>2</b>: The MME sends an identification request (identity request) to the LNAS module, where the identity request is used to request to obtain identification information of the terminal device.</p><p id="p-0089" num="0088">S<b>3</b>: The LNAS module sends an identification accept message (identity accept) to the MME, where the identification accept message includes the identification information of the terminal device.</p><p id="p-0090" num="0089">S<b>4</b>: The MME sends an authentication request to the LNAS module, where the authentication request includes authentication information.</p><p id="p-0091" num="0090">S<b>5</b>: The LNAS module sends an authentication accept message to the MME, where the authentication accept message includes an authentication value obtained by the terminal device through calculation based on the authentication information, so that the MME verifies an identity of the terminal device based on the authentication value, and performs operation S<b>6</b> after the verification succeeds.</p><p id="p-0092" num="0091">S<b>6</b>: The MME sends a registration success accept message to the LNAS module.</p><p id="p-0093" num="0092">Operation <b>303</b>: After NAS registration succeeds, the LNAS module sends, to the registration control module, an accept message indicating that the NAS registration succeeds.</p><p id="p-0094" num="0093">Operation <b>304</b>: The registration control module starts an IMS timer. For example, timing duration of the IMS timer is 35 seconds.</p><p id="p-0095" num="0094">Operation <b>305</b>: The registration control module sends an IMS registration request to an IMS module.</p><p id="p-0096" num="0095">For example, operation <b>304</b> and operation <b>305</b> may be performed at the same time. To be specific, the IMS timer is started when the registration control module sends the IMS registration request to the IMS module. In another example, operation <b>305</b> may be performed before operation <b>304</b>.</p><p id="p-0097" num="0096">Operation <b>306</b>: The IMS module in the terminal device sends an IMS packet data network (PDN) connection establishment request to the LNAS module.</p><p id="p-0098" num="0097">Operation <b>307</b>: The LNAS module sends the PDN connection establishment request to the MME.</p><p id="p-0099" num="0098">Operation <b>308</b>: The MME sends an activate default EPS bearer context request to the LNAS module.</p><p id="p-0100" num="0099">Operation <b>309</b>: The LNAS module sends an activate default EPS bearer context accept (act default eps bearer context accept) message to the MME module.</p><p id="p-0101" num="0100">Operation <b>310</b>: The LNAS module sends an IMS PDN connection establishment accept message to the IMS module.</p><p id="p-0102" num="0101">Operation <b>311</b>: The IMS module sends an IMS registration request to a P-CSCF.</p><p id="p-0103" num="0102">Operation <b>312</b>: When the timing duration of the IMS Timer reaches 35 seconds, the IMS timer sends an IMS timer timeout message to the registration control module. Then, the registration control module may perform operation <b>313</b> or operation <b>314</b>, or does not perform operation <b>313</b> and operation <b>314</b>.</p><p id="p-0104" num="0103">Operation <b>313</b>: The registration control module sends an IMS registration cancellation notification message to the IMS module.</p><p id="p-0105" num="0104">In some embodiments, for a dual standby single pass mobile phone, IMS registration may be canceled to release a radio frequency resource, so as to reduce impact on another card. In an embodiment, the UE may disable an LTE network (for example, when the network does not support CSFB). Then, the UE searches for and switches to a 2G or 3G network to support a voice call. In an embodiment, when the network supports CSFB, the UE may also fall back to the 2G or 3G network to perform a voice call.</p><p id="p-0106" num="0105">Operation <b>314</b>: The registration control module deactivates the 4G network.</p><p id="p-0107" num="0106">In operation <b>314</b>, deactivating the 4G network may also be understood as disabling a 4G capability of the terminal device. For example, the 4G network may be mainly deactivated by using the following operations S<b>7</b> to S<b>9</b>.</p><p id="p-0108" num="0107">S<b>7</b>: The LNAS module sends a PDN disconnect request to the MME.</p><p id="p-0109" num="0108">S<b>8</b>: The MME sends a deactivate default EPS bearer context request to the LNAS module.</p><p id="p-0110" num="0109">S<b>9</b>: The MME sends a deactivate default EPS bearer context accept message to the LNAS module.</p><p id="p-0111" num="0110"><figref idref="DRAWINGS">FIG. <b>4</b></figref> is a schematic diagram of an IMS registration process in a 5G network according to an embodiment of this application. As shown in <figref idref="DRAWINGS">FIG. <b>4</b></figref>, the IMS registration process in the 5G network includes the following operations.</p><p id="p-0112" num="0111">Operation <b>401</b>: A registration control module in a terminal device sends a NAS registration request to a 5G non-access stratum (NRNAS) module in the terminal device.</p><p id="p-0113" num="0112">The NRNAS module mainly includes a mobility management function and a session management function.</p><p id="p-0114" num="0113">Operation <b>402</b>: The NRNAS module sends a NAS registration request to an access and mobility management function (AMF) entity.</p><p id="p-0115" num="0114">Operation <b>403</b>: The AMF entity performs processes such as authentication and authorization with the terminal device. For a specific signaling interaction process, refer to operations S<b>1</b> to S<b>6</b> in <figref idref="DRAWINGS">FIG. <b>3</b></figref>. Details are not described herein again.</p><p id="p-0116" num="0115">Operation <b>404</b>: The AMF entity sends, to the NRNAS module, an accept message indicating that NAS registration succeeds.</p><p id="p-0117" num="0116">Operation <b>405</b>: The NRNAS module sends, to the registration control module, the accept message indicating that the NAS registration succeeds.</p><p id="p-0118" num="0117">Operation <b>406</b>: The NRNAS module sends a NAS registration complete message to the AMF entity.</p><p id="p-0119" num="0118">Operation <b>407</b>: The registration control module starts an IMS timer. For example, timing duration of the IMS timer is 35 seconds.</p><p id="p-0120" num="0119">Operation <b>408</b>: The registration control module sends an IMS registration request to an IMS module.</p><p id="p-0121" num="0120">For example, operation <b>407</b> and operation <b>408</b> may be performed at the same time. To be specific, the IMS timer is started when the registration control module sends the IMS registration request to the IMS module. In another example, operation <b>408</b> may be performed before operation <b>407</b>.</p><p id="p-0122" num="0121">Operation <b>409</b>: The IMS module in the terminal device sends an IMS protocol data unit (PDU) connection establishment request to the NRNAS module.</p><p id="p-0123" num="0122">Operation <b>410</b>: The NRNAS module sends a PDU connection establishment request to the AMF entity.</p><p id="p-0124" num="0123">Operation <b>411</b>: The AMF entity sends a PDU connection establishment accept message to the NRNAS module.</p><p id="p-0125" num="0124">Operation <b>412</b>: The NRNAS module sends an IMS PDU connection establishment accept message to the IMS module.</p><p id="p-0126" num="0125">Operation <b>413</b>: The IMS module sends an IMS registration request to a P-CSCF.</p><p id="p-0127" num="0126">Operation <b>414</b>: When the timing duration of the IMS timer reaches 35 seconds, the IMS timer sends an IMS timer timeout notification message to the registration control module. Then, the registration control module may perform operation <b>415</b>, operation <b>416</b>, or operation <b>417</b>.</p><p id="p-0128" num="0127">Operation <b>415</b>: The registration control module sends an IMS registration cancellation notification message to the IMS module.</p><p id="p-0129" num="0128">Operation <b>416</b>: The registration control module deactivates the 5G network.</p><p id="p-0130" num="0129">After the registration timer expires, the registration control module notifies a related module that an IMS capability is unavailable. The UE disables an NR network, and then searches for and switches to a 2G, 3G, or 4G network to support a voice call.</p><p id="p-0131" num="0130">In operation <b>316</b>, deactivating the 5G network may also be understood as disabling a 5G capability of the terminal device. For example, the 5G network may be mainly deactivated by using the following operations S<b>10</b> and S<b>11</b>.</p><p id="p-0132" num="0131">S<b>10</b>: The NRNAS module sends a PDU session release request to the AMF.</p><p id="p-0133" num="0132">S<b>11</b>: The AMF sends a PDU session release accept message to the NRNAS module.</p><p id="p-0134" num="0133">Operation <b>417</b>: The terminal device performs IMS registration in the 4G network. For example, for an IMS registration process in the 4G network, refer to the process shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>.</p><p id="p-0135" num="0134">In the foregoing embodiment, the IMS registration protection timers in the 4G network and the 5G network are not distinguished between 4G and 5G, and cannot be independently configured based on features of a current network. Consequently, optimal user experience cannot be ensured.</p><p id="p-0136" num="0135">Generally, if the 4G network supports CSFB, before the IMS registration succeeds, voice communication can be fallen back to the 2 or 3G network through the 4G network. Therefore, the voice communication can be guaranteed through a CS domain. However, voice communication in the 5G network can be performed only through an IMS domain, and cannot be ensured before the IMS registration succeeds. The IMS registration in the 4G network and the IMS registration in the 5G network are separately described below with reference to an example of a voice call scenario.</p><p id="p-0137" num="0136"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is a schematic diagram of an IMS registration process in a voice call scenario in a 4G network according to an embodiment of this application. As shown in <figref idref="DRAWINGS">FIG. <b>5</b></figref>, the IMS registration process mainly includes the following operations.</p><p id="p-0138" num="0137">Operation <b>501</b>: A call manager (callmanger) in a terminal device (UE) A sends an IMS registration request to a 4G module, and starts an IMS protection timer. For example, timing duration of the IMS timer is 35 seconds.</p><p id="p-0139" num="0138">Operation <b>502</b>: The 4G module initiates an IMS registration request to an MME.</p><p id="p-0140" num="0139">Operation <b>503</b>: Before IMS registration succeeds, the MME receives a call request from a UE B.</p><p id="p-0141" num="0140">Operation <b>504</b>: The MME indicates the UE A to fall back from the 4G network to a 2G or 3G network, and sends the call request to the UE A.</p><p id="p-0142" num="0141">Before the IMS registration succeeds, the UE A falls back from the 4G network to the 2G or 3G network, and voice communication can be ensured through CSFB. However, the 2G or 3G network does not support an IMS domain. Consequently, the IMS registration cannot be continued. Therefore, after operation <b>504</b>, operation <b>505</b> and operation <b>506</b> are performed, and may be performed in any sequence.</p><p id="p-0143" num="0142">Operation <b>505</b>: The MME sends a call success accept message to the UE B.</p><p id="p-0144" num="0143">Operation <b>506</b>: A 2G/3G/4G module in the UE A notifies the call manager that the IMS registration fails.</p><p id="p-0145" num="0144">Operation <b>507</b>: The call manager stops the IMS protection timer.</p><p id="p-0146" num="0145">It can be learned that, when CSFB is supported, voice communication in the 4G network is ensured through fallback to a CS domain. However, call experience in the CS domain is poorer than that in the IMS domain. Therefore, the timing duration of the IMS timer in the 4G network may be appropriately configured to be longer. In this way, when the IMS registration process is not interrupted by a call, for example, after the call ends, the IMS registration timer does not expire, the UE A may return to the 4G network again to continue the IMS registration. In this way, there may be more chances of successful registration. If registration with the IMS domain succeeds, the call experience in the 4G network can be improved.</p><p id="p-0147" num="0146"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is a schematic diagram of an IMS registration process in a voice call scenario in a 5G network according to an embodiment of this application. As shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>, the IMS registration process mainly includes the following operations.</p><p id="p-0148" num="0147">Operation <b>601</b>: A call manager (callmanger) in a terminal device (UE) A sends an IMS registration request to a 5G module, and starts an IMS protection timer. For example, timing duration of the IMS timer is 35 seconds.</p><p id="p-0149" num="0148">Operation <b>602</b>: The 5G module initiates an IMS registration request to an AMF.</p><p id="p-0150" num="0149">After operation <b>602</b>, the AMF further authenticates the UE A.</p><p id="p-0151" num="0150">Operation <b>603</b>: Before IMS registration succeeds, the AMF receives a call request from a UE B.</p><p id="p-0152" num="0151">Before the IMS registration succeeds, the 5G network cannot provide a voice communications service. As a result, the UE B cannot call the UE A.</p><p id="p-0153" num="0152">Operation <b>604</b>: The AMF sends a call accept fail message to the UE B.</p><p id="p-0154" num="0153">Operation <b>605</b>: After the AMF successfully authenticates the UE A, the AMF sends a 200 OK message to the 5G module of the UE A.</p><p id="p-0155" num="0154">Operation <b>606</b>: The 5G module of the UE A sends an IMS registration success message to the call manager.</p><p id="p-0156" num="0155">Operation <b>607</b>: The UE A stops the IMS protection timer.</p><p id="p-0157" num="0156">It can be learned that in the 5G network, a voice call can be performed only through an IMS domain. Before the IMS registration succeeds, the UE A directly fails to be called. Consequently, voice communication cannot be ensured. To ensure a call connection rate, the timing duration of the IMS timer in the 5G network may be appropriately configured to be shorter. In this way, after the IMS registration in the 5G network fails, a 5G capability of the terminal device is disabled, and then the terminal device falls back to a 2G, 3G, or 4G network to listen to the call request, so that the UE A can receive the call request of the UE B.</p><p id="p-0158" num="0157">It can be learned that, in the foregoing embodiment, a same IMS timer and unified timing duration are used in the 4G network and the 5G network. Consequently, the voice call experience in the 4G network and the voice connection rate in the 5G network cannot be improved at the same time.</p><p id="p-0159" num="0158">Therefore, further, this application further provides an embodiment. Compared with the foregoing embodiment in which the IMS registration protection timer in the 4G network and the 5G network cannot distinguish the 4G network and the 5G network, and cannot be independently configured based on features of a current network, in this embodiment of this application, different timers may be enabled based on different networks, or different duration may be set for a same timer, to ensure optimal user experience. The following separately describes the two embodiments.</p><p id="p-0160" num="0159">In embodiment 1, a same IMS timer A is used to separately time IMS registration processes of the terminal device in different networks, and different timing duration is set when timing is performed on different networks. For example, when an IMS timer A is used to time the IMS registration process in the 4G network, timing duration of the IMS timer A is set to first duration. When the IMS timer A is used to time the IMS registration process in the 5G network, the timing duration of the IMS timer A is set to second duration.</p><p id="p-0161" num="0160"><figref idref="DRAWINGS">FIG. <b>7</b></figref> is a schematic diagram of a communications method according to an embodiment of this application. The communications method mainly includes the following operations.</p><p id="p-0162" num="0161">Operation <b>701</b>: A registration control module in a terminal device determines a type of a network with which the terminal device is currently registered. If the type of the network with which the terminal device is registered is a first network type, operation <b>702</b> is performed. If the type of the network with which the terminal device is registered is a second network type, operation <b>704</b> is performed.</p><p id="p-0163" num="0162">For example, in a network search process, if the terminal device finds a 5G network, the terminal device initiates NAS registration with the network, and is attached to the 5G network after the NAS registration succeeds. If the terminal device finds a 4G network, the terminal device initiates NAS registration with the network, and is attached to the 4G network after the NAS registration succeeds. Then, whether the terminal device currently performs IMS registration in the 4G network or the 5G network may be determined based on a network type of the network to which the terminal device is attached. For example, if the terminal device is currently attached to the 4G network, it may be determined that the type of the network with which the terminal device currently performs IMS registration is 4G. For example, if the terminal device is currently attached to the 5G network, it may be determined that a type of the network with which the terminal device currently performs IMS registration is 5G.</p><p id="p-0164" num="0163">Operation <b>702</b>: The registration control module determines timing duration corresponding to the first network type.</p><p id="p-0165" num="0164">In some embodiments, a configuration file in a non-volatile memory stores timing duration corresponding to various network types. When the terminal is powered on, the registration control module may read, from the configuration file in the non-volatile memory, the timing duration corresponding to the first network type, and store the timing duration in a memory. When the terminal runs, the timing duration is read from the memory for use. For example, the read timing duration is first duration.</p><p id="p-0166" num="0165">Operation <b>703</b>: Initiate an IMS registration procedure in the network corresponding to the first network type, start a first IMS timer at the same time, and set timing duration of the first IMS timer to the first duration.</p><p id="p-0167" num="0166">Operation <b>704</b>: Determine timing duration corresponding to the second network type.</p><p id="p-0168" num="0167">In some embodiments, the registration control module may read, from the configuration file in the non-volatile memory, the timing duration corresponding to the second network type. For example, the read timing duration is second duration.</p><p id="p-0169" num="0168">Operation <b>705</b>: Initiate an IMS registration procedure in the network corresponding to the second network type, start the first IMS timer at the same time, and set the timing duration of the first IMS timer to the second duration.</p><p id="p-0170" num="0169">For example, both the first duration and the second duration may be less than 128 seconds.</p><p id="p-0171" num="0170">In the example shown in <figref idref="DRAWINGS">FIG. <b>7</b></figref>, for example, if the first network type is a 4G network, the second network type is a 5G network. If the first network type is a 5G network, the second network type is a 4G network. For the IMS registration procedure initiated in the 4G network, refer to the related content in <figref idref="DRAWINGS">FIG. <b>3</b></figref>. For the IMS registration procedure initiated in the 5G network, refer to the related content in <figref idref="DRAWINGS">FIG. <b>4</b></figref>. Details are not described herein again.</p><p id="p-0172" num="0171">For example, the first network type is a 4G network, and the second network type is a 5G network. The timing duration of the first IMS timer started in the 4G network is set to the first duration, and the timing duration of the first IMS timer started in the 5G network is set to the second duration. In an embodiment, the first duration is different from the second duration. Further, the first duration is greater than the second duration. For example, the first duration is 35 seconds, and the second duration is 25 seconds. In this way, the terminal device can improve voice call experience in the 4G network and improve a voice connection rate in the 5G network, so that the terminal device can implement different IMS registration protection duration in different network technologies, to ensure optimal user experience in different networks.</p><p id="p-0173" num="0172">In embodiment 2, different IMS timers are used to time IMS registration processes of the terminal device in different networks. For example, an IMS timer A is used to time the IMS registration process in the 4G network, and first duration is configured for the IMS timer A. An IMS timer B is used to time the IMS registration process in the 5G network, and second duration is configured for the IMS timer B. In an embodiment, the first duration and the second duration may be different. For example, the first duration is greater than the second duration. For example, the first duration is 35 seconds, and the second duration is 25 seconds.</p><p id="p-0174" num="0173"><figref idref="DRAWINGS">FIG. <b>8</b></figref> is a schematic diagram of another communications method according to an embodiment of this application. The communications method mainly includes the following operations.</p><p id="p-0175" num="0174">Operation <b>801</b>: A registration control module in a terminal device determines a type of a network with which the terminal device is currently registered. If the type of the network with which the terminal device is currently registered is a first network type, operation <b>802</b> is performed. If the type of the network with which the terminal device is currently registered is a second network type, operation <b>804</b> is performed.</p><p id="p-0176" num="0175">For example, in a network search process, if the terminal device finds a 5G network, the terminal device initiates NAS registration with the network, and is attached to the 5G network after the NAS registration succeeds. If the terminal device finds a 4G network, the terminal device initiates NAS registration with the network, and is attached to the 5G network after the NAS registration succeeds. Therefore, whether the terminal device currently performs IMS registration in the 4G network or the 5G network may be determined based on a network type of the network to which the terminal device is attached. For example, if the terminal device is currently attached to the 4G network, it may be determined that the type of the network with which the terminal device currently performs IMS registration is 4G. For example, if the terminal device is currently attached to the 5G network, it may be determined that a type of the network with which the terminal device currently performs IMS registration is 5G.</p><p id="p-0177" num="0176">Operation <b>802</b>: The registration control module determines timing duration corresponding to the first network type.</p><p id="p-0178" num="0177">For example, a configuration file in a non-volatile memory stores timing duration corresponding to various network types. When the terminal is powered on, the registration control module may read, from the configuration file in the non-volatile memory, the timing duration corresponding to the first network type, and store the timing duration in a memory. When the terminal runs, the timing duration is read from the memory for use. For example, the read timing duration is first duration.</p><p id="p-0179" num="0178">Operation <b>803</b>: Initiate an IMS registration procedure in the network corresponding to the first network type, start a first IMS timer at the same time, and set timing duration of the first IMS timer to the first duration.</p><p id="p-0180" num="0179">Operation <b>804</b>: Determine timing duration corresponding to the second network type.</p><p id="p-0181" num="0180">For example, the registration control module may read, from the configuration file in the non-volatile memory, the timing duration corresponding to the second network type. For example, the read timing duration is second duration.</p><p id="p-0182" num="0181">Operation <b>805</b>: Initiate an IMS registration procedure in the network corresponding to the second network type, start a second IMS timer at the same time, and set the timing duration of the second IMS timer to the second duration.</p><p id="p-0183" num="0182">For example, both the first duration and the second duration may be less than 128 seconds.</p><p id="p-0184" num="0183">In the example shown in <figref idref="DRAWINGS">FIG. <b>8</b></figref>, for example, if the first network type is a 4G network, the second network type is a 5G network. If the first network type is a 5G network, the second network type is a 4G network. For the IMS registration procedure initiated in the 4G network, refer to the related content in <figref idref="DRAWINGS">FIG. <b>3</b></figref>. For the IMS registration procedure initiated in the 5G network, refer to the related content in <figref idref="DRAWINGS">FIG. <b>4</b></figref>. Details are not described herein again.</p><p id="p-0185" num="0184">For example, the first network type is a 4G network, and the second network type is a 5G network. The timing duration of the first IMS timer started in the 4G network is set to the first duration, and the timing duration of the second IMS timer started in the 5G network is set to the second duration. The first duration is greater than the second duration. For example, the first duration is 35 seconds, and the second duration is 25 seconds. In this way, voice call experience of the terminal device in the 4G network can be improved, and a voice call connection rate of the terminal device in the 5G network can be improved. In this way, the terminal device can implement different IMS registration protection duration in different network technologies, to implement optimal user experience in different networks.</p><p id="p-0186" num="0185">It should be understood that in any one of the foregoing embodiments of this application, a protection phase of the IMS timer may include an IMS registration process, or may include both an IMS default bearer establishment process (which is an IMS PDN establishment process in the 4G network or an IMS PDU session establishment process in the 5G network) and an IMS registration process.</p><p id="p-0187" num="0186">The following uses a mobile phone as an example to describe how to test IMS registration duration in the 4G network.</p><p id="p-0188" num="0187">In an example, in the 4G network, an MME does not support circuit switched fallback (CSFB). When the mobile phone receives an operation of enabling a 4G switch or disabling an airplane mode performed by a user, the mobile phone searches for a network, and performs a NAS registration process in the 4G network after finding the 4G network. When the mobile phone completes NAS registration and is attached to the 4G network, a 4G network identifier is displayed on a status bar of the mobile phone, as shown in <figref idref="DRAWINGS">FIG. <b>9</b>(<i>a</i>)</figref>. The mobile phone starts an IMS registration procedure and receives a voice call during this procedure. Then, if the mobile phone does not receive an IMS registration accept message from a network side when the timing duration of the IMS timer reaches 35 seconds, the following statuses may be displayed on the status bar of the mobile phone. In a possible case, information indicating that the 4G network is unavailable is displayed on the status bar of the mobile phone, as shown in <figref idref="DRAWINGS">FIG. <b>9</b>(<i>d</i>)</figref>. In another possible case, the mobile phone is switched to a non-4G network, and after the mobile phone is switched to a 3G network, a 3G network identifier is displayed on the status bar of the mobile phone, as shown in <figref idref="DRAWINGS">FIG. <b>9</b>(<i>b</i>)</figref>; or when the mobile phone is switched to a 2G network, a 2G network identifier is displayed on the status bar of the mobile phone, as shown in <figref idref="DRAWINGS">FIG. <b>9</b>(<i>c</i>)</figref>.</p><p id="p-0189" num="0188">After the mobile phone starts the IMS registration procedure, the mobile phone may test the timing duration of the IMS timer in the following two manners. In one manner, timing starts when an MME receives a PDN connection establishment request (as described in operation <b>307</b>), and ends when the information indicating that the 4G network is unavailable or the 2G or 3G network identifier is displayed on the status bar of the mobile phone. A difference between timing starting time and timing ending time is the specified duration of the IMS timer. In another manner, timing starts when a P-CSCF receives an IMS registration request (as described in operation <b>311</b>), and ends when the information indicating that the 4G network is unavailable or the 2G or 3G network identifier is displayed on the status bar of the mobile phone. A difference between timing starting time and timing ending time is the specified duration of the IMS timer.</p><p id="p-0190" num="0189">In another example, in the 4G network, the MME does not support CSFB. When the mobile phone receives an operation of enabling a 4G switch or disabling an airplane mode performed by a user, the mobile phone searches for a network, and performs a NAS registration process in the 4G network after finding the 4G network. When the mobile phone completes NAS registration and is attached to the 4G network, a 4G network identifier is displayed on a status bar of the mobile phone, as shown in <figref idref="DRAWINGS">FIG. <b>9</b>(<i>a</i>)</figref>. After the mobile phone starts the IMS registration procedure, when the timing duration of the IMS timer reaches 35 seconds, if the mobile phone still does not receive an IMS registration accept message from a network side, the information indicating that the 4G network is unavailable is displayed on the status bar of the mobile phone, as shown in <figref idref="DRAWINGS">FIG. <b>9</b>(<i>d</i>)</figref>.</p><p id="p-0191" num="0190">After the mobile phone starts the IMS registration procedure in the 4G network, the mobile phone may test the timing duration of the IMS timer in the following two manners. In one manner, timing starts when an MME receives a PDN connection establishment request (as described in operation <b>307</b>), and ends when the information indicating that the 4G network is unavailable is displayed on the status bar of the mobile phone. A difference between timing starting time and timing ending time is the specified duration of the IMS timer. In another manner, timing starts when a P-CSCF receives an IMS registration request (as described in operation <b>311</b>), and ends when the information indicating that the 4G network is unavailable (as described in operation <b>314</b>) is displayed on the status bar of the mobile phone. A difference between timing starting time and timing ending time is the specified duration of the IMS timer.</p><p id="p-0192" num="0191">The following uses a mobile phone as an example to describe how to test IMS registration duration in the 5G network.</p><p id="p-0193" num="0192">In the 5G network, when the mobile phone receives an operation of enabling a 5G switch or disabling an airplane mode by a user, or is moved from a non-5G network coverage area to a 5G network coverage area, after the mobile phone finds the 5G network, the mobile phone performs a NAS registration process in the 5G network. After the mobile phone completes NAS registration and is attached to the 5G network, a 5G identifier is displayed on the status bar of the mobile phone, as shown in <figref idref="DRAWINGS">FIG. <b>10</b>(<i>a</i>)</figref>. After the mobile phone starts the IMS registration procedure, if the mobile phone does not receive an IMS registration accept message from a network side when the timing duration of the IMS timer reaches 35 seconds, the following statuses may be displayed on the status bar of the mobile phone. In a possible case, information indicating that the 5G network is unavailable is displayed on the status bar of the mobile phone, as shown in <figref idref="DRAWINGS">FIG. <b>10</b>(<i>d</i>)</figref>. In another possible case, the mobile phone is switched to a non-5G network. For example, after the mobile phone is switched to the 4G network, a 4G network identifier is displayed on the status bar of the mobile phone, as shown in <figref idref="DRAWINGS">FIG. <b>10</b>(<i>b</i>)</figref>. When the mobile phone is switched to a 3G network, a 3G network identifier is displayed on the status bar of the mobile phone, as shown in <figref idref="DRAWINGS">FIG. <b>10</b>(<i>c</i>)</figref>. When the mobile phone is switched to a 2G network, a 2G network identifier is displayed on the status bar of the mobile phone.</p><p id="p-0194" num="0193">After the mobile phone starts the IMS registration procedure in the 5G network, the mobile phone may test the timing duration of the IMS timer in the following two manners. In one manner, timing starts when an AMF entity receives a PDU connection establishment request (as described in operation <b>410</b>), and ends when the information indicating that the 5G network is unavailable or a non-5G network identifier is displayed on the status bar of the mobile phone. A difference between timing starting time and timing ending time is the specified duration of the IMS timer. In another manner, timing starts when a P-CSCF receives an IMS registration request (as described in operation <b>413</b>), and ends when the information indicating that the 5G network is unavailable is displayed on the status bar of the mobile phone. A difference between timing starting time and timing ending time is the specified duration of the IMS timer.</p><p id="p-0195" num="0194">In embodiments of this application, division of modules is an example, and is merely logical function division. In an actual implementation, there may be another division manner. In addition, function modules in embodiments of this application may be integrated into one processor, or each of the modules may exist alone physically, or two or more modules may be integrated into one module. The integrated module may be implemented in a form of hardware, or may be implemented in a form of a software function module. It may be understood that, for functions or implementations of the modules in embodiments of this application, further refer to related descriptions in the method embodiments.</p><p id="p-0196" num="0195">Based on a same inventive concept as the method embodiments, an embodiment of this application provides a communications apparatus. The communications apparatus may be a terminal device. The terminal device may be configured to implement the method performed by the terminal device in embodiments in <figref idref="DRAWINGS">FIG. <b>3</b></figref> to <figref idref="DRAWINGS">FIG. <b>8</b></figref>. Alternatively, the apparatus may be a network device, for example, an access network device.</p><p id="p-0197" num="0196"><figref idref="DRAWINGS">FIG. <b>11</b></figref> is a schematic diagram of a structure of a terminal device according to an embodiment of this application. The terminal device is applicable to the system shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, and performs a function of the terminal device in the foregoing method embodiments. For ease of description, <figref idref="DRAWINGS">FIG. <b>11</b></figref> shows only main components of the terminal device. As shown in <figref idref="DRAWINGS">FIG. <b>11</b></figref>, a terminal device <b>1101</b> includes a processor, a memory, a control circuit, an antenna, and an input/output apparatus. The processor is mainly configured to process a communication protocol and communication data, control the entire terminal device, execute a software program, and process data of the software program, for example, configured to support the terminal device in performing actions described in the foregoing method embodiments. The memory is configured to store the software program and the data. The control circuit is mainly configured to perform conversion between a baseband signal and a radio frequency signal, and process the radio frequency signal. The control circuit together with the antenna may also be referred to as a transceiver, mainly configured to receive and send a radio frequency signal in a form of an electromagnetic wave. The input/output apparatus, for example, a touchscreen, a display, or a keyboard, is mainly configured to receive data entered by a user and output data to the user.</p><p id="p-0198" num="0197">After the terminal device is powered on, the processor may read the software program in the memory, explain and execute instructions of the software program, and process the data of the software program. When data needs to be sent in a wireless manner, after the processor performs baseband processing on the to-be-sent data, the processor outputs a baseband signal to a radio frequency circuit. After performing radio frequency processing on the baseband signal, the radio frequency circuit sends a radio frequency signal through an antenna in a form of an electromagnetic wave. When data is sent to the terminal device, the radio frequency circuit receives a radio frequency signal through the antenna, converts the radio frequency signal into a baseband signal, and outputs the baseband signal to the processor. The processor converts the baseband signal into data and processes the data.</p><p id="p-0199" num="0198">A person skilled in the art may understand that for ease of description, <figref idref="DRAWINGS">FIG. <b>11</b></figref> shows only one memory and one processor. In an actual terminal device, there may be a plurality of processors and a plurality of memories. The memory may also be referred to as a storage medium, a storage device, or the like. The memory may be a storage element located on a same chip as the processor, namely, an on-chip storage element, or may be an independent storage element. This is not limited in this embodiment of this application.</p><p id="p-0200" num="0199">In an embodiment, the terminal device may include a baseband processor and a central processing unit. The baseband processor is mainly configured to process the communication protocol and the communication data. The central processing unit is mainly configured to control the entire terminal device, execute the software program, and process the data of the software program. Functions of the baseband processor and the central processing unit may be integrated into the processor in <figref idref="DRAWINGS">FIG. <b>11</b></figref>. A person skilled in the art may understand that the baseband processor and the central processing unit each may be an independent processor, and are interconnected by using a technology such as a bus. A person skilled in the art may understand that the terminal device may include a plurality of baseband processors to adapt to different network standards, and the terminal device may include a plurality of central processing units to enhance processing capabilities of the terminal device, and components of the terminal device may be connected through various buses. The baseband processor may alternatively be expressed as a baseband processing circuit or a baseband processing chip. The central processing unit may alternatively be expressed as a central processing circuit or a central processing chip. A function of processing the communication protocol and the communication data may be built in the processor, or may be stored in the memory in a form of a software program, and the processor executes the software program to implement a baseband processing function.</p><p id="p-0201" num="0200">In this embodiment of this application, the control circuit and the antenna having sending and receiving functions may be considered as a transceiver unit <b>1101</b> of the terminal device <b>1100</b>. For example, the transceiver unit <b>1101</b> is configured to support the terminal device in performing the receiving function and the sending function. A processor <b>1102</b> having a processing function is considered as a processing unit of the terminal device. As shown in <figref idref="DRAWINGS">FIG. <b>11</b></figref>, the terminal device <b>11</b> includes the transceiver unit <b>1101</b> and the processor <b>1102</b>. The transceiver unit may also be referred to as a transceiver machine, a transceiver, a transceiver apparatus, or the like. In an embodiment, a component configured to implement a receiving function in the transceiver unit <b>1101</b> may be considered as a receiving unit. A component configured to implement a sending function in the transceiver unit <b>1101</b> may be considered as a sending unit. In other words, the transceiver unit <b>1101</b> includes the receiving unit and the sending unit. The receiving unit may also be referred to as a receiver, an input port, a receiving circuit, or the like. The sending unit may be referred to as a transmitter machine, a transmitter, a transmitting circuit, or the like.</p><p id="p-0202" num="0201">The processor <b>1102</b> may be configured to execute instructions stored in the memory, to control the transceiver unit <b>1101</b> to receive a signal and/or send a signal, to complete a function of the terminal device in the foregoing method embodiments. The processor <b>1102</b> further includes an interface, configured to implement a signal input/output function. In an embodiment, a function of the transceiver unit <b>1101</b> may be implemented by using a transceiver circuit or a transceiver-dedicated chip.</p><p id="p-0203" num="0202">An embodiment of this application further provides an IMS registration duration management system, including a terminal device, a first network device, and a second network device, where the terminal device is configured to: send, in a first network to which the terminal device is attached, an Internet protocol multimedia subsystem IMS registration request to the first network device, and start an IMS timer corresponding to the first network. The first network device is configured to: after receiving the IMS registration request, determine whether to send a registration accept message. The terminal device is further configured to deactivate the first network if the registration accept message from the first network device is not received when timing duration of the IMS timer corresponding to the first network reaches first specified duration. The terminal device is further configured to send, in a second network to which the terminal device is attached, an Internet protocol multimedia subsystem IMS registration request to the second network device, and start an IMS timer corresponding to the second network. The second network device is configured to: after receiving the IMS registration request, determine whether to send a registration accept message. The terminal device is further configured to deactivate the second network if the registration accept message from the second network device is not received when timing duration of the IMS timer corresponding to the second network reaches second specified duration. The first specified duration is different from the second specified duration.</p><p id="p-0204" num="0203">In an embodiment, the first network is a 4G network, and the second network is a 5G network; or the first network is a 5G network, and the second network is a 4G network.</p><p id="p-0205" num="0204">In an embodiment, the IMS timer corresponding to the first network is different from the IMS timer corresponding to the second network.</p><p id="p-0206" num="0205">In an embodiment, when the first network is a 4G network, and the second network is a 5G network, the first specified duration is greater than second specified duration.</p><p id="p-0207" num="0206">In an embodiment, the first network is a 4G network, and the terminal device is further configured to deactivate the 4G network if the registration accept message from the first network device is not received when the timing duration of the IMS timer corresponding to the 4G network reaches the first specified duration.</p><p id="p-0208" num="0207">In an embodiment, the first network is a 4G network, the second network is a 5G network, and the terminal device is further configured to: deactivate the 5G network or perform IMS registration in the 4G network if the registration accept message from the second network device is not received when the timing duration of the IMS timer corresponding to the 5G network reaches the first specified duration.</p><p id="p-0209" num="0208">In an embodiment, the first network is a 4G network, the second network is a 5G network, and the terminal device is further configured to: when the first network supports circuit switched fallback and a voice service, search for and fall back to a 2G or 3G network if the registration accept message from the first network device is not received when the timing duration of the IMS timer corresponding to the first network reaches the first specified duration, to access a voice service.</p><p id="p-0210" num="0209">In an embodiment, the terminal device further includes a display, the first network is a 5G network, and the terminal device is further configured to: when the terminal device is attached to the 5G network, display an identifier of the 5G network on the display; and when it is determined that the registration accept message from the second network device is not received when the timing duration of the IMS timer corresponding to the 5G network reaches the second specified duration, control the display to display information indicating that the 5G network is unavailable, or control the display to display an identifier of a 4G network when the 4G network is found.</p><p id="p-0211" num="0210">In an embodiment, the terminal device further includes a display, the first network is a 4G network, and the terminal device is further configured to: when the terminal device is attached to the 4G network, display an identifier of the 4G network on the display; and when it is determined that the registration accept message from the first network device is not received when the timing duration of the IMS timer corresponding to the 4G network reaches the first specified duration, control the display to display information indicating that the 4G network is unavailable, or control the display to display an identifier of the 2G or 3G network when the 2G or 3G network is found.</p><p id="p-0212" num="0211">In an embodiment, the first network device is further configured to send a registration accept message to the terminal device. The terminal device is further configured to: if the registration accept message is received before the timing duration of the IMS timer corresponding to the first network reaches the first specified duration, determine that the IMS registration succeeds.</p><p id="p-0213" num="0212">In an embodiment, the second network device is further configured to send a registration accept message to the terminal device. The terminal device is further configured to: if the registration accept message is received before the timing duration of the IMS timer corresponding to the second network reaches the second specified duration, determine that the IMS registration succeeds.</p><p id="p-0214" num="0213">In an embodiment, the first specified duration is less than 128 seconds, and the second specified duration is less than 128 seconds.</p><p id="p-0215" num="0214">Based on the same concept as the foregoing method embodiments, an embodiment of this application further provides a computer-readable storage medium. The computer-readable storage medium stores some instructions. When these instructions are invoked and executed by a computer, the computer is enabled to perform the method in the foregoing method embodiments and any possible design of the foregoing method embodiments. In this embodiment of this application, the computer-readable storage medium is not limited. For example, the computer-readable storage medium may be a RAM (random access memory) or a ROM (read-only memory).</p><p id="p-0216" num="0215">Based on a same concept as the foregoing method embodiments, this application further provides a computer program product. When being invoked and executed by a computer, the computer program product can perform the method in the foregoing method embodiments and any possible design of the foregoing method embodiments.</p><p id="p-0217" num="0216">Based on a same concept as the foregoing method embodiment, this application further provides a chip. The chip is coupled to a transceiver, and is configured to complete the method in any one of the foregoing method embodiments and the possible implementations of the foregoing method embodiments. &#x201c;Coupling&#x201d; means that two components are directly or indirectly combined with each other. The combination may be fixed or movable, and the combination may allow communication of fluid, electricity, an electrical signal, or another type of signal between the two parts.</p><p id="p-0218" num="0217">An embodiment of this application further provides a baseband chip. The baseband chip may be configured to combine to-be-transmitted baseband signals or decode a received baseband signal. <figref idref="DRAWINGS">FIG. <b>12</b></figref> is an example of a schematic diagram of an architecture of the baseband chip.</p><p id="p-0219" num="0218">As shown in <figref idref="DRAWINGS">FIG. <b>12</b></figref>, the baseband chip includes a microprocessor and a digital signal processor (DSP).</p><p id="p-0220" num="0219">The microprocessor may implement, by using a real-time operating system (RTOS) (such as Nucleus Plus), multi-task scheduling, inter-task communication, peripheral device driving, and communication between the microprocessor and a DSP subsystem or another module. The microprocessor also provides the following functions: control and manage an entire mobile station, including timing control, digital system control, radio frequency control, and power saving control; and implement all software functions, namely, communication between a physical layer of a wireless communications protocol and a protocol stack, and a higher layer protocol stack (TCP/IP) and the like). If the microprocessor is used for a function machine, a man-machine interaction interface (MMI) and application software are further included.</p><p id="p-0221" num="0220">The DSP subsystem processes all algorithms at the physical layer, including channel coding, encryption, channel equalization, voice coding/decoding, and modulation/demodulation. A data communication means between the DSP subsystem and a microprocessor subsystem include a dual-port random access memory (RAM), a multi-bus shared resource (for example, a multilayer bus protocol), and the like. A multimode and multi-frequency baseband chip may contain a plurality of DSPs.</p><p id="p-0222" num="0221">Both the microprocessor and the DSP subsystem may have respective independent caches, a shared on-chip memory (static random access memory (SRAM)), and a shared external memory. The external memory generally supports a synchronous dynamic random access memory (SDRAM), a NAND flash RAM, and the like. A flash erasable read-only memory (flash ROM, also referred to as a flash memory) may be configured to store a diskless boot read-only memory (ROM) interface (boot ROM) and a control program (CP) ROM that links an operating system and a user application program. The ROM interface is mainly configured to connect to the memory flash ROM that stores a program, and a RAM interface is mainly configured to connect to a static RAM (SRAM) that stores temporarily stored data. The on-chip large-capacity static random access memory (SRAM) is widely used, which can reduce power consumption and system costs.</p><p id="p-0223" num="0222">The baseband chip usually supports a plurality of interfaces to facilitate communication with an application processor and add other modules such as a wireless-fidelity module (Wi-Fi) and a global positioning system (GPS). The interfaces include a universal asynchronous receiver/transmitter (UART), a multi-media interface (MMI), a universal serial bus (USB), a serial peripheral interface (SPI), and the like.</p><p id="p-0224" num="0223">Communication between the microprocessor and an external interface may be performed through direct memory access (DMA). If the baseband chip is not integrated with a radio frequency (RF) module, an RF dedicated interface is further provided.</p><p id="p-0225" num="0224">The terminal device, the computer storage medium, the computer program product, or the chip provided in embodiments of this application is configured to perform a corresponding method provided above. Therefore, for beneficial effects that can be achieved, refer to the beneficial effects in the corresponding methods provided above. Details are not described herein again.</p><p id="p-0226" num="0225">Based on the foregoing description of the embodiments, a person skilled in the art may understand that for the purpose of convenient and brief description, division into the foregoing functional modules is merely used as an example for description. In actual application, the foregoing functions can be allocated to different functional modules for implementation based on a requirement, that is, an inner structure of an apparatus is divided into different functional modules to implement all or some of the functions described above.</p><p id="p-0227" num="0226">In the several embodiments provided in this application, it should be understood that the disclosed apparatus and method may be implemented in other manners. For example, the described apparatus embodiment is merely an example. For example, division into modules or units is merely logical function division and may be other division during actual implementation. For example, a plurality of units or components may be combined or integrated into another apparatus, or some features may be discarded or not performed. In addition, the displayed or discussed mutual couplings or direct couplings or communication connections may be implemented through some interfaces. The indirect couplings or communication connections between the apparatuses or units may be implemented in electrical, mechanical, or other forms.</p><p id="p-0228" num="0227">The units described as separate parts may or may not be physically separate, and parts displayed as units may be one or more physical units, in other words, may be located at one place, or may be distributed on different places. Some or all of the units may be selected based on actual requirements to achieve the objectives of the solutions of embodiments.</p><p id="p-0229" num="0228">In addition, function units in embodiments of this application may be integrated into one processing unit, or each of the units may exist alone physically, or two or more units are integrated into one unit. The integrated unit may be implemented in a form of hardware, or may be implemented in a form of a software function unit.</p><p id="p-0230" num="0229">When the integrated unit is implemented in a form of a software functional unit and sold or used as an independent product, the integrated unit may be stored in a readable storage medium. Based on such an understanding, the technical solutions of embodiments of this application essentially, or the part contributing to the conventional technology, or all or some of the technical solutions may be implemented in the form of a software product. The software product is stored in a storage medium and includes several instructions for instructing a device (which may be a single-chip microcomputer, a chip, or the like) or a processor to perform all or some of the operations of the methods described in embodiments of this application. The foregoing storage medium includes any medium that can store program code, such as a USB flash drive, a removable hard disk, a read-only memory, a random access memory, a magnetic disk, or an optical disc.</p><p id="p-0231" num="0230">The foregoing content is merely embodiments of this application, but are not intended to limit the protection scope of this application. Any variation or replacement readily figured out by a person skilled in the art within the technical scope disclosed in this application shall fall within the protection scope of this application. Therefore, the protection scope of this application shall be subject to the protection scope of the claims.</p><?detailed-description description="Detailed Description" end="tail"?></description><claims id="claims"><claim id="CLM-01-30" num="01-30"><claim-text><b>1</b>-<b>30</b>. (canceled)</claim-text></claim><claim id="CLM-00031" num="00031"><claim-text><b>31</b>. A terminal device, comprising:<claim-text>a transceiver;</claim-text><claim-text>a memory; and</claim-text><claim-text>a processor;</claim-text><claim-text>wherein the transceiver is configured to send, in a network to which the terminal device is attached, an Internet protocol multimedia subsystem (IMS) registration request to a network device in the network, wherein the network device is one of a first network device or a second network device, wherein the first network device and the second network device are in a first network and a second network respectively, wherein each of the first network and the second network corresponds to an IMS timer with a different specified duration; and</claim-text><claim-text>wherein the processor is configured to execute instructions stored in the memory and to cause the terminal device to:<claim-text>when the IMS registration request is sent to the network device, start an IMS timer corresponding to the network to which the terminal device is attached, and</claim-text><claim-text>deactivate the network when a registration accept message from the network device is not received when the corresponding IMS timer expires.</claim-text></claim-text></claim-text></claim><claim id="CLM-00032" num="00032"><claim-text><b>32</b>. The terminal device according to <claim-ref idref="CLM-00031">claim 31</claim-ref>, wherein each of the first network and the second network is a 4G network or a 5G network.</claim-text></claim><claim id="CLM-00033" num="00033"><claim-text><b>33</b>. The terminal device according to <claim-ref idref="CLM-00031">claim 31</claim-ref>, wherein the IMS timer corresponding to the first network is different from the IMS timer corresponding to the second network.</claim-text></claim><claim id="CLM-00034" num="00034"><claim-text><b>34</b>. The terminal device according to <claim-ref idref="CLM-00031">claim 31</claim-ref>, wherein when the first network is a 4G network, and the second network is a 5G network, a first specified duration for the IMS timer corresponding to the first network is greater than a second specified duration for the IMS timer corresponding to the second network.</claim-text></claim><claim id="CLM-00035" num="00035"><claim-text><b>35</b>. The terminal device according to <claim-ref idref="CLM-00031">claim 31</claim-ref>, wherein the first network is a 4G network, and the processor is further configured to cause terminal device to:<claim-text>deactivate the 4G network when the registration accept message from the first network device is not received when the IMS timer corresponding to the 4G network expires.</claim-text></claim-text></claim><claim id="CLM-00036" num="00036"><claim-text><b>36</b>. The terminal device according to <claim-ref idref="CLM-00031">claim 31</claim-ref>, wherein the first network is a 4G network, the second network is a 5G network, and the processor is further configured to cause the terminal device to:<claim-text>deactivate the 5G network or perform IMS registration in the 4G network when the registration accept message from the second network device is not received when the IMS timer corresponding to the 5G network expires.</claim-text></claim-text></claim><claim id="CLM-00037" num="00037"><claim-text><b>37</b>. The terminal device according to <claim-ref idref="CLM-00031">claim 31</claim-ref>, wherein the first network is a 4G network, the second network is a 5G network, and the processor is further configured to cause the terminal device to:<claim-text>when the first network supports circuit switched fallback and a voice service, search for and fall back to a 2G or 3G network when the registration accept message from the first network device is not received when the IMS timer corresponding to the first network expires, to access a voice service.</claim-text></claim-text></claim><claim id="CLM-00038" num="00038"><claim-text><b>38</b>. The terminal device according to <claim-ref idref="CLM-00031">claim 31</claim-ref>, further comprising: a display;<claim-text>wherein the second network is a 5G network; and</claim-text><claim-text>wherein the processor is further configured to cause the terminal device to:</claim-text><claim-text>when the terminal device is attached to the 5G network, display an identifier of the 5G network on the display; and</claim-text><claim-text>when it is determined that the IMS registration in the 5G network fails, control the display to display information indicating that the 5G network is unavailable, or control the display to display an identifier of a 4G network when the 4G network is found.</claim-text></claim-text></claim><claim id="CLM-00039" num="00039"><claim-text><b>39</b>. The terminal device according to <claim-ref idref="CLM-00031">claim 31</claim-ref>, further comprising:<claim-text>a display;</claim-text><claim-text>wherein the first network is a 4G network; and</claim-text><claim-text>wherein the processor is further configured to cause the terminal device to:</claim-text><claim-text>when the terminal device is attached to the 4G network, display an identifier of the 4G network on the display; and</claim-text><claim-text>when it is determined that the IMS registration in the 4G network fails, control the display to display information indicating that the 4G network is unavailable, or control the display to display an identifier of a 2G or 3G network when the 2G or 3G network is found.</claim-text></claim-text></claim><claim id="CLM-00040" num="00040"><claim-text><b>40</b>. The terminal device according to <claim-ref idref="CLM-00031">claim 31</claim-ref>, wherein the processor is further configured to cause the terminal device to:<claim-text>when the registration accept message is received before the IMS timer corresponding to the first network expires, determine that the IMS registration succeeds.</claim-text></claim-text></claim><claim id="CLM-00041" num="00041"><claim-text><b>41</b>. The terminal device according to <claim-ref idref="CLM-00031">claim 31</claim-ref>, wherein the processor is further configured to cause the terminal device to:<claim-text>when the registration accept message is received before the IMS timer corresponding to the second network expires, determine that the IMS registration succeeds.</claim-text></claim-text></claim><claim id="CLM-00042" num="00042"><claim-text><b>42</b>. The terminal device according to <claim-ref idref="CLM-00031">claim 31</claim-ref>, wherein a first specified duration for the IMS timer corresponding to the first network is less than 128 seconds, and a second specified duration for the IMS timer corresponding to the second network is less than 128 seconds.</claim-text></claim><claim id="CLM-00043" num="00043"><claim-text><b>43</b>. A chip, comprising:<claim-text>a processor; and</claim-text><claim-text>a communications interface;</claim-text><claim-text>wherein the communications interface is configured to receive code instructions, and transmit the code instructions to the processor; and</claim-text><claim-text>wherein the processor is configured to invoke the code instructions transmitted by the communications interface to:</claim-text><claim-text>when an Internet protocol multimedia subsystem (IMS) registration request is sent to a network device in an attached network, start an IMS timer corresponding to the attached network, and deactivate the network when a registration accept message from the network device is not received when an IMS timer corresponding to the network expires;</claim-text><claim-text>wherein the attached network is one of a first network and a second network;</claim-text><claim-text>wherein the network device is one of a first network device in the first network and a second network device in the second network;</claim-text><claim-text>wherein each of the first network and the second network corresponds to an IMS timer with a different specified duration.</claim-text></claim-text></claim><claim id="CLM-00044" num="00044"><claim-text><b>44</b>. The chip according to <claim-ref idref="CLM-00043">claim 43</claim-ref>, wherein the IMS timer corresponding to the first network is different from the IMS timer corresponding to the second network.</claim-text></claim><claim id="CLM-00045" num="00045"><claim-text><b>45</b>. The chip according to <claim-ref idref="CLM-00043">claim 43</claim-ref>, wherein when the first network is a 4G network, and the second network is a 5G network, a first specified duration for the IMS timer corresponding to the first network is greater than a second specified duration for the IMS timer corresponding to the second network.</claim-text></claim><claim id="CLM-00046" num="00046"><claim-text><b>46</b>. The chip according to <claim-ref idref="CLM-00043">claim 43</claim-ref>, wherein the first network is a 4G network, the second network is a 5G network, and the processor is configured to:<claim-text>when the first network supports circuit switched fallback and a voice service, search for and fall back to a 2G or 3G network when the registration accept message from the first network device is not received when the IMS timer corresponding to the first network expires, to access a voice service.</claim-text></claim-text></claim><claim id="CLM-00047" num="00047"><claim-text><b>47</b>. The chip according to <claim-ref idref="CLM-00043">claim 43</claim-ref>, wherein the first network is a 4G network, and the processor is configured to:<claim-text>deactivate the 4G network when the registration accept message from the first network device is not received when the IMS timer corresponding to the 4G network expires.</claim-text></claim-text></claim><claim id="CLM-00048" num="00048"><claim-text><b>48</b>. The chip according to <claim-ref idref="CLM-00043">claim 43</claim-ref>, wherein the second network is a 5G network, and the processor is configured to:<claim-text>when the registration accept message from the second network device is not received when the IMS timer corresponding to the 5G network expires, deactivate the 5G network, or perform IMS registration in a 4G network when the 4G network is found.</claim-text></claim-text></claim><claim id="CLM-00049" num="00049"><claim-text><b>49</b>. An IMS registration duration management system, comprising:<claim-text>a terminal device;</claim-text><claim-text>a first network device; and</claim-text><claim-text>a second network device;</claim-text><claim-text>wherein the terminal device is configured to send, in a network to which the terminal device is attached, an Internet protocol multimedia subsystem (IMS) registration request to the network device, and start an IMS timer corresponding to the network;</claim-text><claim-text>wherein the network device is configured to: after receiving the IMS registration request, determine whether to send a registration accept message;</claim-text><claim-text>wherein the terminal device is further configured to deactivate the network when the registration accept message from the network device is not received when the IMS timer corresponding to the network expires;</claim-text><claim-text>wherein the network is one of a first network and a second network;</claim-text><claim-text>wherein the network device is one of the first network device in the first network and the second network device in the second network;</claim-text><claim-text>wherein each of the first network and the second network corresponds to an IMS timer with a different specified duration.</claim-text></claim-text></claim><claim id="CLM-00050" num="00050"><claim-text><b>50</b>. The system according to <claim-ref idref="CLM-00049">claim 49</claim-ref>, wherein each of the first network and the second network is a 4G network or a 5G network.</claim-text></claim></claims></us-patent-application>