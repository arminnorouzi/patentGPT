<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230001823A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230001823</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17781654</doc-number><date>20201208</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><priority-claims><priority-claim sequence="01" kind="national"><country>SE</country><doc-number>1951438-9</doc-number><date>20191212</date></priority-claim></priority-claims><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>B</section><class>60</class><subclass>L</subclass><main-group>58</main-group><subgroup>19</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>02</class><subclass>J</subclass><main-group>7</main-group><subgroup>00</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>B</section><class>60</class><subclass>L</subclass><main-group>58</main-group><subgroup>22</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>01</class><subclass>M</subclass><main-group>50</main-group><subgroup>204</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>01</class><subclass>M</subclass><main-group>10</main-group><subgroup>48</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>01</class><subclass>M</subclass><main-group>10</main-group><subgroup>42</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>01</class><subclass>M</subclass><main-group>50</main-group><subgroup>512</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>01</class><subclass>M</subclass><main-group>50</main-group><subgroup>51</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>01</class><subclass>M</subclass><main-group>50</main-group><subgroup>249</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>01</class><subclass>R</subclass><main-group>31</main-group><subgroup>3835</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20190201</date></cpc-version-indicator><section>B</section><class>60</class><subclass>L</subclass><main-group>58</main-group><subgroup>19</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc><further-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>02</class><subclass>J</subclass><main-group>7</main-group><subgroup>0013</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20200101</date></cpc-version-indicator><section>H</section><class>02</class><subclass>J</subclass><main-group>7</main-group><subgroup>007182</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20190201</date></cpc-version-indicator><section>B</section><class>60</class><subclass>L</subclass><main-group>58</main-group><subgroup>22</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20210101</date></cpc-version-indicator><section>H</section><class>01</class><subclass>M</subclass><main-group>50</main-group><subgroup>204</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>01</class><subclass>M</subclass><main-group>10</main-group><subgroup>482</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>01</class><subclass>M</subclass><main-group>10</main-group><subgroup>425</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20210101</date></cpc-version-indicator><section>H</section><class>01</class><subclass>M</subclass><main-group>50</main-group><subgroup>512</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20210101</date></cpc-version-indicator><section>H</section><class>01</class><subclass>M</subclass><main-group>50</main-group><subgroup>51</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20210101</date></cpc-version-indicator><section>H</section><class>01</class><subclass>M</subclass><main-group>50</main-group><subgroup>249</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20190101</date></cpc-version-indicator><section>G</section><class>01</class><subclass>R</subclass><main-group>31</main-group><subgroup>3835</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>02</class><subclass>J</subclass><main-group>7</main-group><subgroup>0019</subgroup><symbol-position>L</symbol-position><classification-value>A</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>01</class><subclass>M</subclass><main-group>2220</main-group><subgroup>20</subgroup><symbol-position>L</symbol-position><classification-value>A</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></further-cpc></classifications-cpc><invention-title id="d2e61">CONTROLLING A BATTERY MODULE COMPRISING A PLURALITY OF SWITCHED BATTERY CELL UNITS</invention-title><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>Scania CV AB</orgname><address><city>S&#xf6;dert&#xe4;lje</city><country>SE</country></address></addressbook><residence><country>SE</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>SV&#xc4;RD</last-name><first-name>Henrik</first-name><address><city>Saltsj&#xf6;-Boo</city><country>SE</country></address></addressbook></inventor></inventors></us-parties><assignees><assignee><addressbook><orgname>Scania CV AB</orgname><role>03</role><address><city>S&#xf6;dert&#xe4;lje</city><country>SE</country></address></addressbook></assignee></assignees><pct-or-regional-filing-data><document-id><country>WO</country><doc-number>PCT/SE2020/051176</doc-number><date>20201208</date></document-id><us-371c12-date><date>20220601</date></us-371c12-date></pct-or-regional-filing-data></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">A battery module comprising a plurality of battery cell units, each one comprising: a battery cell having a first pole and a second pole, and a switch circuit, comprising a plurality of switches, and a switch controller arranged to control the switches of the switch circuit to enter either of a first state, in which the battery cell is connected in parallel with a neighboring battery cell, and a second state, in which the battery cell is connected in series with a neighboring battery cell. The battery module is configured to control the switching between the first and second states on a probabilistic basis.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="142.41mm" wi="143.93mm" file="US20230001823A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="160.19mm" wi="145.97mm" file="US20230001823A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="111.34mm" wi="164.59mm" file="US20230001823A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="211.33mm" wi="102.19mm" orientation="landscape" file="US20230001823A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="146.81mm" wi="137.33mm" file="US20230001823A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00005" num="00005"><img id="EMI-D00005" he="200.41mm" wi="90.51mm" file="US20230001823A1-20230105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00006" num="00006"><img id="EMI-D00006" he="238.42mm" wi="104.65mm" file="US20230001823A1-20230105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="lead"?><heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATIONS</heading><p id="p-0002" num="0001">This application is a National Stage Patent Application (filed under 35 &#xa7; U.S.C. 371) of PCT/SE2020/051176, filed Dec. 8, 2020, of the same title, which, in turn claims priority to Swedish Patent Application No. 1951438-9 filed Dec. 12, 2019, of the same title; the contents of each of which are hereby incorporated by reference.</p><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="tail"?><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0002" level="1">FIELD OF THE INVENTION</heading><p id="p-0003" num="0002">The present invention relates to a method of controlling the output voltage of a battery module, said module comprising: a plurality of battery cell unit, each one comprising: a battery cell having a first pole and a second pole, and a switch circuit, comprising a plurality of switches, and a switch controller arranged to control the switches of the switch circuit to enter either of a first state and a second state.</p><p id="p-0004" num="0003">The invention also relates to such a battery module. If all the switch circuits are in the first state, the battery cell units will be connected in parallel, such that a minimum output voltage is obtained from the battery module, and if all switch circuits of the battery module are in the second state, the battery cell units will be connected in series, such that a maximum output voltage is obtained from the battery module. By controlling the switch circuits, it is thus possible to control to output voltage of the battery module to levels between the minimum and maximum output voltage.</p><heading id="h-0003" level="1">BACKGROUND OF THE INVENTION</heading><p id="p-0005" num="0004">In an electrical vehicle, energy is stored in a battery pack, consisting of one or more battery modules, each having a number of battery cells. The cells typically have a low voltage, in the order of a couple of Volts. The electric machines driving the vehicle typically need an alternating current, with a voltage in the order of hundreds of volts. The battery packs therefore contain hundreds of cells connected in series, to obtain the maximum voltage needed by the engine. To convert this high constant voltage to an alternating voltage of variable amplitude, a device called inverter is used. The inverter converts the constant voltage to an alternating, typically sinusoidal voltage, of variable amplitude.</p><p id="p-0006" num="0005">There are inefficiencies involved in the conversion by the inverter of the constant high voltage to a variable voltage. Therefore, one may propose a battery with internal switches, which connects and disconnects individual cells, in order to achieve an alternating voltage at the terminals of the battery pack. The switches must be controlled in some manner by a master controller, which decides what voltage is currently needed.</p><p id="p-0007" num="0006">Since the number of cells in a battery pack is large, in the order of hundreds, a very large number of switches need to be controlled, if each cell is to be switched on or off individually. The cells could be grouped together, with the groups switched on or off together, but this reduces the granularity of the possible output voltage of the battery. Also, to know which switch to switch on or off, the master controller must possess detailed knowledge of the layout of the battery pack, i.e. which cell is adjacent to which switch, etc.</p><p id="p-0008" num="0007">Another problem with the present technology is that the internal power losses of the battery are not minimized. Using a large battery pack of serially connected cells, the maximum output voltage is n*Ucell, where n is the number of cells, and Ucell is the voltage of each cell. If, for example, half of this maximum voltage is needed at some instance, the power lost due to internal resistance of the cells is (I){circumflex over (&#x2003;)}2*Rcell*n/2, where I is the current drawn from the battery pack, and Rcell is the internal resistance of a battery cell. However, if the battery pack had been arranged into two groups of equally many cells, the cells in each group were serially connected, and the two groups were connected in parallel, losses due to internal resistance were reduced to 2*(I/2){circumflex over (&#x2003;)}2*Rcell*n/2=(I/2){circumflex over (&#x2003;)}2*Rcell*n=&#xbc;*(I){circumflex over (&#x2003;)}2*Rcell*n. Thus, the internal losses were halved, by configuring the battery pack optimally for this specific output voltage.</p><p id="p-0009" num="0008">Another problem is battery pack balancing. If the cells of a battery pack are connected in series, there is a need to introduce extra circuits to transfer electrical charge between the cells, in order to balance the state of charge throughout the pack.</p><heading id="h-0004" level="1">SUMMARY OF THE INVENTION</heading><p id="p-0010" num="0009">It is an object of the present invention to propose a battery module and a method of controlling the output voltage of that battery module, which, with a minimal amount of communication, reconfigures the battery module to minimize the internal losses at every instant. It is also an object of the invention to present a battery module and a method for controlling the output voltage thereof that alleviate the need for balancing circuits, since the cells at certain points in time are connected in parallel, thereby facilitating automatic balancing.</p><p id="p-0011" num="0010">The objects of the invention are achieved by means of a method of controlling the output voltage of a battery module. The battery module comprises a plurality of battery cell units, each one comprising:<ul id="ul0001" list-style="none">    <li id="ul0001-0001" num="0011">a battery cell having a first pole and a second pole, and</li>    <li id="ul0001-0002" num="0012">a switch circuit, comprising</li>    <li id="ul0001-0003" num="0013">a first input connected to a first output via a first switch,</li>    <li id="ul0001-0004" num="0014">a second input connected to a second output via a second switch, and</li>    <li id="ul0001-0005" num="0015">a third switch, via which the second input is connected to the first output, wherein the first pole of the battery cell is connected to the first input and the second pole is connected to the second input.</li></ul></p><p id="p-0012" num="0016">The battery module further comprises a switch controller arranged to control the switches of the switch circuit to enter either of<ul id="ul0002" list-style="none">    <li id="ul0002-0001" num="0017">a first state in which the first input is connected to the first output, and the second input is connected to the second output, and the second input is disconnected from the first output, and</li>    <li id="ul0002-0002" num="0018">a second state in which the first input is disconnected from the first output, and the second input is disconnected from the second output and connected to the first output.</li></ul></p><p id="p-0013" num="0019">The method comprises the steps of:<ul id="ul0003" list-style="none">    <li id="ul0003-0001" num="0020">measuring an output voltage V of the battery module at one of the first and second outputs,</li>    <li id="ul0003-0002" num="0021">generating a differential value by measuring a difference between the measured output voltage V and a reference voltage Vref, said reference voltage Vref being within a range from a nominal minimum output voltage Vmin of the battery module to a nominal maximum output voltage Vmax of the battery module,</li>    <li id="ul0003-0003" num="0022">generating a probability value p on basis of the differential value, said probability value being proportional to an absolute value of the differential value, and being within an interval representing 0% to 100% probability,</li>    <li id="ul0003-0004" num="0023">generating a random number r, by means of a random number generator, within said interval,</li>    <li id="ul0003-0005" num="0024">comparing the probability value p with the random number r, and,    <ul id="ul0004" list-style="none">        <li id="ul0004-0001" num="0025">a) if the switch circuit is in the first state and V-Vref&#x3c;0, and p&#x3e;r, the state is changed to the second state, or,</li>        <li id="ul0004-0002" num="0026">b) if the switch circuit is in the second state and V-Vref&#x3e;0 and p&#x3e;r, the state is changed to the first state, or,</li>        <li id="ul0004-0003" num="0027">c) if p=0, and the switch circuit is in the first state or in the second state, the state is not changed.</li>    </ul>    </li></ul></p><p id="p-0014" num="0028">If p=r or p&#x3c;r, the state is not changed.</p><p id="p-0015" num="0029">The present invention proposes a layout of the battery module with switches, and a control strategy, which, with a minimal amount of communication, reconfigures the battery module to minimize the internal losses at every instant. The invention also alleviates the need for balancing circuits, since the cells at certain points in time are connected in parallel, facilitating automatic balancing. The proposed control strategy consists of a master controller, comprising the voltage regulator and the switch controller, which at each instance possesses knowledge of the necessary output voltage from the battery, i.e. the reference voltage. The master controller is able to broadcast a signal to all of the switches in the battery module. Note that the same signal is sent to all switches, hence only a single communication channel is needed.</p><p id="p-0016" num="0030">A characteristic of the invention is the probabilistic nature of the control of the switch circuits. The switch controllers receive a probability of changing their state, the probability value. Each switch controller, in combination with the random number generator, has a way of internally &#x201c;rolling a dice&#x201d;, to determine its action. This means that although each switch controller receives the same signal (probability value), the switches behave differently (depending on the number generated by the random number generator), an objective that would be more complicated to achieve if using a completely deterministic switch logic.</p><p id="p-0017" num="0031">The master controller measures the current output voltage, and compares it to the desired value, the reference voltage. If the output voltage is higher than the reference voltage, the voltage regulator outputs a differential value&#x3e;0, and if it is lower than the reference voltage, the voltage regulator outputs a differential value&#x3c;0. The specific choice of the value may be done in a number of ways, for example a standard proportional integral derivative (PID)-controller.</p><p id="p-0018" num="0032">The switches located between the battery cells receive a control signal (change state or remain), and update their state at some frequency, for example once every millisecond. All coordination is conducted through the control signal, which leads to the battery cells configuring themselves into parallel groups of serially coupled cells.</p><p id="p-0019" num="0033">Compared to a deterministic solution, which presumes that each battery cell has a predetermined voltage, the present probabilistic approach will automatically adapt the states of the switch circuits, and thus the output voltage to any unforeseen deviation in voltage (or charge) contribution of any of the battery cells. Since the control scheme for the switches has a random element, the resulting parallel groups are not constant, but vary over time, allowing different cells to equalize their charge with each other.</p><p id="p-0020" num="0034">Losses due to internal resistance are minimized, since the cells are constantly reconfigured into the optimal number of parallel groups.</p><p id="p-0021" num="0035">The master controller needs no knowledge of the internal configuration of the battery module, it only measures output voltage and sends a control signal accordingly. Hence, the concept is very modular, and it is possible for example to add or remove battery cells with corresponding switch units, with original functionality maintained.</p><p id="p-0022" num="0036">Only a single one-way communications channel is required from the master controller to the switches of the respective switch circuits.</p><p id="p-0023" num="0037">The probabilistic nature of the control system is essential. If all switch circuits reacted deterministically, then a certain control signal which made one switch circuit change its state, would also change the state of every other switch circuit, creating a too large step in output voltage. By the randomness of the control scheme, it is possible to change the state of only one (or possibly a couple) switch circuits at a time, keeping the possible overvoltage to within reasonable limits.</p><p id="p-0024" num="0038">According to one embodiment, the probability value p is proportional to the difference between the measured output voltage V and the reference voltage Vref. The nominal minimum and maximum output voltages set the limits of the differential value. The differential value is preferably multiplied with a factor that results in a suitable range for the probability value, for example such that the probability value may range from 0 to 100. The random number generator may then be configured to generate integers from 0 to 100. The voltage of each battery cell and the number of battery cells may also be taken into consideration when deciding which factor to use for the generation of the probability value on basis of the differential value.</p><p id="p-0025" num="0039">According to one embodiment,<ul id="ul0005" list-style="none">    <li id="ul0005-0001" num="0040">the nominal minimum voltage Vmin corresponds to a state in which all the battery cells of the battery module are connected in parallel with each other, and</li>    <li id="ul0005-0002" num="0041">the nominal maximum voltage Vmax, corresponds to a state in which all the battery cells of the battery module are connected in series with each other.</li></ul></p><p id="p-0026" num="0042">The method thereby comprises the steps of<ul id="ul0006" list-style="none">    <li id="ul0006-0001" num="0043">measuring a difference between the measured output voltage and the one of the nominal minimum voltage and the nominal maximum voltage that is closer to the reference voltage than to the measured output voltage</li>    <li id="ul0006-0002" num="0044">generating a modifying value, which is proportional to said measured difference, and</li>    <li id="ul0006-0003" num="0045">modifying the differential value on basis of the modifying value, wherein the probability value is generated on basis of said modified differential value.</li></ul></p><p id="p-0027" num="0046">Thereby, the probability value is modified in order to compensate for the number of battery cells (switch circuits) being in a specific state. If all battery cells are connected in parallel (first state), and an increased output voltage is requested, i.e. the reference voltage is higher than the nominal minimum output voltage, a lot of switch circuits could potentially switch to the second state. However, if all switch circuits but one or a few more ones are already in the second state, and an increased output voltage is requested, only said one or more switch circuits can accomplish this increase of the voltage output. Therefore, the probability for those one or more switch circuits to change state should be increased in order to have a quick response from the system and quickly reach the requested output voltage, i.e. the reference voltage. The system would function without this compensation but would be slower the closer to the minimum and maximum nominal output voltage that the reference voltage is.</p><p id="p-0028" num="0047">According to one embodiment, the modifying of the differential value comprises the step of dividing the differential value with the modifying value.</p><p id="p-0029" num="0048">According to one embodiment, the method comprises repeating the steps of the method with a predetermined frequency. The method is an iterative method of reaching a requested output voltage, i.e. the reference voltage. It is a matter of choice to select a suitable frequency. For example, the steps of the method may be repeated each microsecond.</p><p id="p-0030" num="0049">The objects of the invention are also achieved by means of a battery module for a vehicle, the battery module comprising a plurality of battery cell units. Each battery cell unit comprises:<ul id="ul0007" list-style="none">    <li id="ul0007-0001" num="0050">a battery cell having a first pole and a second pole, and</li>    <li id="ul0007-0002" num="0051">a switch circuit, comprising</li>    <li id="ul0007-0003" num="0052">a first input connected to a first output via a first switch,</li>    <li id="ul0007-0004" num="0053">a second input connected to a second output via a second switch, and</li>    <li id="ul0007-0005" num="0054">third switch, via which the second input is connected to the first output.</li></ul></p><p id="p-0031" num="0055">The first pole of the battery cell is connected to the first input and the second pole is connected to the second input.</p><p id="p-0032" num="0056">The battery module further comprises switch controller arranged to control the switches of the switch circuit to enter either of<ul id="ul0008" list-style="none">    <li id="ul0008-0001" num="0057">a first state in which the first input is connected to the first output, and the second input is connected to the second output, and the second input is disconnected from the first output, and</li>    <li id="ul0008-0002" num="0058">a second state in which the first input is disconnected from the first output, and the second input is disconnected from the second output and connected to the first output.</li></ul></p><p id="p-0033" num="0059">The switch controller comprises an input for receiving a probability signal that indicates a probability for the switch circuit to enter the first state or the second state.</p><p id="p-0034" num="0060">The battery module further comprises<ul id="ul0009" list-style="none">    <li id="ul0009-0001" num="0061">a voltage regulator configured to measure an output voltage at one of the first and second outputs, to compare the measured output voltage with a reference voltage, the reference voltage Vref being in a range from a nominal minimum output voltage Vmin of the battery module to a nominal maximum output voltage Vmax of the battery module, and the voltage regulator being configured to generate a differential value on basis of the comparison, and to generate a probability value on basis of the differential value, the probability value being proportional to an absolute value of the differential value, and being within an interval representing from 0% to a value corresponding to 100% probability, and transmit the probability value to the switch controller, and</li>    <li id="ul0009-0002" num="0062">a random number generator generating a random number r within the interval.</li></ul></p><p id="p-0035" num="0063">The switch controller is configured to receive the random number, comparing the probability value with the random number, and,<ul id="ul0010" list-style="none">    <li id="ul0010-0001" num="0000">    <ul id="ul0011" list-style="none">        <li id="ul0011-0001" num="0064">a) if the switch circuit is in the first state and V-Vref&#x3c;0, and p&#x3e;r, to change the state to the second state, or,</li>        <li id="ul0011-0002" num="0065">b) if the switch circuit is in the second state and V-Vref&#x3e;0 and p&#x3e;r, to change the state to the first state, or,</li>        <li id="ul0011-0003" num="0066">c) if p=0, and the switch circuit is in the first state or in the second state, the state is not changed.</li>    </ul>    </li></ul></p><p id="p-0036" num="0067">According to one embodiment, the probability value is proportional to the difference between the measured output voltage and the reference voltage.</p><p id="p-0037" num="0068">According to one embodiment, the method comprises that<ul id="ul0012" list-style="none">    <li id="ul0012-0001" num="0069">the nominal minimum voltage Vmin corresponds to a state in which all the battery cells of the battery module are connected in parallel with each other, and that</li>    <li id="ul0012-0002" num="0070">the nominal maximum voltage Vmax, corresponds to a state in which all the battery cells of the battery module are connected in series with each other, wherein the voltage regulator is configured to</li>    <li id="ul0012-0003" num="0071">measure a difference between the measured output voltage and the one of the nominal minimum voltage and the nominal maximum voltage that is closer to the reference voltage than to the measured output voltage</li>    <li id="ul0012-0004" num="0072">generate a modifying value, which is proportional to said measured difference, and</li>    <li id="ul0012-0005" num="0073">modify the differential value on basis of the modifying value, wherein the probability value is generated on basis of said modified differential value.</li></ul></p><p id="p-0038" num="0074">According to one embodiment, the voltage regulator comprises<ul id="ul0013" list-style="none">    <li id="ul0013-0001" num="0075">a first differential amplifier circuit configured to generate a differential signal which is proportional to the difference between the measured output voltage and the reference voltage, and</li>    <li id="ul0013-0002" num="0076">a modifying circuit which comprises</li>    <li id="ul0013-0003" num="0077">a second differential amplifier circuit.</li></ul></p><p id="p-0039" num="0078">The second differential amplifier circuit is configured to measure<ul id="ul0014" list-style="none">    <li id="ul0014-0001" num="0000">    <ul id="ul0015" list-style="none">        <li id="ul0015-0001" num="0079">a) the difference between a nominal maximum output voltage of the battery module and the measured output voltage for the case in which the reference voltage is higher than the measured output voltage and</li>        <li id="ul0015-0002" num="0080">b) the difference between a nominal minimum output voltage of the battery module and the measured output voltage for the case in which the reference voltage is lower than the nominal minimum output, and</li>        <li id="ul0015-0003" num="0081">configured to generate a modifying value which is proportional to the measured difference, and</li>    </ul>    </li>    <li id="ul0014-0002" num="0082">a divider configured to generate said modified differential value by dividing said differential value with the modifying value.</li></ul></p><p id="p-0040" num="0083">According to one embodiment, the battery module comprises a pole shifting arrangement.</p><p id="p-0041" num="0084">The invention also relates to a vehicle comprising a battery module according to the invention.</p><p id="p-0042" num="0085">According to one embodiment, energy for propulsion of the vehicle is electric energy stored in one or more batteries carried by the vehicle, the vehicle comprising at least one battery module according to the invention, and wherein an engine of the vehicle for the propulsion of the vehicle is an electric motor.</p><p id="p-0043" num="0086">The invention also relates to a computer program comprising a computer program code for causing a computer to implement a method according to the invention when the computer program is executed in the computer.</p><p id="p-0044" num="0087">The invention also relates to a computer program product comprising a non-transitory data storage medium which can be read by a computer and on which the program code of a computer program as disclosed hereinabove.</p><p id="p-0045" num="0088">The invention also relates to an electronic control arrangement of a motor vehicle comprising an execution means and a data storage medium which is connected to the execution means and on which the computer program code of a computer program product according to the invention is stored.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0005" level="1">BRIEF DESCRIPTION OF THE DRAWING</heading><p id="p-0046" num="0089"><figref idref="DRAWINGS">FIG. <b>1</b></figref> is a schematic representation of a part of a battery module according to the invention,</p><p id="p-0047" num="0090"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a detailed representation of an embodiment of a voltage regulator according to the present invention,</p><p id="p-0048" num="0091"><figref idref="DRAWINGS">FIG. <b>3</b></figref> is a representation of a battery module provided with a pole shifting arrangement,</p><p id="p-0049" num="0092"><figref idref="DRAWINGS">FIG. <b>4</b></figref>, is a schematic representation of a vehicle according to the invention,</p><p id="p-0050" num="0093"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is a flow scheme showing a first embodiment of the method of the present invention, and</p><p id="p-0051" num="0094"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is a flow scheme showing a second embodiment of the method of the present invention</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><heading id="h-0006" level="1">DETAILED DESCRIPTION OF EMBODIMENTS</heading><p id="p-0052" num="0095">Reference is made to <figref idref="DRAWINGS">FIG. <b>1</b></figref>, in which a first embodiment of a battery module according to the present invention is shown. Only a part of the module is shown, and it should be understood that the battery module may comprise a plurality of battery cell units like the one shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref>, connected to each other in accordance with the teaching of the invention and as indicated in, for example, <figref idref="DRAWINGS">FIG. <b>4</b></figref>.</p><p id="p-0053" num="0096">The battery module comprises a plurality of battery cell units <b>1</b>, each one comprising: a battery cell <b>2</b> having a first pole <b>3</b> and a second pole <b>4</b>, and a switch circuit <b>5</b>. The switch circuit <b>5</b> comprises a first input <b>6</b> connected to a first output <b>7</b> via a first switch <b>8</b>, a second input <b>9</b> connected to a second output <b>10</b> via a second switch <b>11</b>, and a third switch <b>12</b>, via which the second input <b>9</b> is connected to the first output <b>7</b>. The first pole <b>3</b> of the battery cell <b>2</b> is connected to the first input <b>6</b> and the second pole <b>4</b> is connected to the second input <b>9</b>.</p><p id="p-0054" num="0097">The battery module also comprises a switch controller <b>14</b> arranged to control the switches <b>8</b>, <b>11</b>, <b>12</b> of the switch circuit <b>5</b> to enter either of a first state in which the first input <b>6</b> is connected to the first output <b>7</b>, and the second input <b>9</b> is connected to the second output <b>10</b>, and the second input <b>9</b> is disconnected from the first output <b>7</b>, and a second state in which the first input <b>6</b> is disconnected from the first output <b>7</b>, and the second input <b>9</b> is disconnected from the second output <b>10</b> and connected to the first output <b>7</b>.</p><p id="p-0055" num="0098">The switch controller <b>14</b> comprises an input <b>15</b> for receiving a probability signal p that indicates a probability for the switch circuit <b>5</b> to enter the first state or the second state.</p><p id="p-0056" num="0099">The battery module further comprises a voltage regulator <b>16</b> configured to measure an output voltage V at one of the first and second outputs <b>7</b>, <b>10</b>, to compare the measured output voltage V with a reference voltage Vref. The reference voltage Vref is in a range from a nominal minimum output voltage Vmin of the battery module to a nominal maximum output voltage Vmax of the battery module. The voltage regulator <b>16</b> is configured to generate a differential value d on basis of said comparison, and to generate a probability value p on basis of the differential value d. The probability value p is proportional to an absolute value of the differential value d and is within an interval representing from 0 to a value corresponding to 100% probability. The voltage regulator <b>16</b> is configured to transmit the probability value p to the switch controller <b>14</b>.</p><p id="p-0057" num="0100">The battery module further comprises a random number generator <b>17</b> generating a random number r within said interval. The switch controller <b>14</b> is configured to receive the random number r, to compare the probability value p with the random number r, and,<ul id="ul0016" list-style="none">    <li id="ul0016-0001" num="0000">    <ul id="ul0017" list-style="none">        <li id="ul0017-0001" num="0101">a) if the switch circuit <b>5</b> is in the first state and V-Vref&#x3c;0, and p&#x3e;r, to change the state to the second state, or,</li>        <li id="ul0017-0002" num="0102">b) if the switch circuit <b>5</b> is in the second state and V-Vref&#x3e;0 and p&#x3e;r, to change the state to the first state, or,</li>        <li id="ul0017-0003" num="0103">c) if p=0, and the switch circuit <b>5</b> is in the first state or in the second state, not to change the state.</li>    </ul>    </li></ul></p><p id="p-0058" num="0104">The probability value p is proportional to the difference between the measured output voltage V and the reference voltage Vref.</p><p id="p-0059" num="0105">Reference is now made to <figref idref="DRAWINGS">FIG. <b>2</b></figref>, which shows a further developed embodiment of the voltage regulator. The nominal minimum voltage Vmin corresponds to a state in which all the battery cells <b>2</b> of the battery module are connected in parallel with each other. The nominal maximum voltage Vmax corresponds to a state in which all the battery cells of the battery module are connected in series with each other. The voltage regulator <b>16</b> is configured to measure a difference between the measured output voltage V and the one of the nominal minimum voltage Vmin and the nominal maximum voltage Vmax that is closer to the reference voltage Vref than to the measured output voltage V. The voltage generator <b>16</b> is also configured to generate a modifying value m, which is proportional to said measured difference. The voltage regulator is thereby configured to modify the differential value d on basis of the modifying value m, wherein the probability value p is generated on basis of the thus modified differential value dmod.</p><p id="p-0060" num="0106">The voltage regulator <b>16</b> comprises a first differential amplifier circuit <b>18</b> configured to generate a differential value d which is proportional to the difference between the measured output voltage V and the reference voltage Vref, and a modifying circuit <b>19</b>. The modifying circuit comprises a second differential amplifier circuit <b>20</b> which is configured to measure the difference between a nominal maximum output voltage Vmax of the battery module and the measured output voltage for the case in which the reference voltage Vref is higher than the measured output voltage and configured to generate a modifying value m which is proportional to the measured difference. This is the case shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>.</p><p id="p-0061" num="0107">The modifying circuit <b>20</b> is also configured to measure the difference between a nominal minimum output voltage of the battery module and the measured output voltage for the case in which the reference voltage is lower than the measured output voltage V and configured to generate a modifying value m which is proportional to the measured difference.</p><p id="p-0062" num="0108">The voltage regulator <b>16</b> further comprises a divider <b>21</b> configured to generate said modified differential value dmod by dividing said differential value d with the modifying value m.</p><p id="p-0063" num="0109">In <figref idref="DRAWINGS">FIG. <b>2</b></figref>, reference number <b>32</b> indicates a component in which the differential value d is multiplied with a factor K, preferably chosen with regard to the nominal maximum output voltage Vmax and the nominal minimum output voltage Vmin such that the differential value will have a value in the range of &#x2212;1 to 1. Reference number <b>33</b> indicates a component in which the modified differential value dmod is multiplied with a factor k, for example chosen on beforehand with regard to the possible upper and lower limits of the resulting product between the differential value d and the modifying value m such that the absolute value of the modified differential value dmod results in a probability value that is in a suitable range, for example the range from 0 to 100. The random number generator may then suitable be configured to generate an integer with the range of 0-100.</p><p id="p-0064" num="0110">The voltage regulator <b>16</b> does not necessarily have to include the modifying circuit <b>20</b>, but it should be understood that the inclusion of the modifying circuit results in a quicker response of the voltage regulator <b>16</b> as the reference voltage Vref and the output voltage V get closer to either of the nominal minimum voltage Vmin or the nominal maximum voltage Vmax.</p><p id="p-0065" num="0111">Reference is made to <figref idref="DRAWINGS">FIG. <b>3</b></figref>. The battery module may according to this embodiment comprise a pole-shifting arrangement. In the embodiment shown the pole-shifting arrangement comprises a pole-shifting control module <b>22</b> and controllable switches <b>23</b>, <b>24</b>, <b>25</b>, <b>26</b>, which are provided at opposite ends of the battery module and via which the battery module is connected to a load. By means of the pole-shifting arrangement, the battery module can deliver an alternating current to an AC motor. If no alternating current, AC, is required by the load connected to the battery module, the pole-shifting arrangement may be excluded.</p><p id="p-0066" num="0112">Reference is made to <figref idref="DRAWINGS">FIG. <b>4</b></figref>. The invention comprises a vehicle <b>27</b>, which comprises a battery module <b>28</b> according to the present invention, as disclosed hereinabove. Energy for propulsion of the vehicle <b>27</b> is electric energy stored in one or more batteries <b>29</b> carried by the vehicle <b>27</b> and comprising at least one battery module <b>28</b> according to embodiments of the present invention. An engine <b>30</b> of the vehicle <b>27</b> for the propulsion of the vehicle <b>27</b> is an electric motor, typically an AC motor.</p><p id="p-0067" num="0113">A method of controlling the output voltage of a battery module is according to one embodiment of the invention implemented by means of the battery module as disclosed hereinabove. The method, as shown in <figref idref="DRAWINGS">FIG. <b>5</b></figref>, thus includes the steps:<ul id="ul0018" list-style="none">    <li id="ul0018-0001" num="0000">    <ul id="ul0019" list-style="none">        <li id="ul0019-0001" num="0114">S<b>1</b>) measuring an output voltage V of the battery module at one of the first and second outputs <b>7</b>, <b>10</b>, generating a differential value d by measuring a difference between the measured output voltage V and a reference voltage Vref, said reference voltage Vref being within a range from a nominal minimum output voltage Vmin of the battery module to a nominal maximum output voltage Vmax of the battery module,</li>        <li id="ul0019-0002" num="0115">S<b>2</b>) generating a probability value p on basis of the differential value d, said probability value being proportional to an absolute value of the differential value d, and being within an interval representing 0% to 100% probability,</li>        <li id="ul0019-0003" num="0116">S<b>3</b>) generating a random number r, by means of a random number generator <b>17</b>, within said interval,</li>        <li id="ul0019-0004" num="0117">S<b>4</b>) comparing the probability value p with the random number r, and,</li>        <li id="ul0019-0005" num="0118">a) if the switch circuit <b>5</b> is in the first state and V-Vref&#x3c;0, and p&#x3e;r, the state is changed to the second state, or,</li>        <li id="ul0019-0006" num="0119">b) if the switch circuit <b>5</b> is in the second state and V-Vref&#x3e;0 and p&#x3e;r, the state is changed to the first state, or,</li>        <li id="ul0019-0007" num="0120">c) if p=0, and the switch circuit <b>5</b> is in the first state or in the second state, the state is not changed.</li>    </ul>    </li></ul></p><p id="p-0068" num="0121">Reference is made to <figref idref="DRAWINGS">FIG. <b>6</b></figref>. If the modifying circuit <b>20</b> is incorporated in the voltage regulator <b>16</b>, step S<b>2</b> of the method described above comprises the following steps:<ul id="ul0020" list-style="none">    <li id="ul0020-0001" num="0000">    <ul id="ul0021" list-style="none">        <li id="ul0021-0001" num="0122">S<b>2</b><i>a</i>) measuring a difference between the measured output voltage V and the one of the nominal minimum voltage Vmin and the nominal maximum voltage Vmax that is closer to the reference voltage than to the measured output voltage,</li>        <li id="ul0021-0002" num="0123">S<b>2</b><i>b</i>) generating a modifying value m, which is proportional to said measured difference, and</li>        <li id="ul0021-0003" num="0124">S<b>2</b><i>c</i>) modifying the differential value d on basis of the modifying value m, wherein the probability value is generated on basis of said modified differential value dmod.</li>    </ul>    </li></ul></p><p id="p-0069" num="0125">Above described method steps may according to embodiments of the invention be repeated with a predetermined frequency, for example each microsecond, in order to achieve an output voltage V which is equal to or as close as possible to the requested reference voltage Vref, which may change as a result of changing load. The voltage regulator, the switch controller and the random number generator are thus configured to perform said steps at said frequency.</p><p id="p-0070" num="0126">The invention also relates to a computer program comprising a computer program code for causing a computer to implement a method according to the invention when the computer program is executed in the computer.</p><p id="p-0071" num="0127">The invention also relates to a computer program product comprising a non-transitory data storage medium which can be read by a computer and on which the program code of a computer program as disclosed hereinabove.</p><p id="p-0072" num="0128">The vehicle <b>27</b> shown in <figref idref="DRAWINGS">FIG. <b>4</b></figref> comprises an electronic control arrangement <b>31</b> that comprises an execution means and a data storage medium which is connected to the execution means and on which the computer program code of a computer program according to the invention is stored.</p><?detailed-description description="Detailed Description" end="tail"?></description><claims id="claims"><claim id="CLM-00001" num="00001"><claim-text><b>1</b>. A method of controlling an output voltage of a battery module, said module comprising:<claim-text>a plurality of battery cell units, each battery cell unit comprising:<claim-text>a battery cell having a first pole and a second pole; and</claim-text><claim-text>a switch circuit, comprising:<claim-text>a first input connected to a first output via a first switch;</claim-text><claim-text>a second input connected to a second output via a second switch; and</claim-text><claim-text>a third switch, via which the second input is connected to the first output, wherein the first pole of the battery cell is connected to the first input and the second pole is connected to the second input;</claim-text></claim-text><claim-text>a switch controller arranged to control the switches of the switch circuit to enter either of:<claim-text>a first state in which the first input is connected to the first output, and the second input is connected to the second output, and the second input is disconnected from the first output; and</claim-text><claim-text>a second state in which the first input is disconnected from the first output, and the second input is disconnected from the second output and connected to the first output;</claim-text></claim-text></claim-text><claim-text>said method comprising the steps of:</claim-text><claim-text>measuring an output voltage V of the battery module at one of the first and second outputs;</claim-text><claim-text>generating a differential value d by measuring a difference between the measured output voltage V and a reference voltage Vref, said reference voltage Vref being within a range from a nominal minimum output voltage Vmin of the battery module to a nominal maximum output voltage Vmax of the battery module;</claim-text><claim-text>generating a probability value p on basis of the differential value d, said probability value being proportional to an absolute value of the differential value d, and being within an interval representing 0% to 100% probability;</claim-text><claim-text>generating a random number r, by means of a random number generator, within said interval;</claim-text><claim-text>comparing the probability value p with the random number r, and,<claim-text>a) if the switch circuit is in the first state and V-Vref&#x3c;0, and p&#x3e;r, the state is changed to the second state; or</claim-text><claim-text>b) if the switch circuit is in the second state and V-Vref&#x3e;0 and p&#x3e;r, the state is changed to the first state; or</claim-text><claim-text>c) if p=0, and the switch circuit is in the first state or in the second state, the state is not changed.</claim-text></claim-text></claim-text></claim><claim id="CLM-00002" num="00002"><claim-text><b>2</b>. A method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the probability value p is proportional to the difference between the measured output voltage V and the reference voltage Vref.</claim-text></claim><claim id="CLM-00003" num="00003"><claim-text><b>3</b>. A method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein<claim-text>the nominal minimum voltage Vmin corresponds to a state in which all the battery cells of the battery module are connected in parallel with each other, and that</claim-text><claim-text>the nominal maximum voltage Vmax, corresponds to a state in which all the battery cells of the battery module are connected in series with each other, and that the method comprises the steps of:<claim-text>measuring a difference between the measured output voltage and the one of the nominal minimum voltage and the nominal maximum voltage that is closer to the reference voltage than to the measured output voltage;</claim-text><claim-text>generating a modifying value m, which is proportional to said measured difference; and</claim-text><claim-text>modifying the differential value d on basis of the modifying value m, wherein the probability value is generated on basis of said modified differential value.</claim-text></claim-text></claim-text></claim><claim id="CLM-00004" num="00004"><claim-text><b>4</b>. A method according to <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein the modifying of the differential value d comprises the step of dividing the differential value d with the modifying value m.</claim-text></claim><claim id="CLM-00005" num="00005"><claim-text><b>5</b>. A method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising repeating the steps of the method with a predetermined frequency.</claim-text></claim><claim id="CLM-00006" num="00006"><claim-text><b>6</b>. A battery module for a vehicle, said battery module comprising:<claim-text>a plurality of battery cell units, each one comprising:<claim-text>a battery cell having a first pole and a second pole, and</claim-text><claim-text>a switch circuit, comprising:<claim-text>a first input connected to a first output via a first switch;</claim-text><claim-text>a second input connected to a second output via a second switch; and</claim-text><claim-text>a third switch, via which the second input is connected to the first output,</claim-text><claim-text>wherein the first pole of the battery cell is connected to the first input and the second pole is connected to the second input,</claim-text></claim-text><claim-text>a switch controller arranged to control the switches of the switch circuit to enter either of:<claim-text>a first state in which the first input is connected to the first output, and the second input is connected to the second output, and the second input is disconnected from the first output; and</claim-text><claim-text>a second state in which the first input is disconnected from the first output, and the second input is disconnected from the second output and connected to the first output,</claim-text><claim-text>wherein the switch controller comprises an input for receiving a probability signal that indicates a probability for the switch circuit to enter the first state or the second state;</claim-text></claim-text></claim-text><claim-text>a voltage regulator configured to measure an output voltage V at one of the first and second outputs, to compare the measured output voltage with a reference voltage Vref, said reference voltage Vref being in a range from a nominal minimum output voltage Vmin of the battery module to a nominal maximum output voltage Vmax of the battery module, and said voltage regulator being configured to generate a differential value d on basis of said comparison, and to generate a probability value p on basis of the differential value d, said probability value being proportional to an absolute value of the differential value d, and being within an interval representing from 0% to a value corresponding to 100% probability, and configured to transmit the probability value p to the switch controller, and</claim-text><claim-text>a random number generator configured to generate a random number r within said interval,</claim-text><claim-text>wherein the switch controller is configured to receive the random number r, and to compare the probability value p with the random number r, and,<claim-text>a) if the switch circuit is in the first state and V-Vref&#x3c;0, and p&#x3e;r, to change the state to the second state; or</claim-text><claim-text>b) if the switch circuit is in the second state and V-Vref&#x3e;0 and p&#x3e;r, to change the state to the first state; or</claim-text><claim-text>c) if p=0, and the switch circuit is in the first state or in the second state, the state is not changed.</claim-text></claim-text></claim-text></claim><claim id="CLM-00007" num="00007"><claim-text><b>7</b>. A battery module according to <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein the probability value p is proportional to the difference between the measured output voltage V and the reference voltage Vref.</claim-text></claim><claim id="CLM-00008" num="00008"><claim-text><b>8</b>. A battery module according to <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein<claim-text>the nominal minimum voltage Vmin corresponds to a state in which all the battery cells of the battery module are connected in parallel with each other, and</claim-text><claim-text>the nominal maximum voltage Vmax corresponds to a state in which all the battery cells of the battery module are connected in series with each other,</claim-text><claim-text>wherein the voltage regulator is configured to:<claim-text>measure a difference between the measured output voltage and the one of the nominal minimum voltage Vmin and the nominal maximum voltage Vmax that is closer to the reference voltage Vref than to the measured output voltage;</claim-text><claim-text>generate a modifying value m, which is proportional to said measured difference;</claim-text><claim-text>modify the differential value d on basis of the modifying value m, wherein the probability value p is generated on basis of said modified differential value dmod.</claim-text></claim-text></claim-text></claim><claim id="CLM-00009" num="00009"><claim-text><b>9</b>. A battery module according to <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein the voltage regulator comprises:<claim-text>a first differential amplifier circuit configured to generate a differential value d which is proportional to the difference between the measured output voltage V and the reference voltage Vref; and</claim-text><claim-text>a modifying circuit which comprises:<claim-text>a second differential amplifier circuit which is configured to measure:<claim-text>a) the difference between a nominal maximum output voltage of the battery module and the measured output voltage for the case in which the reference voltage is higher than the measured output voltage; and</claim-text><claim-text>b) the difference between a nominal minimum output voltage of the battery module and the measured output voltage for the case in which the reference voltage is lower than the measured output voltage, and</claim-text><claim-text>configured to generate a modifying value m which is proportional to the measured difference; and</claim-text></claim-text><claim-text>a divider configured to generate said modified differential value dmod by dividing said differential value d with the modifying value m.</claim-text></claim-text></claim-text></claim><claim id="CLM-00010" num="00010"><claim-text><b>10</b>. A battery module according to <claim-ref idref="CLM-00006">claim 6</claim-ref>, further comprising a pole shifting arrangement.</claim-text></claim><claim id="CLM-00011" num="00011"><claim-text><b>11</b>. A vehicle comprising a battery module comprising:<claim-text>a plurality of battery cell units, each one comprising:<claim-text>a battery cell having a first pole and a second pole, and</claim-text><claim-text>a switch circuit, comprising:<claim-text>a first input connected to a first output via a first switch;</claim-text><claim-text>a second input connected to a second output via a second switch; and</claim-text><claim-text>a third switch, via which the second input is connected to the first output,</claim-text><claim-text>wherein the first pole of the battery cell is connected to the first input and the second pole is connected to the second input,</claim-text></claim-text><claim-text>a switch controller arranged to control the switches of the switch circuit to enter either of:<claim-text>a first state in which the first input is connected to the first output, and the second input is connected to the second output, and the second input is disconnected from the first output; and</claim-text><claim-text>a second state in which the first input is disconnected from the first output, and the second input is disconnected from the second output and connected to the first output,</claim-text><claim-text>wherein the switch controller comprises an input for receiving a probability signal that indicates a probability for the switch circuit to enter the first state or the second state;</claim-text></claim-text></claim-text><claim-text>a voltage regulator configured to measure an output voltage V at one of the first and second outputs, to compare the measured output voltage with a reference voltage Vref, said reference voltage Vref being in a range from a nominal minimum output voltage Vmin of the battery module to a nominal maximum output voltage Vmax of the battery module, and said voltage regulator being configured to generate a differential value d on basis of said comparison, and to generate a probability value p on basis of the differential value d, said probability value being proportional to an absolute value of the differential value d, and being within an interval representing from 0% to a value corresponding to 100% probability, and configured to transmit the probability value p to the switch controller, and</claim-text><claim-text>a random number generator configured to generate a random number r within said interval</claim-text><claim-text>wherein the switch controller is configured to receive the random number r, and to compare the probability value p with the random number r, and,<claim-text>a) if the switch circuit is in the first state and V-Vref&#x3c;0, and p&#x3e;r, to change the state to the second state; or</claim-text><claim-text>b) if the switch circuit is in the second state and V-Vref&#x3e;0 and p&#x3e;r, to change the state to the first state; or</claim-text><claim-text>c) if p=0, and the switch circuit is in the first state or in the second state, the state is not changed.</claim-text></claim-text></claim-text></claim><claim id="CLM-00012" num="00012"><claim-text><b>12</b>. A vehicle according to <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein energy for propulsion of the vehicle is electric energy stored in one or more battery cell units of the at least one battery module, and wherein that an engine of the vehicle for the propulsion of the vehicle is an electric motor.</claim-text></claim><claim id="CLM-00013" num="00013"><claim-text><b>13</b>. (canceled)</claim-text></claim><claim id="CLM-00014" num="00014"><claim-text><b>14</b>. (canceled)</claim-text></claim><claim id="CLM-00015" num="00015"><claim-text><b>15</b>. An electronic control arrangement of a motor vehicle comprising:<claim-text>one or more controllers; and</claim-text><claim-text>a non-transitory data storage medium which is connected to the at least one controller and comprising program instructions stored thereon for controlling an output voltage of a battery module, said module comprising:</claim-text><claim-text>a plurality of battery cell units, each battery cell unit comprising:<claim-text>a battery cell having a first pole and a second pole; and</claim-text><claim-text>a switch circuit, comprising:<claim-text>a first input connected to a first output via a first switch;</claim-text><claim-text>a second input connected to a second output via a second switch; and</claim-text><claim-text>a third switch, via which the second input is connected to the first output, wherein the first pole of the battery cell is connected to the first input and the second pole is connected to the second input;</claim-text></claim-text><claim-text>a switch controller arranged to control the switches of the switch circuit to enter either of:</claim-text><claim-text>a first state in which the first input is connected to the first output, and the second input is connected to the second output, and the second input is disconnected from the first output; and</claim-text><claim-text>a second state in which the first input is disconnected from the first output, and the second input is disconnected from the second output and connected to the first output,</claim-text></claim-text><claim-text>wherein said computer program instructions configured to cause the one or more controllers to perform the following operations:</claim-text><claim-text>measure an output voltage V of the battery module at one of the first and second outputs;</claim-text><claim-text>generate a differential value d by measuring a difference between the measured output voltage V and a reference voltage Vref, said reference voltage Vref being within a range from a nominal minimum output voltage Vmin of the battery module to a nominal maximum output voltage Vmax of the battery module;</claim-text><claim-text>generate a probability value p on basis of the differential value d, said probability value being proportional to an absolute value of the differential value d, and being within an interval representing 0% to 100% probability;</claim-text><claim-text>generate a random number r, by means of a random number generator, within said interval;</claim-text><claim-text>compare the probability value p with the random number r, and,<claim-text>a) if the switch circuit is in the first state and V-Vref&#x3c;0, and p&#x3e;r, the state is changed to the second state; or</claim-text><claim-text>b) if the switch circuit is in the second state and V-Vref&#x3e;0 and p&#x3e;r, the state is changed to the first state; or</claim-text><claim-text>c) if p=0, and the switch circuit is in the first state or in the second state, the state is not changed.</claim-text></claim-text></claim-text></claim><claim id="CLM-00016" num="00016"><claim-text><b>16</b>. A non-transitory computer readable media comprising program instructions stored thereon for controlling an output voltage of a battery module, said module comprising:<claim-text>a plurality of battery cell units, each battery cell unit comprising:<claim-text>a battery cell having a first pole and a second pole; and</claim-text><claim-text>a switch circuit, comprising:<claim-text>a first input connected to a first output via a first switch;</claim-text><claim-text>a second input connected to a second output via a second switch; and</claim-text><claim-text>a third switch, via which the second input is connected to the first output, wherein the first pole of the battery cell is connected to the first input and the second pole is connected to the second input;</claim-text></claim-text><claim-text>a switch controller arranged to control the switches of the switch circuit to enter either of:<claim-text>a first state in which the first input is connected to the first output, and the second input is connected to the second output, and the second input is disconnected from the first output; and</claim-text><claim-text>a second state in which the first input is disconnected from the first output, and the second input is disconnected from the second output and connected to the first output,</claim-text></claim-text></claim-text><claim-text>wherein said computer program instructions configured to cause one or more controllers to perform the following operations:</claim-text><claim-text>measure an output voltage V of the battery module at one of the first and second outputs;</claim-text><claim-text>generate a differential value d by measuring a difference between the measured output voltage V and a reference voltage Vref, said reference voltage Vref being within a range from a nominal minimum output voltage Vmin of the battery module to a nominal maximum output voltage Vmax of the battery module;</claim-text><claim-text>generate a probability value p on basis of the differential value d, said probability value being proportional to an absolute value of the differential value d, and being within an interval representing 0% to 100% probability;</claim-text><claim-text>generate a random number r, by means of a random number generator, within said interval;</claim-text><claim-text>compare the probability value p with the random number r, and,<claim-text>a) if the switch circuit is in the first state and V-Vref&#x3c;0, and p&#x3e;r, the state is changed to the second state; or</claim-text><claim-text>b) if the switch circuit is in the second state and V-Vref&#x3e;0 and p&#x3e;r, the state is changed to the first state; or</claim-text><claim-text>c) if p=0, and the switch circuit is in the first state or in the second state, the state is not changed.</claim-text></claim-text></claim-text></claim></claims></us-patent-application>