<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230003806A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230003806</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17845500</doc-number><date>20220621</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><priority-claims><priority-claim sequence="01" kind="regional"><country>EP</country><doc-number>21181223.5</doc-number><date>20210623</date></priority-claim></priority-claims><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>01</class><subclass>R</subclass><main-group>31</main-group><subgroup>389</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>01</class><subclass>R</subclass><main-group>31</main-group><subgroup>3842</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>01</class><subclass>R</subclass><main-group>31</main-group><subgroup>367</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20190101</date></cpc-version-indicator><section>G</section><class>01</class><subclass>R</subclass><main-group>31</main-group><subgroup>389</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc><further-cpc><classification-cpc><cpc-version-indicator><date>20190101</date></cpc-version-indicator><section>G</section><class>01</class><subclass>R</subclass><main-group>31</main-group><subgroup>3842</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20190101</date></cpc-version-indicator><section>G</section><class>01</class><subclass>R</subclass><main-group>31</main-group><subgroup>367</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></further-cpc></classifications-cpc><invention-title id="d2e61">BATTERY IMPEDANCE ESTIMATION METHOD</invention-title><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="obligated-assignee"><addressbook><orgname>TWAICE Technologies GmbH</orgname><address><city>Munchen</city><country>DE</country></address></addressbook><residence><country>DE</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>KONDAVALASA</last-name><first-name>Saiveer Patnaik</first-name><address><city>W&#xfc;rzburg</city><country>DE</country></address></addressbook></inventor><inventor sequence="01" designation="us-only"><addressbook><last-name>ATUKALP</last-name><first-name>Devin</first-name><address><city>M&#xfc;nchen</city><country>DE</country></address></addressbook></inventor></inventors></us-parties></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">A method for estimating an impedance of a battery. The method includes the steps of: acquiring data of the battery during at least a predetermined time range, the data including at least a plurality of voltage measurements and a plurality of current measurements; determining a time window within the predetermined time range, the time window starting after a relaxed voltage interval and including a dynamic load interval, determining an initial voltage, the initial voltage being the voltage measurement at the start of the time window, determining a plurality of dynamic voltages based on the voltage measurements in the time window and the initial voltage, executing a subspace identification analysis based on the plurality of current measurements and on the plurality of dynamic voltages, and computing the impedance from an output of the subspace identification analysis.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="106.93mm" wi="59.61mm" file="US20230003806A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="223.69mm" wi="131.91mm" file="US20230003806A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="221.15mm" wi="146.73mm" orientation="landscape" file="US20230003806A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="241.05mm" wi="156.72mm" orientation="landscape" file="US20230003806A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="230.55mm" wi="107.61mm" file="US20230003806A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00005" num="00005"><img id="EMI-D00005" he="249.34mm" wi="141.48mm" file="US20230003806A1-20230105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00006" num="00006"><img id="EMI-D00006" he="249.17mm" wi="141.82mm" file="US20230003806A1-20230105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0001" level="1">RELATED APPLICATION DATA</heading><p id="p-0002" num="0001">This application claims the benefit of European Patent Application No. 21 181 223.5, filed Jun. 23, 2021, the disclosure of which is incorporated herein by reference in its entirety.</p><heading id="h-0002" level="1">TECHNICAL FIELD</heading><p id="p-0003" num="0002">The present invention relates to a method and an apparatus for estimating an impedance of a battery.</p><heading id="h-0003" level="1">BACKGROUND</heading><p id="p-0004" num="0003">Batteries are finding more and more applications in everyday use. To ensure that batteries are properly used, which is crucial in extracting the maximum performances and prolonging their life, battery analysis and management is becoming more and more crucial.</p><p id="p-0005" num="0004">A variety of battery parameters are used for battery analysis and management. Among them, the impedance of a battery has a relevant role due the following reasons.</p><p id="p-0006" num="0005">The impedance is used to determine the power capability of a battery. Moreover, batteries, particularly lithium-ion batteries, can be sensitive to overvoltage/undervoltage. The impedance value can be used to determine the maximum allowed current thus avoiding exceeding voltage limits. Additionally, batteries, particularly lithium-ion batteries, generally age over time. The impedance value is also a key indicator of the ageing of the battery. Furthermore, heat generation of batteries can be quantified using the impedance. Thermal management control can thus use knowledge of the impedance for more effective/efficient operation. Still further, in various advanced battery control systems, the impedance value is used in various model based estimations such as state-of-charge and state-of-energy, and predictions, such as EV range.</p><p id="p-0007" num="0006">The impedance value of a battery is thus of high relevance for an improved use and/or management of the battery. As this value changes over time, its measurement over time is usually also desired.</p><p id="p-0008" num="0007">Various manners are known in the art for measuring and/or estimating a battery impedance.</p><p id="p-0009" num="0008">The impedance can be determined before beginning of life. The simplest way is to have a static look-up table for impedance. The look-up table can be created using a characterization test at beginning of life of the battery. The impedance of similar batteries can then be estimated by means of the look-up table. As an extension, change of impedance over battery lifetime can be modelled using data collected in laboratory tests. In particular, tests can be carried out on a sample battery from begin of life to end of life in laboratory. The look-up table can then be extended to also take into account ageing.</p><p id="p-0010" num="0009">This approach has high cost due to extensive testing. Moreover, modelling the impedance throughout the lifetime of the battery is complex.</p><p id="p-0011" num="0010">An alternative manner for estimating the impedance can be based on measurements taken on the battery during operation. For instance, during the lifetime of the battery, operation of the battery can be periodically interrupted for diagnostics. During those interruption, a given current and/or voltage pulse is inputted to the battery and the respective voltage and/or current response is measured. In this manner, the DC resistance can be calculated. Similarly, an AC current and/or voltage can be inputted to the battery and its voltage and/or current response can be measured, so as to obtain the AC impedance. The AC frequency can be constant, such as with 1 kHz resistance measurement devices often employed by the automotive industry, or varying, such as with electrochemical impedance spectroscopy.</p><p id="p-0012" num="0011">This approach has the disadvantage that operation of the battery needs periodic interruption, which is usually not acceptable for the users. Moreover, it requires measurement equipment to be present at all time in connection with the battery, which increases costs. Furthermore the analysis of the data from such measurement equipment is often inaccurate due to ill-posed optimization and noisy data from sensors and requires a high computational effort.</p><p id="p-0013" num="0012">There is thus a need for a method for estimating battery impedance which can be implemented in a simple and/or cost-effective manner and provide reliable results.</p><heading id="h-0004" level="1">SUMMARY OF THE INVENTION</heading><p id="p-0014" num="0013">The present invention is generally based on the concept that the impedance of a battery can be measured from voltage and/or current measurement taken while the battery is being used. In particular, embodiments of the invention generally relate to how data from those measurements can be selected and manipulated so as to obtain an estimation of the impedance.</p><p id="p-0015" num="0014">The invention thus allows the impedance to be estimated without requiring extensive characterization of the battery and without interrupting operation of the battery. Moreover, as only voltage and/or current data are needed from the battery, the invention can be implemented in most systems comprising a battery, as most systems are provided with sensors measuring those values. Advantageously, the impedance can thus be estimated remotely, without having physical access to the battery.</p><p id="p-0016" num="0015">An aspect of the invention can in particular relate to a method for estimating an impedance of a battery, the method can comprise the steps of: acquiring data of the battery during at least a predetermined time range, the data comprising at least a plurality of voltage measurements and a plurality of current measurements, determining a time window within the predetermined time range, the time window starting after a relaxed voltage interval and comprising a dynamic load interval, determining an initial voltage, the initial voltage being the voltage measurement at the start of the time window, determining a plurality of dynamic voltages based on the voltage measurements in the time window and the initial voltage, executing a subspace identification analysis based on the plurality of current measurements and on the plurality of dynamic voltages, computing the impedance from an output of the subspace identification analysis.</p><p id="p-0017" num="0016">Thanks to this approach it is advantageously possible to decouple the dynamic component of the voltage measurements from the static component thereof. Thanks to this separation, the dynamic component can be inputted to a subspace identification analysis which can enable the computation of the battery impedance.</p><p id="p-0018" num="0017">In some cases, the time window can start immediately after an end of the relaxed voltage interval.</p><p id="p-0019" num="0018">Thanks to this approach it is advantageously possible to ensure that the open state of charge computed at the end of the relaxed voltage interval can correspond to the state of charge at the beginning of the time window.</p><p id="p-0020" num="0019">In some cases the time window can start within a predetermined time after an end of the relaxed voltage interval RVI.</p><p id="p-0021" num="0020">Thanks to this approach it is advantageously possible to ensure that the open state of charge computed at the end of the relaxed voltage interval can substantially correspond to the state of charge at the beginning of the time window.</p><p id="p-0022" num="0021">In some cases, the dynamic load interval can be a time interval during which the following condition apply: a value of an integral of an absolute value of the current measurements is within a predetermined range, preferably higher than 1% of the capacity of the battery, and/or preferably lower than 5% of the capacity of the battery, and/or even more preferably lower than 2.5% of the capacity of the battery.</p><p id="p-0023" num="0022">In some cases, the dynamic load interval can be a time interval during which the following condition apply: a difference of a maximum value of an integral of the current measurements during the time interval and a minimum value of the integral of the current measurements during the time interval is within a predetermined range, preferably higher than 2.5% and/or preferably lower than 5% of the battery cell capacity.</p><p id="p-0024" num="0023">Thanks to those approaches it is advantageously possible to contain the amount of charge/discharge of the battery during the dynamic load interval to a value which results in a reliable estimation of the battery impedance, while also ensuring a sufficient dynamic behaviour of the battery, which is helpful in correctly estimating the impedance.</p><p id="p-0025" num="0024">In some cases, the dynamic load interval can be a time interval during which the following condition apply: a value of statistical measure for dispersion of the current measurements, preferably the standard deviation of the current measurements, is higher than a predetermined value, preferably higher than 10% of the C-rate of the battery, even more preferably higher than 25% of the C-rate of the battery.</p><p id="p-0026" num="0025">In some cases, the dynamic load interval can be a time interval during which the following condition apply: an absolute value of a differential of the current measurements reaches a predetermined threshold, preferably higher than 1 C-rate/s.</p><p id="p-0027" num="0026">In some cases, the dynamic load interval can be a time interval during which the following condition apply: an absolute value of a differential of a moving average of the current measurements reaches a predetermined threshold, preferably higher than 1 C-rate/s.</p><p id="p-0028" num="0027">In some cases, the dynamic load interval can be a time interval during which the following condition apply: a Fourier transformation of the current measurements results in one or more frequency peaks other than at 0 Hz.</p><p id="p-0029" num="0028">Thanks to those approaches it is advantageously possible to ensure that a sufficient dynamic behaviour of the battery is part of the dynamic load interval.</p><p id="p-0030" num="0029">In some cases the dynamic load interval can have a duration of and/or at least 1 minute, preferably of and/or at least 5 minutes.</p><p id="p-0031" num="0030">In some cases, the battery can be modelled as having one or more RC elements, and the dynamic load interval can have a duration of and/or at least 1 time, preferably of and/or at least 5 times, the biggest of the one or more RC elements.</p><p id="p-0032" num="0031">Thanks to those approaches it is advantageously possible to ensure a length of the dynamic load interval which contains sufficient data for a reliable observation of the battery dynamics and thus for a reliable computation of the impedance.</p><p id="p-0033" num="0032">In some cases the step of determining the dynamic voltage can comprise the steps of: determining an estimated initial state of charge based on the initial voltage, the estimated initial state of charge being the estimated state of charge at the start of the time window, determining a plurality of estimated states of charge throughout the time window based on the estimated initial state of charge, determining a plurality of estimated open circuit voltages throughout the time window based on the estimated plurality of states of charge, determining the plurality of dynamic voltages as, at any given time throughout the time window, a difference between the voltage measurement and the respective estimated open circuit voltage at the given time.</p><p id="p-0034" num="0033">Thanks to this approach it is advantageously possible to track the static component of the voltage measurements throughout the time window so as to remove the static component from the voltage measurements, leaving the dynamic component for subsequent analysis.</p><p id="p-0035" num="0034">In some cases, the subspace identification analysis can be performed with the plurality of current measurements as input and the plurality of dynamic voltages as output.</p><p id="p-0036" num="0035">Thanks to this approach it is advantageously possible to create a state-space representation of the battery, from which the subspace identification analysis allows extraction of the impedance.</p><p id="p-0037" num="0036">In some cases, the subspace identification analysis can be based on a state-space representation of the type of</p><p id="p-0038" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>x</i><sub>k+1</sub><i>=Ax</i><sub>k</sub><i>+Bu</i><sub>k </sub><?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0039" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>y</i><sub>k+1</sub><i>=Cx</i><sub>k</sub><i>+Du</i><sub>k </sub><?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0040" num="0000">wherein<ul id="ul0001" list-style="none">    <li id="ul0001-0001" num="0000">    <ul id="ul0002" list-style="none">        <li id="ul0002-0001" num="0037">k represents a time instant of the time window,</li>        <li id="ul0002-0002" num="0038">k+1 represents a time instant subsequent to k,</li>        <li id="ul0002-0003" num="0039">x<sub>k </sub>represents a state vector at time k,</li>        <li id="ul0002-0004" num="0040">u<sub>k </sub>represents a current measurement at time k,</li>        <li id="ul0002-0005" num="0041">y<sub>k </sub>represents a value of the plurality of dynamic voltages at time k,</li>        <li id="ul0002-0006" num="0042">A represents a state transition matrix,</li>        <li id="ul0002-0007" num="0043">B represents a control input matrix,</li>        <li id="ul0002-0008" num="0044">C represents an output matrix,</li>        <li id="ul0002-0009" num="0045">D represents a feedthrough matrix.</li>    </ul>    </li></ul></p><p id="p-0041" num="0046">Thanks to this approach it is advantageously possible to easily and reliably create state-space representation of the battery.</p><p id="p-0042" num="0047">In some cases the step of executing a subspace identification analysis can comprise any of the steps of orthogonal projection of block Hankel matrix of the current measurements, orthogonal projection of block Hankel matrix of the dynamic voltages, oblique projection of the orthogonal projection of the block Hankel matrix of the current measurements, oblique projection of the orthogonal projection of the block Hankel matrix of the dynamic voltages.</p><p id="p-0043" num="0048">Thanks to this approach it is advantageously possible to project out noise from the states, through the orthogonal projection, and obtain a filtered observability matrix, through the oblique projection.</p><p id="p-0044" num="0049">In some cases the step of executing a subspace identification analysis can further comprise the step of singular vector decomposition to obtain the system matrix A.</p><p id="p-0045" num="0050">Thanks to this approach it is advantageously possible to extract the resistances and time constants from the system matrix A which allows computation of the impedance.</p><p id="p-0046" num="0051">A further aspect of the invention can relate to an apparatus for estimating an impedance of a battery, the apparatus comprising a memory and a processor, wherein the memory comprises instructions configured to, when executed, cause the processor to carry out any of the steps described.</p><p id="p-0047" num="0052">Thanks to this approach it is advantageously possible to implement the invention in form of hardware.</p><p id="p-0048" num="0053">In some cases, the apparatus can further comprise communication means for obtaining the plurality of voltage measurements and the plurality of current measurements.</p><p id="p-0049" num="0054">Thanks to this approach it is advantageously possible to remotely determine the impedance of the battery based on simple current and voltage measurements.</p><p id="p-0050" num="0055">A further aspect of the invention can relate to a software which, when executed on a processor, causes the processor to carry out any of the steps described.</p><p id="p-0051" num="0056">Thanks to this approach it is advantageously possible to provide the invention in form of software which can be executed independently on the location of the battery.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0005" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p-0052" num="0057">In the followings, aspects of the invention will be described with reference to the drawings, in which like reference numerals indicate like elements, and in which:</p><p id="p-0053" num="0058"><figref idref="DRAWINGS">FIG. <b>1</b></figref> schematically illustrates a method <b>1000</b> for estimating an impedance of a battery;</p><p id="p-0054" num="0059"><figref idref="DRAWINGS">FIG. <b>2</b></figref> schematically illustrates an apparatus <b>2000</b> for estimating an impedance of a battery;</p><p id="p-0055" num="0060"><figref idref="DRAWINGS">FIG. <b>3</b>A</figref> schematically illustrates an exemplary voltage measurement over time;</p><p id="p-0056" num="0061"><figref idref="DRAWINGS">FIG. <b>3</b>B</figref> schematically illustrates an exemplary current measurement over time;</p><p id="p-0057" num="0062"><figref idref="DRAWINGS">FIG. <b>4</b></figref> schematically illustrates a possible implementation of a dynamic voltage determination step S<b>4400</b>;</p><p id="p-0058" num="0063"><figref idref="DRAWINGS">FIG. <b>5</b></figref> schematically illustrates a possible implementation of a subspace identification analysis execution step S<b>5500</b>,</p><p id="p-0059" num="0064"><figref idref="DRAWINGS">FIG. <b>6</b>A</figref> schematically illustrates an exemplary state of charge over time;</p><p id="p-0060" num="0065"><figref idref="DRAWINGS">FIG. <b>6</b>B</figref> schematically illustrates an exemplary open circuit voltage over time;</p><p id="p-0061" num="0066"><figref idref="DRAWINGS">FIG. <b>7</b>A</figref> schematically illustrates an exemplary voltage measurement over time;</p><p id="p-0062" num="0067"><figref idref="DRAWINGS">FIG. <b>7</b>B</figref> schematically illustrates an exemplary dynamic voltage over time.</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><heading id="h-0006" level="1">DETAILED DESCRIPTION OF PREFERRED EMBODIMENTS</heading><p id="p-0063" num="0068">Some examples of the present disclosure generally provide for a plurality of circuits or other electrical devices. All references to the circuits and other electrical devices and the functionality provided by each are not intended to be limited to encompassing only what is illustrated and described herein. While particular labels may be assigned to the various circuits or other electrical devices disclosed, such labels are not intended to limit the scope of operation for the circuits and the other electrical devices. Such circuits and other electrical devices may be combined with each other and/or separated in any manner based on the particular type of electrical implementation that is desired. It is recognized that any circuit or other electrical device disclosed herein may include any number of microcontrollers, a graphics processor unit (GPU), integrated circuits, memory devices (e.g., FLASH, random access memory (RAM), read only memory (ROM), electrically programmable read only memory (EPROM), electrically erasable programmable read only memory (EEPROM), or other suitable variants thereof), and software which co-act with one another to perform operation(s) disclosed herein. In addition, any one or more of the electrical devices may be configured to execute a program code that is embodied in a non-transitory computer readable medium programmed to perform any number of the functions as disclosed.</p><p id="p-0064" num="0069">In the following, embodiments of the invention will be described in detail with reference to the accompanying drawings. It is to be understood that the following description of embodiments is not to be taken in a limiting sense. The scope of the invention is not intended to be limited by the embodiments described hereinafter or by the drawings, which are taken to be illustrative only.</p><p id="p-0065" num="0070">The drawings are to be regarded as being schematic representations and elements illustrated in the drawings are not necessarily shown to scale. Rather, the various elements are represented such that their function and general purpose become apparent to a person skilled in the art. Any connection or coupling between functional blocks, devices, components, or other physical or functional units shown in the drawings or described herein may also be implemented by an indirect connection or coupling. A coupling between components may also be established over a wireless connection. Functional blocks may be implemented in hardware, firmware, software, or a combination thereof.</p><p id="p-0066" num="0071"><figref idref="DRAWINGS">FIG. <b>1</b></figref> schematically illustrates a method <b>1000</b> for estimating an impedance of a battery B. The method comprises a step S<b>1100</b> of acquiring data of the battery B during at least a predetermined time range, the data comprising at least a plurality of voltage measurements and a plurality of current measurements. Example voltage measurements are visible in <figref idref="DRAWINGS">FIG. <b>3</b>A</figref> while example current measurements are visible in <figref idref="DRAWINGS">FIG. <b>3</b>B</figref>. In some embodiments, the measurements are preferably sampled with at least the Nyquist frequency of the respective signals.</p><p id="p-0067" num="0072">The method <b>1000</b> further comprises a step S<b>1200</b> of determining a time window W within the predetermined time range, the time window W starting after a relaxed voltage interval RVI of the battery and comprising a dynamic load interval DLI of the battery. In some preferred embodiments, the time window W starts immediately after an end of the relaxed voltage interval RVI. In other words, the end time of the relaxed voltage interval RVI can correspond to the start time of the time window W. In some preferred embodiments, the time window W starts within a predetermined time after an end of the relaxed voltage interval RVI. The predetermined time can preferably be less than 1 minute. Alternatively, or in addition, the predetermined time can be determined so that the state of charge of the battery does not significantly change during the predetermined time.</p><p id="p-0068" num="0073">In general, it will be clear that in general the dynamic load interval DLI can start at any point after a relaxed voltage interval RVI. The relaxed voltage interval RVI can be used to reliably measure the open circuit voltage and thus reliably derive a state of charge of the battery. The state of charge of can then be tracked for any amount of time, in particular at least until the beginning of relaxed voltage interval RVI, so as to provide an initial state of charge, and thus an initial open circuit voltage, of the relaxed voltage interval RVI. The choice of a relaxed voltage interval RVI close, or immediately after, a relaxed voltage interval RVI provides at least the advantage that the tracking of the state of charge can be reduced or avoided entirely.</p><p id="p-0069" num="0074">The relaxed voltage interval RVI is generally a time interval in which the battery is not under significant charge and/or discharge, as known to the skilled person, preferably under no charge and/or discharge, even more preferably for a time sufficient for the open circuit voltage to stabilize. In some embodiments, the relaxed voltage interval RVI can thus be determined to be a time interval during which the voltage is stable within a predetermined range, for at least a predetermined time duration. Alternatively, or in addition, in some embodiments, the relaxed voltage interval RVI can be determined to be a time interval during which the absolute value of the current is lower than a predetermined threshold, for at least a predetermined time duration. In preferred embodiments, the time interval can be at least 1 minute, preferably at least 5 minutes and/or the</p><p id="p-0070" num="0075">The dynamic load interval DLI is generally a time interval comprising charging and/or discharging of the battery, preferably both charging and discharging. In some embodiments, the dynamic load interval DLI can thus be determined to be a time interval during which the voltage is varying outside of a predetermined range, for at least a predetermined time duration. Alternatively, or in addition, in some embodiments, the dynamic load interval DLI can be determined to be a time interval during which the absolute value of the current is higher than a predetermined threshold, for at least a predetermined time duration. It will be appreciated that the numerical values for those ranges, thresholds and time durations are dependent on the characteristics of the battery, such as technology, capacity, voltage and maximum rated output current, and it will be clear to the skilled person how to identify a relaxed voltage interval RLG and a dynamic load interval DLI for a given specific battery.</p><p id="p-0071" num="0076">In some embodiments, the dynamic load interval DLI can be defined as a time interval during which one or more of the following conditions apply.</p><p id="p-0072" num="0077">One condition for identifying the dynamic load interval DLI can be if a value of an integral of an absolute value of the current measurements I is within a predetermined range. That is, an absolute value of the current measurements I can be integrated over the time interval and, if the result is within a predetermined range, the time interval can be considered to be a dynamic load interval DLI. In some embodiments, the predetermined range can be higher than 1% of the capacity of the battery B, and/or preferably lower than 5% of the capacity of the battery B, and/or even more preferably lower than 2.5% of the capacity of the battery B.</p><p id="p-0073" num="0078">Thanks to the upper limitation on the integral of the absolute value of the current measurements I, it can be advantageously ensured that the variation of open circuit voltage, throughout the dynamic load interval DLI, is contained.</p><p id="p-0074" num="0079">One further condition for identifying the dynamic load interval DLI can be if a difference of a maximum value of an integral of the current measurements I during the time interval and a minimum value of the integral of the current measurements I during the time interval is within a predetermined range. That is, the current measurements I can be integrated throughout the time interval, and the integral will assume different values throughout the time interval, among which a minimum and a maximum one. In some embodiments, the predetermined range is preferably higher than 2.5% and/or preferably lower than 5% of the battery cell capacity.</p><p id="p-0075" num="0080">One further condition for identifying the dynamic load interval DLI can be if a value of statistical measure for dispersion of the current measurements I, preferably the standard deviation of the current measurements I, is higher than a predetermined value. In some embodiments, the predetermined value can be preferably higher than 10% of the C-rate of the battery, even more preferably higher than 25% of the C-rate of the battery.</p><p id="p-0076" num="0081">One further condition for identifying the dynamic load interval DLI can be if an absolute value of a differential of the current measurements I reaches a predetermined threshold. In some embodiments, the predetermined threshold can preferably be higher than 1 C-rate/s.</p><p id="p-0077" num="0082">One further condition for identifying the dynamic load interval DLI can be if an absolute value of a differential of a moving average of the current measurements I reaches a predetermined threshold. In some embodiments, the predetermined threshold can preferably be higher than 1 C-rate/s.</p><p id="p-0078" num="0083">One further condition for identifying the dynamic load interval DLI can be if a Fourier transformation of the current measurements I results in one or more frequency peaks other than at 0 Hz.</p><p id="p-0079" num="0084">Alternatively, or in addition, in some embodiments the dynamic load interval DLI can be defined as a time interval having a duration which can be of and/or at least 1 minute, preferably of and/or at least 5 minutes. That is, in some embodiments this can be considered to be a complete duration for the dynamic load interval DLI, while in some other embodiments, this can be considered to be minimum duration for the dynamic load interval DLI.</p><p id="p-0080" num="0085">Still alternatively, or in addition, in some embodiments the dynamic load interval DLI can be defined as a time interval having a minimum duration which depends on the RC values associated to the impedance of the battery. In particular, the battery B can be modelled as having one or more RC elements, as will be described more in details in the following, and the dynamic load interval DLI can have a duration of and/or at least 1, preferably of and/or at least 5, times the biggest of the one or more RC elements. That is, in some embodiments this can be considered to be a complete duration for the dynamic load interval DLI, while in some other embodiments, this can be considered to be minimum duration for the dynamic load interval DLI. As exemplary time window W from time T<b>1</b> to time T<b>2</b> is illustrated, for instance, in both <figref idref="DRAWINGS">FIGS. <b>3</b>A and <b>3</b>B</figref>.</p><p id="p-0081" num="0086">As it can be seen in <figref idref="DRAWINGS">FIG. <b>3</b>A</figref>, the relaxed voltage interval RVI is visible by the voltage signal V remaining substantially stable for a time interval prior to T<b>1</b>, roughly from 8.6&#xd7;10{circumflex over (&#x2003;)}<sup>4 </sup>seconds to 8.62&#xd7;10<o ostyle="single">&#x2003;</o><sup>4 </sup>seconds which, for the battery under consideration, is sufficient to determine a relaxed voltage condition. Alternatively, or in addition, as visible in <figref idref="DRAWINGS">FIG. <b>3</b>B</figref>, the relaxed voltage interval RVI can be identified by the current signal I remaining substantially at 0 for a time interval prior to T<b>1</b>, roughly from 8.6&#xd7;10{circumflex over (&#x2003;)}<sup>4 </sup>seconds to 8.62&#xd7;10{circumflex over (&#x2003;)}4 seconds which, for the battery under consideration, is sufficient to determine a relaxed voltage condition.</p><p id="p-0082" num="0087">Similarly, as it can be seen in <figref idref="DRAWINGS">FIG. <b>3</b>A</figref>, the dynamic load interval DLI is visible by the voltage signal V varying outside of a predetermined range after T<b>1</b>, roughly from 8.62&#xd7;10{circumflex over (&#x2003;)}<sup>4 </sup>seconds onward. Alternatively, or in addition, as visible in <figref idref="DRAWINGS">FIG. <b>3</b>B</figref>, the dynamic load interval DLI can be identified by the current signal I complying with one or more of the criteria previously indicated.</p><p id="p-0083" num="0088">As will become clear from the following description, the identification of a time window W starting after a relaxed voltage interval RVI of the battery B and comprising an appropriate dynamic load interval DLI of the battery B allows the dynamic component of the signals from the dynamic load interval DLI, in particular of the voltage V, to be separated from their static component.</p><p id="p-0084" num="0089">In particular, the battery voltage V contains both a dynamic component, also known as over potential, or dynamic voltage, and a static component, also known as open circuit voltage, or static voltage. For reasons which will become clearer in the following, it is advantageous to remove the static component so as to allow the method <b>1000</b> to estimate the dynamic component. By choosing a time window W starting after a relaxed voltage interval RVI, it is possible to estimate and/or measure the static component, that is, the open circuit voltage, at the beginning of the window W and easily remove the static component from the voltage measurements V, as will be described more in details in the following description.</p><p id="p-0085" num="0090">Moreover, for the execution of method <b>1000</b> it is advantageous to have an initial estimate of the dynamic component, that is, of the over potentials. By choosing a window W starting at the end of a relaxed voltage interval RVI, those estimates can be approximated to zero, which allows a simplified estimate procedure.</p><p id="p-0086" num="0091">It is thus clear that the selection of the time window W based on the one or more described criteria allows data to be extracted in a particularly advantageous manner, which then allows those data to be used in a subspace identification analysis for determining the battery impedance.</p><p id="p-0087" num="0092">The method <b>1000</b> further comprises a step S<b>1300</b> determining an initial voltage, the initial voltage being the voltage measurement V at the start of the time window W. In some embodiments, particularly when the time window W is close to the end of the relaxed voltage interval RVI, the initial voltage can also correspond to the voltage measurement V at the end of the relaxed voltage interval RVI, or to an average of the voltage measurements V during the relaxed voltage interval RVI, or more generally to an open circuit voltage based on the voltage measurement V during the relaxed voltage interval RVI.</p><p id="p-0088" num="0093">The method <b>1000</b> further comprises a step S<b>1400</b> of determining a plurality of dynamic voltages based on the voltage measurements V in the time window W and the initial voltage. Generally, as will become clearer from the following, knowledge of the initial voltage allows the determination of the dynamic component of the voltage throughout the time window W.</p><p id="p-0089" num="0094">In particular, in preferred embodiments as illustrated in <figref idref="DRAWINGS">FIG. <b>4</b></figref>, the step S<b>4400</b> could implement the step S<b>1400</b> of determining the dynamic voltage and can comprise a step S<b>4410</b> of determining an estimated initial state of charge based on the initial voltage, the estimated initial state of charge being the estimated state of charge at the start of the time window W. It will be clear to those skilled in the art that a plurality of manners are known for determining an estimated state of charge based on a voltage value. For instance, a look-up table could be used, linking the open circuit voltage and the estimated state of charge.</p><p id="p-0090" num="0095">An exemplary execution of the method on the exemplary current measurements I and voltage measurements V of <figref idref="DRAWINGS">FIGS. <b>3</b>A and <b>3</b>B</figref> can, for instance, result in an initial voltage of approximately 4,072V which, for the exemplary battery under consideration, corresponds to an estimated initial state of charge of approximately 86.4%.</p><p id="p-0091" num="0096">The step S<b>4400</b> could further comprise a step S<b>4420</b> of determining a plurality of estimated states of charge throughout the time window W based on the estimated initial state of charge. Also in this case, it will be clear to those skilled in the art that a plurality of approaches are known for estimating the evolution of the state of charge of a battery based on a known initial state of charge. For instance, the estimated of charge at any given time throughout the time window can be obtained by adding the integral value of the current measurement I to the initial state of charge.</p><p id="p-0092" num="0097">Referring back to the exemplary execution indicated above, <figref idref="DRAWINGS">FIG. <b>6</b>A</figref> shows an exemplary evolution of the estimated states of charge throughout the time window W. In this example, the estimated states of charge substantially decrease throughout the time window W.</p><p id="p-0093" num="0098">The step S<b>4400</b> could further comprise a step S<b>4430</b> of determining a plurality of estimated open circuit voltages throughout the time window W based on the estimated plurality of states of charge. As previously discussed, various manners such as a look-up table could be implemented for the conversion.</p><p id="p-0094" num="0099">Referring back to the exemplary execution indicated above, <figref idref="DRAWINGS">FIG. <b>6</b>B</figref> shows an exemplary evolution of the estimated open circuit voltages throughout the time window W.</p><p id="p-0095" num="0100">The step S<b>4400</b> could then further comprise a step S<b>4440</b> of determining the plurality of dynamic voltages as, at any given time throughout the time window W, a difference between the voltage measurement V and the respective estimated open circuit voltage at the given time. In this manner, at any given time, the static component of the voltage measurement V is removed from the voltage measurement V thus leaving only the dynamic component.</p><p id="p-0096" num="0101">Referring back to the exemplary execution indicated above, <figref idref="DRAWINGS">FIG. <b>7</b>A</figref> shows an enlarged portion of the voltage measurements of the time window W, approximately from 8,615&#xd7;10{circumflex over (&#x2003;)}<sup>4 </sup>seconds to 8,645&#xd7;10{circumflex over (&#x2003;)}<sup>4 </sup>seconds.</p><p id="p-0097" num="0102">Similarly, <figref idref="DRAWINGS">FIG. <b>7</b>B</figref> shows the dynamic voltage during the time window, obtained by the difference between the voltage measurements V and the static component, that is, the estimated open circuit voltages.</p><p id="p-0098" num="0103">With this approach it is thus possible to extract the dynamic component from the respective voltage measurements V at any point in time of the time window W with a simple and reliable manner. It will however be clear that alternative manners could be implemented for extracting the dynamic component from the respective voltage measurements V and the invention is not to be limited to the specific implementation illustrated in <figref idref="DRAWINGS">FIG. <b>4</b></figref>. In general, the purpose of step S<b>1400</b> is to obtain a plurality of dynamic voltages, that is, the dynamic component of the voltage measurements V, throughout the time window W based on the knowledge of the initial voltage.</p><p id="p-0099" num="0104">Alternatively, in some embodiments, the open circuit voltage throughout the dynamic load interval DLI can be alternatively considered to be substantially constant, particularly if the dynamic load interval DLI is selected so that the integral of the absolute value of the current measurements during the dynamic load interval DLI is lower than a predetermined threshold. This approach has the advantage that it is not necessary to determine a plurality of open circuit voltages throughout the dynamic load interval DLI but a single value can be used, thus simplifying the method.</p><p id="p-0100" num="0105">The method <b>1000</b> further comprises a step S<b>1500</b> of executing a subspace identification analysis based on the plurality of current measurements I and on the plurality of dynamic voltages.</p><p id="p-0101" num="0106">Subspace identification analysis are known manners for, knowing various measurements of a given system, at various time instants, determining a state of variables of the system which cannot be directly measured. In the case of the method <b>1000</b>, in general, the subspace identification analysis can be used to determine the value of the impedance of the battery B based on the plurality of current measurements I and on the plurality of dynamic voltages. In particular, in preferred embodiments, the subspace identification analysis can be performed with the plurality of current measurements I as input and the plurality of dynamic voltages as output.</p><p id="p-0102" num="0107">Various techniques are known for performing a subspace identification analysis. For explanatory purposes, in the following one possible implementation will be described. It will however be clear that the invention is not limited thereto.</p><p id="p-0103" num="0108">In some preferred embodiments, the subspace identification analysis can be based on a state-space representation of the type of</p><p id="p-0104" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>x</i><sub>k+1</sub><i>=Ax</i><sub>k</sub><i>+Bu</i><sub>k </sub><?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0105" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>y</i><sub>k+1</sub><i>=Cx</i><sub>k</sub><i>+Du</i><sub>k </sub><?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0106" num="0109">wherein<ul id="ul0003" list-style="none">    <li id="ul0003-0001" num="0000">    <ul id="ul0004" list-style="none">        <li id="ul0004-0001" num="0110">k represents a time instant of the time window W,</li>        <li id="ul0004-0002" num="0111">k+1 represents a time instant subsequent to k, in some embodiments, the distance in time between k and k+1 can correspond to the distance in time between sampling points for the current measurements I and/or for the voltage measurements V</li>        <li id="ul0004-0003" num="0112">x<sub>k </sub>represents a state vector at time k,</li>        <li id="ul0004-0004" num="0113">u<sub>k </sub>represents a current measurement I, at time k,</li>        <li id="ul0004-0005" num="0114">y<sub>k </sub>represents a value of the plurality of dynamic voltages, at time k,</li>        <li id="ul0004-0006" num="0115">A represents a state transition matrix, also known as system matrix,</li>        <li id="ul0004-0007" num="0116">B represents a control input matrix, which can comprise the plurality of current measurements (I),</li>        <li id="ul0004-0008" num="0117">C represents an output matrix, which can comprise the plurality of dynamic voltages,</li>        <li id="ul0004-0009" num="0118">D represents a feedthrough matrix</li>    </ul>    </li></ul></p><p id="p-0107" num="0119">In the following, an example using this implementation with N indicating the total number of data points in the time window W will be discussed.</p><p id="p-0108" num="0120">The state vector x can be expressed as a matrix have one column and a number of rows which depends on the number P of RC elements, or poles, of the battery B. That is, the impedance of the battery B can be described by a function having a number of poles P, or an equivalent RC circuit, having a number P of RC elements. In some embodiments, the number of poles P is at least 1, preferably 2, even more preferably 3. With a generic number of poles P, the state vector x can be described as:</p><p id="p-0109" num="0000"><maths id="MATH-US-00001" num="00001"><math overflow="scroll"> <mrow>  <mi>x</mi>  <mo>=</mo>  <mrow>   <mo>[</mo>   <mtable>    <mtr>     <mtd>      <msub>       <mi>V</mi>       <mrow>        <mi>RC</mi>        <mo>&#x2062;</mo>        <mn>1</mn>       </mrow>      </msub>     </mtd>    </mtr>    <mtr>     <mtd>      <mo>&#x2026;</mo>     </mtd>    </mtr>    <mtr>     <mtd>      <msub>       <mi>V</mi>       <mi>RCP</mi>      </msub>     </mtd>    </mtr>   </mtable>   <mo>]</mo>  </mrow> </mrow></math></maths></p><p id="p-0110" num="0121">Each rows in the state vector x can comprise the dynamic potential of the given RC element. For instance, in case of a battery B modelled by a function having has two poles, the state vector can be expressed as</p><p id="p-0111" num="0000"><maths id="MATH-US-00002" num="00002"><math overflow="scroll"> <mrow>  <mi>x</mi>  <mo>=</mo>  <mrow>   <mo>[</mo>   <mtable>    <mtr>     <mtd>      <msub>       <mi>V</mi>       <mrow>        <mi>RC</mi>        <mo>&#x2062;</mo>        <mn>1</mn>       </mrow>      </msub>     </mtd>    </mtr>    <mtr>     <mtd>      <msub>       <mi>V</mi>       <mrow>        <mi>RC</mi>        <mo>&#x2062;</mo>        <mn>2</mn>       </mrow>      </msub>     </mtd>    </mtr>   </mtable>   <mo>]</mo>  </mrow> </mrow></math></maths></p><p id="p-0112" num="0122">where V<sub>RC1 </sub>corresponds to the dynamic potential of a first RC element and V<sub>RC2 </sub>corresponds to the dynamic potential of a second RC element.</p><p id="p-0113" num="0123">The state transition matrix A can be a diagonal matrix with a number of rows equal to the number of poles P. The diagonal elements represents the time constant of the respective RC element.</p><p id="p-0114" num="0000"><maths id="MATH-US-00003" num="00003"><math overflow="scroll"> <mrow>  <mi>A</mi>  <mo>=</mo>  <mrow>   <mo>[</mo>   <mtable>    <mtr>     <mtd>           </mtd>     <mtd>      <mo>&#x2026;</mo>     </mtd>     <mtd>      <mn>0</mn>     </mtd>    </mtr>    <mtr>     <mtd>      <mo>&#x2026;</mo>     </mtd>     <mtd>      <mo>&#x2026;</mo>     </mtd>     <mtd>      <mo>&#x2026;</mo>     </mtd>    </mtr>    <mtr>     <mtd>      <mn>0</mn>     </mtd>     <mtd>      <mo>&#x2026;</mo>     </mtd>     <mtd>           </mtd>    </mtr>   </mtable>   <mo>]</mo>  </mrow> </mrow></math></maths></p><p id="p-0115" num="0124">where <img id="CUSTOM-CHARACTER-00001" he="2.79mm" wi="1.78mm" file="US20230003806A1-20230105-P00001.TIF" alt="custom-character" img-content="character" img-format="tif"/><b>1</b> corresponds to the time constant of the first RC element and <img id="CUSTOM-CHARACTER-00002" he="2.79mm" wi="1.78mm" file="US20230003806A1-20230105-P00001.TIF" alt="custom-character" img-content="character" img-format="tif"/>P corresponds to the time constant of the P<sup>th </sup>RC element and where t indicates time, preferably the amount of time between two consecutive sampled points in the time window W.</p><p id="p-0116" num="0125">For instance, for a two pole system A can be expressed as:</p><p id="p-0117" num="0000"><maths id="MATH-US-00004" num="00004"><math overflow="scroll"> <mrow>  <mi>A</mi>  <mo>=</mo>  <mrow>   <mo>[</mo>   <mtable>    <mtr>     <mtd>           </mtd>     <mtd>      <mn>0</mn>     </mtd>    </mtr>    <mtr>     <mtd>      <mn>0</mn>     </mtd>     <mtd>           </mtd>    </mtr>   </mtable>   <mo>]</mo>  </mrow> </mrow></math></maths></p><p id="p-0118" num="0126">The control input matrix B can then be expressed as a matrix having one column and P rows:</p><p id="p-0119" num="0000"><maths id="MATH-US-00005" num="00005"><math overflow="scroll"> <mrow>  <mi>B</mi>  <mo>=</mo>  <mrow>   <mo>[</mo>   <mtable>    <mtr>     <mtd>      <mrow>       <mrow>        <mi>R</mi>        <mo>&#x2062;</mo>        <mn>1</mn>       </mrow>       <mo>&#x22c6;</mo>       <mrow>        <mo>(</mo>        <mrow>         <mn>1</mn>         <mo>-</mo>                 </mrow>        <mo>)</mo>       </mrow>      </mrow>     </mtd>    </mtr>    <mtr>     <mtd>      <mo>&#x2026;</mo>     </mtd>    </mtr>    <mtr>     <mtd>      <mrow>       <mrow>        <mi>R</mi>        <mo>&#x2062;</mo>        <mn>2</mn>       </mrow>       <mo>&#x22c6;</mo>       <mrow>        <mo>(</mo>        <mrow>         <mn>1</mn>         <mo>-</mo>                 </mrow>        <mo>)</mo>       </mrow>      </mrow>     </mtd>    </mtr>   </mtable>   <mo>]</mo>  </mrow> </mrow></math></maths></p><p id="p-0120" num="0127">where R1&#x2212;RP represent the resistance of the respective RC elements. For instance, for a two pole system B can be expressed as:</p><p id="p-0121" num="0000"><maths id="MATH-US-00006" num="00006"><math overflow="scroll"> <mrow>  <mi>B</mi>  <mo>=</mo>  <mrow>   <mo>[</mo>   <mtable>    <mtr>     <mtd>      <mrow>       <mrow>        <mi>R</mi>        <mo>&#x2062;</mo>        <mn>1</mn>       </mrow>       <mo>&#x22c6;</mo>       <mrow>        <mo>(</mo>        <mrow>         <mn>1</mn>         <mo>-</mo>                 </mrow>        <mo>)</mo>       </mrow>      </mrow>     </mtd>    </mtr>    <mtr>     <mtd>      <mo>&#x2026;</mo>     </mtd>    </mtr>    <mtr>     <mtd>      <mrow>       <mrow>        <mi>R</mi>        <mo>&#x2062;</mo>        <mn>2</mn>       </mrow>       <mo>&#x22c6;</mo>       <mrow>        <mo>(</mo>        <mrow>         <mn>1</mn>         <mo>-</mo>                 </mrow>        <mo>)</mo>       </mrow>      </mrow>     </mtd>    </mtr>   </mtable>   <mo>]</mo>  </mrow> </mrow></math></maths></p><p id="p-0122" num="0128">The output matrix C can be expressed as a matrix having one row and P columns, where each element of the matrix is substantially equal to 1. For instance, for a two pole system C can be expressed as:</p><p id="p-0123" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>C</i>=[1 1]<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0124" num="0129">and the feedthrough matrix D can be expressed as</p><p id="p-0125" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>D=R</i><sub>0 </sub><?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0126" num="0130">where R<sub>0 </sub>can be referred to as ohmic resistance. Thanks to this configuration it is possible to extract the value of the impedance of the battery B.</p><p id="p-0127" num="0131">More specifically, for a generic data point k, the generic state space equation can be repeated for the next samples to get the output equation form as:</p><p id="p-0128" num="0000"><maths id="MATH-US-00007" num="00007"><math overflow="scroll"> <mrow>  <mrow>   <mo>[</mo>   <mtable>    <mtr>     <mtd>      <mrow>       <mi>y</mi>       <mo>[</mo>       <mi>k</mi>       <mo>]</mo>      </mrow>     </mtd>    </mtr>    <mtr>     <mtd>      <mrow>       <mi>y</mi>       <mo>[</mo>       <mrow>        <mi>k</mi>        <mo>+</mo>        <mn>1</mn>       </mrow>       <mo>]</mo>      </mrow>     </mtd>    </mtr>    <mtr>     <mtd>      <mo>&#x22ee;</mo>     </mtd>    </mtr>    <mtr>     <mtd>      <mrow>       <mi>y</mi>       <mo>[</mo>       <mrow>        <mi>k</mi>        <mo>+</mo>        <mi>i</mi>        <mo>-</mo>        <mn>1</mn>       </mrow>       <mo>]</mo>      </mrow>     </mtd>    </mtr>   </mtable>   <mo>]</mo>  </mrow>  <mo>=</mo>  <mrow>   <mrow>    <munder>     <munder>      <mrow>       <mo>[</mo>       <mtable>        <mtr>         <mtd>          <mi>C</mi>         </mtd>        </mtr>        <mtr>         <mtd>          <mrow>           <mi>C</mi>           <mo>&#x22c6;</mo>           <mi>A</mi>          </mrow>         </mtd>        </mtr>        <mtr>         <mtd>          <mo>&#x22ee;</mo>         </mtd>        </mtr>        <mtr>         <mtd>          <mrow>           <mi>C</mi>           <mo>&#x22c6;</mo>           <msup>            <mi>A</mi>            <mrow>             <mi>i</mi>             <mo>-</mo>             <mn>1</mn>            </mrow>           </msup>          </mrow>         </mtd>        </mtr>       </mtable>       <mo>]</mo>      </mrow>      <mo>&#xfe38;</mo>     </munder>     <msub>      <mi>O</mi>      <mi>i</mi>     </msub>    </munder>    <mo>&#x22c6;</mo>    <mrow>     <mi>x</mi>     <mo>[</mo>     <mi>k</mi>     <mo>]</mo>    </mrow>   </mrow>   <mo>+</mo>   <mrow>    <munder>     <munder>      <mrow>       <mo>[</mo>       <mtable>        <mtr>         <mtd>          <mi>D</mi>         </mtd>         <mtd>          <mtext> </mtext>         </mtd>         <mtd>          <mtext> </mtext>         </mtd>         <mtd>          <mtext> </mtext>         </mtd>        </mtr>        <mtr>         <mtd>          <mi>CB</mi>         </mtd>         <mtd>          <mi>D</mi>         </mtd>         <mtd>          <mtext> </mtext>         </mtd>         <mtd>          <mtext> </mtext>         </mtd>        </mtr>        <mtr>         <mtd>          <mo>&#x22ee;</mo>         </mtd>         <mtd>          <mo>&#x22f1;</mo>         </mtd>         <mtd>          <mo>&#x22f1;</mo>         </mtd>         <mtd>          <mtext> </mtext>         </mtd>        </mtr>        <mtr>         <mtd>          <mrow>           <msup>            <mi>CA</mi>            <mrow>             <mi>i</mi>             <mo>-</mo>             <mn>2</mn>            </mrow>           </msup>           <mo>&#x2062;</mo>           <mi>B</mi>          </mrow>         </mtd>         <mtd>          <mo>&#x2026;</mo>         </mtd>         <mtd>          <mi>CB</mi>         </mtd>         <mtd>          <mi>D</mi>         </mtd>        </mtr>       </mtable>       <mo>]</mo>      </mrow>      <mo>&#xfe38;</mo>     </munder>     <msub>      <mi>&#x3c8;</mi>      <mi>i</mi>     </msub>    </munder>    <mo>&#x22c6;</mo>    <mrow>     <mo>[</mo>     <mtable>      <mtr>       <mtd>        <mrow>         <mi>u</mi>         <mo>[</mo>         <mi>k</mi>         <mo>]</mo>        </mrow>       </mtd>      </mtr>      <mtr>       <mtd>        <mrow>         <mi>u</mi>         <mo>[</mo>         <mrow>          <mi>k</mi>          <mo>+</mo>          <mn>1</mn>         </mrow>         <mo>]</mo>        </mrow>       </mtd>      </mtr>      <mtr>       <mtd>        <mo>&#x22ee;</mo>       </mtd>      </mtr>      <mtr>       <mtd>        <mrow>         <mi>u</mi>         <mo>[</mo>         <mrow>          <mi>k</mi>          <mo>+</mo>          <mi>i</mi>          <mo>-</mo>          <mn>1</mn>         </mrow>         <mo>]</mo>        </mrow>       </mtd>      </mtr>     </mtable>     <mo>]</mo>    </mrow>   </mrow>  </mrow> </mrow></math></maths></p><p id="p-0129" num="0132">where O<sub>i </sub>is referred to as the observability matrix.</p><p id="p-0130" num="0133">Also, for a generic data point k, the generic state equation can be rewritten as:</p><p id="p-0131" num="0000"><maths id="MATH-US-00008" num="00008"><math overflow="scroll"> <mrow>  <mrow>   <mi>x</mi>   <mo>[</mo>   <mi>k</mi>   <mo>]</mo>  </mrow>  <mo>=</mo>  <mrow>   <mrow>    <msup>     <mi>A</mi>     <mi>i</mi>    </msup>    <mo>*</mo>    <mrow>     <mi>x</mi>     <mo>[</mo>     <mrow>      <mi>k</mi>      <mo>-</mo>      <mi>i</mi>     </mrow>     <mo>]</mo>    </mrow>   </mrow>   <mo>+</mo>   <mrow>    <munder>     <munder>      <mrow>       <mo>[</mo>       <mrow>        <mrow>         <mrow>          <msup>           <mi>A</mi>           <mrow>            <mi>i</mi>            <mo>-</mo>            <mn>1</mn>           </mrow>          </msup>          <mo>*</mo>          <mi>B</mi>         </mrow>         <mtext>&#x205f;  </mtext>         <mo>...</mo>        </mrow>        <mo>&#x2062;</mo>        <mtext>   &#x205f;</mtext>        <msup>         <mi>A</mi>         <mn>2</mn>        </msup>        <mo>&#x2062;</mo>        <mi>B</mi>        <mo>&#x2062;</mo>        <mtext>&#x205f;  </mtext>        <mi>AB</mi>        <mo>&#x2062;</mo>        <mtext>&#x205f;  </mtext>        <mi>B</mi>       </mrow>       <mo>]</mo>      </mrow>      <mo>&#xfe38;</mo>     </munder>     <msub>      <mrow>              <mtext> </mtext>      </mrow>      <mrow>       <mtext>  </mtext>       <mi>i</mi>      </mrow>     </msub>    </munder>    <mo>*</mo>    <mrow>     <mo>[</mo>     <mtable>      <mtr>       <mtd>        <mrow>         <mi>u</mi>         <mo>[</mo>         <mrow>          <mi>k</mi>          <mo>-</mo>          <mi>i</mi>         </mrow>         <mo>]</mo>        </mrow>       </mtd>      </mtr>      <mtr>       <mtd>        <mo>&#x22ee;</mo>       </mtd>      </mtr>      <mtr>       <mtd>        <mrow>         <mi>u</mi>         <mo>[</mo>         <mi>k</mi>         <mo>]</mo>        </mrow>       </mtd>      </mtr>     </mtable>     <mo>]</mo>    </mrow>   </mrow>  </mrow> </mrow></math></maths></p><p id="p-0132" num="0134">where <img id="CUSTOM-CHARACTER-00003" he="2.46mm" wi="2.12mm" file="US20230003806A1-20230105-P00002.TIF" alt="custom-character" img-content="character" img-format="tif"/><sub>i </sub>is referred to as the reverse controllability matrix.</p><p id="p-0133" num="0135">The two equations above, involving the observability matrix O<sub>i </sub>and the reverse controllability matrix <img id="CUSTOM-CHARACTER-00004" he="2.46mm" wi="2.12mm" file="US20230003806A1-20230105-P00002.TIF" alt="custom-character" img-content="character" img-format="tif"/>i form the base for the subspace identification method.</p><p id="p-0134" num="0136">In general, subspace identification methods use the above equations and operate geometric transformations on the Henkel matrices to obtain the value of the battery impedance. More specifically, various subspace identification methods are known by the skilled person and can be implemented for obtaining the impedance value.</p><p id="p-0135" num="0137">Preferably, subspace identification methods defined for a combination of stochastic and deterministic system can be used. One example implementation can be found for instance in chapter 6.1 of &#x201c;<i>Subspace Identification for Linear Systems Theory&#x2014;Implementation&#x2014;Applications</i>&#x201d; Peter Van Overschee/Bart De Moor, for instance in page 169 of the publication year 1996.</p><p id="p-0136" num="0138">The method <b>1000</b> can then further comprises a step S<b>1600</b> of computing the impedance from an output of the subspace identification analysis.</p><p id="p-0137" num="0139">More specifically, the step S<b>1600</b> can compute the eigenvector of the state transition matrix A and thus obtain the time constants (<img id="CUSTOM-CHARACTER-00005" he="2.79mm" wi="1.78mm" file="US20230003806A1-20230105-P00001.TIF" alt="custom-character" img-content="character" img-format="tif"/><b>1</b>&#x2212;<img id="CUSTOM-CHARACTER-00006" he="2.79mm" wi="1.78mm" file="US20230003806A1-20230105-P00001.TIF" alt="custom-character" img-content="character" img-format="tif"/>P) of the RC elements of the battery B. The remaining unknown in the state equation found in the B matrix, namely R1&#x2212;RP, can then be computed by solving the state equation using linear algebra.</p><p id="p-0138" num="0140">Moreover, in some preferred embodiments, the subspace identification analysis can comprise steps S<b>5510</b> and S<b>5520</b> of orthogonal projection of respectively block Hankel matrix of the current measurements I acquired at step S<b>1100</b> and of the dynamic voltages obtained from step S<b>1400</b>, S<b>4400</b>. The orthogonal projection advantageously allows noise to be projected out from the states.</p><p id="p-0139" num="0141">In particular, the input Hankel matrix of the current measurements I can be defined as:</p><p id="p-0140" num="0000"><maths id="MATH-US-00009" num="00009"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <msub>      <mi>U</mi>      <mrow>       <mrow>        <mn>0</mn>        <mo>|</mo>        <mn>2</mn>        <mo>&#x2062;</mo>        <mi>i</mi>       </mrow>       <mo>-</mo>       <mn>1</mn>      </mrow>     </msub>     <mo>=</mo>     <malignmark/>     <mrow>      <mo>[</mo>      <mtable>       <mtr>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mn>0</mn>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mn>1</mn>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mo>&#x2026;</mo>        </mtd>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mrow>           <mi>M</mi>           <mo>-</mo>           <mn>1</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>       </mtr>       <mtr>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mn>1</mn>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mn>2</mn>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mo>&#x2026;</mo>        </mtd>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mi>M</mi>          <mo>]</mo>         </mrow>        </mtd>       </mtr>       <mtr>        <mtd>         <mo>&#x22ee;</mo>        </mtd>        <mtd>         <mo>&#x22ee;</mo>        </mtd>        <mtd>         <mo>&#x22ee;</mo>        </mtd>        <mtd>         <mo>&#x22ee;</mo>        </mtd>       </mtr>       <mtr>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mrow>           <mi>i</mi>           <mo>-</mo>           <mn>1</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mi>i</mi>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mo>&#x2026;</mo>        </mtd>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mrow>           <mi>i</mi>           <mo>+</mo>           <mi>M</mi>           <mo>-</mo>           <mn>2</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>       </mtr>       <mtr>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mi>i</mi>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mrow>           <mi>i</mi>           <mo>+</mo>           <mn>1</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mo>&#x2026;</mo>        </mtd>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mrow>           <mi>i</mi>           <mo>+</mo>           <mi>M</mi>           <mo>-</mo>           <mn>1</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>       </mtr>       <mtr>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mrow>           <mi>i</mi>           <mo>+</mo>           <mn>1</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mrow>           <mi>i</mi>           <mo>+</mo>           <mn>2</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mo>&#x2026;</mo>        </mtd>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mrow>           <mi>i</mi>           <mo>+</mo>           <mi>M</mi>          </mrow>          <mo>]</mo>         </mrow>        </mtd>       </mtr>       <mtr>        <mtd>         <mo>&#x22ee;</mo>        </mtd>        <mtd>         <mo>&#x22ee;</mo>        </mtd>        <mtd>         <mo>&#x22ee;</mo>        </mtd>        <mtd>         <mo>&#x22ee;</mo>        </mtd>       </mtr>       <mtr>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mrow>           <mrow>            <mn>2</mn>            <mo>&#x22c6;</mo>            <mi>i</mi>           </mrow>           <mo>-</mo>           <mn>1</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mrow>           <mn>2</mn>           <mo>&#x22c6;</mo>           <mi>i</mi>          </mrow>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mo>&#x2026;</mo>        </mtd>        <mtd>         <mrow>          <mi>u</mi>          <mo>[</mo>          <mrow>           <mrow>            <mn>2</mn>            <mo>&#x22c6;</mo>            <mi>i</mi>           </mrow>           <mo>+</mo>           <mi>M</mi>           <mo>-</mo>           <mn>2</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>       </mtr>      </mtable>      <mo>]</mo>     </mrow>    </mrow>   </mtd>  </mtr>  <mtr>   <mtd>    <mrow>     <mo>=</mo>     <malignmark/>     <mrow>      <mo>[</mo>      <mtable>       <mtr>        <mtd>         <msub>          <mi>U</mi>          <mrow>           <mtext> </mtext>           <mrow>            <mrow>             <mn>0</mn>             <mo>|</mo>             <mi>i</mi>            </mrow>            <mo>-</mo>            <mn>1</mn>           </mrow>          </mrow>         </msub>        </mtd>       </mtr>       <mtr>        <mtd>         <msub>          <mi>U</mi>          <mrow>           <mtext> </mtext>           <mrow>            <mrow>             <mi>i</mi>             <mo>|</mo>             <mn>2</mn>             <mo>&#x2062;</mo>             <mi>i</mi>            </mrow>            <mo>-</mo>            <mn>1</mn>           </mrow>          </mrow>         </msub>        </mtd>       </mtr>      </mtable>      <mo>]</mo>     </mrow>    </mrow>   </mtd>  </mtr>  <mtr>   <mtd>    <mrow>     <mo>=</mo>     <malignmark/>     <mrow>      <mo>[</mo>      <mtable>       <mtr>        <mtd>         <msub>          <mi>U</mi>          <mi>p</mi>         </msub>        </mtd>       </mtr>       <mtr>        <mtd>         <msub>          <mi>U</mi>          <mi>f</mi>         </msub>        </mtd>       </mtr>      </mtable>      <mo>]</mo>     </mrow>    </mrow>   </mtd>  </mtr> </mtable></math></maths></p><p id="p-0141" num="0142">where;<ul id="ul0005" list-style="none">    <li id="ul0005-0001" num="0000">    <ul id="ul0006" list-style="none">        <li id="ul0006-0001" num="0143">i is a value greater than P, preferably i=2*P, or greater, where P is the number of poles of the battery B as previously described,</li>        <li id="ul0006-0002" num="0144">N is the total number of data points in the window</li>        <li id="ul0006-0003" num="0145">M=N+1&#x2212;(2*i)</li>    </ul>    </li></ul></p><p id="p-0142" num="0146">Similarly, the output Hankel matrix of the dynamic voltages V can be defined as:</p><p id="p-0143" num="0000"><maths id="MATH-US-00010" num="00010"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <msub>      <mi>Y</mi>      <mrow>       <mrow>        <mn>0</mn>        <mo>|</mo>        <mn>2</mn>        <mo>&#x2062;</mo>        <mi>i</mi>       </mrow>       <mo>-</mo>       <mn>1</mn>      </mrow>     </msub>     <mo>=</mo>     <malignmark/>     <mrow>      <mo>[</mo>      <mtable>       <mtr>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mn>0</mn>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mn>1</mn>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mo>&#x2026;</mo>        </mtd>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mrow>           <mi>M</mi>           <mo>-</mo>           <mn>1</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>       </mtr>       <mtr>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mn>1</mn>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mn>2</mn>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mo>&#x2026;</mo>        </mtd>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mi>M</mi>          <mo>]</mo>         </mrow>        </mtd>       </mtr>       <mtr>        <mtd>         <mo>&#x22ee;</mo>        </mtd>        <mtd>         <mo>&#x22ee;</mo>        </mtd>        <mtd>         <mo>&#x22ee;</mo>        </mtd>        <mtd>         <mo>&#x22ee;</mo>        </mtd>       </mtr>       <mtr>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mrow>           <mi>i</mi>           <mo>-</mo>           <mn>1</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mi>i</mi>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mo>&#x2026;</mo>        </mtd>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mrow>           <mi>i</mi>           <mo>+</mo>           <mi>M</mi>           <mo>-</mo>           <mn>2</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>       </mtr>       <mtr>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mi>i</mi>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mrow>           <mi>i</mi>           <mo>+</mo>           <mn>1</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mo>&#x2026;</mo>        </mtd>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mrow>           <mi>i</mi>           <mo>+</mo>           <mi>M</mi>           <mo>-</mo>           <mn>1</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>       </mtr>       <mtr>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mrow>           <mi>i</mi>           <mo>+</mo>           <mn>1</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mrow>           <mi>i</mi>           <mo>+</mo>           <mn>2</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mo>&#x2026;</mo>        </mtd>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mrow>           <mi>i</mi>           <mo>+</mo>           <mi>M</mi>          </mrow>          <mo>]</mo>         </mrow>        </mtd>       </mtr>       <mtr>        <mtd>         <mo>&#x22ee;</mo>        </mtd>        <mtd>         <mo>&#x22ee;</mo>        </mtd>        <mtd>         <mo>&#x22ee;</mo>        </mtd>        <mtd>         <mo>&#x22ee;</mo>        </mtd>       </mtr>       <mtr>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mrow>           <mrow>            <mn>2</mn>            <mo>&#x22c6;</mo>            <mi>i</mi>           </mrow>           <mo>-</mo>           <mn>1</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mrow>           <mn>2</mn>           <mo>&#x22c6;</mo>           <mi>i</mi>          </mrow>          <mo>]</mo>         </mrow>        </mtd>        <mtd>         <mo>&#x2026;</mo>        </mtd>        <mtd>         <mrow>          <mi>y</mi>          <mo>[</mo>          <mrow>           <mrow>            <mn>2</mn>            <mo>&#x22c6;</mo>            <mi>i</mi>           </mrow>           <mo>+</mo>           <mi>M</mi>           <mo>-</mo>           <mn>2</mn>          </mrow>          <mo>]</mo>         </mrow>        </mtd>       </mtr>      </mtable>      <mo>]</mo>     </mrow>    </mrow>   </mtd>  </mtr>  <mtr>   <mtd>    <mrow>     <mo>=</mo>     <malignmark/>     <mrow>      <mo>[</mo>      <mtable>       <mtr>        <mtd>         <msub>          <mi>Y</mi>          <mrow>           <mtext> </mtext>           <mrow>            <mrow>             <mn>0</mn>             <mo>|</mo>             <mi>i</mi>            </mrow>            <mo>-</mo>            <mn>1</mn>           </mrow>          </mrow>         </msub>        </mtd>       </mtr>       <mtr>        <mtd>         <msub>          <mi>Y</mi>          <mrow>           <mtext> </mtext>           <mrow>            <mrow>             <mi>i</mi>             <mo>|</mo>             <mn>2</mn>             <mo>&#x2062;</mo>             <mi>i</mi>            </mrow>            <mo>-</mo>            <mn>1</mn>           </mrow>          </mrow>         </msub>        </mtd>       </mtr>      </mtable>      <mo>]</mo>     </mrow>    </mrow>   </mtd>  </mtr>  <mtr>   <mtd>    <mrow>     <mo>=</mo>     <malignmark/>     <mrow>      <mo>[</mo>      <mtable>       <mtr>        <mtd>         <msub>          <mi>Y</mi>          <mi>p</mi>         </msub>        </mtd>       </mtr>       <mtr>        <mtd>         <msub>          <mi>Y</mi>          <mi>f</mi>         </msub>        </mtd>       </mtr>      </mtable>      <mo>]</mo>     </mrow>    </mrow>   </mtd>  </mtr> </mtable></math></maths></p><p id="p-0144" num="0147">Here it is noted that the formal distinction in past components, namely U<sub>p </sub>and Y<sub>p</sub>, and future components namely U<sub>f </sub>and Y<sub>f</sub>, is arbitrary since all the data in the matrices are already measured and available.</p><p id="p-0145" num="0148">Moreover, in some preferred embodiments, the subspace identification analysis can comprise steps S<b>5530</b> and S<b>5540</b> of oblique projection of respectively the computed orthogonal projections of the block Hankel matrix of the current measurements I and of the dynamic voltages. The oblique projection advantageously allows to obtain filtered observability matrix.</p><p id="p-0146" num="0149">Moreover, in some preferred embodiments, the subspace identification analysis can further comprise a step S<b>5550</b> of singular vector decomposition to obtain the system matrix A. In particular, using as input for step S<b>5550</b> the output of steps S<b>5330</b> and S<b>5340</b>, it is possible using linear algebra to compute the value of the observability matrix O<sub>i</sub>, which comprises the system matrix A. From the system matrix A it is possible to obtain the impedance value from the system matrix. Alternatively, or in addition, in some embodiments step S<b>5550</b> might use as input the output of the steps S<b>5510</b> and S<b>5520</b> instead. Still alternatively, or in addition, step S<b>5550</b> might use as input the output of step S<b>1400</b>, S<b>4400</b>.</p><p id="p-0147" num="0150">That is, summarizing, the output of step S<b>1500</b>, S<b>5500</b> can provide the eigenvector of the system matrix A. Computing the eigenvalues of the output of subspace can calculate the values of the exponential terms of the system matrix A, for instance, for a two pole system, <img id="CUSTOM-CHARACTER-00007" he="2.79mm" wi="1.78mm" file="US20230003806A1-20230105-P00003.TIF" alt="custom-character" img-content="character" img-format="tif"/><b>1</b> and <img id="CUSTOM-CHARACTER-00008" he="2.79mm" wi="1.78mm" file="US20230003806A1-20230105-P00003.TIF" alt="custom-character" img-content="character" img-format="tif"/><b>2</b>. Those exponential terms can be calculated using the sampling time and natural logarithm. Once the exponential terms are known, the unknown resistors, namely R0, R1&#x2212;RP, occur linearly in the system matrix equations. The values of R0, R1&#x2212;RP can thus be computed by solving the dynamic voltage of the window with respect to the current measurement, using for instance a linear least squares method. This provides then values of R0, R1&#x2212;RP, <img id="CUSTOM-CHARACTER-00009" he="2.79mm" wi="1.78mm" file="US20230003806A1-20230105-P00003.TIF" alt="custom-character" img-content="character" img-format="tif"/>&#x2212;<img id="CUSTOM-CHARACTER-00010" he="2.79mm" wi="1.78mm" file="US20230003806A1-20230105-P00003.TIF" alt="custom-character" img-content="character" img-format="tif"/>P which are the parameters defining the dynamic impedances of the battery system. For instance, for a two pole system, the values R0, R1, R2, and <img id="CUSTOM-CHARACTER-00011" he="2.79mm" wi="1.78mm" file="US20230003806A1-20230105-P00003.TIF" alt="custom-character" img-content="character" img-format="tif"/><b>1</b>, <img id="CUSTOM-CHARACTER-00012" he="2.79mm" wi="1.78mm" file="US20230003806A1-20230105-P00003.TIF" alt="custom-character" img-content="character" img-format="tif"/><b>2</b>, can be obtained, from which the impedance of the battery B can be computed.</p><p id="p-0148" num="0151">The description above has been provided with respect to a method. The invention is however not limited to being implemented as a method. In particular, as visible in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, the invention can also be implemented by an apparatus <b>2000</b> for estimating an impedance of a battery B. In particular, the apparatus can comprise a memory <b>2200</b> and a processor <b>2300</b>, wherein the memory <b>2200</b> comprises instructions configured to, when executed, cause the processor <b>2300</b> to carry out any of the steps previously described.</p><p id="p-0149" num="0152">Preferably, the apparatus <b>2000</b> can further comprise communication means <b>2100</b> for obtaining the plurality of voltage measurements V and the plurality of current measurements I. In the embodiment illustrated in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, the plurality of voltage measurements V and the plurality of current measurements I can be obtained by, respectively, a voltage meter VM and a current meter IM. The communication means <b>2100</b> could communicate directly with one or more of the voltage meter VM and the current meter IM. Alternatively, or in addition, one or more of the voltage meter VM and the current meter IM could communicate with a further entity, for instance a controller of the battery B, which could then communicate the measurements to the communication means <b>2100</b>.</p><p id="p-0150" num="0153">This advantageously allows the apparatus <b>2000</b> t perform the method on a battery B remotely located simply by using the voltage meter VM and the current meter IM connected to the battery B and/or to the load L. It will be clear that the acquiring step S<b>1100</b> can be similarly performed through communication means <b>2100</b> so that the method can be similarly executed on a battery B remotely located.</p><p id="p-0151" num="0154">Similarly, the invention can be implemented as any of a software, a computer program, a computer-program product, a computer-readable storage medium including program code, which, when executed on a processor <b>2300</b>, causes the processor <b>2300</b> to carry out any of the steps previously described.</p><p id="p-0152" num="0155">It is to be understood that the features mentioned above may be used not only in the respective combinations indicated, but also in other combinations or in isolation without departing from the scope of the invention.</p><p id="p-0153" num="0156">It has thus be described how the invention allows a precise estimation of the impedance of a battery based merely on voltage and current measurements, with a method which has a low computing effort and can thus be executed quickly and efficiently to correctly compute the impedance value at any given time, without the disadvantages of the state of the art.</p><heading id="h-0007" level="1">LIST OF REFERENCE NUMERALS</heading><p id="p-0154" num="0000"><ul id="ul0007" list-style="none">    <li id="ul0007-0001" num="0157"><b>1000</b>: method for estimating an impedance of a battery</li>    <li id="ul0007-0002" num="0158">S<b>1100</b>: voltage and current data acquisition</li>    <li id="ul0007-0003" num="0159">S<b>1200</b>: time window identification</li>    <li id="ul0007-0004" num="0160">S<b>1300</b>: open circuit voltage determination</li>    <li id="ul0007-0005" num="0161">S<b>1400</b>: dynamic voltage determination</li>    <li id="ul0007-0006" num="0162">S<b>1500</b>: subspace identification analysis execution</li>    <li id="ul0007-0007" num="0163">S<b>1600</b>: impedance computation</li>    <li id="ul0007-0008" num="0164"><b>2000</b>: apparatus for estimating an impedance of a battery</li>    <li id="ul0007-0009" num="0165"><b>2100</b>: communication means</li>    <li id="ul0007-0010" num="0166"><b>2200</b>: memory</li>    <li id="ul0007-0011" num="0167"><b>2300</b>: processor</li>    <li id="ul0007-0012" num="0168">B: battery</li>    <li id="ul0007-0013" num="0169">IM: current meter</li>    <li id="ul0007-0014" num="0170">VM: voltage meter</li>    <li id="ul0007-0015" num="0171">L: load</li>    <li id="ul0007-0016" num="0172">T<b>1</b>, T<b>2</b>: time</li>    <li id="ul0007-0017" num="0173">I: current measurement</li>    <li id="ul0007-0018" num="0174">V: voltage measurement</li>    <li id="ul0007-0019" num="0175">RVI: relaxed voltage interval</li>    <li id="ul0007-0020" num="0176">DLI: dynamic load interval</li>    <li id="ul0007-0021" num="0177">S<b>4400</b>: dynamic voltage determination</li>    <li id="ul0007-0022" num="0178">S<b>4410</b>: estimated initial state of charge determination</li>    <li id="ul0007-0023" num="0179">S<b>4420</b>: plurality of estimated states of charge determination</li>    <li id="ul0007-0024" num="0180">S<b>4430</b>: plurality of estimated open circuit voltages determination</li>    <li id="ul0007-0025" num="0181">S<b>4440</b>: plurality of dynamic voltages determination</li>    <li id="ul0007-0026" num="0182">S<b>5500</b>: subspace identification analysis execution</li>    <li id="ul0007-0027" num="0183">S<b>5510</b>: orthogonal projection of block Hankel matrix</li>    <li id="ul0007-0028" num="0184">S<b>5520</b>: orthogonal projection of block Hankel matrix</li>    <li id="ul0007-0029" num="0185">S<b>5530</b>: oblique projection of orthogonally projected block Hankel matrix</li>    <li id="ul0007-0030" num="0186">S<b>5540</b>: oblique projection of orthogonally projected block Hankel matrix</li>    <li id="ul0007-0031" num="0187">S<b>5550</b>: linear fitting and singular vector decomposition</li></ul></p><?detailed-description description="Detailed Description" end="tail"?></description><us-math idrefs="MATH-US-00001" nb-file="US20230003806A1-20230105-M00001.NB"><img id="EMI-M00001" he="8.81mm" wi="76.20mm" file="US20230003806A1-20230105-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00002" nb-file="US20230003806A1-20230105-M00002.NB"><img id="EMI-M00002" he="5.67mm" wi="76.20mm" file="US20230003806A1-20230105-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00003" nb-file="US20230003806A1-20230105-M00003.NB"><img id="EMI-M00003" he="9.48mm" wi="76.20mm" file="US20230003806A1-20230105-M00003.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00004" nb-file="US20230003806A1-20230105-M00004.NB"><img id="EMI-M00004" he="6.01mm" wi="76.20mm" file="US20230003806A1-20230105-M00004.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00005" nb-file="US20230003806A1-20230105-M00005.NB"><img id="EMI-M00005" he="9.48mm" wi="76.20mm" file="US20230003806A1-20230105-M00005.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00006" nb-file="US20230003806A1-20230105-M00006.NB"><img id="EMI-M00006" he="9.48mm" wi="76.20mm" file="US20230003806A1-20230105-M00006.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00007" nb-file="US20230003806A1-20230105-M00007.NB"><img id="EMI-M00007" he="16.59mm" wi="76.20mm" file="US20230003806A1-20230105-M00007.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00008" nb-file="US20230003806A1-20230105-M00008.NB"><img id="EMI-M00008" he="10.24mm" wi="76.20mm" file="US20230003806A1-20230105-M00008.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00009" nb-file="US20230003806A1-20230105-M00009.NB"><img id="EMI-M00009" he="40.22mm" wi="76.20mm" file="US20230003806A1-20230105-M00009.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00010" nb-file="US20230003806A1-20230105-M00010.NB"><img id="EMI-M00010" he="40.22mm" wi="76.20mm" file="US20230003806A1-20230105-M00010.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-claim-statement>What is claimed is:</us-claim-statement><claims id="claims"><claim id="CLM-00001" num="00001"><claim-text><b>1</b>. A method for estimating an impedance of a battery, the method comprising the steps of:<claim-text>acquiring data of the battery during at least a predetermined time range, the data comprising at least a plurality of voltage measurements and a plurality of current measurements,</claim-text><claim-text>determining a time window within the predetermined time range, the time window starting after a relaxed voltage interval and comprising a dynamic load interval,</claim-text><claim-text>determining an initial voltage, the initial voltage being the voltage measurement at the start of the time window,</claim-text><claim-text>determining a plurality of dynamic voltages based on the voltage measurements in the time window and the initial voltage,</claim-text><claim-text>executing a subspace identification analysis based on the plurality of current measurements and on the plurality of dynamic voltages,</claim-text><claim-text>computing the impedance from an output of the subspace identification analysis.</claim-text></claim-text></claim><claim id="CLM-00002" num="00002"><claim-text><b>2</b>. The method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>,<claim-text>wherein the time window starts immediately after an end of the relaxed voltage interval.</claim-text></claim-text></claim><claim id="CLM-00003" num="00003"><claim-text><b>3</b>. The method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>,<claim-text>wherein the time window starts within a predetermined time after an end of the relaxed voltage interval.</claim-text></claim-text></claim><claim id="CLM-00004" num="00004"><claim-text><b>4</b>. The method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>,<claim-text>wherein the dynamic load interval is a time interval during which one or more of the following conditions apply:<claim-text>a value of an integral of an absolute value of the current measurements is within a predetermined range, preferably higher than 1% of the capacity of the battery, and/or preferably lower than 5% of the capacity of the battery, and/or even more preferably lower than 2.5% of the capacity of the battery,</claim-text><claim-text>a difference of a maximum value of an integral of the current measurements during the time interval and a minimum value of the integral of the current measurements during the time interval is within a predetermined range, preferably higher than 2.5% and/or preferably lower than 5% of the battery cell capacity,</claim-text><claim-text>a value of statistical measure for dispersion of the current measurements, preferably the standard deviation of the current measurements, is higher than a predetermined value, preferably higher than 10% of the C-rate of the battery, even more preferably higher than 25% of the C-rate of the battery</claim-text><claim-text>an absolute value of a differential of the current measurements reaches a predetermined threshold, preferably higher than 1 C-rate/s,</claim-text><claim-text>an absolute value of a differential of a moving average of the current measurements reaches a predetermined threshold, preferably higher than 1 C-rate/s,</claim-text><claim-text>a Fourier transformation of the current measurements results in one or more frequency peaks other than at 0 Hz.</claim-text></claim-text></claim-text></claim><claim id="CLM-00005" num="00005"><claim-text><b>5</b>. The method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>,<claim-text>wherein the dynamic load interval has a duration of and/or at least 1 minute, preferably of and/or at least 5 minutes.</claim-text></claim-text></claim><claim id="CLM-00006" num="00006"><claim-text><b>6</b>. The method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>,<claim-text>wherein the battery can be modelled as having one or more RC elements, and</claim-text><claim-text>wherein the dynamic load interval has a duration of and/or at least 1 time, preferably of and/or at least 5 times, the biggest of the one or more RC elements.</claim-text></claim-text></claim><claim id="CLM-00007" num="00007"><claim-text><b>7</b>. The method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the step of determining the dynamic voltage comprises the steps of:<claim-text>determining an estimated initial state of charge based on the initial voltage, the estimated initial state of charge being the estimated state of charge at the start of the time window,</claim-text><claim-text>determining a plurality of estimated states of charge throughout the time window based on the estimated initial state of charge,</claim-text><claim-text>determining a plurality of estimated open circuit voltages throughout the time window based on the estimated plurality of states of charge,</claim-text><claim-text>determining the plurality of dynamic voltages as, at any given time throughout the time window, a difference between the voltage measurement and the respective estimated open circuit voltage at the given time.</claim-text></claim-text></claim><claim id="CLM-00008" num="00008"><claim-text><b>8</b>. The method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>,<claim-text>wherein the subspace identification analysis is performed with the plurality of current measurements as input and the plurality of dynamic voltages as output.</claim-text></claim-text></claim><claim id="CLM-00009" num="00009"><claim-text><b>9</b>. The method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>,<claim-text>wherein the subspace identification analysis is based on a state-space representation of the type of<claim-text><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>x</i><sub>k+1</sub><i>=Ax</i><sub>k</sub><i>+Bu</i><sub>k </sub><?in-line-formulae description="In-line Formulae" end="tail"?></claim-text><claim-text><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>y</i><sub>k+1</sub><i>=Cx</i><sub>k</sub><i>+Du</i><sub>k </sub><?in-line-formulae description="In-line Formulae" end="tail"?></claim-text></claim-text><claim-text>wherein<claim-text>k represents a time instant of the time window,</claim-text><claim-text>k+1 represents a time instant subsequent to k,</claim-text><claim-text>x<sub>k </sub>represents a state vector at time k,</claim-text><claim-text>u<sub>k </sub>represents a current measurement at time k,</claim-text><claim-text>y<sub>k </sub>represents a value of the plurality of dynamic voltages at time k,</claim-text><claim-text>A represents a state transition matrix,</claim-text><claim-text>B represents a control input matrix,</claim-text><claim-text>C represents an output matrix,</claim-text><claim-text>D represents a feedthrough matrix.</claim-text></claim-text></claim-text></claim><claim id="CLM-00010" num="00010"><claim-text><b>10</b>. The method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the step of executing a subspace identification analysis comprises any of the steps of:<claim-text>orthogonal projection of block Hankel matrix of the current measurements,</claim-text><claim-text>orthogonal projection of block Hankel matrix of the dynamic voltages,</claim-text><claim-text>oblique projection of the orthogonal projection of the block Hankel matrix of the current measurements,</claim-text><claim-text>oblique projection of the orthogonal projection of the block Hankel matrix of the dynamic voltages.</claim-text></claim-text></claim><claim id="CLM-00011" num="00011"><claim-text><b>11</b>. The method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the step of executing a subspace identification analysis further comprises the step of:<claim-text>singular vector decomposition to obtain the system matrix A.</claim-text></claim-text></claim><claim id="CLM-00012" num="00012"><claim-text><b>12</b>. An apparatus for estimating an impedance of a battery, the apparatus comprising<claim-text>a memory and a processor,</claim-text><claim-text>wherein the memory comprises instructions configured to, when executed, cause the processor to carry out the steps of <claim-ref idref="CLM-00001">claim 1</claim-ref>.</claim-text></claim-text></claim><claim id="CLM-00013" num="00013"><claim-text><b>13</b>. The apparatus according to <claim-ref idref="CLM-00012">claim 12</claim-ref>, further comprising communication means for obtaining the plurality of voltage measurements and the plurality of current measurements.</claim-text></claim><claim id="CLM-00014" num="00014"><claim-text><b>14</b>. A computer readable medium storing software which, when executed on a processor, causes the processor to carry out the steps of <claim-ref idref="CLM-00001">claim 1</claim-ref>.</claim-text></claim></claims></us-patent-application>