<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230000440A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230000440</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17781184</doc-number><date>20191204</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>A</section><class>61</class><subclass>B</subclass><main-group>5</main-group><subgroup>00</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>A</section><class>61</class><subclass>B</subclass><main-group>5</main-group><subgroup>0245</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>A</section><class>61</class><subclass>B</subclass><main-group>5</main-group><subgroup>352</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>A</section><class>61</class><subclass>B</subclass><main-group>5</main-group><subgroup>7207</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc><further-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>A</section><class>61</class><subclass>B</subclass><main-group>5</main-group><subgroup>0245</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20210101</date></cpc-version-indicator><section>A</section><class>61</class><subclass>B</subclass><main-group>5</main-group><subgroup>352</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></further-cpc></classifications-cpc><invention-title id="d2e43">Heartrate Detection Device, Heartrate Detection Method, and Heartrate Detection Program</invention-title><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>Nippon Telegraph and Telephone Corporation</orgname><address><city>Tokyo</city><country>JP</country></address></addressbook><residence><country>JP</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>Hashimoto</last-name><first-name>Yuki</first-name><address><city>Tokyo</city><country>JP</country></address></addressbook></inventor><inventor sequence="01" designation="us-only"><addressbook><last-name>Kuwabara</last-name><first-name>Kei</first-name><address><city>Tokyo</city><country>JP</country></address></addressbook></inventor><inventor sequence="02" designation="us-only"><addressbook><last-name>Matsuura</last-name><first-name>Nobuaki</first-name><address><city>Tokyo</city><country>JP</country></address></addressbook></inventor></inventors></us-parties><pct-or-regional-filing-data><document-id><country>WO</country><doc-number>PCT/JP2019/047438</doc-number><date>20191204</date></document-id><us-371c12-date><date>20220531</date></us-371c12-date></pct-or-regional-filing-data></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">A heartbeat detection device includes: a sensor data acquisition unit that acquires sensor data indicating an electrocardiographic waveform of a living body and outputs a sampling data sequence D(i) based on the sensor data; a first calculation unit that calculates a temporal difference value DY(i) of sampling data D(i) from the output sampling data sequence D(i) for each sampling time; a determination unit that determines a heartbeat time on the basis of a time at which a change in the calculated temporal difference value DY(i) exceeds a set threshold; a correction unit that corrects the heartbeat time by using a reference time; and a heart rate calculation unit that calculates a heart rate of the living body from the corrected heartbeat time.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="69.34mm" wi="152.82mm" file="US20230000440A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="213.61mm" wi="154.86mm" file="US20230000440A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="228.77mm" wi="119.55mm" file="US20230000440A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="178.14mm" wi="157.40mm" file="US20230000440A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="235.80mm" wi="157.23mm" file="US20230000440A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="lead"?><heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATIONS</heading><p id="p-0002" num="0001">This application is a national phase entry of PCT Application No. PCT/JP2019/047438, filed on Dec. 4, 2019, which application is hereby incorporated herein by reference.</p><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="tail"?><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0002" level="1">TECHNICAL FIELD</heading><p id="p-0003" num="0002">The present invention relates to a heartbeat detection device, a heartbeat detection method, and a heartbeat detection program.</p><heading id="h-0003" level="1">BACKGROUND</heading><p id="p-0004" num="0003">In recent years, there has been a growing interest in self-health management by wearing wearable devices and using measurement data such as a footstep count, the amount of activity or a heart rate in various daily activity scenes such as running and walking.</p><p id="p-0005" num="0004">For example, Patent Literature 1 discloses an application that uses a wearable sensor mounted on clothing to acquire an electrocardiographic waveform during wear, calculates a heart rate based on it, and sends obtained data to an external terminal such as a smartphone.</p><p id="p-0006" num="0005">Conventionally-known wearable devices of this kind use no external power source, and thus, reduction in power consumption of the device is important in applications that require long-time continuous use such as measuring the heartbeat of a user.</p><p id="p-0007" num="0006">In this regard, in order to achieve reduction in power consumption of the wearable device, there has conventionally been an attempt to reduce the computation load per unit time by increasing the interval of acquiring data such as the heart rate of the user.</p><p id="p-0008" num="0007">For example, Patent Literature 2 discloses a technique for calculating the heart rate from the electrocardiographic potential by setting a threshold corresponding to the amplitude of an R wave for time-series data of the electrocardiographic potential, detecting the R wave when the data exceeds the threshold, and calculating the heart rate from its period (R-R interval).</p><p id="p-0009" num="0008">Also, as a method for stably detecting the heart rate of a living body without influence by motion artifact noise, there has been proposed a technique of using, as an index value, a temporal difference value of the electrocardiographic potential or a temporal difference value obtained by considering clearances before and after peaks of the QRS waves, instead of using time-series data of the electrocardiographic potential (see Patent Literature 3).</p><heading id="h-0004" level="1">CITATION LIST</heading><heading id="h-0005" level="1">Patent Literature</heading><p id="p-0010" num="0009">Patent Literature 1: International Publication No. WO 2016/024495</p><p id="p-0011" num="0010">Patent Literature 2: Japanese Patent Laid-Open No. 2015-156936</p><p id="p-0012" num="0011">Patent Literature 3: Japanese Patent No. 6404784</p><heading id="h-0006" level="1">SUMMARY</heading><heading id="h-0007" level="1">Technical Problem</heading><p id="p-0013" num="0012">However, in conventional techniques, since a feature value of the electrocardiographic potential is detected by a threshold, shifts in detection times corresponding to the interval of data acquisition may occur, resulting in an error in the calculation of the heart rate.</p><p id="p-0014" num="0013">Embodiments of the present invention have been made in order to solve the above-described problem, and it is an objective of embodiments of the present invention to more accurately measure the heart rate of a living body.</p><heading id="h-0008" level="1">Means for Solving the Problem</heading><p id="p-0015" num="0014">In order to solve the above-described problem, a heartbeat detection device according to embodiments of the present invention includes: a sensor data acquisition unit that acquires sensor data indicating an electrocardiographic waveform of a living body and outputs a sampling data sequence based on the sensor data; a first calculation unit that calculates a temporal difference value of sampling data from the output sampling data sequence for each sampling time; a determination unit that determines a heartbeat time on the basis of a time at which a change in the temporal difference value calculated by the first calculation unit exceeds a set threshold; a correction unit that corrects the heartbeat time by using a reference time that is a time at which the temporal difference value becomes zero on a straight line passing through two points of a temporal difference value of sampling data at the heartbeat time determined by the determination unit and a temporal difference value of immediately preceding sampling data; and a second calculation unit that calculates a heart rate of the living body from the heartbeat time corrected by the correction unit.</p><p id="p-0016" num="0015">In order to solve the above-described problem, a heartbeat detection method according to embodiments of the present invention includes: a first step of acquiring sensor data indicating an electrocardiographic waveform of a living body and outputs a sampling data sequence based on the sensor data; a second step of calculating a temporal difference value of sampling data from the sampling data sequence output in the first step for each sampling time; a third step of determining a heartbeat time on the basis of a time at which a change in the temporal difference value calculated in the second step exceeds a set threshold; a fourth step of correcting the heartbeat time by using a reference time that is a time at which the temporal difference value becomes zero on a straight line passing through two points of a temporal difference value of sampling data at the heartbeat time determined in the third step and a temporal difference value of immediately preceding sampling data; and a fifth step of calculating a heart rate of the living body from the heartbeat time corrected in the fourth step.</p><p id="p-0017" num="0016">In order to solve the above-described problem, a heartbeat detection program according to embodiments of the present invention is characterized by causing performance of: a first step of acquiring sensor data indicating an electrocardiographic waveform of a living body and outputs a sampling data sequence based on the sensor data; a second step of calculating a temporal difference value of sampling data from the sampling data sequence output in the first step for each sampling time; a third step of determining a heartbeat time on the basis of a time at which a change in the temporal difference value calculated in the second step exceeds a set threshold; a fourth step of correcting the heartbeat time by using a reference time that is a time at which the temporal difference value becomes zero on a straight line passing through two points of a temporal difference value of sampling data at the heartbeat time determined in the third step and a temporal difference value of immediately preceding sampling data; and a fifth step of calculating a heart rate of the living body from the heartbeat time corrected in the fourth step.</p><heading id="h-0009" level="1">Effects of Embodiments of the Invention</heading><p id="p-0018" num="0017">According to embodiments of the present invention, a heartbeat time is corrected by using a reference time that is a time at which a temporal difference value becomes zero on a straight line passing through two points of a temporal difference value of sampling data at a heartbeat time determined on the basis of a time at which change in the temporal difference value of the sampling data for each sampling time calculated from a sampling data sequence based on an electrocardiographic waveform exceeds a set threshold and a temporal difference value of immediately preceding sampling data. Thus, it is possible to more accurately measure the heart rate of a user.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0010" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. <b>1</b></figref> is a block diagram showing a functional configuration of a heartbeat detection device according to an embodiment of the present invention.</p><p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a diagram for illustrating an electrocardiographic waveform according to the present embodiment.</p><p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. <b>3</b></figref> is a diagram for illustrating an electrocardiographic waveform according to the present embodiment.</p><p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. <b>4</b></figref> is a block diagram showing a functional configuration of a heartbeat time calculation unit according to the present embodiment.</p><p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is a block diagram showing another example of functional configuration of the heartbeat time calculation unit according to the present embodiment.</p><p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is a block diagram showing an example of hardware configuration of the heartbeat detection device according to the present embodiment.</p><p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. <b>7</b></figref> is a flow chart for illustrating a heartbeat detection method according to the present embodiment.</p><p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. <b>8</b></figref> is a flow chart for illustrating a heartbeat time calculation process according to the present embodiment.</p><p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. <b>9</b></figref> is a diagram for illustrating effects of the heartbeat detection device according to the present embodiment.</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><heading id="h-0011" level="1">DETAILED DESCRIPTION OF ILLUSTRATIVE EMBODIMENTS</heading><p id="p-0028" num="0027">A preferred embodiment of the present invention will be described in detail below with reference to <figref idref="DRAWINGS">FIGS. <b>1</b> to <b>9</b></figref>.</p><heading id="h-0012" level="1">Outline of Embodiments of Invention</heading><p id="p-0029" num="0028">First, an outline of a heartbeat detection device <b>1</b> according to an embodiment of the present invention will be described with reference to <figref idref="DRAWINGS">FIGS. <b>2</b> and <b>3</b></figref>.</p><p id="p-0030" num="0029"><figref idref="DRAWINGS">FIGS. <b>2</b> and <b>3</b></figref> are diagrams showing general electrocardiographic waveforms (Electrocardiogram: ECG). An ECG waveform consists of a continuous heartbeat waveform, and one heartbeat waveform consists of components such as P, Q, R, S and T waves, which reflect activities of the atriums and ventricles, as shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>. Among them, an R wave occur in association with a contraction of the ventricles (depolarization of the ventricular muscle) and has a large amplitude, and therefore the detection of heartbeats is often performed with reference to R waves. In particular, it becomes easier to detect heartbeats by obtaining temporal differences in a sampling data sequence of the ECG waveform to emphasize steep changes from R waves to S waves in peaked shapes. The interval of each heartbeat is referred to as an R-R interval and is used as a primary index of heartbeat fluctuation.</p><p id="p-0031" num="0030">The heartbeat detection device <b>1</b> according to the present embodiment uses a detection point on an RS interval from the starting portion of a QRS wave to the peak of an S wave included in the ECG waveform in order to detect a steep change from the R wave to the S wave. The present embodiment has a feature in using a temporal difference value of electrocardiographic potential corresponding to the detection point on the RS interval and its immediately preceding point to estimate times at which this temporal difference value becomes 0 in the RS interval and correcting the R-R interval by using the time interval of the estimated times.</p><p id="p-0032" num="0031">Next, a configuration of the heartbeat detection device <b>1</b> according to the present embodiment will be described by using <figref idref="DRAWINGS">FIG. <b>1</b></figref>. The following describes a procedure in which the heartbeat detection device <b>1</b> detects one heartbeat and obtains its heartbeat time. By repeating such calculation of a heartbeat time for a period of measurement of the ECG waveform, time-series data of heartbeat times can be obtained, and the R-R interval can be calculated from this time-series data.</p><p id="p-0033" num="0032">In the present embodiment, sampling data obtained by sampling the ECG waveform is defined as D(i). Here, i (i=1, 2, . . . ) indicates a number serially given to data obtained by one time of sampling. A larger number i of the data sequence indicates a later sampling time.</p><p id="p-0034" num="0033">In the present embodiment, a minimum value of the temporal difference value in the range of a first time interval Tinr1, which will be described later, is defined as Min1, a minimum value of the temporal difference value in the range of a second time interval Tinr2 is defined as Min2, and a minimum value of the temporal difference value in the range of a third time interval Tinr3 is defined as Min3. The initial values of these minimum values Min1, Min2 and Min3 may be set to 0, for example.</p><heading id="h-0013" level="1">Functional Blocks of Heartbeat Detection Device</heading><p id="p-0035" num="0034">As shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref>, the heartbeat detection device <b>1</b> includes a sensor data acquisition unit <b>10</b>, a heartbeat time calculation unit <b>11</b>, a correction unit <b>12</b>, a heart rate calculation unit (second calculation unit) <b>13</b>, a first storage unit <b>14</b>, and a transmission/reception unit <b>15</b>.</p><p id="p-0036" num="0035">The sensor data acquisition unit <b>10</b> acquires sensor data including an electrocardiographic signal of a user and a measurement time, for example. The sensor data acquisition unit <b>10</b> can acquire an electrocardiographic signal of the user measured by a sensor <b>105</b> constituted by an electrocardiograph, for example. The sensor data acquisition unit <b>10</b> performs signal processing such as amplification, AD conversion, and noise removal on the acquired electrocardiographic signal. The sensor data acquisition unit <b>10</b> stores sampling data D(i) as time-series data of the ECG and a sampling time in the first storage unit <b>14</b>. Note that, although the case where the sensor data acquisition unit <b>10</b> acquires an electrocardiographic signal of the user from the sensor <b>105</b> is described in the present embodiment, the sensor data acquisition unit <b>10</b> can also perform off-line acquisition of an electrocardiographic signal of the user measured in advance.</p><p id="p-0037" num="0036">The heartbeat time calculation unit <b>11</b> reads the sampling data D(i) of the ECG waveform stored in the first storage unit <b>14</b> and calculates a heartbeat time. As shown in <figref idref="DRAWINGS">FIG. <b>4</b></figref>, the heartbeat time calculation unit <b>11</b> includes a first calculation unit <b>110</b>, a first determination unit <b>111</b>, a second determination unit <b>112</b>, a second storage unit <b>113</b>, and a determination unit <b>114</b> (see Patent Literature 3).</p><p id="p-0038" num="0037">The first calculation unit <b>110</b> calculates a temporal difference value DY(i) of the sampling data D(i) of the ECG waveform for each sampling time (time indicated by i). More specifically, the first calculation unit <b>110</b> reads data D(i+1) of the next sampling to the sampling data D(i) of the ECG waveform and sampling data D(i&#x2212;1) of the previous sampling from the first storage unit <b>14</b> and calculates the temporal difference value DY(i) of the sampling data D(i) based on the following equation (1).</p><p id="p-0039" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>DY</i>(<i>i</i>)=<i>D</i>(<i>i+</i>1)&#x2212;<i>D</i>(<i>i&#x2212;</i>1) &#x2003;&#x2003;(1)<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0040" num="0038">The first determination unit <b>111</b> determines whether the temporal difference value DY(i) calculated by the first calculation unit <b>110</b> is below a threshold TH. In the present embodiment, a peak of the temporal difference value DY(i) due to a steep change from an R wave to an S wave is detected, as shown in the ECG waveforms in <figref idref="DRAWINGS">FIGS. <b>2</b> and <b>3</b></figref>. The peak of the temporal difference value DY(i) appears as a negative value. Therefore, the first determination unit <b>111</b> performs threshold processing of the temporal difference value DY(i) by using a threshold TH that is a set negative value.</p><p id="p-0041" num="0039">For example, the first determination unit <b>111</b> can use, as the threshold TH, a value obtained by multiplying by 0.5 an average value of peaks (Min2), e.g., five peaks (Min2), closest to the temporal difference value DY(i) detected as a heartbeat. The reason for multiplying the average value of the peaks (Min2) by 0.5 is to set the absolute value of the threshold TH to be smaller than that for the purpose of simply detecting peaks (see Non-Patent Literature 3). It is possible to capture a peak with a small absolute value by setting a smaller absolute value of the threshold TH.</p><p id="p-0042" num="0040">The second determination unit <b>112</b> determines whether a first elapsed time T1 from the immediately preceding heartbeat time to the latest sampling time (the time indicated by i) at which the temporal difference value DY(i) is obtained is in the range of a first time interval Tinr1. The second determination unit <b>112</b> also determines whether a second elapsed time T2 from the time at which the temporal difference value DY(i) falls below the threshold TH to the latest sampling time at which the temporal difference value DY(i) is obtained is in the range of a second time interval Tinr2. Further, the second determination unit <b>112</b> determines whether a third elapsed time T3 from the time at which the second elapsed time T2 exceeds the range of the second time interval Tinr2 to the latest sampling time at which the temporal difference value DY(i) is obtained is in the range of a third time interval Tinr3.</p><p id="p-0043" num="0041">The first time interval Tinr1 is a parameter for defining a time region before the next assumed heartbeat time. The second time interval Tinr2 is a parameter for defining a time region assumed to include a peak of the temporal difference value DY(i). The third time interval Tinr3 is a parameter for defining a certain time region after the time region assumed to include the peak of the temporal difference value DY(i).</p><p id="p-0044" num="0042">For example, the second determination unit <b>112</b> uses, as the range of first time interval Tinr1, a range between a time length shorter by 150 [ms] than the R-R interval obtained from the immediately preceding heartbeat time and a time length obtained by adding 100 [ms] to this time length. The R-R interval here is a time length obtained by subtracting the second preceding heartbeat time from the immediately preceding heartbeat time.</p><p id="p-0045" num="0043">Alternatively, the second determination unit <b>112</b> can use, as the range of the first time interval Tinr1, a time region from the immediately preceding heartbeat time to immediately before the temporal difference value DY(i) next exceeds the threshold TH.</p><p id="p-0046" num="0044">The second time interval Tinr2 is preferably a time width sufficient to cover a peak of the temporal difference value DY(i) and can be preset to 50 [ms], for example.</p><p id="p-0047" num="0045">The third time interval Tinr3 can be preset to 100 [ms], for example.</p><p id="p-0048" num="0046">The second storage unit <b>113</b> retains a minimum value Mini of the temporal difference value DY(i) when the first elapsed time T1 is in the range of the first time interval Tinr1. The second storage unit <b>113</b> also retains a minimum value Min2 of the temporal difference value DY(i) when the second elapsed time T2 is in the range of the second time interval Tinr2. The second storage unit <b>113</b> also retains a minimum value Min3 of the temporal difference value DY(i) when the third elapsed time T3 is in the range of the third time interval Tinr3.</p><p id="p-0049" num="0047">The determination unit <b>114</b> regards, as a heartbeat time, a time at which the temporal difference value DY(i) falls below the threshold TH or a time at which the minimum value Min2 is obtained when the relationship between the minimum values Min1, Min2 and Min3 of the temporal difference value DY(i) retained by the second storage unit <b>113</b> satisfies a preset condition for fixing the heartbeat time. Which time the determination unit <b>114</b> adopts as the heartbeat time can be preset by a program.</p><p id="p-0050" num="0048">For example, the condition that both of a ratio Min2/Min1 of the minimum value Min2 to the minimum value Min1 and a ratio Min2/Min3 of the minimum value Min2 to the minimum value Min3 exceed a predetermined value can be used as the preset condition for fixing the heartbeat time. By presetting such a condition, it is possible to determine whether or not the peak of the temporal difference value is unimodal.</p><p id="p-0051" num="0049">The correction unit <b>12</b> identifies a time at which the temporal difference value of the ECG waveform data becomes o from ECG waveform data based on the heartbeat time calculated by the heartbeat time calculation unit <b>11</b>. In addition, the correction unit <b>12</b> uses the time at which the temporal difference value becomes o in the ECG waveform data as a reference time for calculating the R-R interval. More specifically, the correction unit <b>12</b> identifies a time at which the temporal difference value becomes 0, that is, the time of an R wave included in the ECG waveform on a straight line passing through two points of a temporal difference value DY(n) of ECG waveform data D(n) at the heartbeat time calculated by the heartbeat time calculation unit <b>11</b> and the immediately preceding temporal difference value DY(n&#x2212;1), and regards it as a reference time for calculating the R-R interval.</p><p id="p-0052" num="0050">For example, a shift &#x394;n (the unit is the sampling data number) with reference to a heartbeat time at which the electrocardiographic potential becomes 0 is calculated by the following equation (2).</p><p id="p-0053" num="0000"><maths id="MATH-US-00001" num="00001"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <mi>Math</mi>     <mo>&#x2062;</mo>     <mtext>   </mtext>     <mn>1</mn>    </mrow>   </mtd>   <mtd>    <mi>&#xf3ba;</mi>   </mtd>  </mtr>  <mtr>   <mtd>    <mrow>     <mrow>      <mi>&#x394;</mi>      <mo>&#x2062;</mo>      <mi>n</mi>     </mrow>     <mo>=</mo>     <mrow>      <mo>-</mo>      <mfrac>       <mrow>        <mrow>         <mi>DY</mi>         <mo>&#x2061;</mo>         <mo>(</mo>         <mi>n</mi>         <mo>)</mo>        </mrow>        <mo>-</mo>        <mrow>         <mi>DY</mi>         <mo>&#x2061;</mo>         <mo>(</mo>         <mrow>          <mi>n</mi>          <mo>-</mo>          <mn>1</mn>         </mrow>         <mo>)</mo>        </mrow>       </mrow>       <mrow>        <mi>DY</mi>        <mo>&#x2061;</mo>        <mo>(</mo>        <mi>n</mi>        <mo>)</mo>       </mrow>      </mfrac>     </mrow>    </mrow>   </mtd>   <mtd>    <mrow>     <mo>(</mo>     <mn>2</mn>     <mo>)</mo>    </mrow>   </mtd>  </mtr> </mtable></math></maths></p><p id="p-0054" num="0051">The correction unit <b>12</b> can calculate the reference time by using the shift &#x394;n calculated from the above equation (2).</p><p id="p-0055" num="0052">Here, it is necessary that the ECG waveform data D(n) at the heartbeat time calculated by the heartbeat time calculation unit <b>11</b> and the immediately preceding ECG waveform data D(n&#x2212;1) are measurement points on an interval from an inflection point immediately before the R wave to an inflection point immediately after the R wave. That is, there is an upper limit of the sampling interval. For example, in consideration of the fact that the QRS interval is generally said to be about 100 [ms], the above-mentioned interval is estimated to be 25 [ms], and thus the sampling interval needs to be 12.5 [ms] or less.</p><p id="p-0056" num="0053">On the other hand, if the sampling interval is too short, the ECG waveform data D(n) at the heartbeat time calculated by the heartbeat time calculation unit <b>11</b> and the immediately preceding ECG waveform data D(n&#x2212;1) would be present around the inflection point immediately after the R wave, that is, the temporal difference value DY(n) of the ECG waveform and the immediately preceding temporal difference value DY(n&#x2212;1) would be present in a region where the gradient of the tangent to the time-series data of the temporal difference value steeply changes. Thus, a large error occurs when the heartbeat time is corrected by using the two points of the temporal difference value DY(n) of the ECG waveform and the immediately preceding temporal difference value DY(n&#x2212;1). That is, there is also a lower limit of the sampling interval, which is specifically about 4 [ms].</p><p id="p-0057" num="0054">The heart rate calculation unit <b>13</b> calculates a heart rate X [bpm] from the latest heartbeat time corrected by the correction unit <b>12</b>. Specifically, the heart rate calculation unit <b>13</b> calculates an instantaneous heart rate X by the following equation (3), where the R-R interval, which is a time length obtained by subtracting from the latest heartbeat time calculated and fixed by the correction unit <b>12</b> its preceding heartbeat time, is defined as RRI [ms].</p><p id="p-0058" num="0000"><maths id="MATH-US-00002" num="00002"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <mi>Math</mi>     <mo>&#x2062;</mo>     <mtext>   </mtext>     <mn>2</mn>    </mrow>   </mtd>   <mtd>    <mi>&#xf3ba;</mi>   </mtd>  </mtr>  <mtr>   <mtd>    <mrow>     <mi>X</mi>     <mo>=</mo>     <mfrac>      <mn>60000</mn>      <mi>RRI</mi>     </mfrac>    </mrow>   </mtd>   <mtd>    <mrow>     <mo>(</mo>     <mn>3</mn>     <mo>)</mo>    </mrow>   </mtd>  </mtr> </mtable></math></maths></p><p id="p-0059" num="0055">The heart rate calculation unit <b>13</b> can also calculate an average heart rate X by using the following equation (4) described in reference literature 3 (Japanese Patent Laid-Open No. 2018-011819), instead of the instantaneous heart rate.</p><p id="p-0060" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?>Math 3<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0061" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>X</i>(<i>i</i>)=<i>q</i>&#xd7;HR(<i>i</i>)+(1&#x2212;<i>q</i>)&#xd7;<i>X</i>(i&#x2212;1) &#x2003;&#x2003;(4)<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0062" num="0056">In the above equation (4), HR(i) represents the i-th instantaneous heart rate before averaging, X(i&#x2212;1) represents a value obtained by averaging the instantaneous heart rates up to the (i&#x2212;1)-th, 1 represents a predetermined averaging coefficient, and X(i) represents an average heart rate obtained by averaging the instantaneous heart rates up to the i-th.</p><p id="p-0063" num="0057">The transmission/reception unit <b>15</b> sends the heart rate calculated by the heart rate calculation unit <b>13</b> to an external terminal device such as an external smartphone (not shown) in a wired or wireless manner.</p><heading id="h-0014" level="1">Another Example of Heartbeat Time Calculation Unit</heading><p id="p-0064" num="0058">The heartbeat detection device <b>1</b> according to the present embodiment can also calculate the heartbeat time by a heartbeat time calculation unit <b>11</b>A having a configuration shown in <figref idref="DRAWINGS">FIG. <b>5</b></figref>, for example, without limitation to the functional configuration of the heartbeat time calculation unit <b>11</b> described above (see reference literature 1: Japanese Patent No. 6360017 and reference literature 2: Japanese Patent No. 6527286).</p><p id="p-0065" num="0059">The heartbeat time calculation unit <b>11</b>A includes a first calculation unit <b>110</b>, an index value calculation unit <b>115</b>, an acquisition unit <b>116</b>, a second storage unit <b>113</b>, and a determination unit <b>114</b>.</p><p id="p-0066" num="0060">The first calculation unit no calculates a temporal difference value DY(i) of the sampling data D(i) of the electrocardiographic waveform for each sampling time.</p><p id="p-0067" num="0061">For each sampling point i, the acquisition unit <b>116</b> acquires the minimum value of the temporal difference value in a predetermined time region before and after the sampling point i.</p><p id="p-0068" num="0062">For each sampling point i, the index value calculation unit <b>115</b> obtains, as an index value, a value obtained by subtracting the minimum value of the temporal difference value in the predetermined time region before and after the sampling point i from the temporal difference value DY(i) of the sampling point i.</p><p id="p-0069" num="0063">The determination unit <b>114</b> identifies, as a downward peak, an index value of the index values of respective sampling points i that is below a predetermined threshold and is at a point at which the tendency of change of the index value turns from decrease to increase, and regards the time of the identified downward peak as a heartbeat time.</p><p id="p-0070" num="0064">For example, the predetermined time region before and after the sampling point i is a region of &#x2212;112.5 ms to &#x2212;12.5 ms and a region of +12.5 ms to +112.5 ms with respect to the time at the sampling point i.</p><p id="p-0071" num="0065">The second storage unit <b>113</b> temporarily stores the minimum value of the temporal difference value acquired by the acquisition unit <b>116</b>, the index value obtained by the index value calculation unit <b>115</b>, and the heartbeat time determined by the determination unit <b>114</b>.</p><heading id="h-0015" level="1">Hardware Configuration of Heartbeat Detection Device</heading><p id="p-0072" num="0066">Next, an example of hardware configuration for realizing the heartbeat detection device <b>1</b> having the above-described functions will be described with reference to <figref idref="DRAWINGS">FIG. <b>6</b></figref>.</p><p id="p-0073" num="0067">As shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>, the heartbeat detection device <b>1</b> can be realized by a computer including a CPU <b>101</b>, a memory <b>102</b>, an AFE <b>103</b>, an ADC <b>104</b>, and a communication I/F <b>106</b> connected via a bus and programs for controlling these hardware resources, for example. For example, a sensor <b>105</b> provided externally is connected to the heartbeat detection device <b>1</b> via the bus. The heartbeat detection device <b>1</b> also includes a power source <b>107</b> and provides power supply to the entire device except for the sensor <b>105</b> as shown in <figref idref="DRAWINGS">FIG. <b>5</b></figref>.</p><p id="p-0074" num="0068">Programs for performing various control and computational operations by the CPU <b>101</b> are stored in the memory <b>102</b> in advance. The functions of the heartbeat detection device <b>1</b> including the sensor data acquisition unit <b>10</b>, the heartbeat time calculation unit <b>11</b>, the correction unit <b>12</b> and the heart rate calculation unit <b>13</b> shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref> are realized by the CPU <b>101</b> and the memory <b>102</b>.</p><p id="p-0075" num="0069">The sensor <b>105</b> is realized by an electrocardiograph or the like and measures weak electrocardiographic signals through the skin of the user.</p><p id="p-0076" num="0070">The AFE (Analog Front End) <b>103</b> is a circuit for amplifying the analog electrocardiographic signals measured by the sensor <b>105</b>.</p><p id="p-0077" num="0071">The ADC (Analog-to-Digital Converter) <b>104</b> is a circuit for converting the analog signals amplified by the AFE <b>103</b> into digital signals with a predetermined sampling frequency. The AFE <b>103</b> and the ADC <b>104</b> realize the sensor data acquisition unit <b>10</b> illustrated in <figref idref="DRAWINGS">FIG. <b>1</b></figref>.</p><p id="p-0078" num="0072">The memory <b>102</b> is realized by a non-volatile memory such as a flash memory, a volatile memory such as a DRAM, or the like. The memory <b>102</b> temporarily stores time-series data of signals output from the ADC <b>104</b>. The memory <b>102</b> realizes the first storage unit <b>14</b> illustrated in <figref idref="DRAWINGS">FIG. <b>1</b></figref> and the second storage unit illustrated in <figref idref="DRAWINGS">FIG. <b>5</b></figref>.</p><p id="p-0079" num="0073">In addition, the memory <b>102</b> has a program storage region for storing programs for performing the heartbeat detection process by the heartbeat detection device <b>1</b>. Further, for example, it may also have a backup region for backing up the above-described data and programs and the like.</p><p id="p-0080" num="0074">The communication I/F <b>106</b> is a interface circuit for performing communication with various external electronic devices via a communication network NW.</p><p id="p-0081" num="0075">As the communication I/F <b>106</b>, a communication interface or an antenna compatible with wired or wireless data communication standards such as LTE, 3G, Bluetooth (R), Bluetooth Low Energy, and Ethernet (R), for example, is used. The transmission/reception unit <b>15</b> illustrated in <figref idref="DRAWINGS">FIG. <b>1</b></figref> is realized by the communication I/F <b>106</b>.</p><p id="p-0082" num="0076">Note that the heartbeat detection device <b>1</b> acquire time information from a clock integrated in the CPU <b>101</b> or a time server (not shown) and uses it as a sampling time.</p><heading id="h-0016" level="1">Heartbeat Detection Method</heading><p id="p-0083" num="0077">Next, operations of the heartbeat detection device <b>1</b> having the above-described configuration will be described by using the flow chart in <figref idref="DRAWINGS">FIG. <b>7</b></figref>. First, when the sensor <b>105</b> consisting of an electrocardiograph is worn on the user and measurement of electrocardiographic signals is started, the following process is performed.</p><p id="p-0084" num="0078">First, the sensor data acquisition unit <b>10</b> acquires an electrocardiographic signal of the user, for example, from the sensor <b>105</b> (step S<b>1</b>). The sensor data acquisition unit <b>10</b> amplifies the electrocardiographic signal, samples it with a predetermined sampling frequency, and outputs a digital ECG waveform. The sampling data of the ECG waveform is stored in the first storage unit <b>14</b>.</p><p id="p-0085" num="0079">Next, the heartbeat time calculation unit <b>11</b> reads the sampling data D(i) of the ECG waveform from the first storage unit <b>14</b> and calculates a heartbeat time (step S<b>2</b>).</p><p id="p-0086" num="0080">Here, a heartbeat time calculation process performed by the heartbeat time calculation unit <b>11</b> in step S<b>2</b> will be described with reference to <figref idref="DRAWINGS">FIG. <b>8</b></figref>.</p><p id="p-0087" num="0081">First, the first calculation unit <b>110</b> reads data D(i+1) of the next sampling to the sampling data D(i) and data D(i&#x2212;1) of the previous sampling in order to calculate the temporal difference value DY(i) of the sampling data D(i) from the first storage unit <b>14</b> (step S<b>200</b>).</p><p id="p-0088" num="0082">Next, the first calculation unit no calculates the temporal difference value DY(i) of the sampling data D(i) from equation (1) (step S<b>201</b>). Next, the first determination unit <b>111</b> determines whether the temporal difference value DY(i) is below the threshold TH (step S<b>202</b>).</p><p id="p-0089" num="0083">Next, when it is determined that the temporal difference value DY(i) is not below the threshold TH (step S<b>202</b>: NO), the second determination unit <b>112</b> determines whether the first elapsed time T1, which is the elapsed time from the immediately preceding heartbeat time to the sampling time (the time indicated by i) of the sampling data D(i) to be processed, is in the range of the first time interval Tinr1 (step S<b>203</b>).</p><p id="p-0090" num="0084">When it is determined that the first elapsed time T1 is in the range of the first time interval Tinr1, that is, when the sampling time of the sampling data D(i) to be processed is in a time region before the next assumed heartbeat time (step S<b>203</b>: YES), the second storage unit <b>113</b> updates the minimum value Mini of the temporal difference value in the range of the first time interval Tinr1 (step S<b>204</b>). That is, the second storage unit <b>113</b> compares the temporal difference value DY(i) of the sampling data D(i) to be processed and the current minimum value Min1, and when the temporal difference value DY(i) to be processed is smaller than the current minimum value Min1, sets the temporal difference value DY(i) as a new minimum value Min1. The process then returns to step S<b>200</b>. Note that, when it is determined in step S<b>203</b> that the first elapsed time T1 is out of the range of the first time interval Tinr1, the process returns to step S<b>200</b> without updating the minimum value Min1.</p><p id="p-0091" num="0085">On the other hand, when it is determined that the temporal difference value DY(i) exceeds the threshold TH (step S<b>202</b>: YES), the first calculation unit <b>110</b> reads data D(j+1) of the next sampling to sampling data D(j) and data D(j&#x2212;1) of the previous sampling from the first storage unit <b>14</b> in order to calculate a temporal difference value DY(j) of the next sampling data D(j) (j is an integer of j&#x2265;(i+1) and its initial value is j=i+1) (step S<b>205</b>). Then, the first calculation unit <b>110</b> calculates the temporal difference value DY(j) of the sampling data D(j) in the same way as the above equation (1) (step S<b>206</b>).</p><p id="p-0092" num="0086">A time determination unit <b>5</b> determines whether the elapsed time from the time at which the temporal difference value Y(i) exceeds the threshold TH to the sampling time (the time indicated by i) of the sampling data X(j) to be processed (the second elapsed time T2) is in the range of the second time interval Tinr2 (step S<b>207</b>).</p><p id="p-0093" num="0087">When it is determined that the second elapsed time T2 is in the range of the second time interval Tinr2, that is, when the sampling time of the sampling data D(j) to be processed is in a time region assumed to include a peak of the temporal difference value (step S<b>207</b>: YES), the second storage unit <b>113</b> updates the minimum value Min2 of the temporal difference value in the range of the second time interval Tinr2 (step S<b>208</b>). That is, the second storage unit <b>113</b> compares the temporal difference value DY(j) of the sampling data D(j) to be processed and the current minimum value Min2, and when the temporal difference value DY(j) to be processed is smaller than the current minimum value Min2, sets the temporal difference value DY(j) as a new minimum value Min2. The process then returns to step S<b>205</b>.</p><p id="p-0094" num="0088">Thus, the processes of steps S<b>205</b> to S<b>208</b> are repeatedly performed while shifting the processing target toward sampling data D(j) of a newer sampling time such that j=i+1, i+2, i+3, i+4, . . . until the second elapsed time T2 is out of the range of the second time interval Tinr2.</p><p id="p-0095" num="0089">Next, when it is determined in step S<b>207</b> that the second elapsed time T2 exceeds the range of the second time interval Tinr2, that is, when the sampling time exceeds the time region assumed to include the peak of the temporal difference value, the first calculation unit no reads data D(k+1) of the next sampling to sampling data D(k) and data D(k&#x2212;1) of the previous sampling from the first storage unit <b>14</b> in order to calculate a temporal difference value DY(k) of the next sampling data D(k) (k is an integer of k&#x2265;(j+1) and its initial value is k=j+1) (step S<b>209</b>). Then, the first calculation unit no calculates the temporal difference value DY(k) of the sampling data D(k) in the same way as the above equation (1) (step S<b>210</b>).</p><p id="p-0096" num="0090">The second determination unit <b>112</b> determines whether the elapsed time from the time at which it is determined in step S<b>207</b> that the second elapsed time T2 exceeds the range of the second time interval Tinr2 to the sampling time (the time indicated by k) of the sampling data D(k) to be processed (the third elapsed time T3) is in the range of the third time interval Tinr3 (step S<b>211</b>).</p><p id="p-0097" num="0091">When it is determined that the third elapsed time T3 is in the range of the third time interval Tinr3, that is, when the sampling time of the sampling data D(k) to be processed is in a certain time region after the peak of the temporal difference value (step S<b>211</b>: YES), the second storage unit <b>113</b> updates the minimum value Min3 of the temporal difference value in the range of the third time interval Tinr3 (step S<b>212</b>). That is, the second storage unit <b>113</b> compares the temporal difference value DY(k) of the sampling data D(k) to be processed and the current minimum value Min3, and when the temporal difference value DY(k) to be processed is smaller than the current minimum value Min3, sets the temporal difference value DY(k) as a new minimum value Min3. The process then returns to step S<b>209</b>.</p><p id="p-0098" num="0092">Thus, the processes of steps S<b>209</b> to S<b>212</b> are repeatedly performed while shifting the processing target toward sampling data D(k) of a newer sampling time such that k=j+1, j+2, j+3, j+4, . . . until the third elapsed time T3 is out of the range of the third time interval Tinr3.</p><p id="p-0099" num="0093">Next, when it is determined in step S<b>211</b> that the third elapsed time T3 is out of the range of the third time interval Tinr3, that is, when the sampling time of the sampling data D(k) to be processed exceeds the certain time region after the peak of the temporal difference value, the determination unit <b>114</b> determines whether the relationship between the three minimum values Min1, Min2 and Min3 satisfies a predetermined condition for fixing the heartbeat time (step S<b>213</b>).</p><p id="p-0100" num="0094">Here, the minimum value Min2 corresponds to the magnitude of the detected peak of the temporal difference value of the sampling data, the minimum value Min1 corresponds to a floor level in a certain region before the peak, and the minimum value Min3 corresponds to a floor level in a certain region after the peak. If the peak of the temporal difference value is a unimodal negative peak, the minimum value Min2 must have a larger absolute value than the minimum values Min1 and Min3.</p><p id="p-0101" num="0095">The determination unit <b>114</b> can determine that the predetermined condition is satisfied when the ratios Min2/Min1 and Min2/Min3 both exceed a predetermined value and determine that the predetermined condition is not satisfied when at least one of the ratios Min2/Min1 and Min2/Min3 is less than or equal to the predetermined value.</p><p id="p-0102" num="0096">When it is determined that the relationship between the three minimum values Min1, Min2 and Min3 satisfies the condition for fixing the heartbeat time (step S<b>213</b>: YES), the determination unit <b>114</b> adopts, as a heartbeat time, a time at which the temporal difference value DY(i) exceeds the threshold TH or the latest time at which the minimum value Min2 is updated (the time of the peak of the temporal difference value) (step S<b>214</b>).</p><p id="p-0103" num="0097">After step S<b>214</b> ends, the process returns to step S<b>200</b> by setting i=k+1. Then, detection of the next heartbeat is started. In addition, although the process also returns to step S<b>200</b> by setting i=k+1 when it is determined in step S<b>213</b> that the relationship between the three minimum values Min1, Min2 and Min3 does not satisfies the condition for fixing the heartbeat time, in this case, the temporal difference value exceeding the threshold TH detected in step S<b>202</b> is not due to a heartbeat but a noise, and the heartbeat is not detected yet.</p><p id="p-0104" num="0098">By repeating the processes of steps S<b>200</b> to S<b>214</b> in this manner, time-series data of heartbeat times can be obtained.</p><p id="p-0105" num="0099">Next, returning to <figref idref="DRAWINGS">FIG. <b>7</b></figref>, the correction unit <b>12</b> corrects the heartbeat time obtained by the heartbeat time calculation unit <b>11</b> (step S<b>3</b>). More specifically, the correction unit <b>12</b> identifies a time at which the temporal difference value of the ECG waveform becomes o from ECG waveform data based on the heartbeat time calculated by the heartbeat time calculation unit <b>11</b>. In addition, the correction unit <b>12</b> uses the time at which the identified temporal difference value becomes 0 as a reference time for calculating the R-R interval. More specifically, the correction unit <b>12</b> identifies a time at which the temporal difference value becomes 0 on a straight line passing through two points of an immediately preceding temporal difference value DY(n) in the ECG waveform data at the heartbeat time calculated by the heartbeat time calculation unit <b>11</b> and the immediately following temporal difference value DY(n&#x2212;1), and regards it as a reference time for calculating the R-R interval. The time at which the temporal difference value becomes 0 in the ECG waveform identified by the correction unit <b>12</b> is the time of an R wave in the ECG waveform.</p><p id="p-0106" num="0100">Next, the heart rate calculation unit <b>13</b> calculates the heart rate X [bpm] from the latest heartbeat time corrected by using the reference time, at which the temporal difference value becomes 0, identified by the correction unit <b>12</b> (step S<b>4</b>). More specifically, the heart rate calculation unit <b>13</b> calculates an instantaneous heart rate X by equation (3) mentioned above, where the R-R interval, which is a time obtained by subtracting from the latest heartbeat time calculated and fixed by the correction unit <b>12</b> its preceding heartbeat time, is defined as RRI [ms]. Alternatively, the heart rate calculation unit <b>13</b> can also calculate an average heart rate X by using equation (4) mentioned above, instead of the instantaneous heart rate.</p><p id="p-0107" num="0101">Subsequently, the transmission/reception unit <b>15</b> sends the instantaneous heart rate X or average heart rate X calculated by the heart rate calculation unit <b>13</b> to an external terminal (not shown) such as a smartphone via a communication network in a wired or wireless manner (step S<b>5</b>).</p><heading id="h-0017" level="1">Effects of Heartbeat Detection Device</heading><p id="p-0108" num="0102">Next, effects of the heartbeat detection device <b>1</b> according to the present embodiment will be described with reference to <figref idref="DRAWINGS">FIG. <b>9</b></figref>. The example of <figref idref="DRAWINGS">FIG. <b>9</b></figref> shows detection results of the R-R interval (RRI) in the presence and absence of the correction unit <b>12</b> when an electrocardiographic waveform with a constant heart rate of 60 [bpm] is input. In <figref idref="DRAWINGS">FIG. <b>9</b></figref>, the horizontal axis indicates time, and the vertical axis indicates the R-R interval. &#x201c;Quadrangular&#x201d; markers indicate measurement results by a heartbeat detection device not including the correction unit <b>12</b> according to a conventional example. On the other hand, &#x201c;circular&#x201d; markers indicate measurement results by the heartbeat detection device <b>1</b> including the correction unit <b>12</b> according to the present embodiment.</p><p id="p-0109" num="0103">In the example of <figref idref="DRAWINGS">FIG. <b>9</b></figref>, heartbeat times calculated by the heartbeat time calculation unit <b>11</b>A described in reference literature 1 and reference literature 2 as the heartbeat time calculation unit <b>11</b> are used. In addition, the sampling interval is 10 [ms]. It can be seen from the calculation results in <figref idref="DRAWINGS">FIG. <b>9</b></figref> that detect errors are reduced due to the introduction of the correction unit <b>12</b>. In addition, it is demonstrated that the heartbeat detection device <b>1</b> according to the present embodiment can detect the heartbeat and the RRI with an accuracy exceeding the sampling interval from the ECG waveform.</p><p id="p-0110" num="0104">As described above, with the heartbeat detection device <b>1</b> according to the present embodiment, since a time at which the temporal difference value becomes 0, that is, the time of an R wave in the electrocardiographic waveform is identified on a straight line passing through two points of the temporal difference value DY(n) of the electrocardiographic waveform at the heartbeat time calculated by the heartbeat time calculation unit <b>11</b> and the immediately preceding temporal difference value DY(n&#x2212;1) and the R-R interval is corrected by using the identified time, it is possible to more accurately measure the heart rate of a living body.</p><p id="p-0111" num="0105">In addition, according to the present embodiment, it is possible to accurately detect the heart rate of the user even when the interval of data acquisition for acquiring the heart rate of the user with an electrocardiograph is set to be larger in order to reduce power consumption.</p><p id="p-0112" num="0106">Note that, although a case of detecting the heart rate is illustrated in the described embodiment, there is no limitation to the heart rate, and application is also possible for calculating the heart rate on the basis of biological information with periodicity such as brain waves and for correcting other feature values of the R-R interval included in the ECG waveform, for example, sample data such as P, Q, S and T waves.</p><p id="p-0113" num="0107">In addition, in the described embodiment, a case of using the techniques described in Patent Literature 3 and reference literatures 1 and 2 has been described as a specific example of the heartbeat time calculation unit <b>11</b>. However, the heartbeat time calculation unit <b>11</b> is not limited to the heartbeat time calculation method described in these literatures, and the heartbeat detection device <b>1</b> according to the present embodiment can be applied.</p><p id="p-0114" num="0108">In addition, the heartbeat time calculation method described in Patent Literature 3 and reference literatures 1 and 2 can reduce erroneous heartbeat detection caused by fluctuation of the base line or a steep noise such as due to body motions and sweating as compared to the conventional heartbeat detection techniques. Thus, by combining the heartbeat time calculation method described in Patent Literature 3 and reference literatures 1 and 2 and the correction unit <b>12</b> according to embodiments of the present invention, it is possible to calculate the heart rate with a higher accuracy.</p><p id="p-0115" num="0109">Although the embodiment of the heartbeat detection device, the heartbeat detection method, and the heartbeat detection program of the present invention has been described above, the present invention is not limited to the described embodiment, and various modifications are possible that can be conceived by those skilled in the art within the scope of the invention defined in the claims.</p><heading id="h-0018" level="1">REFERENCE SIGNS LIST</heading><p id="p-0116" num="0000"><ul id="ul0001" list-style="none">    <li id="ul0001-0001" num="0000">    <ul id="ul0002" list-style="none">        <li id="ul0002-0001" num="0110"><b>1</b> Heartbeat detection device</li>        <li id="ul0002-0002" num="0111"><b>10</b> Sensor data acquisition unit</li>        <li id="ul0002-0003" num="0112"><b>11</b>, <b>11</b>A Heartbeat time calculation unit</li>        <li id="ul0002-0004" num="0113"><b>12</b> Correction unit</li>        <li id="ul0002-0005" num="0114"><b>13</b> Heart rate calculation unit</li>        <li id="ul0002-0006" num="0115"><b>14</b> First storage unit</li>        <li id="ul0002-0007" num="0116"><b>15</b> Transmission/reception unit</li>        <li id="ul0002-0008" num="0117"><b>110</b> First calculation unit</li>        <li id="ul0002-0009" num="0118"><b>111</b> First determination unit</li>        <li id="ul0002-0010" num="0119"><b>112</b> Second determination unit</li>        <li id="ul0002-0011" num="0120"><b>113</b> Second storage unit</li>        <li id="ul0002-0012" num="0121"><b>114</b> Determination unit</li>        <li id="ul0002-0013" num="0122"><b>115</b> Index value calculation unit</li>        <li id="ul0002-0014" num="0123"><b>116</b> Acquisition unit</li>        <li id="ul0002-0015" num="0124"><b>101</b> CPU</li>        <li id="ul0002-0016" num="0125"><b>102</b> Memory</li>        <li id="ul0002-0017" num="0126"><b>103</b> AFE</li>        <li id="ul0002-0018" num="0127"><b>104</b> ADC</li>        <li id="ul0002-0019" num="0128"><b>105</b> Sensor</li>        <li id="ul0002-0020" num="0129"><b>106</b> Communication I/F</li>        <li id="ul0002-0021" num="0130"><b>107</b> Power source.</li>    </ul>    </li></ul></p><?detailed-description description="Detailed Description" end="tail"?></description><us-math idrefs="MATH-US-00001" nb-file="US20230000440A1-20230105-M00001.NB"><img id="EMI-M00001" he="8.47mm" wi="76.20mm" file="US20230000440A1-20230105-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00002" nb-file="US20230000440A1-20230105-M00002.NB"><img id="EMI-M00002" he="8.13mm" wi="76.20mm" file="US20230000440A1-20230105-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><claims id="claims"><claim id="CLM-001-7" num="001-7"><claim-text><b>1</b>-<b>7</b>. (canceled)</claim-text></claim><claim id="CLM-00008" num="00008"><claim-text><b>8</b>. A heartbeat detection device comprising:<claim-text>a sensor data acquisition circuit configured to acquire sensor data indicating an electrocardiographic waveform of a living body and output a sampling data sequence based on the sensor data;</claim-text><claim-text>a first calculation circuit configured to calculate a temporal difference value of sampling data from the sampling data sequence for a plurality of sampling times;</claim-text><claim-text>a determination circuit configured to determine a heartbeat time on the basis of a time at which a change in the temporal difference value calculated by the first calculation circuit exceeds a set threshold;</claim-text><claim-text>a correction circuit configured to correct the heartbeat time in accordance with a reference time, the reference time being is a time at which the temporal difference value becomes zero on a straight line passing through two points of a first temporal difference value of sampling data at the heartbeat time and a second temporal difference value of an immediately preceding sampling data; and</claim-text><claim-text>a second calculation circuit configured to calculate a heart rate of the living body from the heartbeat time corrected by the correction circuit.</claim-text></claim-text></claim><claim id="CLM-00009" num="00009"><claim-text><b>9</b>. The heartbeat detection device according to <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein<claim-text>the two points of the sampling data at the heartbeat time and the immediately preceding sampling data are points on an interval from a first inflection point immediately before an R wave included in the electrocardiographic waveform to a second inflection point immediately after the R wave.</claim-text></claim-text></claim><claim id="CLM-00010" num="00010"><claim-text><b>10</b>. The heartbeat detection device according to <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the second calculation circuit is further configured to:<claim-text>calculate an R-R interval that is a time interval of an R wave included in the electrocardiographic waveform of the living body and a preceding R wave in accordance with the reference time obtained by the correction circuit; and</claim-text><claim-text>calculate the heart rate of the living body from the R-R interval.</claim-text></claim-text></claim><claim id="CLM-00011" num="00011"><claim-text><b>11</b>. A heartbeat detection method comprising:<claim-text>a first step of acquiring, by a sensor data acquisition circuit, sensor data indicating an electrocardiographic waveform of a living body and outputting a sampling data sequence based on the sensor data;</claim-text><claim-text>a second step of calculating, by a first calculation circuit, a temporal difference value of sampling data from the sampling data sequence output in the first step for a plurality of sample times;</claim-text><claim-text>a third step of determining, by a determination circuit, a heartbeat time on the basis of a time at which a change in the temporal difference value calculated in the second step exceeds a set threshold;</claim-text><claim-text>a fourth step of correcting, by a correction circuit, the heartbeat time by using a reference time, the reference time being a time at which the temporal difference value becomes zero on a straight line passing through two points of a first temporal difference value of sampling data at the heartbeat time determined in the third step and a second temporal difference value of an immediately preceding sampling data; and</claim-text><claim-text>a fifth step of calculating, a second calculation circuit, a heart rate of the living body from the heartbeat time corrected in the fourth step.</claim-text></claim-text></claim><claim id="CLM-00012" num="00012"><claim-text><b>12</b>. The heartbeat detection method according to <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein the two points of the sampling data at the heartbeat time determined in the third step and the immediately preceding sampling data are points on an interval from a first inflection point immediately before an R wave included in the electrocardiographic waveform to a second inflection point immediately after the R wave.</claim-text></claim><claim id="CLM-00013" num="00013"><claim-text><b>13</b>. The heartbeat detection method according to claim ii, wherein the fifth step comprises:<claim-text>calculating an R-R interval, the R-R interval being a time interval of an R wave included in the electrocardiographic waveform of the living body and a preceding R wave by using the reference time obtained in the fourth step; and</claim-text><claim-text>calculating the heart rate of the living body from the R-R interval.</claim-text></claim-text></claim><claim id="CLM-00014" num="00014"><claim-text><b>14</b>. A heartbeat detection program that causes a computer to perform:<claim-text>a first step of acquiring sensor data indicating an electrocardiographic waveform of a living body and outputting a sampling data sequence based on the sensor data;</claim-text><claim-text>a second step of calculating a temporal difference value of sampling data from the sampling data sequence output in the first step for a plurality of sample times;</claim-text><claim-text>a third step of determining a heartbeat time on the basis of a time at which a change in the temporal difference value calculated in the second step exceeds a set threshold;</claim-text><claim-text>a fourth step of correcting the heartbeat time by using a reference time, the reference time being a time at which the temporal difference value becomes zero on a straight line passing through two points of a first temporal difference value of sampling data at the heartbeat time determined in the third step and a second temporal difference value of an immediately preceding sampling data; and</claim-text><claim-text>a fifth step of calculating a heart rate of the living body from the heartbeat time corrected in the fourth step.</claim-text></claim-text></claim></claims></us-patent-application>