<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230003904A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230003904</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17363360</doc-number><date>20210630</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>01</class><subclass>S</subclass><main-group>19</main-group><subgroup>39</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>01</class><subclass>S</subclass><main-group>19</main-group><subgroup>47</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>01</class><subclass>S</subclass><main-group>19</main-group><subgroup>49</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20190801</date></cpc-version-indicator><section>G</section><class>01</class><subclass>S</subclass><main-group>19</main-group><subgroup>396</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc><further-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>01</class><subclass>S</subclass><main-group>19</main-group><subgroup>47</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>01</class><subclass>S</subclass><main-group>19</main-group><subgroup>49</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></further-cpc></classifications-cpc><invention-title id="d2e43">APPARATUS, SYSTEM AND METHOD FOR GENERALIZED MULTI-MODE STATE MACHINE BASED LOCALIZATION ENGINE AND APPLICATION OF SAME</invention-title><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>Guangzhou Xiaopeng Autopilot Technology Co., Ltd.</orgname><address><city>Guangzhou</city><country>CN</country></address></addressbook><residence><country>CN</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>Wang</last-name><first-name>Pengluo</first-name><address><city>San Diego</city><state>CA</state><country>US</country></address></addressbook></inventor><inventor sequence="01" designation="us-only"><addressbook><last-name>Zhuang</last-name><first-name>Hairuo</first-name><address><city>San Diego</city><state>CA</state><country>US</country></address></addressbook></inventor><inventor sequence="02" designation="us-only"><addressbook><last-name>Bansal</last-name><first-name>Amit</first-name><address><city>San Diego</city><state>CA</state><country>US</country></address></addressbook></inventor><inventor sequence="03" designation="us-only"><addressbook><last-name>Li</last-name><first-name>Xue</first-name><address><city>San Diego</city><state>CA</state><country>US</country></address></addressbook></inventor><inventor sequence="04" designation="us-only"><addressbook><last-name>Ekambaram</last-name><first-name>Venkatesan Nallampatti</first-name><address><city>San Diego</city><state>CA</state><country>US</country></address></addressbook></inventor><inventor sequence="05" designation="us-only"><addressbook><last-name>Sethuraman</last-name><first-name>Vignesh</first-name><address><city>San Diego</city><state>CA</state><country>US</country></address></addressbook></inventor></inventors></us-parties></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">An apparatus and a method for performing positioning using a Global Navigation Satellite System (GNSS) with a state machine based localization engine are provided. When the apparatus receives GNSS signals, the apparatus provides the localization engine to process the GNSS signals, and determines, based on a GNSS status and a position-velocity-time (PVT) status, a state of the localization engine. Specifically, the state of the localization engine is switchable between at least 3 states, including a dead reckoning state, a tightly coupling state, and a loosely coupling state. Once the state is determined, the localization engine may determine a local accuracy status based on the state of the localization engine. Thus, a downstream module on the apparatus may use the local accuracy status to perform a corresponding downstream action.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="106.26mm" wi="158.75mm" file="US20230003904A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="186.18mm" wi="149.44mm" orientation="landscape" file="US20230003904A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="194.23mm" wi="130.64mm" orientation="landscape" file="US20230003904A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="95.93mm" wi="126.58mm" orientation="landscape" file="US20230003904A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="215.56mm" wi="145.46mm" orientation="landscape" file="US20230003904A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00005" num="00005"><img id="EMI-D00005" he="196.93mm" wi="112.27mm" orientation="landscape" file="US20230003904A1-20230105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00006" num="00006"><img id="EMI-D00006" he="200.07mm" wi="151.81mm" orientation="landscape" file="US20230003904A1-20230105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00007" num="00007"><img id="EMI-D00007" he="145.12mm" wi="152.82mm" orientation="landscape" file="US20230003904A1-20230105-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0001" level="1">FIELD OF THE INVENTION</heading><p id="p-0002" num="0001">The present invention relates generally to satellite navigation technology, and more particularly to an apparatus, system and method for performing positioning using a Global Navigation Satellite System (GNSS) with a state machine based localization engine, and applications of the same.</p><heading id="h-0002" level="1">BACKGROUND OF THE INVENTION</heading><p id="p-0003" num="0002">The background description provided herein is for the purpose of generally presenting the context of the present invention. The subject matter discussed in the background of the invention section should not be assumed to be prior art merely as a result of its mention in the background of the invention section. Similarly, a problem mentioned in the background of the invention section or associated with the subject matter of the background of the invention section should not be assumed to have been previously recognized in the prior art. The subject matter in the background of the invention section merely represents different approaches, which in and of themselves may also be inventions.</p><p id="p-0004" num="0003">The Global Navigation Satellite System (GNSS) is an essential part for obtaining accurate global position. In some cases, a user may use an electronic receiver with a localization engine thereon, such as an extended Kalman filter (EKF) engine, to receive signals from GNSS to perform geo-spatial positioning with high precision. However, GNSS can be of low quality when the signal is blocked by tunnels, bridges, buildings, and even trees. Further, downstream modules on the electronic receiver may theoretically use the covariance output of the localization engine to determine the quality of localization and take appropriate actions. In some cases, however, the covariance matrix may not reflect the true quality of the solution.</p><p id="p-0005" num="0004">Therefore, a heretofore unaddressed need exists in the art to address the aforementioned deficiencies and inadequacies.</p><heading id="h-0003" level="1">SUMMARY OF THE INVENTION</heading><p id="p-0006" num="0005">The present invention relates to an apparatus, system and method for performing positioning using a Global Navigation Satellite System (GNSS) with a generalized multi-mode state machine based localization engine, and application of the same. Specifically, the apparatus provides a state machine based localization engine switchable between multiple states and local accuracy statuses, in order to control different behaviors of EKF based on the quality of raw GNSS observations and PVT solution given by on-board chip.</p><p id="p-0007" num="0006">In one aspect of the invention, an apparatus for performing positioning using a Global Navigation Satellite System (GNSS) with a state machine based localization engine is provided. In certain embodiments, the apparatus includes: a receiving device communicatively connected to the GNSS, configured to receive GNSS signals from the GNSS; and a computing device having a processor and a storage device storing computer executable instructions. The computer executable instructions, when executed on the processor, cause the processor to: provide the localization engine to process the GNSS signals; determine, based on a GNSS status and a position-velocity-time (PVT) status, a state of the localization engine, wherein the state of the localization engine is switchable between at least 3 states, and the at least 3 states include a dead reckoning state, a tightly coupling state, and a loosely coupling state; determine, by the localization engine, a local accuracy status based on the state of the localization engine; and perform, by a downstream module, a downstream action based on the local accuracy status.</p><p id="p-0008" num="0007">Another aspect of the invention relates to a method for performing positioning using a Global Navigation Satellite System (GNSS) with a state machine based localization engine. In certain embodiments, the method includes: receiving, by an apparatus communicatively connected to the GNSS, GNSS signals from the GNSS; providing the localization engine on the apparatus to process the GNSS signals; determining, based on a GNSS status and a position-velocity-time (PVT) status, a state of the localization engine, wherein the state of the localization engine is switchable between at least 3 states, and the at least 3 states include a dead reckoning state, a tightly coupling state, and a loosely coupling state; determining, by the localization engine, a local accuracy status based on the state of the localization engine; and performing, by a downstream module executed on the apparatus, a downstream action based on the local accuracy status.</p><p id="p-0009" num="0008">In one embodiment, the GNSS status indicates, based on a quantity of inliers in the GNSS, whether there is valid GNSS observation or good GNSS observation; and the PVT status indicates, based on PVT accuracy values, whether there is valid PVT observation or good PVT observation.</p><p id="p-0010" num="0009">In one embodiment, the GNSS status indicates valid GNSS observation when the quantity of the inliers in the GNSS is greater than or equal to 2, and indicates good GNSS observation when the quantity of the inliers in the GNSS is greater than or equal to 7; and the PVT status indicates valid PVT observation when a horizontal accuracy value is less than 0.5, and indicates good PVT observation when the horizontal accuracy value is less than 0.2.</p><p id="p-0011" num="0010">In one embodiment, the localization engine is switched to the dead reckoning state in response to determine that there is no valid GNSS observation for a predetermined time period; the localization engine is switched to the loosely coupling state in response to determine that there is good GNSS observation; and the localization engine is switched to the tightly coupling state in response to determine that there is valid PVT observation but no good GNSS observation for the predetermined time period.</p><p id="p-0012" num="0011">In one embodiment, the predetermined time period is 5 seconds.</p><p id="p-0013" num="0012">In one embodiment, the local accuracy status is switchable between a dead reckoning mode, a GNSS based localization mode and a PVT based localization mode.</p><p id="p-0014" num="0013">In one embodiment, the local accuracy status is switched to the dead reckoning mode when a last GNSS update time is greater than 1 second; the local accuracy status is switched to the GNSS based localization mode when the last GNSS update time is less than 1 second; and the local accuracy status is switched to the PVT based localization mode when: (1) the last GNSS update time is less than 1 second, the state of the localization engine is in the loosely coupling state, and the localization engine passes a PVT innovation test; or (2) the local accuracy status is in the GNSS based localization mode for 5 second, and the localization engine passes the PVT innovation test.</p><p id="p-0015" num="0014">In one embodiment, the downstream module is a map fusion module.</p><p id="p-0016" num="0015">Another aspect of the invention relates to a vehicle having the apparatus as described above.</p><p id="p-0017" num="0016">A further aspect of the invention relates to a non-transitory tangible computer-readable medium storing computer executable instructions which, when executed by one or more processors, cause the method as described above to be performed.</p><p id="p-0018" num="0017">These and other aspects of the present invention will become apparent from the following description of the preferred embodiments, taken in conjunction with the following drawings, although variations and modifications therein may be affected without departing from the spirit and scope of the novel concepts of the disclosure.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p-0019" num="0018">The accompanying drawings illustrate one or more embodiments of the invention and, together with the written description, serve to explain the principles of the invention. The same reference numbers may be used throughout the drawings to refer to the same or like elements in the embodiments.</p><p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. <b>1</b></figref> shows schematically an overall architecture of a Global Navigation Satellite System (GNSS) according to one embodiment of the invention.</p><p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. <b>2</b>A</figref> shows schematically a computing device of the GNSS receiver according to one embodiment of the invention.</p><p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. <b>2</b>B</figref> shows schematically an outlier detection module in the computing device as shown in <figref idref="DRAWINGS">FIG. <b>2</b>A</figref> according to one embodiment of the invention.</p><p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. <b>3</b></figref> shows schematically a state flow of a 3-state localization engine according to one embodiment of the invention, where the state of the localization engine is switchable between a dead reckoning state GNSS_DR, a tightly coupling state GNSS_TC, and a loosely coupling state GNSS_LC.</p><p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. <b>4</b></figref> shows schematically a status flow of the localization accuracy status according to one embodiment of the invention.</p><p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. <b>5</b></figref> shows schematically a state flow of a 4-state localization engine according to one embodiment of the invention, where the state of the localization engine is switchable between a dead reckoning state GNSS_DR, a differential GPS (DGPS) tightly coupling state DGPS-TC, a carrier phase (CP) tightly coupling state CP-TC, and a PVT loosely coupling state PVT-LC.</p><p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. <b>6</b></figref> shows a flowchart of a method for performing positioning using the GNSS with a state machine based localization engine according to one embodiment of the invention.</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><heading id="h-0005" level="1">DETAILED DESCRIPTION OF THE INVENTION</heading><p id="p-0027" num="0026">The invention will now be described more fully hereinafter with reference to the accompanying drawings, in which exemplary embodiments of the invention are shown. This invention may, however, be embodied in many different forms and should not be construed as limited to the embodiments set forth herein. Rather, these embodiments are provided so that this invention will be thorough and complete, and will fully convey the scope of the invention to those skilled in the art. Like reference numerals refer to like elements throughout.</p><p id="p-0028" num="0027">The terms used in this specification generally have their ordinary meanings in the art, within the context of the invention, and in the specific context where each term is used. Certain terms that are used to describe the invention are discussed below, or elsewhere in the specification, to provide additional guidance to the practitioner regarding the description of the invention. For convenience, certain terms may be highlighted, for example using italics and/or quotation marks. The use of highlighting has no influence on the scope and meaning of a term; the scope and meaning of a term is the same, in the same context, whether or not it is highlighted. It will be appreciated that same thing can be said in more than one way. Consequently, alternative language and synonyms may be used for any one or more of the terms discussed herein, nor is any special significance to be placed upon whether or not a term is elaborated or discussed herein. Synonyms for certain terms are provided. A recital of one or more synonyms does not exclude the use of other synonyms. The use of examples anywhere in this specification including examples of any terms discussed herein is illustrative only, and in no way limits the scope and meaning of the invention or of any exemplified term. Likewise, the invention is not limited to various embodiments given in this specification.</p><p id="p-0029" num="0028">It will be understood that, as used in the description herein and throughout the claims that follow, the meaning of &#x201c;a&#x201d;, &#x201c;an&#x201d;, and &#x201c;the&#x201d; includes plural reference unless the context clearly dictates otherwise. Also, it will be understood that when an element is referred to as being &#x201c;on&#x201d; another element, it can be directly on the other element or intervening elements may be present therebetween. In contrast, when an element is referred to as being &#x201c;directly on&#x201d; another element, there are no intervening elements present. As used herein, the term &#x201c;and/or&#x201d; includes any and all combinations of one or more of the associated listed items.</p><p id="p-0030" num="0029">It will be understood that, although the terms first, second, third etc. may be used herein to describe various elements, components, regions, layers and/or sections, these elements, components, regions, layers and/or sections should not be limited by these terms. These terms are only used to distinguish one element, component, region, layer or section from another element, component, region, layer or section. Thus, a first element, component, region, layer or section discussed below could be termed a second element, component, region, layer or section without departing from the teachings of the invention.</p><p id="p-0031" num="0030">Furthermore, relative terms, such as &#x201c;lower&#x201d; or &#x201c;bottom&#x201d; and &#x201c;upper&#x201d; or &#x201c;top,&#x201d; may be used herein to describe one element's relationship to another element as illustrated in the figures. It will be understood that relative terms are intended to encompass different orientations of the device in addition to the orientation depicted in the figures. For example, if the device in one of the figures is turned over, elements described as being on the &#x201c;lower&#x201d; side of other elements would then be oriented on &#x201c;upper&#x201d; sides of the other elements. The exemplary term &#x201c;lower&#x201d;, can therefore, encompasses both an orientation of &#x201c;lower&#x201d; and &#x201c;upper,&#x201d; depending of the particular orientation of the figure. Similarly, if the device in one of the figures is turned over, elements described as &#x201c;below&#x201d; or &#x201c;beneath&#x201d; other elements would then be oriented &#x201c;above&#x201d; the other elements. The exemplary terms &#x201c;below&#x201d; or &#x201c;beneath&#x201d; can, therefore, encompass both an orientation of above and below.</p><p id="p-0032" num="0031">It will be further understood that the terms &#x201c;comprises&#x201d; and/or &#x201c;comprising,&#x201d; or &#x201c;includes&#x201d; and/or &#x201c;including&#x201d; or &#x201c;has&#x201d; and/or &#x201c;having&#x201d;, or &#x201c;carry&#x201d; and/or &#x201c;carrying,&#x201d; or &#x201c;contain&#x201d; and/or &#x201c;containing,&#x201d; or &#x201c;involve&#x201d; and/or &#x201c;involving, and the like are to be open-ended, i.e., to mean including but not limited to. When used in this invention, they specify the presence of stated features, regions, integers, steps, operations, elements, and/or components, but do not preclude the presence or addition of one or more other features, regions, integers, steps, operations, elements, components, and/or groups thereof.</p><p id="p-0033" num="0032">Unless otherwise defined, all terms (including technical and scientific terms) used herein have the same meaning as commonly understood by one of ordinary skill in the art to which this invention belongs. It will be further understood that terms, such as those defined in commonly used dictionaries, should be interpreted as having a meaning that is consistent with their meaning in the context of the relevant art and the present invention, and will not be interpreted in an idealized or overly formal sense unless expressly so defined herein.</p><p id="p-0034" num="0033">As used herein, the phrase at least one of A, B, and C should be construed to mean a logical (A or B or C), using a non-exclusive logical OR. As used herein, the term &#x201c;and/or&#x201d; includes any and all combinations of one or more of the associated listed items.</p><p id="p-0035" num="0034">As used herein, the term module may refer to, be part of, or include an Application Specific Integrated Circuit (ASIC); an electronic circuit; a combinational logic circuit; a field programmable gate array (FPGA); a processor (shared, dedicated, or group) that executes code; other suitable hardware components that provide the described functionality; or a combination of some or all of the above, such as in a system-on-chip. The term module may include memory (shared, dedicated, or group) that stores code executed by the processor.</p><p id="p-0036" num="0035">The terms chip or computer chip, as used herein, generally refers to a hardware electronic component, and may refer to or include a small electronic circuit unit, also known as an integrated circuit (IC), or a combination of electronic circuits or ICs.</p><p id="p-0037" num="0036">As used herein, the term microcontroller unit or its acronym MCU generally refers to a small computer on a single IC chip that can execute programs for controlling other devices or machines. A microcontroller unit contains one or more CPUs (processor cores) along with memory and programmable input/output (I/O) peripherals, and is usually designed for embedded applications.</p><p id="p-0038" num="0037">The term interface, as used herein, generally refers to a communication tool or means at a point of interaction between components for performing wired or wireless data communication between the components. Generally, an interface may be applicable at the level of both hardware and software, and may be uni-directional or bi-directional interface. Examples of physical hardware interface may include electrical connectors, buses, ports, cables, terminals, and other I/O devices or components. The components in communication with the interface may be, for example, multiple components or peripheral devices of a computer system.</p><p id="p-0039" num="0038">The term code, as used herein, may include software, firmware, and/or microcode, and may refer to programs, routines, functions, classes, and/or objects. Some or all code from multiple modules may be executed using a single (shared) processor. In addition, some or all code from multiple modules may be stored by a single (shared) memory. Further, some or all code from a single module may be executed using a group of processors. Moreover, some or all code from a single module may be stored using a group of memories.</p><p id="p-0040" num="0039">The apparatuses and methods will be described in the following detailed description and illustrated in the accompanying drawings by various blocks, components, circuits, processes, algorithms, etc. (collectively referred to as &#x201c;elements&#x201d;). These elements may be implemented using electronic hardware, computer software, or any combination thereof. Whether such elements are implemented as hardware or software depends upon the particular application and design constraints imposed on the overall system. By way of example, an element, or any portion of an element, or any combination of elements may be implemented as a &#x201c;processing system&#x201d; that includes one or more processors. Examples of processors include microprocessors, microcontrollers, graphics processing units (GPUs), central processing units (CPUs), application processors, digital signal processors (DSPs), reduced instruction set computing (RISC) processors, systems on a chip (SoC), baseband processors, field programmable gate arrays (FPGAs), programmable logic devices (PLDs), state machines, gated logic, discrete hardware circuits, and other suitable hardware configured to perform the various functionality described throughout this disclosure. One or more processors in the processing system may execute software. Software shall be construed broadly to mean instructions, instruction sets, code, code segments, program code, programs, subprograms, software components, applications, software applications, software packages, routines, subroutines, objects, executables, threads of execution, procedures, functions, etc., whether referred to as software, firmware, middleware, microcode, hardware description language, or otherwise.</p><p id="p-0041" num="0040">Accordingly, in one or more example embodiments, the functions described may be implemented in hardware, software, or any combination thereof If implemented in software, the functions may be stored on or encoded as one or more instructions or code on a computer-readable medium. Computer-readable media includes computer storage media. Storage media may be any available media that can be accessed by a computer. By way of example, and not limitation, such computer-readable media can comprise a random-access memory (RAM), a read-only memory (ROM), an electrically erasable programmable ROM (EEPROM), optical disk storage, magnetic disk storage, other magnetic storage devices, combinations of the aforementioned types of computer-readable media, or any other medium that can be used to store computer executable code in the form of instructions or data structures that can be accessed by a computer.</p><p id="p-0042" num="0041">The description below is merely illustrative in nature and is in no way intended to limit the invention, its application, or uses. The broad teachings of the invention can be implemented in a variety of forms. Therefore, while this invention includes particular examples, the true scope of the invention should not be so limited since other modifications will become apparent upon a study of the drawings, the specification, and the following claims. For purposes of clarity, the same reference numbers will be used in the drawings to identify similar elements. It should be understood that one or more steps within a method may be executed in different order (or concurrently) without altering the principles of the invention.</p><p id="p-0043" num="0042">As discussed above, the GNSS can be of low quality in some cases when the signal is blocked by outer structures. For example, most on-board chips in the GNSS receiver provide their own PVT solutions with possibly more satellites and frequency bands. Thus, the PVT solutions could be better than what the consumer obtained from the raw GNSS data (with less observations).</p><p id="p-0044" num="0043">Further, as discussed above, downstream modules provided on the GNSS receiver can theoretically use the covariance output of the localization engine to determine the quality of localization and take appropriate actions. However, the covariance matrix may not always reflect the true quality of the solution, as covariance is independent of several factors like consistency with different observations, which may fail to capture the underlying accuracy of localization.</p><p id="p-0045" num="0044">In view of the deficiencies, certain aspects of the invention relate to an apparatus which provides a state machine based localization engine switchable between multiple states and local accuracy statuses, in order to control different behaviors of EKF based on the quality of raw GNSS observations and PVT solution given by on-board chip. Further, the localization engine may define a localization accuracy detector, which provides a semantic output to downstream modules, allowing the downstream module to make a more informed decision utilizing the localization output.</p><p id="p-0046" num="0045">One aspect of the invention relates to an apparatus for performing positioning using a GNSS with a state machine based localization engine. <figref idref="DRAWINGS">FIG. <b>1</b></figref> shows schematically an overall architecture of a GNSS according to one embodiment of the invention. As shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref>, the GNSS <b>100</b> includes a GNSS receiver <b>110</b> and a plurality of satellites <b>120</b>. Specifically, the GNSS receiver <b>110</b> may be an apparatus having a receiving device communicatively connected to the satellites <b>120</b>, such that the GNSS receiver <b>110</b> may receive GNSS signals from the satellites <b>120</b>. In certain embodiments, the GNSS receiver <b>110</b> may be an in-vehicle device installed or mounted in a vehicle, which may be a car, a motocycle, a plane, a ship, a rover or other types of vehicles that require positioning or localization functions. Further, the GNSS receiver <b>110</b> also includes a computing device to process the GNSS signals received from the satellites <b>120</b> and to perform positioning or localization functions. In certain embodiment, the computing device may be an in-vehicle computer, such as the built-in electronic control unit (ECU) of the vehicle. Alternatively, in certain embodiments, the computing device may be an individual computing device or control unit of the GNSS receiver <b>110</b>, which runs independently and separately from the existing ECU of the vehicle. In certain embodiments, the computing device may be a general purpose computer being provided with the necessary hardware and/or software components to perform positioning or localization functions, or may be a specialized computer or controller specifically designed and configured to perform positioning or localization functions.</p><p id="p-0047" num="0046"><figref idref="DRAWINGS">FIG. <b>2</b>A</figref> shows schematically a computing device according to one embodiment of the invention. Specifically, the computing device <b>200</b> as shown in <figref idref="DRAWINGS">FIG. <b>2</b>A</figref> is used as the computing device of the GNSS receiver <b>110</b> (i.e., the apparatus) as shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref>. As shown in <figref idref="DRAWINGS">FIG. <b>2</b>A</figref>, the computing device <b>200</b> includes a processor <b>210</b>, a memory <b>220</b>, and a storage device <b>230</b>, and a bus <b>240</b> interconnecting the processor <b>210</b>, the memory <b>220</b> and the storage device <b>230</b>. In certain embodiments, the computing device <b>200</b> may include necessary hardware and/or software components (not shown) to perform its corresponding tasks. Examples of these hardware and/or software components may include, but not limited to, other required memory modules, interfaces, buses, Input/Output (I/O) modules and peripheral devices, and details thereof are not elaborated herein.</p><p id="p-0048" num="0047">The processor <b>210</b> controls operation of the computing device <b>200</b>, which may be used to execute any computer executable code or instructions. In certain embodiments, the processor <b>210</b> may be a central processing unit (CPU), and the computer executable code or instructions being executed by the processor <b>210</b> may include an operating system (OS) and other applications, codes or instructions stored in the computing device <b>200</b>. In certain embodiments, the computing device <b>200</b> may run on multiple processors, which may include any suitable number of processors.</p><p id="p-0049" num="0048">The memory <b>220</b> may be a volatile memory module, such as the random-access memory (RAM), for storing the data and information during the operation of the computing device <b>200</b>. In certain embodiments, the memory <b>220</b> may be in the form of a volatile memory array. In certain embodiments, the computing device <b>200</b> may run on more than one memory <b>220</b>.</p><p id="p-0050" num="0049">The storage device <b>230</b> is a non-volatile storage media or device for storing the computer executable code or instructions, such as the OS and the software applications for the computing device <b>200</b>. Examples of the storage device <b>230</b> may include flash memory, memory cards, USB drives, or other types of non-volatile storage devices such as hard drives, floppy disks, optical drives, or any other types of data storage devices. In certain embodiments, the computing device <b>200</b> may have more than one storage device <b>230</b>, and the software applications of the computing device <b>200</b> may be stored in the more than one storage device <b>230</b> separately.</p><p id="p-0051" num="0050">As shown in <figref idref="DRAWINGS">FIG. <b>2</b>A</figref>, the computer executable code stored in the storage device <b>230</b> may include a localization engine <b>250</b> and a map fusion module <b>255</b>. Specifically, the localization engine <b>250</b> is a generalized multi-mode state machine based localization engine which, when executed, provides the localization functions for performing the positioning. In certain embodiments, the localization engine <b>250</b> may be an EKF engine or other types of localization engines. <figref idref="DRAWINGS">FIG. <b>2</b>B</figref> shows schematically a localization engine in the computing device as shown in <figref idref="DRAWINGS">FIG. <b>2</b>A</figref> according to one embodiment of the invention. Specifically, the localization engine <b>250</b> as shown in <figref idref="DRAWINGS">FIG. <b>2</b>B</figref> includes a GNSS detection module <b>260</b>, a PVT module <b>270</b>, and a localization state module <b>280</b>. Further, although not explicitly shown in <figref idref="DRAWINGS">FIG. <b>2</b>B</figref>, a database, which may be in the form of a table or other data collections, is provided to store and record the GNSS/PVT and/or other information required for the localization functions. For example, for each of the satellites in a GNSS, the status of the satellite may be detected as an outlier or an inlier, and the status as detected may be stored in the database.</p><p id="p-0052" num="0051">The GNSS detection module <b>260</b> is used to process the GNSS signals received from the satellites in the GNS S, and to detect the status of each of the satellites in the GNSS. Specifically, the GNSS detection module <b>260</b> may determine a GNSS status, which is used to indicate the status of the GNSS observation (hereinafter the &#x201c;ObsGNSS&#x201d;), based on the status of each of the satellites in the GNSS. In certain embodiments, the GNSS detection module <b>260</b> may detect the status of each satellite in the GNSS as an outlier or an inlier, and then correspondingly determine the GNSS status based on the quantity of the inliers in the GNSS. In one embodiment, the GNSS detection module <b>260</b> may set a first threshold value for a valid ObsGNSS and a second threshold value for a good ObsGNSS. For example, the first threshold value may be set as 2, such that the GNSS status may indicate valid ObsGNSS when the quantity of the inliers in the GNSS is greater than or equal to 2; and the second threshold value may be set as 7, such that the GNSS status may indicate good ObsGNSS when the quantity of the inliers in the GNSS is greater than or equal to 7. On the other hand, when the quantity of the inliers in the GNSS is less than 2, the GNSS status may indicate that there is no valid or good ObsGNSS.</p><p id="p-0053" num="0052">In the exemplary embodiment stated above, the GNSS detection module <b>260</b> determines the GNSS status based on the quantity of the inliers in the GNSS. However, the GNSS detection module <b>260</b> may detect each satellite in the GNSS as either an inlier or an outlier. Thus, in an alternative embodiment, it is also possible to determine the GNSS status based on the quantity of the outliers in the GNSS. The inlier/outlier detection may be performed using existing detection algorithms. For example, existing algorithms such as Doppler-pseudorange comparison, Random Sampling Consensus (RANSAC) check, history-based outlier rejection, or a combination thereof, may be used to perform GNSS outlier detection and/or rejection. Details of the inlier/outlier detection is not hereinafter elaborated.</p><p id="p-0054" num="0053">The PVT module <b>270</b> is used to perform PVT observation for each of the satellites in the GNSS. Specifically, in the GNSS-Signal Processing Blocks (SDR) flow graph, the PVT block is the last one, and it acts as a signal sink, as the stream of data flowing along the GNSS receiver ends in the PVT block. In certain embodiments, the PVT module <b>270</b> may be in the form of the existing PVT solution on the on-board chip, or may be a modified software module that provides the PVT observation functions. Specifically, the PVT module <b>270</b> may determine a PVT status, which is used to indicate the status of the PVT observation (hereinafter the &#x201c;ObsPVT&#x201d;), based on the PVT accuracy values and other PVT related factors. In certain embodiments, for example, the horizontal accuracy value h_acc may be used to determine the PVT status by setting up a plurality of horizontal accuracy threshold values. In one embodiments, a first threshold value of 0.5 and a second threshold value of 0.2 may be preset, such that the PVT status indicates valid ObsPVT when h_acc&#x3c;0.5 (i.e., the horizontal accuracy value h_acc is less than the first threshold value of 0.5), and indicates good ObsPVT when h_acc&#x3c;0.2 (i.e., the horizontal accuracy value h_acc is less than the second threshold value of 0.2). On the other hand, when h_acc&#x3e;0.5, the PVT module <b>270</b> may determine that there is no valid or good ObsPVT. In certain embodiments, the PVT status may be determined with other factors involved. For example, the PVT module <b>270</b> may determine that there is valid or good ObsPVT when the heading direction is accurate. Details of the PVT accuracy values and/or other factors being used may vary, and are thus not hereinafter elaborated.</p><p id="p-0055" num="0054">The localization state module <b>280</b> is used to perform determination of the state of the localization engine <b>250</b> as well as the local accuracy status. Specifically, the localization state module <b>280</b> may generate the state of the localization state module <b>280</b> based on the GNSS status determined by the GNSS detection module <b>260</b> and the PVT status determined by the PVT module <b>270</b>, and then determine the local accuracy status based on the state of the localization engine <b>280</b>.</p><p id="p-0056" num="0055">As discussed above, the localization engine is a state machine based localization engine, in which the state thereof is switchable between multiple predetermined states. Specifically, the state machine is used for the localization engine in order to handle situations for EKF resetting (e.g., when the vehicle enters or comes out of a tunnel). For example, <figref idref="DRAWINGS">FIG. <b>3</b></figref> shows schematically a state flow of a 3-state localization engine according to one embodiment of the invention, where the state of the localization engine is switchable between a dead reckoning state GNSS_DR, a tightly coupling state GNSS_TC, and a loosely coupling state GNSS_LC. Specifically, the 3 states as shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref> are intuitively designed based on practical situations, which are elaborated as follows:<ul id="ul0001" list-style="none">    <li id="ul0001-0001" num="0000">    <ul id="ul0002" list-style="none">        <li id="ul0002-0001" num="0056">The dead reckoning (DR) state GNSS_DR <b>310</b>: this is the state when EKF (i.e., the localization engine) does not consume GNSS/PVT observations and only use inertial navigation system (INS) propagation. In certain embodiment, the GNSS_DR state is the initial state.</li>        <li id="ul0002-0002" num="0057">The tightly coupling (TC) state GNSS_TC <b>320</b>: in this state, EKF (i.e., the localization engine) will consume valid GNSS observation and good PVT observation.</li>        <li id="ul0002-0003" num="0058">The loosely coupling (LC) state GNSS_LC <b>330</b>: in this state, EKF (i.e., the localization engine) consumes only PVT observation in a loosely coupling way, as there is no good GNSS observation.</li>    </ul>    </li></ul></p><p id="p-0057" num="0059">As shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>, when the localization engine is in the DR state GNSS_DR, the localization engine does not consume ObsGNSS or ObsPVT. At this time, if there is no good ObsGNSS, but there is valid ObsPVT (e.g., h_acc&#x3c;0.5) for a predetermined time period, e.g., 5 seconds, the localization engine is switched from the DR state GNSS_DR to the LC state GNSS_LC, such that the localization engine may consume the valid ObsPVT. On the other hand, if there is good ObsGNSS (e.g., quantity of inlier&#x3e;=7), the localization engine is switched from the DR state GNSS_DR to the TC state GNSS_TC, such that the localization engine may consume the valid or good ObsGNSS.</p><p id="p-0058" num="0060">Further, when the localization engine is in the LC state GNSS_LC, the localization engine only consumes the valid ObsPVT, as there is no valid ObsGNSS in this state. At this time, if there is no valid ObsPVT (e.g., h_acc&#x3e;0.5) for the predetermined time period, e.g., 5 seconds, the localization engine is switched from the LC state GNSS_LC to the DR state GNSS_DR. On the other hand, if there is good ObsGNSS (e.g., quantity of inlier&#x3e;=7), the localization engine is switched from the LC state GNSS_LC to the TC state GNSS_TC, such that the localization engine may consume the valid or good ObsGNSS.</p><p id="p-0059" num="0061">Moreover, when the localization engine is in the TC state GNSS TC, the localization engine may consumes the valid ObsGNSS, and may consume good ObsPVT only if the ObsGNSS exists. At this time, if there is no valid ObsGNSS (e.g., quantity of inlier&#x3c;2) for the predetermined time period, e.g., 5 seconds, the localization engine is switched from the TC state GNSS_TC to the DR state GNSS_DR. It should be noted that there is no case that the localization engine is switched from the TC state GNSS_TC directly to the LC state GNSS_LC.</p><p id="p-0060" num="0062">It should be noted that the conditions (i.e., the GNSS status and the PVT status) as shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref> for the localization engine to switch between the different states are provided as one exemplary embodiment, and are thus not intended to limit the scope of the invention.</p><p id="p-0061" num="0063">Referring back to <figref idref="DRAWINGS">FIG. <b>2</b>A</figref>, the map fusion module <b>255</b> is a downstream module of the apparatus that may perform corresponding downstream map fusion actions, such as tracking the apparatus in a preset map, based on the input of the localization engine <b>250</b>. For example, as discussed above, the localization state module <b>280</b> is used to perform determination of the localization accuracy status. Specifically, the localization state module <b>280</b> may define a localization accuracy detector, which provides the localization accuracy status as a semantic output to a downstream module, such as the map fusion module <b>255</b> as shown in <figref idref="DRAWINGS">FIG. <b>2</b>A</figref>, thus allowing the downstream map fusion module <b>255</b> to make a more informed decision utilizing the output of the localization engine <b>250</b>.</p><p id="p-0062" num="0064">Specifically, in certain embodiments, when the apparatus <b>100</b> is mounted on a vehicle, the map fusion module <b>255</b> may be used to control autonomous driving of the vehicle based on a map and the information provided by the localization engine <b>250</b>. For example, in certain embodiments, level 3 driving requires the vehicle to be in a &#x201c;Drive by Map&#x201d; mode, in which the position of the vehicle with respect to a preset map is tracked. However, when the position of the vehicle cannot be tracked successfully in the map, the map fusion module <b>255</b> may downgrade to level 2 driving, which is in a &#x201c;Drive by Perception&#x201d; mode. Ideally, a user would want the vehicle to be in the level 3 self-driving mode as much as possible. Thus, the map fusion module <b>255</b> may utilize the output of the localization accuracy status by the localization state module <b>280</b> in order to control the switch between the level 2 and level 3 self-driving mode.</p><p id="p-0063" num="0065">In certain embodiments, there are some assumptions about the localization function that the map fusion module <b>255</b> has to trigger an upgrade from the level 2 mode to the level 3 mode. For example, the map fusion module <b>255</b> would assume the localization to be lane level accurate. Thus, the localization engine <b>250</b> (or the localization state module <b>280</b> therein) has to indicate its estimated accuracy to the map fusion module <b>255</b>. Accordingly, the localization accuracy status may be output in a Loc_Acc_St field to relay the information to the map fusion module <b>255</b> (or any other downstream module that may use this information to perform corresponding downstream actions).</p><p id="p-0064" num="0066"><figref idref="DRAWINGS">FIG. <b>4</b></figref> shows schematically a status flow of the localization accuracy status according to one embodiment of the invention. Specifically, as shown in <figref idref="DRAWINGS">FIG. <b>4</b></figref>, the local accuracy status is switchable between 3 modes, including:<ul id="ul0003" list-style="none">    <li id="ul0003-0001" num="0000">    <ul id="ul0004" list-style="none">        <li id="ul0004-0001" num="0067">a dead reckoning (DR) mode (indicated by Loc_Acc_St=0);</li>        <li id="ul0004-0002" num="0068">a GNSS based localization mode (indicated by Loc_Acc_St=1); and</li>        <li id="ul0004-0003" num="0069">a PVT based localization mode (indicated by Loc_Acc_St=2).</li>    </ul>    </li></ul></p><p id="p-0065" num="0070">The DR mode (Loc_Acc_St=0) indicates that EKF (i.e., the localization engine) was not consuming ObsGNSS or ObsPVT. In other words, the DR mode corresponds to the DR state of the localization engine. In the DR mode, if the last GNSS update time is greater than 1 second (or any predetermined time threshold), the local accuracy status is switched to the DR mode. When the last GNSS update time becomes less than 1 second, the local accuracy status is switched to the GNSS based localization mode. On the other hand, when the last GNSS update time is less than 1 second and the state of the localization engine is in the LC state, the local accuracy status may be switched to the PVT based localization mode.</p><p id="p-0066" num="0071">Further, the GNSS based localization mode (Loc_Acc_St=<b>1</b>) indicates that localization may be based on ObsGNSS. In other words, the GNSS based localization mode may correspond to the TC state of the localization engine. If the last GNSS update time is less than 1 second (or any predetermined time threshold), the local accuracy status is switched to the GNSS based localization mode. In the GNSS based localization mode, if the last GNSS update time becomes greater than 1 second, the local accuracy status may be switched back to the DR mode. On the other hand, if the local accuracy status is out of the DR mode for more than 5 seconds (or any other predetermined time threshold), the local accuracy status may be switched to the PVT based localization mode.</p><p id="p-0067" num="0072">Moreover, the PVT based localization mode (Loc_Acc_St=2) indicates that localization may be based on ObsPVT. In other words, the GNSS based localization mode may correspond to the LC and/or TC states of the localization engine. If the last GNSS update time is less than 1 second (or any predetermined time threshold) and the state of the localization engine is in the LC state, the local accuracy status is switched to the PVT based localization mode. In addition, if the local accuracy status is in the GNSS based localization mode (and is thus out of the DR mode) for more than 5 seconds (or any other predetermined time threshold), the local accuracy status is also switched to the PVT based localization mode. In the PVT based localization mode, if the last GNSS update time becomes greater than 1 second, the local accuracy status may be switched back to the DR mode.</p><p id="p-0068" num="0073">In certain embodiment, a PVT innovation test may be performed as a part of the condition for the PVT based localization mode. An example of the PVT innovation test may be performed as follows:</p><p id="p-0069" num="0074">1) If the PVT is not consuming real-time kinematic (RTK), then the status is reported as a NO_RTK-PVT. The following formula shows the determination:</p><p id="p-0070" num="0000"><tables id="TABLE-US-00001" num="00001"><table frame="none" colsep="0" rowsep="0" pgwide="1"><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="259pt" align="left"/><thead><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>If ( hacc &#x3c; h_acc_thershold &#x2225; s_acc &#x3c; s_Acc &#x3c; threshold &#x2225; !fix_ok &#x2225; !diff_sol)</entry></row><row><entry>&#x2003;pvt solution = NO_RTK_PVT</entry></row><row><entry>&#x2003;2) If the EKF error with respect to the PVT innovation test is less than a threshold</entry></row><row><entry>and the PVT accuracies are high, then the status is set as EKF_CONSISTENT, else the</entry></row><row><entry>status is HIGH_PVT_ERROR. The following formula shows the determination:</entry></row><row><entry>If ( abs(ekf_pvt_error_cbf_lateral &#x3c; PVT_RESIDUAL_MAX_ERR &#x26;&#x26; h_err &#x3c;</entry></row><row><entry>MAX_HACC_SACC &#x26;&#x26; s_err &#x3c; MAX_HACC_SACC &#x26;&#x26; fix_ok &#x26;&#x26; diff_sol )</entry></row><row><entry>&#x2003;pvt_solution = EKF CONSISTENT PVT</entry></row><row><entry>else</entry></row><row><entry>&#x2003;pvt_solution = HIGH_PVT_ERROR (test failed)</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0071" num="0075">When the PVT innovation test is performed as a part of the condition for the PVT based localization mode, the localization engine must pass the PVT innovation test (i.e., pvt_solution!=HIGH_PVT_ERROR) in order to stay in the PVT based localization mode. In other words, the condition for the PVT based localization mode may be summarized as: (1) the last GNSS update time is less than 1 second, the state of the localization engine is in the LC state, and the localization engine passes the PVT innovation test, or (2) the local accuracy status is in the GNSS based localization mode (and thus being out of the DR mode) for 5 second, and the localization engine passes a PVT innovation test.</p><p id="p-0072" num="0076">In certain embodiments, the map fusion module <b>255</b> may use the local accuracy status (or the value of Loc_Acc_St) to assign an initial variance to localization, and trigger an upgrade from the level 2 mode to the level 3 mode.</p><p id="p-0073" num="0077">In certain embodiments, the advantages of using the state machine based localization engine as described above include:<ul id="ul0005" list-style="none">    <li id="ul0005-0001" num="0000">    <ul id="ul0006" list-style="none">        <li id="ul0006-0001" num="0078">Using the state machine to control abnormal EKF behavior, such as position resetting when going out of tunnel.</li>        <li id="ul0006-0002" num="0079">By using the internal counter and the innovation test, the state machine will choose suitable action to make for DR, LC, and TC, making the localization engine more stable under multiple situations.</li>        <li id="ul0006-0003" num="0080">Better handling of situations and corner case when GNSS observations is of low quality with flexible design of state transition conditions.</li>    </ul>    </li></ul></p><p id="p-0074" num="0081">It should be particularly emphasized that the localization accuracy status as shown in <figref idref="DRAWINGS">FIG. <b>4</b></figref> does not necessarily one-to-one correspond with the state of the localization engine as shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>. For example, the localization engine could be in the TC state, but the localization accuracy status could be either in the GNSS based localization mode or in the PVT based localization mode.</p><p id="p-0075" num="0082">In the embodiment as shown in <figref idref="DRAWINGS">FIGS. <b>3</b> and <b>4</b></figref>, a 3-state localization engine is used. However, the localization engine may be a 4-state localization engine, in which the state thereof is switchable between 4 different states. For example, <figref idref="DRAWINGS">FIG. <b>5</b></figref> shows schematically a state flow of a 4-state localization engine according to one embodiment of the invention, where the state of the localization engine is switchable between a dead reckoning state DR <b>510</b>, a differential GPS (DGPS) tightly coupling state DGPS-TC <b>520</b>, a carrier phase (CP) tightly coupling state CP-TC <b>525</b>, and a PVT loosely coupling state PVT-LC <b>530</b>. Specifically, the TC state <b>320</b> as shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref> is separated into two individual states, including the DGPS TC state DGPS-TC <b>520</b> and the CP TC state CP-TC <b>525</b>. The conditions for switching between the states may be similar to those as shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>.</p><p id="p-0076" num="0083">Another aspect of the invention relates to a method for performing positioning using a GNSS with a state machine based localization engine. For example, <figref idref="DRAWINGS">FIG. <b>6</b></figref> shows a flowchart of a method for performing positioning using the GNSS with a state machine based localization engine according to one embodiment of the invention. In certain embodiments, the method as shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref> may be implemented on the GNSS receiver <b>110</b> (i.e., the apparatus) as shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref> and the computing device <b>200</b> as shown in <figref idref="DRAWINGS">FIGS. <b>2</b>A and <b>2</b>B</figref>. It should be particularly noted that, unless otherwise stated in the present disclosure, the steps of the method may be arranged in a different sequential order, and are thus not limited to the sequential order as shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>.</p><p id="p-0077" num="0084">As shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>, at the process <b>610</b>, the apparatus may provide a state machine based localization engine, such as the localization engine as shown in <figref idref="DRAWINGS">FIGS. <b>2</b>A and <b>2</b>B</figref>. At the process <b>620</b>, the localization engine determines a state thereof based on the GNSS status and the PVT status. For example, when the localization engine is a 3-state localization engine, the state of the localization engine may be switchable between the DC state, the TC state and the LC state as shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>. Once the state of the localization engine is determined, at the process <b>630</b>, the localization engine may determine a local accuracy status based on the state of the localization engine. An example of the local accuracy status may be referenced to in the status flow as shown in <figref idref="DRAWINGS">FIG. <b>4</b></figref>. Using the method, the local accuracy status may be generated as a semantic output by the localization engine, which is then passed to a downstream module, such as such as the map fusion module <b>255</b> as shown in <figref idref="DRAWINGS">FIG. <b>2</b>A</figref>. At the process <b>640</b>, the downstream module may perform a corresponding downstream action based on the local accuracy status. In this case, the downstream modules can appropriately take corresponding actions on the localization pose output depending on the state of the localization engine.</p><p id="p-0078" num="0085">Yet another aspect of the invention provides a non-transitory tangible computer-readable medium storing instructions which, when executed by one or more processors of the GNSS receiver, cause the above disclosed method for performing positioning using a GNSS with a state machine based localization engine to be performed. The computer executable instructions or program codes enable the above disclosed GNSS receiver (i.e., the apparatus) or a similar system or apparatus to complete various operations in accordance with the above disclosed method. The storage medium/memory may include, but is not limited to, high-speed random access medium/memory such as DRAM, SRAM, DDR RAM or other random access solid state memory devices, and non-volatile memory such as one or more magnetic disk storage devices, optical disk storage devices, flash memory devices, or other non-volatile solid state storage devices.</p><p id="p-0079" num="0086">The foregoing description of the exemplary embodiments of the invention has been presented only for the purposes of illustration and description and is not intended to be exhaustive or to limit the invention to the precise forms disclosed. Many modifications and variations are possible in light of the above teaching.</p><p id="p-0080" num="0087">The embodiments were chosen and described in order to explain the principles of the invention and their practical application so as to enable others skilled in the art to utilize the invention and various embodiments and with various modifications as are suited to the particular use contemplated. Alternative embodiments will become apparent to those skilled in the art to which the invention pertains without departing from its spirit and scope. Accordingly, the scope of the invention is defined by the appended claims rather than the foregoing description and the exemplary embodiments described therein.</p><p id="p-0081" num="0088">Some references, which may include patents, patent applications and various publications, are cited and discussed in the description of this disclosure. The citation and/or discussion of such references is provided merely to clarify the description of the present disclosure and is not an admission that any such reference is &#x201c;prior art&#x201d; to the disclosure described herein. All references cited and discussed in this specification are incorporated herein by reference in their entireties and to the same extent as if each reference was individually incorporated by reference.</p><?detailed-description description="Detailed Description" end="tail"?></description><us-claim-statement>What is claimed is:</us-claim-statement><claims id="claims"><claim id="CLM-00001" num="00001"><claim-text><b>1</b>. An apparatus for performing positioning using a Global Navigation Satellite System (GNSS) with a state machine based localization engine, the apparatus comprising:<claim-text>a receiving device communicatively connected to the GNSS, configured to receive GNSS signals from the GNSS; and</claim-text><claim-text>a computing device having a processor and a storage device storing computer executable instructions, wherein the computer executable instructions, when executed on the processor, cause the processor to:<claim-text>provide the localization engine to process the GNSS signals;</claim-text><claim-text>determine, based on a GNSS status and a position-velocity-time (PVT) status, a state of the localization engine, wherein the state of the localization engine is switchable between at least 3 states, and the at least 3 states include a dead reckoning state, a tightly coupling state, and a loosely coupling state;</claim-text><claim-text>determine, by the localization engine, a local accuracy status based on the state of the localization engine; and</claim-text><claim-text>perform, by a downstream module, a downstream action based on the local accuracy status.</claim-text></claim-text></claim-text></claim><claim id="CLM-00002" num="00002"><claim-text><b>2</b>. The apparatus of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein:<claim-text>the GNSS status indicates, based on a quantity of inliers in the GNSS, whether there is valid GNSS observation or good GNSS observation; and</claim-text><claim-text>the PVT status indicates, based on PVT accuracy values, whether there is valid PVT observation or good PVT observation.</claim-text></claim-text></claim><claim id="CLM-00003" num="00003"><claim-text><b>3</b>. The apparatus of <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein:<claim-text>the GNSS status indicates valid GNSS observation when the quantity of the inliers in the GNSS is greater than or equal to 2, and indicates good GNSS observation when the quantity of the inliers in the GNSS is greater than or equal to 7; and</claim-text><claim-text>the PVT status indicates valid PVT observation when a horizontal accuracy value is less than 0.5, and indicates good PVT observation when the horizontal accuracy value is less than 0.2.</claim-text></claim-text></claim><claim id="CLM-00004" num="00004"><claim-text><b>4</b>. The apparatus of <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein:<claim-text>the localization engine is switched to the dead reckoning state in response to determine that there is no valid GNSS observation for a predetermined time period;</claim-text><claim-text>the localization engine is switched to the loosely coupling state in response to determine that there is good GNSS observation; and</claim-text><claim-text>the localization engine is switched to the tightly coupling state in response to determine that there is valid PVT observation but no good GNSS observation for the predetermined time period.</claim-text></claim-text></claim><claim id="CLM-00005" num="00005"><claim-text><b>5</b>. The apparatus of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the predetermined time period is 5 seconds.</claim-text></claim><claim id="CLM-00006" num="00006"><claim-text><b>6</b>. The apparatus of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the local accuracy status is switchable between a dead reckoning mode, a GNSS based localization mode and a PVT based localization mode.</claim-text></claim><claim id="CLM-00007" num="00007"><claim-text><b>7</b>. The apparatus of <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein:<claim-text>the local accuracy status is switched to the dead reckoning mode when a last GNSS update time is greater than 1 second;</claim-text><claim-text>the local accuracy status is switched to the GNSS based localization mode when the last GNSS update time is less than 1 second; and</claim-text><claim-text>the local accuracy status is switched to the PVT based localization mode when:<claim-text>(1) the last GNSS update time is less than 1 second, the state of the localization engine is in the loosely coupling state, and the localization engine passes a PVT innovation test; or</claim-text><claim-text>(2) the local accuracy status is in the GNSS based localization mode for 5 second, and the localization engine passes the PVT innovation test.</claim-text></claim-text></claim-text></claim><claim id="CLM-00008" num="00008"><claim-text><b>8</b>. The apparatus of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the downstream module is a map fusion module.</claim-text></claim><claim id="CLM-00009" num="00009"><claim-text><b>9</b>. A vehicle having the apparatus of <claim-ref idref="CLM-00001">claim 1</claim-ref>.</claim-text></claim><claim id="CLM-00010" num="00010"><claim-text><b>10</b>. A method for performing positioning using a Global Navigation Satellite System (GNSS) with a state machine based localization engine, the method comprising:<claim-text>receiving, by an apparatus communicatively connected to the GNSS, GNSS signals from the GNSS;</claim-text><claim-text>providing the localization engine on the apparatus to process the GNSS signals;</claim-text><claim-text>determining, based on a GNSS status and a position-velocity-time (PVT) status, a state of the localization engine, wherein the state of the localization engine is switchable between at least 3 states, and the at least 3 states include a dead reckoning state, a tightly coupling state, and a loosely coupling state;</claim-text><claim-text>determining, by the localization engine, a local accuracy status based on the state of the localization engine; and</claim-text><claim-text>performing, by a downstream module executed on the apparatus, a downstream action based on the local accuracy status.</claim-text></claim-text></claim><claim id="CLM-00011" num="00011"><claim-text><b>11</b>. The method of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein:<claim-text>the GNSS status indicates, based on a quantity of inliers in the GNSS, whether there is valid GNSS observation or good GNSS observation; and</claim-text><claim-text>the PVT status indicates, based on PVT accuracy values, whether there is valid PVT observation or good PVT observation.</claim-text></claim-text></claim><claim id="CLM-00012" num="00012"><claim-text><b>12</b>. The method of <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein:<claim-text>the GNSS status indicates valid GNSS observation when the quantity of the inliers in the GNSS is greater than or equal to 2, and indicates good GNSS observation when the quantity of the inliers in the GNSS is greater than or equal to 7; and</claim-text><claim-text>the PVT status indicates valid PVT observation when a horizontal accuracy value is less than 0.5, and indicates good PVT observation when the horizontal accuracy value is less than 0.2.</claim-text></claim-text></claim><claim id="CLM-00013" num="00013"><claim-text><b>13</b>. The method of <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein:<claim-text>the localization engine is switched to the dead reckoning state in response to determine that there is no valid GNSS observation for a predetermined time period;</claim-text><claim-text>the localization engine is switched to the loosely coupling state in response to determine that there is good GNSS observation; and</claim-text><claim-text>the localization engine is switched to the tightly coupling state in response to determine that there is valid PVT observation but no good GNSS observation for the predetermined time period.</claim-text></claim-text></claim><claim id="CLM-00014" num="00014"><claim-text><b>14</b>. The method of <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein the predetermined time period is 5 seconds.</claim-text></claim><claim id="CLM-00015" num="00015"><claim-text><b>15</b>. The method of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein:<claim-text>the local accuracy status is switchable between a dead reckoning mode, a GNSS based localization mode and a PVT based localization mode;</claim-text><claim-text>the local accuracy status is switched to the dead reckoning mode when a last GNSS update time is greater than 1 second;</claim-text><claim-text>the local accuracy status is switched to the GNSS based localization mode when the last GNSS update time is less than 1 second; and</claim-text><claim-text>the local accuracy status is switched to the PVT based localization mode when:<claim-text>(1) the last GNSS update time is less than 1 second, the state of the localization engine is in the loosely coupling state, and the localization engine passes a PVT innovation test; or</claim-text><claim-text>(2) the local accuracy status is in the GNSS based localization mode for 5 second, and the localization engine passes the PVT innovation test.</claim-text></claim-text></claim-text></claim><claim id="CLM-00016" num="00016"><claim-text><b>16</b>. A non-transitory tangible computer-readable medium storing computer executable instructions which, when executed by one or more processors, cause a method for performing positioning using a Global Navigation Satellite System (GNSS) with a state machine based localization engine to be performed, the method comprising:<claim-text>receiving, by an apparatus communicatively connected to the GNSS, GNSS signals from the GNSS;</claim-text><claim-text>providing the localization engine on the apparatus to process the GNSS signals;</claim-text><claim-text>determining, based on a GNSS status and a position-velocity-time (PVT) status, a state of the localization engine, wherein the state of the localization engine is switchable between at least 3 states, and the at least 3 states include a dead reckoning state, a tightly coupling state, and a loosely coupling state;</claim-text><claim-text>determining, by the localization engine, a local accuracy status based on the state of the localization engine; and</claim-text><claim-text>performing, by a downstream module executed on the apparatus, a downstream action based on the local accuracy status.</claim-text></claim-text></claim><claim id="CLM-00017" num="00017"><claim-text><b>17</b>. The non-transitory tangible computer-readable medium of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein:<claim-text>the GNSS status indicates, based on a quantity of inliers in the GNSS, whether there is valid GNSS observation or good GNSS observation;</claim-text><claim-text>the PVT status indicates, based on PVT accuracy values, whether there is valid PVT observation or good PVT observation;</claim-text><claim-text>the GNSS status indicates valid GNSS observation when the quantity of the inliers in the GNSS is greater than or equal to 2, and indicates good GNSS observation when the quantity of the inliers in the GNSS is greater than or equal to 7; and</claim-text><claim-text>the PVT status indicates valid PVT observation when a horizontal accuracy value is less than 0.5, and indicates good PVT observation when the horizontal accuracy value is less than 0.2.</claim-text></claim-text></claim><claim id="CLM-00018" num="00018"><claim-text><b>18</b>. The non-transitory tangible computer-readable medium of <claim-ref idref="CLM-00017">claim 17</claim-ref>, wherein:<claim-text>the localization engine is switched to the dead reckoning state in response to determine that there is no valid GNSS observation for a predetermined time period;</claim-text><claim-text>the localization engine is switched to the loosely coupling state in response to determine that there is good GNSS observation; and</claim-text><claim-text>the localization engine is switched to the tightly coupling state in response to determine that there is valid PVT observation but no good GNSS observation for the predetermined time period.</claim-text></claim-text></claim><claim id="CLM-00019" num="00019"><claim-text><b>19</b>. The non-transitory tangible computer-readable medium of <claim-ref idref="CLM-00018">claim 18</claim-ref>, wherein the predetermined time period is 5 seconds.</claim-text></claim><claim id="CLM-00020" num="00020"><claim-text><b>20</b>. The non-transitory tangible computer-readable medium of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein:<claim-text>the local accuracy status is switchable between a dead reckoning mode, a GNSS based localization mode and a PVT based localization mode;</claim-text><claim-text>the local accuracy status is switched to the dead reckoning mode when a last GNSS update time is greater than 1 second;</claim-text><claim-text>the local accuracy status is switched to the GNSS based localization mode when the last GNSS update time is less than 1 second; and</claim-text><claim-text>the local accuracy status is switched to the PVT based localization mode when:<claim-text>(1) the last GNSS update time is less than 1 second, the state of the localization engine is in the loosely coupling state, and the localization engine passes a PVT innovation test; or</claim-text><claim-text>(2) the local accuracy status is in the GNSS based localization mode for 5 second, and the localization engine passes the PVT innovation test.</claim-text></claim-text></claim-text></claim></claims></us-patent-application>