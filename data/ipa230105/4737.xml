<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230004738A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230004738</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17467398</doc-number><date>20210906</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><priority-claims><priority-claim sequence="01" kind="national"><country>TW</country><doc-number>110124027</doc-number><date>20210630</date></priority-claim></priority-claims><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>06</class><subclass>K</subclass><main-group>9</main-group><subgroup>00</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>06</class><subclass>N</subclass><main-group>3</main-group><subgroup>04</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>06</class><subclass>K</subclass><main-group>9</main-group><subgroup>62</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>06</class><subclass>T</subclass><main-group>7</main-group><subgroup>00</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>06</class><subclass>K</subclass><main-group>9</main-group><subgroup>00315</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc><further-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>06</class><subclass>K</subclass><main-group>9</main-group><subgroup>00281</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>06</class><subclass>N</subclass><main-group>3</main-group><subgroup>0454</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>06</class><subclass>K</subclass><main-group>9</main-group><subgroup>6256</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>06</class><subclass>T</subclass><main-group>7</main-group><subgroup>0002</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>06</class><subclass>T</subclass><main-group>2207</main-group><subgroup>30168</subgroup><symbol-position>L</symbol-position><classification-value>A</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>06</class><subclass>T</subclass><main-group>2207</main-group><subgroup>30201</subgroup><symbol-position>L</symbol-position><classification-value>A</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></further-cpc></classifications-cpc><invention-title id="d2e61">SYSTEM AND METHOD OF IMAGE PROCESSING BASED EMOTION RECOGNITION</invention-title><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>National Yang Ming Chiao Tung University</orgname><address><city>Taipei City</city><country>TW</country></address></addressbook><residence><country>TW</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>Wu</last-name><first-name>Bing-Fei</first-name><address><city>Taipei City</city><country>TW</country></address></addressbook></inventor><inventor sequence="01" designation="us-only"><addressbook><last-name>Su</last-name><first-name>Wei-Hsiang</first-name><address><city>Taipei City</city><country>TW</country></address></addressbook></inventor><inventor sequence="02" designation="us-only"><addressbook><last-name>Wu</last-name><first-name>Yi-Chiao</first-name><address><city>Taipei City</city><country>TW</country></address></addressbook></inventor></inventors></us-parties><assignees><assignee><addressbook><orgname>National Yang Ming Chiao Tung University</orgname><role>03</role><address><city>Taipei City</city><country>TW</country></address></addressbook></assignee></assignees></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">A system of image processing based emotion recognition is disclosed. The system principally comprises a camera and a main processor. Particularly, there a plurality of function units provided in the main processor, including: face detection unit, feature processing module, feature combination unit, conversion module, facial action judging unit, and emotion recognition unit. According to the present invention, the emotion recognition unit is configured to utilize a facial emotion recognition (FER) model to evaluate or distinguish an emotion state of a user based on at least one facial action, at least one emotional dimension, and a plurality of emotional scores. As a result, the accuracy of the emotion recognition conducted by the emotion recognition unit is significantly enhanced because basis of the emotion recognition comprises basic emotions, emotional dimension(s) and the user's facial action.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="156.72mm" wi="146.13mm" file="US20230004738A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="192.70mm" wi="148.17mm" file="US20230004738A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="193.12mm" wi="138.94mm" file="US20230004738A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="191.85mm" wi="132.67mm" file="US20230004738A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="153.25mm" wi="140.46mm" file="US20230004738A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00005" num="00005"><img id="EMI-D00005" he="220.05mm" wi="139.95mm" file="US20230004738A1-20230105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00006" num="00006"><img id="EMI-D00006" he="235.37mm" wi="139.95mm" file="US20230004738A1-20230105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0001" level="1">BACKGROUND OF THE INVENTION</heading><heading id="h-0002" level="1">1. Field of the Invention</heading><p id="p-0002" num="0001">The present invention relates to the technology field of emotion recognition, and more particularly to a system and method of image processing based emotion recognition.</p><heading id="h-0003" level="1">2. Description of the Prior Art</heading><p id="p-0003" num="0002">Nowadays, highly-convenient transportations and high-tech electronic products speed life pace. However, research reports have indicated that, living in fast-paced life in the long run leads people to feel stress on their life, thereby producing a series of negative consequences. Findings from previous studies have shown that psychological stress responses often include negative emotions. In other words, people experience a complex array of negative emotions, such as depression, anxiety, anger, and distress during real-life stressful events. Therefore, for the purpose of preventing the undesirable events from occurring, there is a need for everyone to be treated with emotion recognition in some circumstances and/or environments.</p><p id="p-0004" num="0003">U.S. Pat. No. 9,972,341 B2 has disclosed an apparatus for emotion recognition. The apparatus includes a frame parameter generator configured to detect a plurality of unit frames from an input speech and to generate a parameter vector for each of the unit frames, a key-frame selector configured to select a unit frame as a key frame among the plurality of unit frames, an emotion-probability calculator configured to calculate an emotion probability of each of the selected key frames, and an emotion determiner configured to determine an emotion of a speaker based on the calculated emotion probabilities. On the other hand, China Patent Publication No. CN104391569A has disclosed an apparatus using brain-computer interface (BCI) to carry out emotion recognition. In summary, for achieving an individual's emotion recognition, conventional technologies commonly utilize at least one signal sensing device to collect at least one physiological signal like voice signal and/or brainwave signal from the individual, thereby distinguishing an immediate emotion type of the individual after a series of processes of the physiological signal are completed.</p><p id="p-0005" num="0004">Furthermore, with the well development and wide applications of technologies of machine vision (MV) and machine learning (ML), it is allowable to achieve facial emotion recognition of an individual by using a camera and a microprocessor. For example, U.S. Pat. No. 9,576,190 B2 has disclosed a system for recognizing a customer's facial emotion in a videoconference. According to the disclosures of U.S. Pat. No. 9,576,190 B2, the system comprises at least one camera and a microprocessor, of which the camera is used to acquire an image from a participant (i.e., customer). Particularly, there is a Viola-Jones algorithm provided in the microprocessor, such that the microprocessor is able to detect the face region in the image received from camera. Moreover, the microprocessor is also provided with an active shape models (ASM) algorithm therein, and the ASM algorithm is applied to the face region to locate reference feature points associated with the face of the customer. As described in more detail below, because these feature reference points include one or more facial landmarks, it is allowable for the microprocessor to determine that the at least one facial landmark refers to a plurality of facial feature templates, thereby generating a communication bearing data associated with the facial emotion. Engineers skilled in development and manufacture of apparatus for facial emotion recognition certainly know that, there are many famous databases for acquiring facial feature samples, for example, Fer2013 dataset, Real-world Affective Faces (RAF) Database, AffectNet Dataset, CK+, and JAFFE.</p><p id="p-0006" num="0005">It is known that, discrete emotion theory is the claim that there is a small number of core emotions. For example, Silvan Tomkins concluded that there are nine basic emotions: interest, enjoyment, surprise, distress, fear, anger, shame, dissmell (reaction to bad smell) and disgust. Discrete emotion theory states that these specific core emotions are biologically determined emotional responses whose expression and recognition is fundamentally the same for all individuals regardless of ethnic or cultural differences. On the other hand, Mehrabian and Russell (1974) introduced pleasure, arousal and dominance as three independent emotional dimensions to describe people's state of feeling.</p><p id="p-0007" num="0006">In brief, when conducting facial emotion recognition, the above-mentioned conventional system of image processing based emotion recognition often firstly complete the training and learning performed by a learning platform so as to generate a specific facial emotion recognition (FER) model. Subsequently, the FER model is provided in the microprocessor, such that microprocessor is allowed to achieve an individual's facial emotion recognition under the execution of the FER model. In other words, the conventional system of image processing based emotion recognition not refers to or uses the three emotional dimensions during the conduction of facial emotion recognition, and this means that the accuracy of a result of the facial emotion recognition made by the conventional system is remained to be discussed.</p><p id="p-0008" num="0007">According to above descriptions, it is understood that there is still room for improvement in the conventional system of image processing based emotion recognition. In view of that, inventors of the present invention have made great efforts to make inventive research and eventually provided a system of image processing based emotion recognition.</p><heading id="h-0004" level="1">SUMMARY OF THE INVENTION</heading><p id="p-0009" num="0008">The primary objective of the present invention is to disclose an image processing based emotion recognition system, comprising: a camera and a main processor. Particularly, there a plurality of function units provided in the main processor, including: face detection unit, feature processing module, feature combination unit, conversion module, facial action judging unit, and emotion recognition unit. According to the present invention, the emotion recognition unit is configured for using an emotion state recognizing model so as to evaluate an emotion state of a user based on at least one facial action, at least one emotional dimension, and a plurality of emotional scores.</p><p id="p-0010" num="0009">Briefly speaking, after the face detection unit detect a face region from a user image that is acquired from a user by the camera, the feature processing module is enabled to extract a plurality of facial features, at least one feature of emotional dimensions and at least one feature of facial action from the face region. As a result, the accuracy of an emotion recognition conducted by the emotion recognition unit is significantly enhanced because basis of the emotion recognition comprises basic emotions, emotional dimension(s) and the user's facial action.</p><p id="p-0011" num="0010">For achieving the primary objective, the present invention discloses an embodiment for the system of image processing based emotion recognition, comprising:<ul id="ul0001" list-style="none">    <li id="ul0001-0001" num="0000">    <ul id="ul0002" list-style="none">        <li id="ul0002-0001" num="0011">a camera, being faced to a user for capturing a user image;</li>        <li id="ul0002-0002" num="0012">a main processor, being coupled to the camera, and comprising one or more embedded programs including instructions for:</li>        <li id="ul0002-0003" num="0013">detecting a face region from the user image;</li>        <li id="ul0002-0004" num="0014">extracting a plurality of facial features and a plurality of facial expression features from the face region, and subsequently outputting the plurality of facial features by a form of a first feature vector, and outputting the plurality of facial expression features by a form of a second feature vector;</li>        <li id="ul0002-0005" num="0015">combining the first feature vector and the second feature vector to a third feature vector, and then utilizing a recurrent neural network (RNN) model to conduct a dimensionality reduction of the third feature vector, thereby producing an input feature vector;</li>        <li id="ul0002-0006" num="0016">converting the input feature vector to a plurality of emotional scores that are respectively corresponding to a plurality of basic emotions, and also converting the input feature vector to an emotion dimension value;</li>        <li id="ul0002-0007" num="0017">converting the input feature vector to a plurality of facial action values, and then determining a facial action based on the plurality of facial action values; and</li>        <li id="ul0002-0008" num="0018">utilizing a facial emotion recognition (FER) model to evaluate an emotion state of the user according to the facial action, the emotion dimension value, the plurality of emotional scores.</li>    </ul>    </li></ul></p><p id="p-0012" num="0019">Moreover, the present invention also discloses an embodiment for the method of image processing based emotion recognition, comprising a plurality of steps of:<ul id="ul0003" list-style="none">    <li id="ul0003-0001" num="0000">    <ul id="ul0004" list-style="none">        <li id="ul0004-0001" num="0020">(1) capturing a user image form a user by using a camera;</li>        <li id="ul0004-0002" num="0021">(2) detecting a face region from the user image by using a main processor;</li>        <li id="ul0004-0003" num="0022">(3) using the main processor to extract a plurality of facial features and a plurality of facial expression features from the face region, to output the plurality of facial features by a form of a first feature vector, and to output the plurality of facial expression features by a form of a second feature vector;</li>        <li id="ul0004-0004" num="0023">(4) using the main processor to combine the first feature vector and the second feature vector to a third feature vector, and subsequently to utilize a recurrent neural network (RNN) model to conduct a dimensionality reduction of the third feature vector, thereby producing an input feature vector;</li>        <li id="ul0004-0005" num="0024">(5) using the main processor to convert the input feature vector to a plurality of emotional scores that are respectively corresponding to a plurality of basic emotions, and to convert the input feature vector to an emotion dimension value;</li>        <li id="ul0004-0006" num="0025">(6) using the main processor to convert the input feature vector to a plurality of facial action values, and then to determine a facial action based on the plurality of facial action values; and</li>        <li id="ul0004-0007" num="0026">(7) using the main processor to utilize a facial emotion recognition (FER) model to evaluate an emotion state of the user according to the facial action, the emotion dimension value, the plurality of emotional scores.</li>    </ul>    </li></ul></p><p id="p-0013" num="0027">In one embodiment, the RNN model is established by using artificial neural networks selected from a group consisting of long short-term memory (LSTM) neural networks and gate recurrent unit (GRU) neural networks.</p><p id="p-0014" num="0028">In one embodiment, the main processor combines the first feature vector and the second feature vector to the third feature vector after completing an operation selected from a group consisting of pointwise addition operation and vector concatenation operation.</p><p id="p-0015" num="0029">In one embodiment, a pre-trained model is used by the main processor to extract the plurality of facial expression features from the face region, so as to output the second feature vector.</p><p id="p-0016" num="0030">In one embodiment, the pre-trained model is selected from a group consisting of VGG16 model and VGG19 model, and the plurality of basic emotions comprise neutral, surprise, happiness, angry, disgust, fear, and sadness.</p><p id="p-0017" num="0031">In one embodiment, the main processor is further embedded with one program including instructions for:<ul id="ul0005" list-style="none">    <li id="ul0005-0001" num="0000">    <ul id="ul0006" list-style="none">        <li id="ul0006-0001" num="0032">conducting a brightness quality estimation of the face region, and then outputting a first estimation value;</li>        <li id="ul0006-0002" num="0033">conducting a head rotation angle estimation of the face region, and then outputting a second estimation value;</li>        <li id="ul0006-0003" num="0034">calculating an image quality loss weight based on the first estimation value and the second estimation value; and</li>        <li id="ul0006-0004" num="0035">adjusting an image quality of the face region by using the image quality loss weight.</li>    </ul>    </li></ul></p><p id="p-0018" num="0036">In one embodiment, the main processor is further embedded with one program including instructions for:<ul id="ul0007" list-style="none">    <li id="ul0007-0001" num="0000">    <ul id="ul0008" list-style="none">        <li id="ul0008-0001" num="0037">conducting a model training of the FER model by using a training sample set, the facial action, the emotion dimension value, the plurality of emotional scores.</li>    </ul>    </li></ul></p><p id="p-0019" num="0038">In one embodiment, the main processor is further embedded with one program including instructions for:<ul id="ul0009" list-style="none">    <li id="ul0009-0001" num="0000">    <ul id="ul0010" list-style="none">        <li id="ul0010-0001" num="0039">calculating a plurality of average emotion feature vectors based on the plurality of emotional scores that are in correspondence to the plurality of basic emotions;</li>        <li id="ul0010-0002" num="0040">calculating a plurality of Euclidean distances based on the plurality of emotional scores that are in correspondence to the plurality of basic emotions;</li>        <li id="ul0010-0003" num="0041">calculating an emotion feature loss weight based on the plurality of average emotion feature vectors and the plurality of Euclidean distances; and</li>        <li id="ul0010-0004" num="0042">adjusting at least one of the plurality of emotional scores by using the emotion feature loss weight before starting to conduct the model training of the FER model.</li>    </ul>    </li></ul></p><p id="p-0020" num="0043">In one embodiment, the main processor is further embedded with one program including instructions for:<ul id="ul0011" list-style="none">    <li id="ul0011-0001" num="0000">    <ul id="ul0012" list-style="none">        <li id="ul0012-0001" num="0044">calculating a score loss of each of the plurality of emotional scores by using a cross entropy loss algorithm;</li>        <li id="ul0012-0002" num="0045">calculating a value loss of the emotion dimension value by using a mean square error loss algorithm and a concordance correlation coefficient loss algorithm; and</li>        <li id="ul0012-0003" num="0046">calculating a value loss of each of the plurality of facial action values by using a binary cross entropy loss algorithm.</li>    </ul>    </li></ul></p><p id="p-0021" num="0047">In one embodiment, the main processor and the camera are both integrated in an electronic device selected from a group consisting of smart television, smartphone, tablet computer, laptop computer, physiological parameter measuring device, electronic kiosk, and video door phone system.</p><p id="p-0022" num="0048">In another one embodiment, the main processor is integrated in an electronic device, and is coupled to the camera through a wired connection or a wireless communication; the electronic device being selected from a group consisting of desktop computer, smart television, smartphone, tablet computer, laptop computer, physiological parameter measuring device, electronic kiosk, and video door phone system.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0005" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p-0023" num="0049">The invention as well as a preferred mode of use and advantages thereof will be best understood by referring to the following detailed descriptions of an illustrative embodiment in conjunction with the accompanying drawings, wherein:</p><p id="p-0024" num="0050"><figref idref="DRAWINGS">FIG. <b>1</b></figref> shows a schematic diagram for describing a system of image processing based emotion recognition according to the present invention;</p><p id="p-0025" num="0051"><figref idref="DRAWINGS">FIG. <b>2</b></figref> shows a first block diagram of a main processor as illustrated in <figref idref="DRAWINGS">FIG. <b>1</b></figref>;</p><p id="p-0026" num="0052"><figref idref="DRAWINGS">FIG. <b>3</b>A</figref> and <figref idref="DRAWINGS">FIG. <b>3</b>B</figref> shows a flowchart of a method of image processing based emotion recognition according to the present invention;</p><p id="p-0027" num="0053"><figref idref="DRAWINGS">FIG. <b>4</b></figref> shows a second block diagram of the main processor as illustrated in <figref idref="DRAWINGS">FIG. <b>1</b></figref>; and</p><p id="p-0028" num="0054"><figref idref="DRAWINGS">FIG. <b>5</b></figref> shows a third block diagram of the main processor as illustrated in <figref idref="DRAWINGS">FIG. <b>1</b></figref>.</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><heading id="h-0006" level="1">DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS</heading><p id="p-0029" num="0055">To more clearly describe a system and method of image processing based emotion recognition according to the present invention, related embodiments will be described in detail with reference to the attached drawings hereinafter.</p><heading id="h-0007" level="1">First Embodiment</heading><p id="p-0030" num="0056">With reference to <figref idref="DRAWINGS">FIG. <b>1</b></figref>, there is shown a schematic diagram for describing a system of image processing based emotion recognition according to the present invention. As <figref idref="DRAWINGS">FIG. <b>1</b></figref> shows, the system <b>1</b> principally comprises: a camera <b>11</b> and a main processor <b>12</b>, of which the main processor <b>12</b> is integrated in an electronic device <b>3</b>, and is coupled to the camera <b>11</b> through wired connection or wireless communication. Although <figref idref="DRAWINGS">FIG. <b>1</b></figref> depicts that the electronic device <b>3</b> is a desktop computer, the electronic device <b>3</b> is not limited to be a desktop computer.</p><p id="p-0031" num="0057">In any practicable embodiments, the electronic device <b>3</b> can be a desktop computer, a smart television, a smartphone, a tablet computer, a laptop computer, a physiological parameter measuring device, an electronic kiosk, or a video door phone system. Of course, it is known that some electronic devices <b>3</b> like smartphone and tablet computer have been provided with camera module therein, such case means that the main processor <b>12</b> and the camera <b>11</b> of the system <b>1</b> of the present invention are integrated in an identical electronic device <b>3</b>.</p><p id="p-0032" num="0058">Continuously referring to <figref idref="DRAWINGS">FIG. <b>1</b></figref>, and please simultaneously refer to <figref idref="DRAWINGS">FIG. <b>2</b></figref> which illustrates a first block diagram of the main processor <b>12</b>. As <figref idref="DRAWINGS">FIG. <b>1</b></figref> and <figref idref="DRAWINGS">FIG. <b>2</b></figref> shows, there are multiple functionality units provided in the main processor <b>12</b> by a form of function libraries, application programs, and/or operands. The functionality units comprises: a face detection unit <b>121</b>, a first feature processing module <b>122</b>, a second feature processing module <b>123</b>, a feature combination unit <b>124</b>, a conversion module consisting of an emotional score calculating unit <b>125</b>, a dimensional value calculating unit <b>126</b> and a facial action distinguishing unit <b>127</b>, and an emotion recognition unit <b>128</b>.</p><p id="p-0033" num="0059"><figref idref="DRAWINGS">FIG. <b>3</b>A</figref> and <figref idref="DRAWINGS">FIG. <b>3</b>B</figref> shows a flowchart of a method of image processing based emotion recognition according to the present invention. When adopting the system <b>1</b> as illustrated in <figref idref="DRAWINGS">FIG. <b>1</b></figref> to conduct a facial emotion recognition of a user <b>2</b>, the camera <b>1</b> is firstly controlled by the main processor <b>12</b> to capture a user image form the user <b>2</b> (i.e., step S<b>1</b>). In step S<b>2</b>, the main processor <b>12</b> utilizes the face detection unit <b>121</b> to detect a face region from the user image. As described in more detail below, after detecting a face region from the user image, the face detection unit <b>121</b> subsequently finds out the five face features in the face region, i.e., eyes, nose, mouth, chin, and face shape. Subsequently, the face region is moved so as to position the tip of the nose at a center point of the user image. After that, the face region is rotated by taking the tip of the nose as a rotation center, so as to make the eyes be on a horizontal line. Consequently, the face region is cut off from the user image.</p><p id="p-0034" num="0060">The method flow is subsequently proceeded to step S<b>3</b>. In step S<b>3</b>, the main processor <b>12</b> utilizes the first feature processing unit <b>122</b> to extract a plurality of facial features from the face region, and then output the plurality of facial features by a form of a first feature vector. Simultaneously, in step S<b>3</b>, the main processor <b>12</b> also utilizes the second feature processing unit <b>123</b> to extract a plurality of facial expression features from the face region, and then output the plurality of facial expression features by a form of a second feature vector. In following table (1), multiple facial expression features in correspondence to basic emotions are exemplarily presented.</p><p id="p-0035" num="0000"><tables id="TABLE-US-00001" num="00001"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="3"><colspec colname="offset" colwidth="21pt" align="left"/><colspec colname="1" colwidth="70pt" align="left"/><colspec colname="2" colwidth="126pt" align="left"/><thead><row><entry/><entry namest="offset" nameend="2" rowsep="1">TABLE 1</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row><row><entry/><entry>Basic emotion</entry><entry>Facial expression features</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry/><entry>Surprise</entry><entry>Mouth is opened.</entry></row><row><entry/><entry/><entry>Eyebrows are raised and arched.</entry></row><row><entry/><entry>Happiness</entry><entry>Corners of mouth are slightly raised</entry></row><row><entry/><entry>Angry</entry><entry>Eyebrows are lowered and knit</entry></row><row><entry/><entry/><entry>together.</entry></row><row><entry/><entry/><entry>Eyes stare intensely.</entry></row><row><entry/><entry>Disgust</entry><entry>Eyes blink quickly or blink too little.</entry></row><row><entry/><entry/><entry>Eyebrows knit together.</entry></row><row><entry/><entry>Fear</entry><entry>Eyes close tightly.</entry></row><row><entry/><entry>Sadness</entry><entry>Eyebrows are lowered and knit</entry></row><row><entry/><entry/><entry>together.</entry></row><row><entry/><entry/><entry>Inner corners of eyebrows are drawn</entry></row><row><entry/><entry/><entry>up.</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0036" num="0061">For example, there are 70 facial features extracted from the face region by the first feature processing unit <b>122</b>, and the 70 facial features are outputted to a 512-dimension feature vector by the first feature processing unit <b>122</b>. Moreover, in one embodiment, the second feature processing unit <b>123</b> is a pre-trained model like VGG16 model and VGG19 model, and the main processor <b>12</b> utilizes the pre-trained model to extract the plurality of facial expression features from the face region, so as to output the second feature vector.</p><p id="p-0037" num="0062">As <figref idref="DRAWINGS">FIG. <b>2</b></figref> and <figref idref="DRAWINGS">FIG. <b>3</b>A</figref> show, the method flow is subsequently proceeded to step S<b>4</b>. In step S<b>4</b>, the main processor <b>12</b> utilizes the feature combination unit <b>124</b> to combine the first feature vector and the second feature vector to a third feature vector by completing a pointwise addition operation or a vector concatenation operation. Moreover, the feature combination unit <b>124</b> subsequently utilizes a recurrent neural network (RNN) model to conduct a dimensionality reduction of the third feature vector, thereby producing an input feature vector. In one embodiment, the RNN model is established by using artificial neural networks, for example, long short-term memory (LSTM) neural networks and gate recurrent unit (GRU) neural networks.</p><p id="p-0038" num="0063">As <figref idref="DRAWINGS">FIG. <b>2</b></figref> and <figref idref="DRAWINGS">FIG. <b>3</b>B</figref> show, the method flow is next proceeded to steps S<b>5</b>-S<b>6</b>. In step S<b>5</b>, the main processor <b>12</b> utilizes a conversion module to convert the input feature vector to a plurality of emotional scores that are respectively corresponding to a plurality of basic emotions, and to convert the input feature vector to an emotion dimension value. Subsequently, in step S<b>6</b>, the main processor <b>12</b> utilizes the conversion module to convert the input feature vector to a plurality of facial action values, and then to determine a facial action based on the plurality of facial action values.</p><p id="p-0039" num="0064">The plurality of basic emotions are neutral, surprise, happiness, angry, disgust, fear, and sadness. On the other hand, <figref idref="DRAWINGS">FIG. <b>2</b></figref> depicts that the conversion module consists of an emotional score calculating unit <b>125</b>, a dimensional value calculating unit <b>126</b> and a facial action distinguishing unit <b>127</b>, of which the emotional score calculating unit <b>125</b> is configured for converting the input feature vector to a plurality of emotional scores that are respectively corresponding to a plurality of basic emotions. Moreover, the dimensional value calculating unit <b>126</b> is configured for converting the input feature vector to an emotion dimension value. On the other hand, the facial action distinguishing unit <b>127</b> is configured for converting the input feature vector to a plurality of facial action values, so as to determine a facial action based on the plurality of facial action values. For example, the plurality of facial action values include AU1, AU2, AU4, AU6, AU12, AU15, AU20, and AU15, and the facial action distinguishing unit <b>127</b> determines a facial action based on the foregoing 8 facial action values. Eventually, the method flow proceeds to step S<b>7</b>, such that the main processor <b>12</b> utilizes the emotion recognition unit <b>128</b> to conduct a facial emotion recognition of the user <b>2</b> based on the facial action, the emotion dimension value, the plurality of emotional scores. As explained in more detail below, the emotion recognition unit <b>128</b> is provided in the main processor <b>12</b> by a form of a facial emotion recognition (FER) model, and the FER model is adopted for evaluating an emotion state of the user according to the facial action, the emotion dimension value, the plurality of emotional scores, thereby completing the facial emotion recognition of the user <b>2</b>.</p><heading id="h-0008" level="1">Second Embodiment</heading><p id="p-0040" num="0065">With reference to <figref idref="DRAWINGS">FIG. <b>1</b></figref> again, and please simultaneously refer to <figref idref="DRAWINGS">FIG. <b>4</b></figref> which illustrates a second block diagram of the main processor <b>12</b> as illustrated in <figref idref="DRAWINGS">FIG. <b>1</b></figref>. In second embodiment, the main processor <b>12</b> is further provided with a compensation unit <b>120</b> therein. In other words, the main processor <b>12</b> is further embedded with one program including instructions, such that the main processor <b>12</b> is able to apply an image process for compensating the image quality loss of the user image before starting to conduct the feature extractions. The image process comprises following steps:<ul id="ul0013" list-style="none">    <li id="ul0013-0001" num="0000">    <ul id="ul0014" list-style="none">        <li id="ul0014-0001" num="0066">(1a) conducting a brightness quality estimation of the face region, and then outputting a first estimation value;</li>        <li id="ul0014-0002" num="0067">(2a) conducting a head rotation angle estimation of the face region, and then outputting a second estimation value;</li>        <li id="ul0014-0003" num="0068">(3a) calculating an image quality loss weight based on the first estimation value and the second estimation value; and</li>        <li id="ul0014-0004" num="0069">(4a) adjusting an image quality of the face region by using the image quality loss weight.</li>    </ul>    </li></ul></p><heading id="h-0009" level="1">Third Embodiment</heading><p id="p-0041" num="0070">With reference to <figref idref="DRAWINGS">FIG. <b>1</b></figref> again, and please simultaneously refer to <figref idref="DRAWINGS">FIG. <b>5</b></figref> which illustrates a third block diagram of the main processor <b>12</b> as illustrated in <figref idref="DRAWINGS">FIG. <b>1</b></figref>. In third embodiment, the main processor <b>12</b> is further provided with a loss calculating unit <b>12</b>A and a model training unit <b>129</b>. Engineers skilled in development and manufacture of apparatus for facial emotion recognition certainly know that, there are many famous databases for acquiring facial feature samples, for example, Fer2013 dataset, Real-world Affective Faces (RAF) Database, AffectNet Dataset, CK+, and JAFFE. Therefore, in case of the databases having a data updating of the facial feature samples, the model training unit <b>129</b> is configured for conducting a model training of the FER model (i.e., the emotion recognition unit <b>128</b>) by using a training sample set, the facial action, the emotion dimension value, the plurality of emotional scores. As a result, the accuracy of the emotion recognition conducted by the emotion recognition unit <b>128</b> is significantly enhanced because basis of the emotion recognition comprises basic emotions, emotional dimension(s) and the user's facial action.</p><p id="p-0042" num="0071">Particularly, the model training unit <b>129</b> is also configured to properly adjust at least one of the plurality of emotional scores before starting to conduct the model training of the FER model. According to the present invention, the model training unit <b>129</b> calculates a plurality of average emotion feature vectors based on the plurality of emotional scores that are in correspondence to the plurality of basic emotions, and also calculates a plurality of Euclidean distances based on the plurality of emotional scores that are in correspondence to the plurality of basic emotions. After that, the model training unit <b>129</b> is able to calculate an emotion feature loss weight based on the plurality of average emotion feature vectors and the plurality of Euclidean distances, thereby adjusting at least one of the plurality of emotional scores by using the emotion feature loss weight.</p><p id="p-0043" num="0072">On the other hand, the loss calculating unit <b>12</b>A is provided in the main processor <b>12</b> for:<ul id="ul0015" list-style="none">    <li id="ul0015-0001" num="0000">    <ul id="ul0016" list-style="none">        <li id="ul0016-0001" num="0073">calculating a score loss of each of the plurality of emotional scores by using a cross entropy loss algorithm;</li>        <li id="ul0016-0002" num="0074">calculating a value loss of the emotion dimension value by using a mean square error loss algorithm and a concordance correlation coefficient loss algorithm; and</li>        <li id="ul0016-0003" num="0075">calculating a value loss of each of the plurality of facial action values by using a binary cross entropy loss algorithm.</li>    </ul>    </li></ul></p><p id="p-0044" num="0076">Therefore, through above descriptions, the system and method of image processing based emotion recognition according to the present invention has been introduced completely and clearly. However, the embodiments are not intended to limit the scope of the present invention, and all equivalent implementations or alterations within the spirit of the present invention still fall within the scope of the present invention.</p><?detailed-description description="Detailed Description" end="tail"?></description><us-claim-statement>What is claimed is:</us-claim-statement><claims id="claims"><claim id="CLM-00001" num="00001"><claim-text><b>1</b>. A system of image processing based emotion recognition, comprising:<claim-text>a camera, being faced to a user for capturing a user image;</claim-text><claim-text>a main processor, being coupled to the camera, and comprising one or more embedded programs including instructions for:</claim-text><claim-text>detecting a face region from the user image;</claim-text><claim-text>extracting a plurality of facial features and a plurality of facial expression features from the face region, and subsequently outputting the plurality of facial features by a form of a first feature vector, and outputting the plurality of facial expression features by a form of a second feature vector;</claim-text><claim-text>combining the first feature vector and the second feature vector to a third feature vector, and then utilizing a recurrent neural network (RNN) model to conduct a dimensionality reduction of the third feature vector, thereby producing an input feature vector;</claim-text><claim-text>converting the input feature vector to a plurality of emotional scores that are respectively corresponding to a plurality of basic emotions, and also converting the input feature vector to an emotion dimension value;</claim-text><claim-text>converting the input feature vector to a plurality of facial action values, and then determining a facial action based on the plurality of facial action values; and</claim-text><claim-text>utilizing a facial emotion recognition (FER) model to evaluate an emotion state of the user according to the facial action, the emotion dimension value, the plurality of emotional scores.</claim-text></claim-text></claim><claim id="CLM-00002" num="00002"><claim-text><b>2</b>. The system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the RNN model is established by using artificial neural networks selected from a group consisting of long short-term memory (LSTM) neural networks and gate recurrent unit (GRU) neural networks.</claim-text></claim><claim id="CLM-00003" num="00003"><claim-text><b>3</b>. The system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the main processor combines the first feature vector and the second feature vector to the third feature vector after completing an operation selected from a group consisting of pointwise addition operation and vector concatenation operation.</claim-text></claim><claim id="CLM-00004" num="00004"><claim-text><b>4</b>. The system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein a pre-trained model is used by the main processor to extract the plurality of facial expression features from the face region, so as to output the second feature vector.</claim-text></claim><claim id="CLM-00005" num="00005"><claim-text><b>5</b>. The system of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the pre-trained model being selected from a group consisting of VGG16 model and VGG19 model.</claim-text></claim><claim id="CLM-00006" num="00006"><claim-text><b>6</b>. The system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the plurality of basic emotions comprise neutral, surprise, happiness, angry, disgust, fear, and sadness.</claim-text></claim><claim id="CLM-00007" num="00007"><claim-text><b>7</b>. The system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the main processor is further embedded with one program including instructions for:<claim-text>conducting a brightness quality estimation of the face region, and then outputting a first estimation value;</claim-text><claim-text>conducting a head rotation angle estimation of the face region, and then outputting a second estimation value;</claim-text><claim-text>calculating an image quality loss weight based on the first estimation value and the second estimation value; and</claim-text><claim-text>adjusting an image quality of the face region by using the image quality loss weight.</claim-text></claim-text></claim><claim id="CLM-00008" num="00008"><claim-text><b>8</b>. The system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the main processor is further embedded with one program including instructions for:<claim-text>conducting a model training of the FER model by using a training sample set, the facial action, the emotion dimension value, the plurality of emotional scores.</claim-text></claim-text></claim><claim id="CLM-00009" num="00009"><claim-text><b>9</b>. The system of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the main processor is further embedded with one program including instructions for:<claim-text>calculating a plurality of average emotion feature vectors based on the plurality of emotional scores that are in correspondence to the plurality of basic emotions;</claim-text><claim-text>calculating a plurality of Euclidean distances based on the plurality of emotional scores that are in correspondence to the plurality of basic emotions;</claim-text><claim-text>calculating an emotion feature loss weight based on the plurality of average emotion feature vectors and the plurality of Euclidean distances; and</claim-text><claim-text>adjusting at least one of the plurality of emotional scores by using the emotion feature loss weight before starting to conduct the model training of the FER model.</claim-text></claim-text></claim><claim id="CLM-00010" num="00010"><claim-text><b>10</b>. The system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the main processor is further embedded with one program including instructions for:<claim-text>calculating a score loss of each of the plurality of emotional scores by using a cross entropy loss algorithm;</claim-text><claim-text>calculating a value loss of the emotion dimension value by using a mean square error loss algorithm and a concordance correlation coefficient loss algorithm; and</claim-text><claim-text>calculating a value loss of each of the plurality of facial action values by using a binary cross entropy loss algorithm.</claim-text></claim-text></claim><claim id="CLM-00011" num="00011"><claim-text><b>11</b>. The system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the main processor and the camera are both integrated in an electronic device selected from a group consisting of desktop computer, smart television, smartphone, tablet computer, laptop computer, physiological parameter measuring device, electronic kiosk, and video door phone system.</claim-text></claim><claim id="CLM-00012" num="00012"><claim-text><b>12</b>. The system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the main processor is integrated in an electronic device, and being coupled to the camera; the electronic device being selected from a group consisting of smart television, smartphone, tablet computer, laptop computer, physiological parameter measuring device, electronic kiosk, and video door phone system.</claim-text></claim><claim id="CLM-00013" num="00013"><claim-text><b>13</b>. A method of image processing based emotion recognition, comprising a plurality of steps of:<claim-text>(1) capturing a user image form a user by using a camera;</claim-text><claim-text>(2) detecting a face region from the user image by using a main processor;</claim-text><claim-text>(3) using the main processor to extract a plurality of facial features and a plurality of facial expression features from the face region, to output the plurality of facial features by a form of a first feature vector, and to output the plurality of facial expression features by a form of a second feature vector;</claim-text><claim-text>(4) using the main processor to combine the first feature vector and the second feature vector to a third feature vector, and subsequently to utilize a recurrent neural network (RNN) model to conduct a dimensionality reduction of the third feature vector, thereby producing an input feature vector;</claim-text><claim-text>(5) using the main processor to convert the input feature vector to a plurality of emotional scores that are respectively corresponding to a plurality of basic emotions, and to convert the input feature vector to an emotion dimension value;</claim-text><claim-text>(6) using the main processor to convert the input feature vector to a plurality of facial action values, and then to determine a facial action based on the plurality of facial action values; and</claim-text><claim-text>(7) using the main processor to utilize a facial emotion recognition (FER) model to evaluate an emotion state of the user according to the facial action, the emotion dimension value, the plurality of emotional scores.</claim-text></claim-text></claim><claim id="CLM-00014" num="00014"><claim-text><b>14</b>. The method of <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein the RNN model is established by using artificial neural networks selected from a group consisting of long short-term memory (LSTM) neural networks and gate recurrent unit (GRU) neural networks.</claim-text></claim><claim id="CLM-00015" num="00015"><claim-text><b>15</b>. The method of <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein the main processor combines the first feature vector and the second feature vector to the third feature vector after completing an operation selected from a group consisting of pointwise addition operation and vector concatenation operation.</claim-text></claim><claim id="CLM-00016" num="00016"><claim-text><b>16</b>. The method of <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein a pre-trained model is used by the main processor to extract the plurality of facial expression features from the face region, so as to output the second feature vector.</claim-text></claim><claim id="CLM-00017" num="00017"><claim-text><b>17</b>. The method of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the pre-trained model being selected from a group consisting of VGG16 model and VGG19 model, and the plurality of basic emotions comprising neutral, surprise, happiness, angry, disgust, fear, and sadness.</claim-text></claim><claim id="CLM-00018" num="00018"><claim-text><b>18</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising a plurality of steps that are executed between the step (1) and the step (2); the plurality of steps comprising:<claim-text>(1a) conducting a brightness quality estimation of the face region, and then outputting a first estimation value;</claim-text><claim-text>(2a) conducting a head rotation angle estimation of the face region, and then outputting a second estimation value;</claim-text><claim-text>(3a) calculating an image quality loss weight based on the first estimation value and the second estimation value; and</claim-text><claim-text>(4a) adjusting an image quality of the face region by using the image quality loss weight.</claim-text></claim-text></claim><claim id="CLM-00019" num="00019"><claim-text><b>19</b>. The method of <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein the main processor is further embedded with one program including instructions for:<claim-text>conducting a model training of the FER model by using a training sample set, the facial action, the emotion dimension value, the plurality of emotional scores.</claim-text></claim-text></claim><claim id="CLM-00020" num="00020"><claim-text><b>20</b>. The method of <claim-ref idref="CLM-00019">claim 19</claim-ref>, wherein the main processor is further embedded with one program including instructions for:<claim-text>calculating a plurality of average emotion feature vectors based on the plurality of emotional scores that are in correspondence to the plurality of basic emotions;</claim-text><claim-text>calculating a plurality of Euclidean distances based on the plurality of emotional scores that are in correspondence to the plurality of basic emotions;</claim-text><claim-text>calculating an emotion feature loss weight based on the plurality of average emotion feature vectors and the plurality of Euclidean distances; and</claim-text><claim-text>adjusting at least one of the plurality of emotional scores by using the emotion feature loss weight before starting to conduct the model training of the FER model.</claim-text></claim-text></claim></claims></us-patent-application>