<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230007711A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230007711</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17931487</doc-number><date>20220912</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><priority-claims><priority-claim sequence="01" kind="national"><country>JP</country><doc-number>2013-033419</doc-number><date>20130222</date></priority-claim></priority-claims><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>W</subclass><main-group>76</main-group><subgroup>14</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>W</subclass><main-group>76</main-group><subgroup>38</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>W</subclass><main-group>84</main-group><subgroup>12</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>L</subclass><main-group>67</main-group><subgroup>06</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20180201</date></cpc-version-indicator><section>H</section><class>04</class><subclass>W</subclass><main-group>76</main-group><subgroup>14</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc><further-cpc><classification-cpc><cpc-version-indicator><date>20180201</date></cpc-version-indicator><section>H</section><class>04</class><subclass>W</subclass><main-group>76</main-group><subgroup>38</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>W</subclass><main-group>84</main-group><subgroup>12</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>L</subclass><main-group>67</main-group><subgroup>06</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20180201</date></cpc-version-indicator><section>H</section><class>04</class><subclass>W</subclass><main-group>4</main-group><subgroup>029</subgroup><symbol-position>L</symbol-position><classification-value>A</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></further-cpc></classifications-cpc><invention-title id="d2e61">COMMUNICATION APPARATUS, METHOD FOR CONTROLLING COMMUNICATION APPARATUS, AND COMPUTER PROGRAM</invention-title><us-related-documents><continuation><relation><parent-doc><document-id><country>US</country><doc-number>16000577</doc-number><date>20180605</date></document-id><parent-grant-document><document-id><country>US</country><doc-number>11477830</doc-number></document-id></parent-grant-document></parent-doc><child-doc><document-id><country>US</country><doc-number>17931487</doc-number></document-id></child-doc></relation></continuation><continuation><relation><parent-doc><document-id><country>US</country><doc-number>14768427</doc-number><date>20150817</date></document-id><parent-grant-document><document-id><country>US</country><doc-number>10015827</doc-number></document-id></parent-grant-document></parent-doc><child-doc><document-id><country>US</country><doc-number>16000577</doc-number></document-id></child-doc></relation></continuation></us-related-documents><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>CANON KABUSHIKI KAISHA</orgname><address><city>Tokyo</city><country>JP</country></address></addressbook><residence><country>JP</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>Goto</last-name><first-name>Fumihide</first-name><address><city>Tokyo</city><country>JP</country></address></addressbook></inventor></inventors></us-parties></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">A communication apparatus determines whether the communication apparatus is to operate as a transmission apparatus for transmitting service data to be transferred by a service performed via a network, or operate as both the transmission apparatus for transmitting the service data to be transferred by the service performed via the network and a reception apparatus for receiving the service data to be transferred by the service performed via the network, terminates a connection with a communication partner apparatus in response to completion of transmission of the service data if the communication apparatus operates as the transmission apparatus, and terminates the connection with the communication partner apparatus in response to a user operation if the communication apparatus operates as both the transmission apparatus and the reception apparatus.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="73.66mm" wi="158.75mm" file="US20230007711A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="196.00mm" wi="109.98mm" orientation="landscape" file="US20230007711A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="143.00mm" wi="155.53mm" file="US20230007711A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="99.82mm" wi="134.54mm" file="US20230007711A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="198.46mm" wi="140.72mm" file="US20230007711A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00005" num="00005"><img id="EMI-D00005" he="193.21mm" wi="125.31mm" file="US20230007711A1-20230105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00006" num="00006"><img id="EMI-D00006" he="199.05mm" wi="156.72mm" file="US20230007711A1-20230105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00007" num="00007"><img id="EMI-D00007" he="243.59mm" wi="157.48mm" file="US20230007711A1-20230105-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00008" num="00008"><img id="EMI-D00008" he="196.26mm" wi="160.02mm" file="US20230007711A1-20230105-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00009" num="00009"><img id="EMI-D00009" he="244.94mm" wi="159.60mm" file="US20230007711A1-20230105-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00010" num="00010"><img id="EMI-D00010" he="138.18mm" wi="150.37mm" file="US20230007711A1-20230105-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="lead"?><heading id="h-0001" level="1">RELATED APPLICATIONS</heading><p id="p-0002" num="0001">This application is a continuation of U.S. patent application Ser. No. 16/000,577 filed on Jun. 5, 2018, which is a continuation of U.S. patent application Ser. No. 14/768,427 filed on Aug. 17, 2015, and issued as U.S. Pat. No. 10,015,827 on Jul. 3, 2018, which is a National Stage application pursuant to 35 U.S.C. 371, of International Patent Application No. PCT/JP2014/000807, filed Feb. 17, 2014. These applications each claim the benefit of Japanese Application No. 2013-033419, filed Feb. 22, 2013. The above applications are hereby incorporated by reference herein in their entireties.</p><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="tail"?><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0002" level="1">TECHNICAL FIELD</heading><p id="p-0003" num="0002">The present invention relates to a communication apparatus, a method for controlling the communication apparatus, and a computer program.</p><heading id="h-0003" level="1">BACKGROUND ART</heading><p id="p-0004" num="0003">In recent years, more and more electronic apparatuses, such as digital cameras or printers, have been equipped with a wireless local area network (LAN) station function and used as communication apparatuses by connecting to a wireless LAN. For example, Japanese Patent Application Laid-Open No. 2011-35768 discusses a method in which a digital camera is equipped with a wireless LAN function to facilitate image sharing.</p><p id="p-0005" num="0004">Further, a standard called Wi-Fi Direct (registered trademark) is established by Wi-Fi Alliance. In Wi-Fi Direct, a protocol for determining whether each electronic apparatus operates as either a wireless LAN access point or a wireless LAN station is defined. By implementing the protocol, which electronic apparatus is to operate as the wireless LAN access point and which electronic apparatus is to operate as the wireless LAN station can be automatically determined, so that user convenience is enhanced.</p><p id="p-0006" num="0005">Further, in Wi-Fi Direct, a function of advertising and searching for service information supported by a higher-order application (service discovery function) is defined as an optional function. The service discovery function allows, before executing connection processing, an electronic apparatus to obtain the service information stored in an electronic apparatus to be connected thereto. Accordingly, user convenience is enhanced.</p><p id="p-0007" num="0006">The user can execute wireless LAN connection processing and service connection processing as an operation sequence simply by selecting the service the user desires to use. However, various kinds of services are provided via a network, and when a service will end cannot always be identified.</p><heading id="h-0004" level="1">SUMMARY OF INVENTION</heading><p id="p-0008" num="0007">The present invention is directed to terminating a connection with a communication partner apparatus according to a service.</p><p id="p-0009" num="0008">According to an aspect of the present invention, a communication apparatus includes a transmission means for transmitting service data to be transferred by a service performed via a network, a reception means for receiving the service data to be transferred by the service performed via the network, a determination means for determining whether the communication apparatus is to operate as a transmission apparatus on a transmitting side where the service data is transmitted by the transmission means, or operate as both the transmission apparatus on the transmitting side where the service data is transmitted by the transmission means and a reception apparatus on a receiving side where the service data is received by the reception means, and a disconnection means for terminating a connection with a communication partner apparatus, wherein if the communication apparatus operates as the transmission apparatus, the disconnection means terminates the connection with the communication partner apparatus in response to completion of transmission of the service data, and if the communication apparatus operates as both the transmission apparatus and the reception apparatus, the disconnection means terminates the connection with the communication partner apparatus in response to a user operation.</p><p id="p-0010" num="0009">According to another aspect of the present invention, a communication apparatus includes a transmission means for transmitting service data to be transferred by a service performed via a network, a reception means for receiving the service data to be transferred by the service performed via the network, a determination means for determining whether the communication apparatus is to operate as a reception apparatus on a receiving side where the service data is received by the reception means, or operate as both a transmission apparatus on a transmitting side where the service data is transmitted by the transmission means and the reception apparatus on the receiving side where the service data is received by the reception means, and a disconnection means for terminating a connection with a communication partner apparatus, wherein if the communication apparatus operates as the reception apparatus, the disconnection means terminates the connection with the communication partner apparatus in response to completion of reception of the service data, and if the communication apparatus operates as both the transmission apparatus and the reception apparatus, the disconnection means terminates the connection with the communication partner apparatus in response to a user operation.</p><p id="p-0011" num="0010">Further features of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached drawings.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0005" level="1">BRIEF DESCRIPTION OF DRAWINGS</heading><p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. <b>1</b></figref> is a block diagram of a configuration of a communication apparatus.</p><p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a block diagram of software functions in the communication apparatus.</p><p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. <b>3</b></figref> illustrates an example of a network configuration according to a first exemplary embodiment of the present invention.</p><p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. <b>4</b></figref> is an operation sequence diagram according to the first exemplary embodiment.</p><p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is another operation sequence diagram according to the first exemplary embodiment.</p><p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is yet another operation sequence diagram according to the first exemplary embodiment.</p><p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. <b>7</b></figref> is a flowchart illustrating operation performed by the communication apparatus according to the first exemplary embodiment.</p><p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. <b>8</b></figref> is an operation sequence diagram according to a second exemplary embodiment of the present invention.</p><p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. <b>9</b></figref> is a flowchart illustrating operation performed by the communication apparatus according to the second exemplary embodiment.</p><p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. <b>10</b></figref> is an image diagram illustrating a simultaneously-captured image sharing service according to the first exemplary embodiment.</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><heading id="h-0006" level="1">DESCRIPTION OF EMBODIMENTS</heading><p id="p-0022" num="0021">Various exemplary embodiments, features, and aspects of the invention will be described in detail below with reference to the drawings. Although an example will be described below where communication apparatuses perform wireless communication using the wireless LAN system defined by the IEEE 802.11 series of standards, the communication method to be used is not limited to the wireless LAN conforming to IEEE 802.11.</p><p id="p-0023" num="0022">First, a hardware configuration of a communication apparatus according to a first exemplary embodiment of the present invention will be described.</p><p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. <b>1</b></figref> is a block diagram illustrating an example of a configuration of each communication apparatus to be described below according to the first exemplary embodiment. A communication apparatus <b>101</b> includes various units. A control unit <b>102</b> controls the entire communication apparatus <b>101</b> by executing a control program stored in a storage unit <b>103</b>. The control unit <b>102</b> also controls setting of communication parameters to be used for communication with other apparatuses. The storage unit <b>103</b> stores a control program executed by the control unit <b>102</b> and various types of information such as the communication parameters. Various operations to be described below are realized by the control unit <b>102</b> executing a control program stored in the storage unit <b>103</b>.</p><p id="p-0025" num="0024">A wireless communication unit <b>104</b> performs wireless LAN communication which conforms to the IEEE 802.11 series of standards. A display unit <b>105</b> performs various types of display. The display unit <b>105</b> has a function of outputting visually-recognizable information, such as a liquid crystal display (LCD) or a light-emitting diode (LED), or a function of outputting audio such as a speaker. The display unit <b>105</b> has a function of outputting at least either visual information or audio information. The communication apparatus <b>101</b> further includes an antenna control unit <b>107</b> and an antenna <b>108</b>. An operation unit <b>109</b> is used by a user to perform various inputs to operate the communication apparatus <b>101</b>.</p><p id="p-0026" num="0025">A service providing unit <b>110</b> has a function that provides application-level service information provided by the communication apparatus <b>101</b>. For example, if the communication apparatus <b>101</b> is a printer, the service providing unit <b>110</b> provides a printing function, and the communication apparatus <b>101</b> prints out document data and image data received via the antenna <b>108</b> and the wireless communication unit <b>104</b>. Further, if the communication apparatus <b>101</b> is a digital camera, the service providing unit <b>110</b> provides an imaging function, and the image captured by the imaging function can be transmitted to another apparatus as transmission data. The service providing unit <b>110</b> may provide both the printing function and the imaging function, or may also provide other functions including a telephone function, a wireless communication function of a third-generation (3G) telephone, a wireless communication function of a GSM (registered trademark) telephone, and an electronic mail function. Further, the service providing unit <b>110</b> may have a function that provides time information and position information to a communication partner apparatus and receives such information from the communication partner apparatus using the global positioning system (GPS), a function that enables position information to be added to a captured image, and a function that enables an image, such as a captured image, to be shared among a plurality of apparatuses. The service providing unit <b>110</b> can operate as a service providing unit <b>208</b> which provides a service as well as a service using unit <b>209</b> which uses the service, which will be described below.</p><p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a block diagram illustrating an example of a configuration of software functional blocks which execute a communication control function to be described below. Software functional blocks <b>201</b> include various units. A discovery control unit <b>202</b> performs processing for searching for a communication apparatus that can serve as a communication partner apparatus, which will be described below.</p><p id="p-0028" num="0027">A Wi-Fi Direct control unit <b>203</b> performs control based on a Wi-Fi Direct protocol specification. According to the Wi-Fi Direct specification, a communication apparatus which serves as a wireless LAN access point is called a P2P Group Owner (GO) and a communication apparatus which serves as a wireless LAN station is called a P2P Client (CL) . Such roles are determined by a protocol for GO Negotiation and are defined by the Wi-Fi Direct specification. In the Wi-Fi Direct specification, a network established by a Group Owner is called a P2P group. The network to be described below is a P2P group. A Group Owner provides a Client with communication parameters. Then, the Group Owner and the Client are connected to each other using the communication parameters. The communication parameters include various kinds of wireless communication parameters for wireless communication conforming to the IEEE 802.11 standard. More specifically, the communication parameters include wireless communication parameters necessary to perform wireless LAN communication, such as a service set identifier (SSID) as a network identifier, an encryption method, an encryption key, an authentication method, and an authentication key. Further, the communication parameters include an internet protocol (IP) address to be used for communication on the IP layer. If the communication apparatus <b>101</b> operates as a Group Owner, the wireless communication unit <b>104</b> establishes a wireless network as a Group Owner and a Client is connected to the Group Owner by wireless LAN. The wireless network is established using the network identifier, encryption method, encryption key, authentication method, authentication key, and frequency channel that are specified by the Group Owner. The encryption key to be used for encrypted communication is determined by encryption key sharing processing which is performed by the Group Owner and the Client when the Group Owner authenticates the Client for wireless connection. A P2P Group Owner (GO), a P2P Client (CL), and a communication apparatus, which has not yet been given a defined role, are collectively called a P2P device.</p><p id="p-0029" num="0028">A service discovery control unit <b>204</b> controls a service discovery function to be described below. The service discovery function allows a communication apparatus to exchange service information with a partner communication apparatus by transmitting and receiving an action frame specified by IEEE 802.11. More specifically, a communication apparatus transmits a Service Discovery (SD) query to a partner communication apparatus and receives a SD response as a response. Alternatively, the communication apparatus receives a SD query from the partner communication apparatus and transmits a SD response as a response. The service information exchanged between the communication apparatuses includes protocol information to be used when the apparatuses mutually execute the service communication, and service function information that indicates the essential and optional functions supported by the service. For example, if the target apparatus is a printer, information on whether the printer can support two-sided printing, color or monochrome printing, or format printing can be provided or acquired as the service function information. The examples described above shall not be construed as limiting the present invention. These examples are simply given to enhance the understanding.</p><p id="p-0030" num="0029">An L3 Service Discovery control unit <b>205</b> controls a service discovery function on the network layer (layer 3) of the open systems interconnection (OSI) reference model. This service discovery function can be executed by using a technique such as Universal Plug and Play (UPnP) (registered trademark) or Bonjour (registered trademark). A packet reception unit <b>206</b> and a packet transmission unit <b>207</b> control transmission and reception of all packets including an upper layer communication protocol.</p><p id="p-0031" num="0030">The service providing unit <b>208</b> provides services on the application layer. The application layer is a service providing layer in the fifth and upper layers of the OSI reference model. Specifically, the service providing unit <b>208</b> provides functions such as a printing function, an image streaming function, and a file transfer function. The services provided via a network, which will be described below, are provided by the service providing unit <b>208</b>.</p><p id="p-0032" num="0031">The service using unit <b>209</b> uses services on the application layer. The service using unit <b>209</b> uses the services provided by a service providing unit on the application layer of the communication partner apparatus. More specifically, the service using unit <b>209</b> controls a function of transmitting a print product to a print service providing apparatus, a function of transmitting a moving image to a digital display, and the like. The services provided via a network to be described below are used by the service using unit <b>209</b>.</p><p id="p-0033" num="0032">All the functional blocks are associated with each other software or hardware wise. Further, the above-described functional blocks are used as an example. A plurality of functional blocks in this example may be configured to form one functional block, or a functional block may be further divided into a plurality of functional blocks.</p><p id="p-0034" num="0033"><figref idref="DRAWINGS">FIG. <b>3</b></figref> illustrates a network A<b>31</b> (hereinafter referred to as a network A) which includes a communication apparatus A<b>32</b> (hereinafter referred to as a STA-A) and a communication apparatus B<b>33</b> (hereinafter referred to as a STA-B). These apparatuses have the configuration described above with reference to <figref idref="DRAWINGS">FIGS. <b>1</b> and <b>2</b></figref>.</p><p id="p-0035" num="0034">In the first exemplary embodiment, service search processing and connection processing on the wireless LAN layer, which are performed when the STA-A serving as a digital camera executes a service for transmitting service data via a network, will be described. The STA-A executes a geotag acquisition service, an image transfer service, and a simultaneously-captured image sharing service, and performs connection processing on the wireless LAN layer. The geotag acquisition service is used for acquiring position information and adding the acquired position information to an image. The image transfer service is used for transferring an image. The simultaneously-captured image sharing service is used for sharing an image between apparatuses. If the STA-A uses the geotag acquisition service, the STA-A is connected to the STA-B serving as a GPS logger by wireless LAN. Further, if the STA-A uses the geotag acquisition service, the STA-A operates as a reception apparatus which receives and acquires position information as the service data of the geotag acquisition service. Furthermore, if the STA-A uses the geotag acquisition service, the STA-B operates as a transmission apparatus which transmits position information as the service data.</p><p id="p-0036" num="0035">If the STA-A uses the image transfer service, the STA-A is connected to the STA-B serving as a cellular phone or a smartphone by wireless LAN. Further, if the STA-A uses the image transfer service, the STA-A operates as a transmission apparatus which transmits image data or an image file, which is transmitted as the service data of the image transfer service. Furthermore, if the STA-A uses the image transfer service, the STA-B operates as a reception apparatus which receives image data or an image file, which is transmitted as the service data of the image transfer service.</p><p id="p-0037" num="0036">If the STA-A uses the simultaneously-captured image sharing service, the STA-A is connected to the STA-B serving as a digital camera by wireless LAN. Further, if the STA-A uses the simultaneously-captured image sharing service, the STA-A operates as both a transmission apparatus for transmitting image data or an image file, which is the service data of the simultaneously-captured image sharing service, and a reception apparatus for receiving the image data or the image file.</p><p id="p-0038" num="0037"><figref idref="DRAWINGS">FIG. <b>4</b></figref> is an operation sequence diagram illustrating the geotag acquisition service as an example of a service on the application layer.</p><p id="p-0039" num="0038">In <figref idref="DRAWINGS">FIG. <b>4</b></figref>, the STA-A is a digital camera and the STA-B is a GPS logger. The GPS logger is an apparatus for recording a moving path using the GPS. The STA-A records the shooting date and time each time an image is captured. The STA-B records the date and time and the moving path as GPS information. When the geotag acquisition service is started by the STA-A and the STA-B, the STA-A and the STA-B are connected to each other to synchronize the data, so that geotag information can be added to each captured image. In this context, the geotag information is position information on the latitude and longitude of the shooting location as additional information of the captured image.</p><p id="p-0040" num="0039">First, the digital camera (STA-A) searches for the GPS logger (STA-B) using the service discovery processing defined by the Wi-Fi Direct specification. Specifically, the STA-A transmits a SD query packet that specifies the geotag acquisition service to the STA-B (F<b>401</b>).</p><p id="p-0041" num="0040">Here, it is assumed that the STA-B supports the geotag acquisition service specified in the SD query packet transmitted from the STA-A. Thus, the STA-B adds information indicating that the STA-B supports the geotag acquisition service to a SD response packet, and transmits the SD response packet to the STA-A (F<b>402</b>).</p><p id="p-0042" num="0041">Since the service information has been determined in F<b>401</b> and F<b>402</b>, wireless LAN connection processing is performed (F<b>403</b>). In the wireless LAN connection processing, a predetermined protocol for determining a Group Owner and a Client is executed by the control of the Wi-Fi Direct control unit <b>203</b>. As a result of the execution of the protocol, one apparatus is determined to serve as a Group Owner and the other apparatus is determined to serve as a Client. Further, the Group Owner provides the Client with communication parameters, and the apparatuses are connected to each other by wireless LAN. If the Group Owner has already been determined before the connection processing is performed, the Group Owner that has already been operating as a Group Owner provides the Client with communication parameters and the apparatuses are connected to each other by wireless LAN. When the connection on the wireless LAN layer has been completed, the geotag acquisition service is executed (F<b>404</b>).</p><p id="p-0043" num="0042">The geotag acquisition service allows a camera to obtain a corresponding set of GPS information and time information from a GPS logger based on the shooting time of the images stored in the camera. More specifically, the service using unit <b>209</b> of the STA-A requests the service providing unit <b>208</b> of the STA-B to transmit a set of GPS information and time information corresponding to the images. At this time, the service using unit <b>209</b> notifies the service providing unit <b>208</b> of the shooting time of the images. More specifically, the service using unit <b>209</b> provides the service providing unit <b>208</b> with the shooting time of all the images stored in the storage unit <b>103</b> of the STA-A, or with the shooting time of an image that does not have GPS information added or an image that is specified by the user. Then, the service providing unit <b>208</b> transmits the GPS information corresponding to the provided shooting time to the service using unit <b>209</b>.</p><p id="p-0044" num="0043">When the service using unit <b>209</b> of the STA-A determines that the corresponding set of the GPS information and time information has been obtained, the service using unit <b>209</b> instructs the Wi-Fi Direct control unit <b>203</b> to perform wireless LAN disconnection processing to terminate the wireless LAN connection. Specifically, the STA-A transmits a deauthentication packet to the STA-B (F<b>405</b>). When receiving the deauthentication packet, the STA-B transmits a deauthentication packet to the STA-A as a response (F<b>406</b>).</p><p id="p-0045" num="0044"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is an operation sequence diagram illustrating the image transfer service as an example of a service on the application layer. In <figref idref="DRAWINGS">FIG. <b>5</b></figref>, it is assumed that the STA-A is a digital camera and the STA-B is a smartphone. The STA-A transfers a desired image to the smartphone, so that an image captured by the digital camera can be used as a wallpaper of the smartphone.</p><p id="p-0046" num="0045">The digital camera (STA-A) searches for a cellular phone or a smartphone (STA-B) using the service discovery processing defined by the Wi-Fi Direct specification. Specifically, the STA-A transmits a SD query packet that specifies the image transfer service to the STA-B (F<b>501</b>).</p><p id="p-0047" num="0046">Since the STA-B supports the image transfer service specified in the SD query packet transmitted from the STA-A, the STA-B adds information indicating that the STA-B supports the image transfer service to a SD response packet, and transmits the SD response packet to the STA-A (F<b>502</b>).</p><p id="p-0048" num="0047">Since the service information has been determined in F<b>501</b> and F<b>502</b>, wireless LAN connection processing is performed (F<b>503</b>). In the wireless LAN connection processing, a predetermined protocol for determining a Group Owner and a Client is executed by the control of the Wi-Fi Direct control unit <b>203</b>. As a result of the execution of the protocol, one apparatus is determined to serve as a Group Owner and the other apparatus is determined to serve as a Client. Further, the Group Owner provides the Client with communication parameters, and the apparatuses are connected to each other by wireless LAN. If the Group Owner has already been determined before the connection processing is performed, the Group Owner which has already been operating as a Group Owner provides the Client with communication parameters and the apparatuses are connected to each other by wireless LAN. When the connection on the wireless LAN layer has been completed, the image transfer service is executed (F<b>504</b>).</p><p id="p-0049" num="0048">The image transfer service allows a camera to transfer the image data or an image file stored therein to a partner communication apparatus such as a smartphone according to a user's instruction. Specifically, the service using unit <b>209</b> of the STA-A transfers image data or an image file to the service providing unit <b>208</b> of the STA-B. The image data or image file to be transferred may be a still image or a moving image. The image data or image file to be transferred is specified by a user operation.</p><p id="p-0050" num="0049">When the service using unit <b>209</b> of the STA-A determines that transfer of the specified image data or image file has been completed, the service using unit <b>209</b> instructs the Wi-Fi Direct control unit <b>203</b> to perform wireless LAN disconnection processing to terminate the wireless LAN connection. Specifically, the STA-A transmits a deauthentication packet to the STA-B (F<b>505</b>). When receiving the deauthentication packet, the STA-B transmits a deauthentication packet to the STA-A as a response (F<b>506</b>).</p><p id="p-0051" num="0050"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is an operation sequence diagram illustrating the simultaneously-captured image sharing service as an example of a service on the application layer. In <figref idref="DRAWINGS">FIG. <b>6</b></figref>, it is assumed that both the STA-A and the STA-B are digital cameras. The simultaneously-captured image sharing service allows the STA-A and STA-B to share captured images and obtain multiangle images. During the simultaneously-captured image sharing service, the STA-A and the STA-B transfer image data or an image file which is displayed on the display unit <b>105</b> to the apparatus being an image sharing partner. When the apparatus as an image sharing partner has received the displayed image data or the displayed image file, the apparatus displays the received image along with an image being captured by its image-capture unit. If the apparatus that has received the displayed image has already been viewing an image stored in the storage unit <b>103</b>, the received displayed image is displayed together with the image being viewed. Further, during the simultaneously-captured image sharing service, if an image is captured, the STA-A and the STA-B store the captured image in the storage unit <b>103</b> as well as transfer image data or an image file of the captured image to the apparatus being an image sharing partner. The apparatus as an image sharing partner that has received the captured image displays the received captured image on the display unit <b>105</b> for a predetermined period of time. In the simultaneously-captured image sharing service, since each of the apparatuses (the STA-A and the STA-B) that share the image operates as described above, the STA-A and the STA-B can display the image almost simultaneously. Further, the captured image can be shared almost at the same time as when the image has been captured.</p><p id="p-0052" num="0051"><figref idref="DRAWINGS">FIG. <b>10</b></figref> is an image diagram of the above-described example. In this service, the remote screen of the display unit <b>105</b> of the STA-B is displayed on the screen of the display unit of the STA-A. In the first exemplary embodiment, since the remote screen of the STA-B is displayed, the user of the STA-A can also remotely operate the STA-B via the display unit of the STA-A. For example, the user can click the shutter of the STA-B via the display unit of the STA-A.</p><p id="p-0053" num="0052">In <figref idref="DRAWINGS">FIG. <b>6</b></figref>, the digital camera (STA-A) searches for another digital camera (STA-B) using the service discovery processing defined by the Wi-Fi Direct specification. Specifically, the STA-A transmits a SD query packet that specifies the image transfer service to the STA-B (F<b>601</b>). Here, it is assumed that the STA-B supports the simultaneously-captured image sharing service specified in the SD query packet transmitted from the STA-A. Thus, the STA-B adds information indicating that the STA-B supports the simultaneously-captured image sharing service to a SD response packet, and transmits the SD response packet to the STA-A (F<b>602</b>).</p><p id="p-0054" num="0053">Since the service information has been determined in F<b>601</b> and F<b>602</b>, wireless LAN connection processing is performed (F<b>603</b>). In the wireless LAN connection processing, a predetermined protocol for determining a Group Owner and a Client is executed by the control of the Wi-Fi Direct control unit <b>203</b>. As a result of the execution of the protocol, one apparatus is determined to serve as a Group Owner and the other apparatus is determined to serve as a Client. Further, the Group Owner provides the Client with communication parameters, and the apparatuses are connected to each other by wireless LAN. If the Group Owner has already been determined before the connection processing is performed, the Group Owner which has already been operating as a Group Owner provides the Client with communication parameters, and the apparatuses are connected to each other by wireless LAN. When the connection on the wireless LAN layer has been completed, the simultaneously-captured image sharing service is executed (F<b>604</b>).</p><p id="p-0055" num="0054">The simultaneously-captured image sharing service allows the image data or image file acquired by capturing an image according to an user's instruction to be transferred to a partner communication apparatus such as a digital camera. Thus, the service using unit <b>209</b> of the STA-A cannot identify when the image will be transferred from the service providing unit <b>208</b> of the STA-B, which is an image sharing partner of the STA-A. Thus, if the service using unit <b>209</b> of the STA-A uses the simultaneously-captured image sharing service, the service using unit <b>209</b> determines the completion of the service according to the user operation. Similarly, if the service using unit <b>209</b> of the STA-B uses the simultaneously-captured image sharing service, the service using unit <b>209</b> determines the completion of the service according to the user operation.</p><p id="p-0056" num="0055">More specifically, if the user issues a service end instruction by operating the operation unit <b>109</b>, the service using unit <b>209</b> of the STA-A detects the operation (F<b>605</b>). When the service using unit <b>209</b> of the STA-A has detected the operation to end the above-described service, the STA-A transmits a deauthentication packet to the STA-B (F<b>606</b>). When receiving the deauthentication packet, the STA-B transmits a deauthentication packet to the STA-A as a response (F<b>607</b>).</p><p id="p-0057" num="0056">Further, the STA-B which has received the deauthentication packet displays, on the display unit <b>105</b>, a message informing the user that the simultaneously-captured image sharing service has ended and the wireless LAN has been disconnected (F<b>608</b>).</p><p id="p-0058" num="0057">As described above, according to the service executed on the application layer, whether the disconnection processing is automatically performed after the service has been completed or is performed according to the user's instruction is determined.</p><p id="p-0059" num="0058"><figref idref="DRAWINGS">FIG. <b>7</b></figref> is a flowchart illustrating an example of the operation performed by the STA-A described with reference to <figref idref="DRAWINGS">FIGS. <b>4</b>, <b>5</b></figref>, and <b>6</b>. In step S<b>701</b>, the user specifies the service to be used. In step S<b>702</b>, the control unit <b>102</b> searches for any available partner apparatus that supports the specified service. In step S<b>703</b>, the control unit <b>102</b> determines whether the partner apparatus that supports the specified service has been detected. If such a partner apparatus does not exist (NO in step S<b>703</b>), the processing proceeds to step S<b>710</b>. In step S<b>710</b>, the control unit <b>102</b> performs error processing. Then, the processing is ended.</p><p id="p-0060" num="0059">On the other hand, in step S<b>703</b>, if the partner apparatus that supports the specified service has been detected (YES in step S<b>703</b>), the processing proceeds to step S<b>704</b>. In step S<b>704</b>, the control unit <b>102</b> performs the connection processing on the wireless LAN layer as described above. In step S<b>705</b>, the control unit <b>102</b> executes the service processing on the application layer. Here, if the service type is the image transfer service, the processing is continued until all the image data or all the image files specified by the user have been transferred. If the service type is the geotag acquisition service, the processing is continued until all the GPS information as the position information necessary for the images stored in the camera has been acquired. In step S<b>706</b>, the control unit <b>102</b> determines whether the service type is the simultaneously-captured image sharing service. If the service type is the image transfer service (NO in step S<b>706</b>), the processing proceeds to step S<b>707</b>. In step S<b>707</b>, the control unit <b>102</b> determines whether the service processing has been completed. If the control unit <b>102</b> determines that transfer of all the image data or all the image files specified by the user has been completed (YES in step S<b>707</b>), the processing proceeds to step S<b>709</b>. In step S<b>709</b>, the control unit <b>102</b> disconnects the wireless LAN, and then the processing is ended. In step S<b>706</b>, if the service type is the geotag acquisition service (NO in step S<b>706</b>), the processing proceeds to step S<b>707</b>. In step S<b>707</b>, if the control unit <b>102</b> determines that all the GPS information necessary for the images stored in the camera has been acquired (YES in step S<b>707</b>), the processing proceeds to step S<b>709</b>. In step S<b>709</b>, the control unit <b>102</b> disconnects the wireless LAN, and then the processing is ended. In step S<b>708</b>, the control unit <b>102</b> determines whether a disconnection instruction has been issued by the user. If the control unit <b>102</b> determines that a disconnection instruction has been issued by the user (YES in step S<b>708</b>), the processing proceeds to step S<b>709</b>. If the control unit <b>102</b> determines that a disconnection instruction has not been issued by the user (NO in step S<b>708</b>), the processing returns to step S<b>707</b>. Thus, when the image transfer service or the geotag acquisition service is performed, if a disconnection instruction has been issued by the user before the completion of the service, the wireless LAN is disconnected and the processing is ended.</p><p id="p-0061" num="0060">In step S<b>706</b>, if the service type is the simultaneously-captured image sharing service (YES in step S<b>706</b>), the processing proceeds to step S<b>711</b>. In step S<b>711</b>, the control unit <b>102</b> determines whether a disconnection instruction has been issued by the user. If a disconnection instruction has been issued by the user (YES in step S<b>711</b>), the processing proceeds to step S<b>709</b>. In step S<b>709</b>, the control unit <b>102</b> disconnects the wireless LAN, and then the processing is ended.</p><p id="p-0062" num="0061">On the other hand, in step S<b>711</b>, if a disconnection instruction has not been issued by the user (NO in step S<b>711</b>), the control unit <b>102</b> continues the simultaneously-captured image sharing service.</p><p id="p-0063" num="0062">According to the first exemplary embodiment, if the service has a clear end condition , the wireless LAN disconnection processing can be automatically performed after the completion of the service. On the other hand, if the service does not have a clear end condition and the end condition is based on the determination of the user, the apparatus waits for a disconnection instruction or an end instruction from the user.</p><p id="p-0064" num="0063">The geotag acquisition service, the image transfer service, and the simultaneously-captured image sharing service are described as examples of the service according to the first exemplary embodiment. However, the service is not limited thereto. The geotag acquisition service and the image transfer service are used as examples of the service having a clear end condition, and the simultaneously-captured image sharing service is used as an example of the service which is determined to be completed by the user.</p><p id="p-0065" num="0064">For example, if a Push service is used, the completion of the service can be determined when the transmission apparatus for transmitting the service data determines that transmitting the service data has been completed. Further, if a Pull service is used, the completion of the service can be determined when the reception apparatus for receiving the service data determines that receiving or acquiring the service data has been completed. Further, the service data is not limited to image data or an image file of a still image or a moving image, or position information. The service data may be file data of a document file or print data.</p><p id="p-0066" num="0065">In the first exemplary embodiment, an example has been described, where whether to terminate the wireless LAN connection when the service has been completed is determined according to the service type used by the communication apparatus. In a second exemplary embodiment of the present invention, an example will be described, where instead of specifying the service type, the transmission/reception direction of service data is specified for executing the service. A communication apparatus according to the second exemplary embodiment also has the configuration described above with reference to <figref idref="DRAWINGS">FIGS. <b>1</b> and <b>2</b></figref>.</p><p id="p-0067" num="0066"><figref idref="DRAWINGS">FIG. <b>8</b></figref> is an example of an operation sequence diagram of a service on the application layer. In this service, the transfer direction of the service data is bidirectional.</p><p id="p-0068" num="0067">The STA-A searches for the STA-B using the service discovery processing defined by the Wi-Fi Direct specification. Specifically, the STA-A transmits a SD query packet which specifies a service data transmission/reception capability to the STA-B (F<b>801</b>). In this example, it is assumed that the STA-B supports the service data transmission/reception capability specified in the SD query packet transmitted from the STA-A. Thus, the STA-B adds information indicating that the STA-B supports the service data transmission/reception capability to a SD Response packet, and transmits the SD Response packet to the STA-A (F<b>802</b>).</p><p id="p-0069" num="0068">Since the transfer direction of the service data has been determined in F<b>801</b> and F<b>802</b>, wireless LAN connection processing is performed (F<b>803</b>). In the wireless LAN connection processing, a predetermined protocol for determining a Group Owner and a Client is executed by the control of the Wi-Fi Direct control unit <b>203</b>. As a result of the execution of the protocol, one apparatus is determined to serve as a Group Owner and the other apparatus is determined to serve as a Client. The Group Owner provides the Client with communication parameters, and the apparatuses are connected to each other by wireless LAN. Further, if the Group Owner has already been determined before the connection processing is performed, the Group Owner which has already been operating as a Group Owner provides the Client with communication parameters, and the apparatuses are connected to each other by wireless LAN. When the connection on the wireless LAN layer has been completed, the service on the application layer is executed (F<b>804</b>).</p><p id="p-0070" num="0069">If the transfer direction of the service data is bidirectional, the disconnection processing is executed when the user issues an instruction to end the service by performing an operation. More specifically, the user issues a service end instruction to the STA-A by operating the operation unit <b>109</b> (F<b>805</b>). Then, the STA-A transmits a deauthentication packet to the STA-B (F<b>806</b>). When receiving the deauthentication packet, the STA-B transmits a deauthentication packet to the STA-A as a response (F<b>807</b>). Further, the STA-B which has received the deauthentication packet displays, on the display unit <b>105</b>, a message informing the user that the service on the application layer has ended and the wireless LAN has been disconnected (F<b>808</b>).</p><p id="p-0071" num="0070">On the other hand, if the transfer direction of the service data of the service on the application layer is unidirectional, the completion of the service can be determined when either the transmission apparatus, which is on the transmitting side of the service data, or the reception apparatus, which is on the receiving side of the data, determines the completion of the data transfer. The communication apparatus that has determined the completion of the service starts the disconnection processing of the wireless LAN. In the second exemplary embodiment, similarly to the first exemplary embodiment, if the service is the image transfer service, the service is determined to be completed when the STA-A, which is a transmission apparatus for transmitting image data or an image file as the service data, has completed transmission of the service data. If the service is the geotag acquisition service, the service is determined to be completed when the STA-A, which acquires GPS information as the service data, determines that the STA-A has acquired the GPS information which the STA-A has requested the STA-B to transmit.</p><p id="p-0072" num="0071">Further, if the service is the simultaneously-captured image sharing service, both the STA-A and the STA-B serve as service data transmission apparatus as well as service data reception apparatuses, and the transfer direction of the service data is determined to be bidirectional.</p><p id="p-0073" num="0072"><figref idref="DRAWINGS">FIG. <b>9</b></figref> is a flowchart illustrating an example of the operation performed by the STA-A described with reference to <figref idref="DRAWINGS">FIG. <b>8</b></figref>. In step S<b>901</b>, the user specifies the transmission/reception direction of the service data. Here, there are three patterns regarding the transmission/reception direction of the service data: transmission of the data from the STA-A to STA-B, transmission of the data from the STA-B to the STA-A (the STA-A receives the data transmitted from the STA-B), and bidirectional transmission/reception of the data between the STA-A and the STA-B.</p><p id="p-0074" num="0073">In step S<b>902</b>, the control unit <b>102</b> searches for any available partner apparatus that supports the specified service transmission/reception direction.</p><p id="p-0075" num="0074">In step S<b>903</b>, the control unit <b>102</b> determines whether the partner apparatus that supports the specified service has been detected. If such a partner apparatus does not exist (NO in step S<b>903</b>), the processing proceeds to step S<b>909</b>. In step S<b>909</b>, the control unit <b>102</b> performs error processing. Then, the processing is ended.</p><p id="p-0076" num="0075">On the other hand, in step S<b>903</b>, if the partner apparatus that s the specified service has been detected (YES in step S<b>903</b>), the processing proceeds to step S<b>904</b>. In step S<b>904</b>, the control unit <b>102</b> performs the wireless LAN connection processing. In step S<b>905</b>, the control unit <b>102</b> executes the service processing on the application layer. If the service is the image transfer service, the processing is continued until transfer of the image data or image file specified by the user is completed. If the service is the geotag acquisition service, the processing is continued until all the GPS information necessary for the images stored in the camera is acquired. In other words, the processing is continued until transfer of all the service data from the apparatus on the transmitting side to the apparatus on the receiving side is completed.</p><p id="p-0077" num="0076">In step S<b>906</b>, the control unit <b>102</b> determines whether the transfer direction of the service data is bidirectional. In this example, if the service is the image transfer service or the geotag acquisition service, the transfer direction of the service data is unidirectional (NO in step S<b>906</b>). Therefore, the processing proceeds to step S<b>907</b>. In step S<b>907</b>, the control unit <b>102</b> of the STA-A determines whether the service processing has been completed. If the control unit <b>102</b> determines that transmission or reception of the service data has been completed (YES in step S<b>907</b>), the processing proceeds to step S<b>908</b>. In step S<b>908</b>, the control unit <b>102</b> disconnects the wireless LAN, and then the processing is ended. Even when the image transfer service or the geotag acquisition service is performed (NO in step S<b>906</b>), if a disconnection instruction has been issued by the user before the completion of the service (YES in step S<b>911</b>), then in step <b>908</b>, the wireless LAN is disconnected and the processing is ended.</p><p id="p-0078" num="0077">In step S<b>906</b>, if the transmission/reception direction of the service data is bidirectional (YES in step S<b>906</b>), the processing proceeds to step S<b>910</b>. In step S<b>910</b>, the control unit <b>102</b> determines whether a disconnection instruction has been issued by the user. If a disconnection instruction has been issued by the user (YES in step S<b>910</b>), the processing proceeds to step S<b>908</b>. In step S<b>910</b>, if a disconnection instruction has not been issued by the user (NO in step S<b>910</b>), the control unit <b>102</b> continues the service processing on the application layer.</p><p id="p-0079" num="0078">As described above, in the second exemplary embodiment, whether the wireless LAN disconnection processing is to be automatically performed after the completion of the service or whether the apparatus is to wait for a disconnection instruction or an end instruction from the user can be autonomously determined according to the transfer direction of the service data.</p><p id="p-0080" num="0079">Although the geotag acquisition service, the image transfer service, and the simultaneously-captured image sharing service are described as examples of the service according to the second exemplary embodiment, the service is not limited thereto. The geotag acquisition service and the image transfer service are used as examples of the service having a clear end condition. The simultaneously-captured image sharing service is used as an example of the service which is determined to be completed by the user.</p><p id="p-0081" num="0080">For example, if a Push service is used, the completion of the service can be determined when the transmission apparatus for transmitting the service data determines that transmission of the service data has been completed. Further, if a Pull service is used, the completion of the service can be determined when the reception apparatus for receiving the service data determines that receiving or acquiring the service data has been completed. Furthermore, the service data is not limited to image data or an image file of a still image or a moving image, or position information. The service data may be file data of a document file or print data.</p><p id="p-0082" num="0081">As described above, according to each of the above-described embodiments, if a communication apparatus operates as a service data transmission apparatus or a service data reception apparatus, a connection with a communication partner apparatus is terminated in response to completion of transmission or reception of the service data. On the other hand, if a communication apparatus operates as both a service data transmission apparatus and a service data reception apparatus, a connection with a communication partner apparatus is terminated in response to a user operation. Thus, if a communication apparatus can identify the end condition for a service in advance, the communication apparatus can terminate a connection with a communication partner apparatus in response to completion of the service, so that unnecessary connections can be reduced. Reducing unnecessary connections can cut down power consumption. Further, the network resources can be efficiently used. Furthermore, if the end condition for a service cannot be identified or is difficult to be identified in advance, a disconnection from the communication partner apparatus before completion of the service can be prevented.</p><p id="p-0083" num="0082">Another exemplary embodiment of the present invention will be described.</p><p id="p-0084" num="0083">In the above-described exemplary embodiments, examples using a wireless LAN conforming to IEEE 802.11 have been described. However, the exemplary embodiments of the present invention can be implemented using other wireless medium such as wireless universal serial bus (USB), multiband-OFDM alliance (MBOA), Bluetooth (registered trademark), ultra wide band (UWB), and ZigBee. Further, the embodiments of the present invention can also be implemented using a wired communication medium such as wired LAN. The UWB includes Wireless USB, Wireless 1394, and Wireless Networking (WINET).</p><p id="p-0085" num="0084">Furthermore, in the above-described exemplary embodiments, examples using Wi-Fi Direct have been described. However, the exemplary embodiments of the present invention can be applied to a method where a predetermined protocol for determining whether to serves as a master unit or a slave unit is performed between apparatuses. Further, the exemplary embodiments can be applied to a method where a predetermined protocol for determining whether to serve as a server or a client is performed between apparatuses, a method for determining a base station and an apparatus to be connected thereto by wireless LAN, and the like.</p><p id="p-0086" num="0085">The exemplary embodiments of the present invention can also be realized by a computer program code. In such a case, a storage medium storing a program code of software for implementing the functions of the above-described exemplary embodiments is supplied to a system or an apparatus, and a computer (or central processing unit (CPU) or micro processing unit (MPU)) in the system or the apparatus reads out and executes the program code stored in the storage medium. In this case, the program code read from the storage medium itself implements the functions of the above-described exemplary embodiments. Thus, the storage medium storing the program code is an exemplary embodiment of the present invention. As the storage medium for providing the program code, a flexible disk, a hard disk, an optical disk, a magneto-optical disk, a compact disc read-only memory (CD-ROM), a CD recordable (CD-R), a magnetic tape, a non-volatile memory card, a ROM, or a digital versatile disc (DVD) may be used, for example.</p><p id="p-0087" num="0086">Further, the functions of the above-described exemplary embodiments can be implemented not only by the computer executing the program code, but also by an operating system (OS), which runs on the computer, executing some or all of actual processes based on an instruction of the program code. Furthermore, the functions of the above-described exemplary embodiments can be implemented in such a way that the program code read from the storage medium is written into a memory provided in an function expansion board inserted into the computer or a function expansion unit connected to the computer, and a CPU provided in the function expansion board or the function expansion unit performs some or all of actual processes based on an instruction of the program code,</p><p id="p-0088" num="0087">According to the exemplary embodiments of the present invention, a communication apparatus can terminate a connection with a communication partner apparatus according to the service used.</p><p id="p-0089" num="0088">Embodiments of the present invention can also be realized by a computer of a system or apparatus that reads out and executes computer executable instructions recorded on a storage medium (e.g., non-transitory computer-readable storage medium) to perform the functions of one or more of the above-described embodiment(s) of the present invention, and by a method performed by the computer of the system or apparatus by, for example, reading out and executing the computer executable instructions from the storage medium to perform the functions of one or more of the above-described embodiment(s). The computer may comprise one or more of a central processing unit (CPU), micro processing unit (MPU), or other circuitry, and may include a network of separate computers or separate computer processors. The computer executable instructions may be provided to the computer, for example, from a network or the storage medium. The storage medium may include, for example, one or more of a hard disk, a random-access memory (RAM), a read only memory (ROM), a storage of distributed computing systems, an optical disk (such as a compact disc (CD), digital versatile disc (DVD), or Blu-ray Disc (BD) (trademark), a flash memory device, a memory card, and the like.</p><p id="p-0090" num="0089">While the present invention has been described with reference to exemplary embodiments, it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.</p><?detailed-description description="Detailed Description" end="tail"?></description><claims id="claims"><claim id="CLM-00001" num="00001"><claim-text><b>1</b>. (canceled)</claim-text></claim><claim id="CLM-00002" num="00002"><claim-text><b>2</b>. A communication apparatus comprising:<claim-text>at least one antenna;</claim-text><claim-text>at least one memory that stores a set of instructions; and</claim-text><claim-text>at least one processor that executes the instructions, the instructions, when executed, causing the communication apparatus to perform operations comprising:</claim-text><claim-text>transmitting a deauthentication packet conforming to IEEE 802.11 series of standards to disconnect a first wireless connection to another communication apparatus without receiving an instruction to disconnect the wireless connection from a user after image processing specified by the user is finished in a case where the first wireless connection uses the at least one antenna, is with the other communication apparatus and is established by a first operation by the user; and</claim-text><claim-text>transmitting the deauthentication packet conforming to the IEEE 802.11 series of standards to disconnect a second wireless connection to the other communication apparatus in response to an instruction to disconnect the wireless connection in a case where the second wireless connection uses the at least one antenna, is with the other communication apparatus and is established by a second operation different from the first operation by the user.</claim-text></claim-text></claim><claim id="CLM-00003" num="00003"><claim-text><b>3</b>. A communication apparatus comprising:<claim-text>at least one antenna;</claim-text><claim-text>at least one memory that stores a set of instructions; and</claim-text><claim-text>at least one processor that executes the instructions, the instructions, when executed, causing the communication apparatus to perform operations comprising:</claim-text><claim-text>transmitting a deauthentication packet conforming to IEEE 802.11 series of standards to disconnect wireless connection to another communication apparatus without receiving an instruction to disconnect a first wireless connection from a user after image processing designated by the user is finished in a case where the first wireless connection uses the at least one antenna, is with the other communication apparatus and is established by a first operation by the user,</claim-text><claim-text>wherein the deauthentication packet conforming to the IEEE 802.11 series of standards to disconnect the wireless connection is not transmitted to the other communication apparatus until an instruction to disconnect a second wireless connection is issued in a case where the second wireless connection uses the at least one antenna, is with the other communication apparatus and is established by a second operation different from the first operation by the user.</claim-text></claim-text></claim><claim id="CLM-00004" num="00004"><claim-text><b>4</b>. The communication apparatus according to <claim-ref idref="CLM-00003">claim 3</claim-ref>,<claim-text>wherein the communication apparatus performs a search to detect another communication apparatus capable of executing the designated image processing, and</claim-text><claim-text>wherein the first wireless connection is established with the detected other communication apparatus capable of executing the designated image processing.</claim-text></claim-text></claim><claim id="CLM-00005" num="00005"><claim-text><b>5</b>. The communication apparatus according to <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein, in a case where another communication apparatus capable of executing the designated image processing is not detected by the search, the communication apparatus performs error processing.</claim-text></claim><claim id="CLM-00006" num="00006"><claim-text><b>6</b>. The communication apparatus according to <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the search is performed by using a Service Discovery Query signal.</claim-text></claim><claim id="CLM-00007" num="00007"><claim-text><b>7</b>. The communication apparatus according to <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein the communication apparatus executes Group Owner (GO) Negotiation defined by a Wi-Fi Direct specification with the other communication apparatus before the first wireless connection with the other communication apparatus is established.</claim-text></claim><claim id="CLM-00008" num="00008"><claim-text><b>8</b>. The communication apparatus according to <claim-ref idref="CLM-00003">claim 3</claim-ref>,<claim-text>wherein the second operation is an operation for performing wireless connection in order to execute image processing in which a transfer direction of data to be used for the image processing is bidirectional, and</claim-text><claim-text>wherein the first operation is an operation for performing wireless connection in order to execute image processing in which the transfer direction of data to be used for the image processing is unidirectional.</claim-text></claim-text></claim><claim id="CLM-00009" num="00009"><claim-text><b>9</b>. The communication apparatus according to <claim-ref idref="CLM-00004">claim 4</claim-ref>,<claim-text>wherein, in response to at least the designated image processing having been finished, the deauthentication packet is transmitted to the detected other communication apparatus capable of executing the designated image processing.</claim-text></claim-text></claim><claim id="CLM-00010" num="00010"><claim-text><b>10</b>. A control method for a communication apparatus having at least one antenna, the control method comprising:<claim-text>transmitting a deauthentication packet conforming to IEEE 802.11 series of standards to disconnect wireless connection to another communication apparatus without receiving an instruction to disconnect a first wireless connection from a user after image processing designated by the user is finished in a case where the first wireless connection uses the at least one antenna, is with the other communication apparatus and is established by a first operation by the user,</claim-text><claim-text>wherein the deauthentication packet conforming to the IEEE 802.11 series of standards to disconnect the wireless connection is not transmitted to the other communication apparatus until an instruction to disconnect a second wireless connection is issued in a case where the second wireless connection uses the at least one antenna, is with the other communication apparatus and is established by a second operation different from the first operation by the user.</claim-text></claim-text></claim><claim id="CLM-00011" num="00011"><claim-text><b>11</b>. The control method according to <claim-ref idref="CLM-00010">claim 10</claim-ref>,<claim-text>wherein the communication apparatus performs a search to detect another communication apparatus capable of executing the designated image processing, and</claim-text><claim-text>wherein the first wireless connection is established with the detected other communication apparatus capable of executing the designated image processing.</claim-text></claim-text></claim><claim id="CLM-00012" num="00012"><claim-text><b>12</b>. The control method according to <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein, in a case where another communication apparatus capable of executing the designated image processing is not detected by the search, the communication apparatus performs error processing.</claim-text></claim><claim id="CLM-00013" num="00013"><claim-text><b>13</b>. The control method according to <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein the search is performed by using a Service Discovery Query signal.</claim-text></claim><claim id="CLM-00014" num="00014"><claim-text><b>14</b>. The control method according to <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein the communication apparatus executes Group Owner (GO) Negotiation defined by a Wi-Fi Direct specification with the other communication apparatus before the first wireless connection with the other communication apparatus is established.</claim-text></claim><claim id="CLM-00015" num="00015"><claim-text><b>15</b>. The control method according to <claim-ref idref="CLM-00010">claim 10</claim-ref>,<claim-text>wherein the second operation is an operation for performing wireless connection in order to execute image processing in which a transfer direction of data to be used for the image processing is bidirectional, and</claim-text><claim-text>wherein the first operation is an operation for performing wireless connection in order to execute image processing in which the transfer direction of data to be used for the image processing is unidirectional.</claim-text></claim-text></claim><claim id="CLM-00016" num="00016"><claim-text><b>16</b>. The control method according to <claim-ref idref="CLM-00011">claim 11</claim-ref>,<claim-text>wherein, in response to at least the designated image processing having been finished, the deauthentication packet is transmitted to the detected other communication apparatus capable of executing the designated image processing.</claim-text></claim-text></claim><claim id="CLM-00017" num="00017"><claim-text><b>17</b>. A non-transitory computer readable storage medium storing instructions for performing a process at a communication apparatus having at least one antenna, the process comprising:<claim-text>transmitting a deauthentication packet conforming to IEEE 802.11 series of standards to disconnect wireless connection to another communication apparatus without receiving an instruction to disconnect a first wireless connection from a user after image processing designated by the user is finished in a case where the first wireless connection uses the at least one antenna, is with the other communication apparatus and is established by a first operation by the user,</claim-text><claim-text>wherein the deauthentication packet conforming to the IEEE 802.11 series of standards to disconnect the wireless connection is not transmitted to the other communication apparatus until an instruction to disconnect a second wireless connection is issued in a case where the second wireless connection uses the at least one antenna, is with the other communication apparatus and is established by a second operation different from the first operation by the user.</claim-text></claim-text></claim><claim id="CLM-00018" num="00018"><claim-text><b>18</b>. The non-transitory computer readable storage medium according to <claim-ref idref="CLM-00017">claim 17</claim-ref>,<claim-text>wherein the communication apparatus performs a search to detect another communication apparatus capable of executing the designated image processing, and</claim-text><claim-text>wherein the first wireless connection is established with the detected other communication apparatus capable of executing the designated image processing.</claim-text></claim-text></claim><claim id="CLM-00019" num="00019"><claim-text><b>19</b>. The non-transitory computer readable storage medium according to <claim-ref idref="CLM-00018">claim 18</claim-ref>, wherein, in a case where another communication apparatus capable of executing the designated image processing is not detected by the search, the communication apparatus performs error processing.</claim-text></claim><claim id="CLM-00020" num="00020"><claim-text><b>20</b>. The non-transitory computer readable storage medium according to <claim-ref idref="CLM-00018">claim 18</claim-ref>, wherein the search is performed by using a Service Discovery Query signal.</claim-text></claim><claim id="CLM-00021" num="00021"><claim-text><b>21</b>. The non-transitory computer readable storage medium according to <claim-ref idref="CLM-00017">claim 17</claim-ref>, wherein the communication apparatus executes Group Owner (GO) Negotiation defined by a Wi-Fi Direct specification with the other communication apparatus before the first wireless connection with the other communication apparatus is established.</claim-text></claim><claim id="CLM-00022" num="00022"><claim-text><b>22</b>. The non-transitory computer readable storage medium according to <claim-ref idref="CLM-00017">claim 17</claim-ref>,<claim-text>wherein the second operation is an operation for performing wireless connection in order to execute image processing in which a transfer direction of data to be used for the image processing is bidirectional, and</claim-text><claim-text>wherein the first operation is an operation for performing wireless connection in order to execute image processing in which the transfer direction of data to be used for the image processing is unidirectional.</claim-text></claim-text></claim><claim id="CLM-00023" num="00023"><claim-text><b>23</b>. The non-transitory computer readable storage medium according to <claim-ref idref="CLM-00018">claim 18</claim-ref>,<claim-text>wherein, in response to at least the designated image processing having been finished, the deauthentication packet is transmitted to the detected other communication apparatus capable of executing the designated image processing.</claim-text></claim-text></claim><claim id="CLM-00024" num="00024"><claim-text><b>24</b>. A communication system comprising:<claim-text>a first communication apparatus; and</claim-text><claim-text>a second communication apparatus,</claim-text><claim-text>wherein the first communication apparatus comprises:</claim-text><claim-text>at least one antenna;</claim-text><claim-text>at least one memory that stores a set of instructions; and</claim-text><claim-text>at least one processor that executes the instructions, the instructions, when executed, causing the first communication apparatus to perform operations comprising:</claim-text><claim-text>transmitting a deauthentication packet conforming to IEEE 802.11 series of standards to disconnect wireless connection to the second communication apparatus without receiving an instruction to disconnect a first wireless connection from a user after image processing designated by the user is finished in a case where the first wireless connection uses the at least one antenna, is with the second communication apparatus and is established by a first operation by the user,</claim-text><claim-text>wherein the second communication apparatus comprises:</claim-text><claim-text>at least one antenna;</claim-text><claim-text>at least one memory that stores a set of instructions; and</claim-text><claim-text>at least one processor that executes the instructions, the instructions, when executed, causing the second communication apparatus to perform operations comprising:</claim-text><claim-text>disconnecting the first wireless connection in a case where the deauthentication packet is received from the first communication apparatus in a state where the first wireless connection with the first communication apparatus is established,</claim-text><claim-text>wherein the deauthentication packet conforming to the IEEE 802.11 series of standards to disconnect a second wireless connection is not transmitted to another communication apparatus until an instruction to disconnect the second wireless connection is issued in a case where the second wireless connection uses the at least one antenna, is with the other communication apparatus and is established by a second operation different from the first operation by the user, and</claim-text><claim-text>wherein the second wireless connection is disconnected in a case where the second communication apparatus receives the deauthentication packet from the first communication apparatus in a state where the second wireless connection with the first communication apparatus is established.</claim-text></claim-text></claim></claims></us-patent-application>