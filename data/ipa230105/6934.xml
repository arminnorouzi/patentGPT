<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230006935A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230006935</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17902160</doc-number><date>20220902</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>L</subclass><main-group>47</main-group><subgroup>215</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>L</subclass><main-group>47</main-group><subgroup>24</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>L</subclass><main-group>47</main-group><subgroup>62</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>L</subclass><main-group>47</main-group><subgroup>215</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc><further-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>L</subclass><main-group>47</main-group><subgroup>24</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>L</subclass><main-group>47</main-group><subgroup>6215</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></further-cpc></classifications-cpc><invention-title id="d2e43">MINI-TOKEN BUCKET FOR UPLINK TRANSMISSION</invention-title><us-related-documents><continuation><relation><parent-doc><document-id><country>US</country><doc-number>PCT/US2021/012660</doc-number><date>20210108</date></document-id><parent-status>PENDING</parent-status></parent-doc><child-doc><document-id><country>US</country><doc-number>17902160</doc-number></document-id></child-doc></relation></continuation><us-provisional-application><document-id><country>US</country><doc-number>62984180</doc-number><date>20200302</date></document-id></us-provisional-application></us-related-documents><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>ZEKU, INC.</orgname><address><city>Palo Alto</city><state>CA</state><country>US</country></address></addressbook><residence><country>US</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>LOW</last-name><first-name>Su-Lin</first-name><address><city>San Diego</city><state>CA</state><country>US</country></address></addressbook></inventor><inventor sequence="01" designation="us-only"><addressbook><last-name>MA</last-name><first-name>Tianan</first-name><address><city>Palo Alto</city><state>CA</state><country>US</country></address></addressbook></inventor><inventor sequence="02" designation="us-only"><addressbook><last-name>YANG</last-name><first-name>Hong Kui</first-name><address><city>San Diego</city><state>CA</state><country>US</country></address></addressbook></inventor><inventor sequence="03" designation="us-only"><addressbook><last-name>HONG</last-name><first-name>Hausting</first-name><address><city>San Diego</city><state>CA</state><country>US</country></address></addressbook></inventor><inventor sequence="04" designation="us-only"><addressbook><last-name>LEE</last-name><first-name>Chun-I</first-name><address><city>Pleasanton</city><state>CA</state><country>US</country></address></addressbook></inventor></inventors></us-parties></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">Embodiments of apparatuses and methods for uplink data transmission preparation and a baseband chip for packet preparation for uplink transmission are disclosed. In an example, a method for packet preparation for uplink transmission can include determining, by a user equipment, a quality of service identifier associated with a quality of service flow. The method can also include mapping, by the user equipment, the quality of service identifier to a group token level. The method can further include processing, by the user equipment, the quality of service flow in accordance with the group token level.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="114.47mm" wi="158.75mm" file="US20230006935A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="187.71mm" wi="148.51mm" orientation="landscape" file="US20230006935A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="198.12mm" wi="135.72mm" file="US20230006935A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="176.02mm" wi="137.67mm" file="US20230006935A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="172.21mm" wi="148.00mm" orientation="landscape" file="US20230006935A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00005" num="00005"><img id="EMI-D00005" he="219.20mm" wi="138.43mm" file="US20230006935A1-20230105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00006" num="00006"><img id="EMI-D00006" he="112.44mm" wi="83.90mm" file="US20230006935A1-20230105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00007" num="00007"><img id="EMI-D00007" he="217.85mm" wi="115.82mm" orientation="landscape" file="US20230006935A1-20230105-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00008" num="00008"><img id="EMI-D00008" he="151.05mm" wi="148.17mm" orientation="landscape" file="US20230006935A1-20230105-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="lead"?><heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATIONS</heading><p id="p-0002" num="0001">The present application is a continuation of International Application No. PCT/US2021/012660 filed on Jan. 8, 2021, which claims the benefit of priority to U.S. Provisional Application No. 62/984,180 filed on Mar. 2, 2020, both of which are incorporated herein by reference in their entireties.</p><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="tail"?><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0002" level="1">BACKGROUND</heading><p id="p-0003" num="0002">Embodiments of the present disclosure relate to apparatuses and methods that may be used to prepare data for transmission in uplink.</p><p id="p-0004" num="0003">Wireless communication systems are widely deployed to provide various telecommunication services such as telephony, video, data, messaging, and broadcasts. Various wireless communication systems rely on uplink communication of data. For example, in a fifth-generation (5G) communication system, an access node may schedule uplink transmission by one or more user equipment devices. The user equipment devices may be responsible for communicating data in the uplink according to the schedule. When the data is sent by the user equipment the user equipment may have more data to send than can be sent within the schedule. Accordingly, the user equipment may need to send data according to some prioritization.</p><heading id="h-0003" level="1">SUMMARY</heading><p id="p-0005" num="0004">Embodiments of methods and apparatuses that may be used to prepare data to be transmitted in uplink communication are disclosed herein.</p><p id="p-0006" num="0005">In one example, a method for packet preparation for uplink transmission can include determining, by a user equipment, a quality of service identifier associated with a quality of service flow. The method can also include mapping, by the user equipment, the quality of service identifier to a group token level. The method can further include processing, by the user equipment, the quality of service flow in accordance with the group token level.</p><p id="p-0007" num="0006">In another example, an apparatus for packet preparation for uplink transmission can include at least one processor and at least one memory including computer program code. The at least one memory and the computer program code can be configured to, with the at least one processor, cause the apparatus at least to determine a quality of service identifier associated with a quality of service flow. The at least one memory and the computer program code can also be configured to, with the at least one processor, cause the apparatus at least to map the quality of service identifier to a group token level. The at least one memory and the computer program code can further be configured to, with the at least one processor, cause the apparatus at least to process the quality of service flow in accordance with the group token level.</p><p id="p-0008" num="0007">In a further example, a baseband chip for packet preparation for uplink transmission can include a service data adaptation protocol circuit, a packet data convergence protocol circuit, and a medium access control circuit. The service data adaptation protocol circuit can be configured to determine a quality of service identifier associated with a quality of service flow, map the quality of service identifier to a group token level, process the quality of service flow in accordance with the group token level, and provide the quality of service flow to the packet data convergence protocol circuit to passed toward the medium access control circuit for transmission by a physical layer circuit.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p-0009" num="0008">The accompanying drawings, which are incorporated herein and form a part of the specification, illustrate embodiments of the present disclosure and, together with the description, further serve to explain the principles of the present disclosure and to enable a person skilled in the pertinent art to make and use the present disclosure.</p><p id="p-0010" num="0009"><figref idref="DRAWINGS">FIG. <b>1</b></figref> illustrates a modem data processing stack.</p><p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. <b>2</b></figref> illustrates an example method for packet preparation for uplink transmission according to certain embodiments of the present disclosure.</p><p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. <b>3</b></figref> illustrates an overflow of a packet flow according to certain embodiments of the present disclosure.</p><p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. <b>4</b></figref> illustrates an example of group token level usage corresponding to table 1, according to certain embodiments of the present disclosure.</p><p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. <b>5</b></figref> illustrates an example wireless network according to certain embodiments of the present disclosure.</p><p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. <b>6</b></figref> illustrates a block diagram of an example node according to certain embodiments of the present disclosure.</p><p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. <b>7</b></figref> illustrates a block diagram of an apparatus, according to some embodiments of the present disclosure.</p><p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. <b>8</b></figref> illustrates a detailed block diagram of an example baseband chip, according to some embodiments of the present disclosure.</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><p id="p-0018" num="0017">Embodiments of the present disclosure will be described with reference to the accompanying drawings.</p><heading id="h-0005" level="1">DETAILED DESCRIPTION</heading><p id="p-0019" num="0018">Although specific configurations and arrangements are discussed, it should be understood that this is done for illustrative purposes only. A person skilled in the pertinent art will recognize that other configurations and arrangements can be used without departing from the spirit and scope of the present disclosure. It will be apparent to a person skilled in the pertinent art that the present disclosure can also be employed in a variety of other applications.</p><p id="p-0020" num="0019">It is noted that references in the specification to &#x201c;one embodiment,&#x201d; &#x201c;an embodiment,&#x201d; &#x201c;an example embodiment,&#x201d; &#x201c;some embodiments,&#x201d; &#x201c;certain embodiments,&#x201d; etc., indicate that the embodiment described may include a particular feature, structure, or characteristic, but every embodiment may not necessarily include the particular feature, structure, or characteristic. Moreover, such phrases do not necessarily refer to the same embodiment. Further, when a particular feature, structure or characteristic is described in connection with an embodiment, it would be within the knowledge of a person skilled in the pertinent art to effect such feature, structure or characteristic in connection with other embodiments whether or not explicitly described.</p><p id="p-0021" num="0020">In general, terminology may be understood at least in part from usage in context. For example, the term &#x201c;one or more&#x201d; as used herein, depending at least in part upon context, may be used to describe any feature, structure, or characteristic in a singular sense or may be used to describe combinations of features, structures or characteristics in a plural sense. Similarly, terms, such as &#x201c;a,&#x201d; &#x201c;an,&#x201d; or &#x201c;the,&#x201d; again, may be understood to convey a singular usage or to convey a plural usage, depending at least in part upon context. In addition, the term &#x201c;based on&#x201d; may be understood as not necessarily intended to convey an exclusive set of factors and may, instead, allow for existence of additional factors not necessarily expressly described, again, depending at least in part on context.</p><p id="p-0022" num="0021">The techniques described herein may be used for various wireless communication networks such as Long-Term Evolution (LTE) system, code division multiple access (CDMA) system, time division multiple access (TDMA) system, frequency division multiple access (FDMA) system, orthogonal frequency division multiple access (OFDMA) system, single-carrier frequency division multiple access (SC-FDMA) system, and other networks. The terms &#x201c;network&#x201d; and &#x201c;system&#x201d; are often used interchangeably. A CDMA network may implement a radio technology such as Universal Terrestrial Radio Access (UTRA), CDMA 2000, etc. UTRA includes Wideband CDMA (WCDMA) and other variants of CDMA. CDMA 2000 covers IS-2000, IS-95, and IS-856 standards. A TDMA network may implement a radio technology such as Global System for Mobile Communications (GSM). An OFDMA network may implement a radio technology such as new radio (NR) (e.g., 5G RAT), Evolved UTRA (E-UTRA), Ultra Mobile Broadband (UMB), IEEE 802.11 (Wi-Fi), IEEE 802.16 (WiMAX), IEEE 802.20, Flash-OFDMA, etc. UTRA and E-UTRA are part of Universal Mobile Telecommunication System (UMTS). NR is an emerging wireless communications technology under development in conjunction with the 5G Technology Forum (5GTF). 3GPP Long Term Evolution (LTE) and LTE-Advanced (LTE-A) are releases of UMTS that use E-UTRA. UTRA, E-UTRA, UMTS, LTE, LTE-A, and GSM are described in documents from an organization named &#x201c;3rd Generation Partnership Project&#x201d; (3GPP). CDMA2000 and UMB are described in documents from an organization named &#x201c;3rd Generation Partnership Project 2&#x201d; (3GPP2). The techniques described herein may be used for the wireless networks and radio technologies mentioned above as well as other wireless networks and radio technologies.</p><p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. <b>1</b></figref> illustrates a modem data processing stack. As shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref>, in a 5G cellular wireless modem, the packet data protocol stack includes the Internet protocol (IP) layer (also known as Layer 3 (L3)), the packet data convergence protocol (PDCP) layer, the radio link control (RLC) layer, and the media access control (MAC) layer. Each layer is responsible for processing the user plane packet data in the form of IP data or raw user data and ensuring that data transmission is secure, on-time, and error-free. A user equipment (UE) can be configured to transmit uplink data packets through resource allocations scheduled by the network, for example, by the base station or the like.</p><p id="p-0024" num="0023">In the uplink (UL) direction, incoming packet data from an external application processor (AP) or a host (e.g., through universal serial bus (USB) or peripheral component interconnected express (PCIe)) in the form of IP packets from a protocol data unit (PDU) session arrives at the Layer 3 protocol stack. These IP packets are classified into L3 quality of service (QoS) flows and mapped to each data radio bearer (DRB), shown as DRB1, DRB2, and DRB3. Thus, incoming IP packets from AP/hosts may first be sorted into L3 QoS flows with a QoS flow indicator (QFI), and can be mapped to specific data radio bearers according to the grouping of similar traffic requirements by the network.</p><p id="p-0025" num="0024">Packets in each DRB will be dequeued and processed by the packet data convergence protocol (PDCP) layer. PDCP layer processing includes robust header compression (ROHC) and security functions, such as integrity checking and ciphering. Once the PDCP layer processing is done, the packets are queued into their corresponding Layer 2 (L2) logical channels (LCs), identified as LC0, LC1, LC2, LC3, LC4, LC5, and LC6. In the meantime, modem signaling messages also arrive at their Layer 2 logical channels for signaling messages.</p><p id="p-0026" num="0025">At the physical (PHY) layer, at every slot, the physical downlink control channel (PDCCH), which contains the downlink control indicator (DCI) information, is decoded. The DCI contains the dynamic grant allocation for dynamic uplink transmission, for a slot transmission at an indicated time.</p><p id="p-0027" num="0026">At the MAC layer, once the dynamic grant allocation size is calculated, the modem can dequeue and gather L2 packets from the logical channels through a logical channel prioritization (LCP) algorithm as specified in the 3GPP standard. Typically, the grant bytes are distributed evenly between all the L3 QoS flows without any priority considerations. Bytes are dequeued on first-come-first-served schemes, as and when grant bytes for the logical channel are available. The MAC layer can then compose the MAC protocol data unit (PDU) in a transport block for the PHY layer to be sent out. There is one such transport block for each component carrier. Hence packet data is being transmitted out from the packet data stack to the base station (BS) according to the logical channel prioritization in the base station-allocated uplink grant size for each slot.</p><p id="p-0028" num="0027">Thus, at every slot, the network can allocate a grant size for the user equipment for uplink transmission. The UL MAC at the UE can then perform LCP to schedule the allocated grant for each logical channel. Based on these grant bytes for each LC, the maximum number of data packets within the grant allocation can be dequeued for MAC, where these data packets can be combined together into a MAC PDU for UL data transmission.</p><p id="p-0029" num="0028">MAC sub-PDU (MacSubPDU) packets can be prepared in L2 logical channel queues after L3 data arrives at the modem. Once a dynamic grant is allocated by a base station and received by the MAC layer, the MAC layer can perform logical channel prioritization to create a MAC PDU with the exact grant size. The packets in the logical channels are extracted with priority accordingly from the logical channel prioritization. After that, the MAC PDU is transferred to the physical layer for transmission.</p><p id="p-0030" num="0029">In another approach, logical channel L2 data within each individual logical channel queue are combined a few packets at a time to a continuous block. However, they are not prepared in a MAC PDU format because the exact grant allocation size is still not known yet. Once a dynamic grant is allocated by the base station and received by the MAC layer, the MAC layer performs the logical channel prioritization to create the MAC PDU with the exact grant size. The packets in the logical channels are extracted with priority accordingly from the logical channel prioritization. After that, the MAC PDU is transferred to the physical layer for transmission. The assembly of a first transport block corresponding to a component carrier (CC) is shown for CC1, but a similar assembly may occur for each of CC2 and CC3 and so on, as well. Each component carrier can include one transport block.</p><p id="p-0031" num="0030">Typically, the physical layer may save a copy of the entire transport block for re-transmission purposes at the PHY layer.</p><p id="p-0032" num="0031">One challenge in UL MAC transmission is in the servicing of the grant bytes for each logical channel that has MAC PDU content for transmission. Given a calculated allocated grant size for the logical channel, the UL MAC may need to dequeue packets from the L2 logical channel queue, which may be fed by multiple L3 QoS flows. The draining of data packets from these L3 QoS flows into the L2 LC may present a challenge with its various QoS flow parameters, and are not defined by existing standards.</p><p id="p-0033" num="0032">As a result, there may be an absence of differentiated services for all the QoS flows in each logical channel. Moreover, there may be an inefficient resource allocation with only one level of priority, regardless of application QoS requirements. Furthermore, there may be an inflexible resource allocation for only one type of traffic and delay requirements.</p><p id="p-0034" num="0033">Certain embodiments of the present disclosure provide a 5G UL scheduling method for prioritizing the packet data dequeuing from layer 3 QoS flows to layer 2 logical channels for UL MAC PDU data transmission. Certain embodiments take into consideration key critical QoS parameters, and can provide a simple, fast, and efficient mechanism to allocate grant bytes to each flow to be used without wastage, thus achieving differentiated service treatment for each QoS flow.</p><p id="p-0035" num="0034">Certain embodiments of the present disclosure may employ any of the following three aspects alone or in combination with one another: a priority scheme for dequeuing L3 packets in each UL QoS flow sharing the same DRB, flexible mapping of each QoS flow priority to a group token level for resource allocation, or scheduling of packet transmission for each QoS flow from its group token level access.</p><p id="p-0036" num="0035">For example, in certain embodiments, the scheduling of L3 data packets from several UL QoS flows, which share the same data radio bearer, to L2 MAC for UL transmission, can be differentiated for each flow with optimized performance. With a given LC token bucket bytes resource from L2 MAC LCP for each LC, the resource can be distributed optimally to each of the UL QoS flows constituting this DRB channel.</p><p id="p-0037" num="0036">For another example, certain embodiments take into account the QoS flow's 5G QoS characteristic(s) including priority level, resource traffic type, and packet delay budget or latency requirement, and can map them to a &#x201c;group token level&#x201d; with defined resource allocation bytes. The mapping can be defined whenever a QoS flow is set up and can be tuned flexibly at static setup or dynamic runtime to suit application performance needs.</p><p id="p-0038" num="0037">For a further example, in certain embodiments, with a given total LC token bucket bytes resource from L2 LCP for each LC, the resource bytes can be distributed to each QoS flow according to its group token access level. The packets can be pulled into the L2 MAC PDU for transmission at the next transmission slot/symbol.</p><p id="p-0039" num="0038"><figref idref="DRAWINGS">FIG. <b>2</b></figref> illustrates an example method <b>200</b> for packet preparation for uplink transmission according to certain embodiments of the present disclosure. As shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, method <b>200</b> can include, at <b>210</b>, upon radio resource control setup, for each LC, mapping each QoS flow to a group token level.</p><p id="p-0040" num="0039">At setup, for each LC, the mapping of each QoS flow to a group token level can be performed in a variety of ways, with the following explanation providing an example.</p><p id="p-0041" num="0040">At QOS Flow setup with a QFI, with an associated 5G QoS Identifier (5QI), the system can construct the mapping of each flow's 5QI attributes, for example, priority level, traffic resource type, and/or packet delay budget, to a group token level. This mapping can be flexibly tuned for each DRB with the weights of K1, K2, K3 values, and can have a separate set for each LC or even for each QoS flow, depending on the application requirements.</p><p id="p-0042" num="0041">Thus, group token level (L)=(K1)*(P)+(K2)*(R)+(K3)*(D), where L is the group token level for a QoS FlowId queue, P is a mapped priority level for QoS Flow (range from 1-100), R is a mapped resource type (non-GBR, GBR, or Delay-Critical GBR), and D is a mapped Packet Delay Budget (range from 5 ms to 500 ms). The discrete Group_Token_Levels can be any implementation of specific levels.</p><p id="p-0043" num="0042">Table 1 illustrates an example of possible mapping:</p><p id="p-0044" num="0000"><tables id="TABLE-US-00001" num="00001"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="4"><colspec colname="1" colwidth="42pt" align="center"/><colspec colname="2" colwidth="63pt" align="left"/><colspec colname="3" colwidth="56pt" align="center"/><colspec colname="4" colwidth="56pt" align="center"/><thead><row><entry namest="1" nameend="4" rowsep="1">TABLE 1</entry></row><row><entry namest="1" nameend="4" align="center" rowsep="1"/></row><row><entry>Priority</entry><entry>Resource</entry><entry>Packet Delay</entry><entry>Mapped Group</entry></row><row><entry>Level (P)</entry><entry>Type (R)</entry><entry>Budget (D)</entry><entry>Token Level (L)</entry></row><row><entry namest="1" nameend="4" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>&#x2002;1-10</entry><entry>Delay Critical GBR</entry><entry>&#x2002;5 ms-20 ms</entry><entry>8</entry></row><row><entry>11-20</entry><entry/><entry>21 ms-40 ms</entry><entry>7</entry></row><row><entry>21-30</entry><entry>GBR</entry><entry>41 ms-70 ms</entry><entry>6</entry></row><row><entry>31-50</entry><entry/><entry>&#x2002;71 ms-100 ms</entry><entry>5</entry></row><row><entry>41-50</entry><entry/><entry>101 ms-200 ms</entry><entry>4</entry></row><row><entry>51-70</entry><entry>non-GBR</entry><entry>201 ms-300 ms</entry><entry>3</entry></row><row><entry>71-90</entry><entry/><entry>301 ms-400 ms</entry><entry>2</entry></row><row><entry>&#x2002;91-100</entry><entry/><entry>401 ms-500 ms</entry><entry>1</entry></row><row><entry namest="1" nameend="4" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0045" num="0043"><figref idref="DRAWINGS">FIG. <b>2</b></figref> shows an example of how this mapping can be statically determined at setup time to configure a group token level. This can be adjusted for each flow or DRB as suitable.</p><p id="p-0046" num="0044"><figref idref="DRAWINGS">FIG. <b>4</b></figref> illustrates an example of group token level usage corresponding to Table 1, according to certain embodiments of the present disclosure. In the example, QoS flows are mapped into 8 group token levels, where Level 8 is the highest priority, and Level 1 is the lowest priority. Priority level can map the range of 1-100 into these 8 levels as shown in Table 1, or in any other desired way. Similarly, resource type can be mapped, such that delay-critical guaranteed bit rate (GBR) is mapped to Level 8, GBR to level 6, and non-GBR to level 3, although any other desired mapping can be used. Likewise, packet delay budget can be mapped across the eight levels such that 5-20 ms maps to Level 8, 401-500 ms maps to Level 1, and other intervals map to levels 2-7 (see Table 1 for more details of this example), although any other desired mapping can be used.</p><p id="p-0047" num="0045">With the weight factors K1, K2, and K3, a normalized group token level (L) can be obtained. L can reflect the desired priority token level of a flow corresponding to a given QoS flow identifier.</p><p id="p-0048" num="0046">Certain embodiments can allocate an infinite priority queue with the highest priority and no bucket size limit for absolutely highest priority applications, such as transmission control protocol (TCP) acknowledgment (ack) for a logical channel TCP/IP transfer.</p><p id="p-0049" num="0047">In the example of <figref idref="DRAWINGS">FIG. <b>4</b></figref>, QFI A has been determined to have a group token level of 8, QFI B has also been determined to have a group token level of 8, QFI C has been determined to have a group token level of 4, QFI D has been determined to have a group token level of 2, and QFI E has been determined to have a group token level of 1.</p><p id="p-0050" num="0048">As shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, at <b>215</b>, the system implementing the method (for example, a user equipment or modem or other component or subcomponent thereof) may, for each LC, sort the QoS flows in order of priority access using group token levels. Thus, once the mapping is done, the QoS flow L3 queue can be sorted in order of priority access, where the highest group token level is put at the head of the queue. In the example of <figref idref="DRAWINGS">FIG. <b>4</b></figref>, the flow with QFI A has the highest level, as does the flow with QFI B. In cases of a tie, the system may randomly select between flows with tied levels.</p><p id="p-0051" num="0049">As shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, at <b>220</b>, for every slot, the system may run LCP with the NW grant to obtain an LC token bucket size grant for each LC. Once the UE is in connected mode, at every slot, the network can allocate a grant size number of bytes for each component carrier, each MAC instance, corresponding to a transport block. This grant can then be distributed to the UE's logical channels per an LCP algorithm according to the 3GPP MAC standard, where each logical channel, j, is given a grant allocation up to a bucket level, Bj. With this grant allocation, each logical channel can dequeue packet data to the MAC, and the MAC can compose the MAC PDU and schedule the data transmission per slot.</p><p id="p-0052" num="0050">In a mini-token bucket scheme, the total LC token bucket bytes resource from L2 LCP for each LC, can be further distributed to each QoS flow according to its group token level access in order to dequeue packets according to QoS priority levels.</p><p id="p-0053" num="0051">For example, as shown in <figref idref="DRAWINGS">FIG. <b>2</b></figref> at <b>225</b>, for each LC, the system may run a mini-token bucket scheme to distribute LC token bytes to each flow. The mini-token bucket scheme may include the following: at <b>230</b>, calculating bytes per group token level for a given LC; at <b>235</b>, calculating for each flow a number of mini-token bucket bytes; at <b>240</b>, dequeueing data up to the number calculated at <b>235</b> plus any donated tokens; at <b>245</b>, determining whether any tokens are left; at <b>250</b>, donating any leftover tokens to a next flow; and at <b>255</b>, determining whether all flows have been served for a given LC.</p><p id="p-0054" num="0052">If it was determined at <b>245</b> that no tokens were left, the donating at <b>250</b> may be omitted. If at <b>255</b>, it is determined that not all flows have been served, the system can, at <b>235</b>, calculate the mini-token bucket bytes for the next flow. Alternatively, the mini-token bucket bytes for all the flows of a given LC may be calculated initially and then may be adjusted based on any donated tokens.</p><p id="p-0055" num="0053">When it is determined that, for a given LC, all flows have been served, the system can, at <b>260</b>, determine whether all LCs have been served. If not, the system can repeat the mini-token bucket scheme beginning at <b>225</b> for the next LC. Otherwise, at <b>265</b>, the system can compose a MAC PDU with the dequeued data and provide the MAC PDU to the physical (PHY) layer for transmission. At <b>270</b>, the system can then wait for the next slot, which can then trigger the process to continue from <b>220</b>.</p><p id="p-0056" num="0054">The calculation at <b>230</b> can be performed in variety of ways. For example, BB j can be the total LC token bucket bytes resources from the L2 LCP calculations for a given LC j. In this case, BBj=MM [Bj, GrantLeft], where Bj is a bucket level from L2 MAC for this LC j at current transmission slot/occasion according to a LCP algorithm (see, for example, 3GPP2 TS 38.321) and GrantLeft is a MAC grant size remaining for this LC j, after serving any higher priority LCs, and where MAC grant size is the resource allocation given by the NW for UE for this MAC instance. B_n, namely bytes per group token level at slot n can be calculated as: B_n=BBj/(&#x3a3;(Group_Token_Levels) for all flows). This sum can be the summation of all the token levels for each flow, and B_n can be the basic token bytes per level unit for this DRB/LC j at current slot n.</p><p id="p-0057" num="0055">Likewise, the calculation at <b>235</b> can be performed in a variety of ways. For example, for each flow i in this DRB/LC j, MB_i, namely the flow mini-token bucket bytes, can be derived. This can be the token resource allocation bytes for this flow i. For example, MB_i=(L_i). (B_n), where MB_i is the flow mini-token bucket bytes for this flow i, at slot n, L_i is the group token level for this flow I, and B_n is the bytes per group token level, at slot n.</p><p id="p-0058" num="0056"><figref idref="DRAWINGS">FIG. <b>4</b></figref> illustrates an example of the dequeueing at <b>240</b>. For each flow i, data packets can be dequeued till the token bytes for this flow (MB_i) are used up. If the flow mini-token bucket bytes from one priority flow are unused after all data from this flow queue i are dequeued, the unused bytes can be rolled over to the next priority flow in line. This can be seen in <figref idref="DRAWINGS">FIG. <b>4</b></figref>, where there are unused flow mini-token bucket bytes in QFI A, which are then rolled into QFI B, and then a smaller amount of unused flow mini-token bucket bytes in QFI B are rolled into QFI C.</p><p id="p-0059" num="0057">All the flow token bucket bytes can be reset for each transmission slot. This may ensure that the high priority flows have constant, guaranteed data rate transfer. Only when data from the flows of the highest priority are exhausted, the token bytes from that flow can be donated to the next lower priority flows.</p><p id="p-0060" num="0058">As mentioned above and illustrated in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, the process can be performed until all the QoS flows in a given LC j are served, where either all the BBj (total LC token bucket bytes for this LCj) are used up, or the data bytes from all QoS flows are dequeued completely.</p><p id="p-0061" num="0059">Once all the QoS flows in an LC are served, the remaining grant can be given to the next LC to be served until all LCs are served. The MAC PDU can then be composed with the packets dequeued from L3 QoS flows and sent to PHY layer for transmission.</p><p id="p-0062" num="0060">Hence, by using certain embodiments of the present disclosure, data from multiple L3 QoS flows in the same DRB/LC can be dequeued with fast optimal priority performance, using minimal complexity.</p><p id="p-0063" num="0061"><figref idref="DRAWINGS">FIG. <b>3</b></figref> illustrates an overflow of a packet flow according to certain embodiments of the present disclosure. As shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>, from top to bottom data may be taken from IP flows, placed into L3 QoS flow queues, and then placed into L2 logical channel queues. The L2 logical channels can be prioritized according to logical channel prioritization, and the data can be formed into a MAC PDU corresponding to a transport block grant.</p><p id="p-0064" num="0062">More particularly, as shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>, QoS rules can be used to map IP flows to QoS flows. This can result in a number of different quality of service (QoS) flows having their own QFI, for each data radio bearer. The use of a mini-token bucket scheme, such as described above with reference to <figref idref="DRAWINGS">FIG. <b>2</b></figref>, can be used to schedule L3 QoS flow packets to each LC grant allocation.</p><p id="p-0065" num="0063">Next, PDCP processing, as described above with reference to <figref idref="DRAWINGS">FIG. <b>1</b></figref>, can be performed, leading to L2 logical channel queues. Logical channel prioritization can be performed on these L2 logical channel queues, yielding MAC sub-PDUs that can be assembled, together with MAC control elements (CEs) and so on, to form a MAC PDU in each MAC instance.</p><p id="p-0066" num="0064">Certain embodiments of the present disclosure may have various benefits and/or advantages. For example, certain embodiments may provide a straightforward, practical scheme with minimal software complexity. Moreover, certain embodiments may provide enhanced performance with prioritized packet delivery for delay-sensitive applications. Furthermore, certain embodiments may provide differentiated services for applications with different QoS flow requirements. Additionally, certain embodiments may eliminate the starving of low priority application data sending. Also, certain embodiments may provide efficient service distribution to all application service flows with maximal grant usage and minimal wastage.</p><p id="p-0067" num="0065"><figref idref="DRAWINGS">FIG. <b>5</b></figref> illustrates an example wireless network <b>500</b>, such as an NR or 5G network, in which aspects of the present disclosure may be performed, for example, for enabling uplink data preparation, as described in greater detail below. As shown in <figref idref="DRAWINGS">FIG. <b>5</b></figref>, wireless network <b>500</b> may include a network of nodes, such as a user equipment <b>510</b>, an access node <b>520</b>, and a core network element <b>530</b>. User equipment <b>510</b> may be any terminal device, such as a smart phone, personal computer, laptop computer, tablet computer, vehicle computer, wearable electronic device, smart sensor, or any other device capable of receiving, processing, and transmitting information, such as any member of a vehicle to everything (V2X) network, a cluster network, a smart grid node, or an Internet-of-Things (IoT) node. Other devices are also permitted. User equipment <b>510</b> is illustrated as a smart phone simply by way of illustration and not by way of limitation.</p><p id="p-0068" num="0066">An access node <b>520</b> may be a device that communicates with the user equipment <b>510</b>, such as wireless access point, a base station, an enhanced Node B (eNB), a cluster master node, or the like. Access node <b>520</b> may have a wired connection to user equipment <b>510</b>, a wireless connection to user equipment <b>510</b>, or any combination thereof. Access node <b>520</b> may be connected to user equipment <b>510</b> by multiple connections, and user equipment <b>510</b> may be connected to other access nodes in addition to access node <b>520</b>. Access node <b>520</b> may also be connected to other user equipment. Access node <b>520</b> is illustrated by a radio tower by way of illustration and not by way of limitation.</p><p id="p-0069" num="0067">A core network element <b>530</b> may serve access node <b>520</b> and user equipment <b>510</b> to provide core network services. Examples of a core network element <b>530</b> include a home subscriber server (HSS), a mobility management entity (MME), a serving gateway (GW), a packet data network (PDN) GW. These are examples of core network elements of an evolved packet core (EPC) system, which is a core network for the LTE system. Other core network elements may be used in LTE and in other communication systems. Core network element <b>530</b> is shown as a set of rack-mounted servers by way of illustration and not by way of limitation.</p><p id="p-0070" num="0068">Core network element <b>530</b> may connect with a large network, such as the Internet <b>540</b>, or another IP network, to communicate packet data over any distance. In this way, data from user equipment <b>510</b> may be communicated to other user equipment connected to other access points, including, for example, a personal computer <b>550</b> connected to Internet <b>540</b>, for example, using a wired connection, or a tablet <b>570</b> connected to Internet <b>540</b> via a router <b>560</b>. Thus, personal computer <b>550</b> and tablet <b>570</b> provide additional examples of possible user equipment devices, and router <b>560</b> provides an example of another access point device.</p><p id="p-0071" num="0069">A generic example of a rack-mounted server is provided as an illustration of core network element <b>530</b>. However, there may be multiple elements in the core network including database servers, such as database <b>580</b>, and security and authentication servers, such as authentication server <b>590</b>. Database <b>580</b> may, for example, manage data related to user subscription to network services. A home location register (HLR) is an example of standardized database of subscriber information for a mobile network. Likewise, authentication server <b>590</b> may handle authentication of users, sessions, and so on. In 5G, an authentication server function (AUSF) may be the specific entity to perform user equipment authentication. In certain embodiments, a single server rack may handle multiple such functions, such that the connections between core network element <b>530</b>, authentication server <b>590</b>, and database <b>580</b> may be local connections within a single rack.</p><p id="p-0072" num="0070">Certain embodiments of the present disclosure may be implemented in a modem of a user equipment, such as user equipment <b>510</b>, tablet <b>570</b>, or personal computer <b>550</b>. For example, a modem or other transceiver of user equipment <b>510</b> may prepare packets for transmission and re-transmission to a communication from access node <b>520</b>. As described above in detail, user equipment <b>510</b> may prepare packets and store them suitably at the MAC layer.</p><p id="p-0073" num="0071">Each of the elements of <figref idref="DRAWINGS">FIG. <b>5</b></figref> may be considered a node of a communication network. More detail regarding the possible implementation of communication nodes is provided by way of example in the description of <figref idref="DRAWINGS">FIG. <b>6</b></figref> and node <b>600</b> below. For example, user equipment <b>510</b> in <figref idref="DRAWINGS">FIG. <b>5</b></figref> may be implemented as node <b>600</b> shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>.</p><p id="p-0074" num="0072"><figref idref="DRAWINGS">FIG. <b>6</b></figref> illustrates a device according to certain embodiments of the present disclosure. As shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>, a node <b>600</b> can include various components. Node <b>600</b> can correspond to user equipment <b>510</b>, access node <b>520</b>, or core network element <b>530</b> in <figref idref="DRAWINGS">FIG. <b>5</b></figref>. In some embodiments, node <b>600</b> corresponds to the modem in user equipment <b>510</b>, access node <b>520</b>, or core network element <b>530</b> in <figref idref="DRAWINGS">FIG. <b>5</b></figref>.</p><p id="p-0075" num="0073">As shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>, node <b>600</b> can include a processor <b>610</b>, a memory <b>620</b>, and a transceiver <b>630</b>. These components are shown as connected to one another by a bus, but other connection types are also permitted. Transceiver <b>630</b> may include any suitable device for sending and/or receiving data. Node <b>600</b> may include one or many transceivers, although only one transceiver <b>630</b> is shown for simplicity of illustration. An antenna <b>640</b> is shown as a possible communication mechanism for node <b>600</b>. Multiple antennas and/or arrays of antennas may be utilized. Additionally, examples of node <b>600</b> may communicate using wired techniques rather than (or in addition to) wireless techniques. For example, access node <b>520</b> may communicate wirelessly to user equipment <b>510</b> and may communicate by a wired connection (for example, by optical or coaxial cable) to core network element <b>530</b>. Other communication hardware, such as a network interface card (NIC), can be included.</p><p id="p-0076" num="0074">When node <b>600</b> is a user equipment, additional components may also be included, such as a user interface (UI), sensors, and the like. Similarly, node <b>600</b> may be implemented as a blade in a server system when node <b>600</b> is configured as a core network element <b>530</b>. Other implementations are also possible.</p><p id="p-0077" num="0075">As shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>, node <b>600</b> may include processor <b>610</b>. Although only one processor is shown, it is understood that multiple processors can be included. Processor <b>610</b> may be any suitable computational device, such as a central processing unit (CPU), a microcontroller unit (MCU), application-specific integrated circuit (ASIC), field-programmable gate array (FPGA), or the like. Processor <b>610</b> may be a hardware device having one or many processing cores. In some embodiments in which node <b>600</b> corresponds to a modem, processor <b>610</b> may be a baseband processor.</p><p id="p-0078" num="0076">As shown in <figref idref="DRAWINGS">FIG. <b>6</b></figref>, node <b>600</b> may also include memory <b>620</b>. Although only memory is shown, it is understood that multiple memories can be included. Memory <b>620</b> can broadly include both memory and storage. For example, memory <b>620</b> can include random access memory (RAM) included on the same chip with processor <b>610</b>. Memory <b>620</b> can also include storage, such as a hard disk drive (HDD), solid-state drive (SSD), or the like. Other memory types and storage types are also permitted.</p><p id="p-0079" num="0077">Similarly, node <b>600</b> can also be configured as personal computer <b>550</b>, router <b>560</b>, tablet <b>570</b>, database <b>580</b>, or authentication server <b>590</b> in <figref idref="DRAWINGS">FIG. <b>5</b></figref>. Node <b>600</b> can be configured to perform any of the above-described methods using hardware alone or hardware operating together with software.</p><p id="p-0080" num="0078">Another aspect of the disclosure is directed to a non-transitory computer-readable medium encoded with instructions that, when executed by at least one processor (e.g., processor <b>610</b> in <figref idref="DRAWINGS">FIG. <b>6</b></figref>), perform any processes disclosed herein. The computer-readable medium may include volatile or non-volatile, magnetic, semiconductor, tape, optical, removable, non-removable, or other types of computer-readable medium or computer-readable storage devices. For example, the computer-readable medium may be the storage device or the memory module having the computer instructions stored thereon, as disclosed. In some embodiments, the computer-readable medium may be a disc, a flash drive, or a solid-state drive having the computer instructions stored thereon.</p><p id="p-0081" num="0079"><figref idref="DRAWINGS">FIG. <b>7</b></figref> illustrates a block diagram of an apparatus <b>700</b> including a baseband chip <b>702</b>, a radio frequency chip <b>704</b>, and a host chip <b>706</b>, according to some embodiments of the present disclosure. Apparatus <b>700</b> may be an example of any suitable node of wireless network <b>500</b> in <figref idref="DRAWINGS">FIG. <b>5</b></figref>, such as user equipment <b>510</b> or access node <b>520</b>. As shown in <figref idref="DRAWINGS">FIG. <b>7</b></figref>, apparatus <b>700</b> may include baseband chip <b>702</b>, radio frequency chip <b>704</b>, host chip <b>706</b>, and one or more antennas <b>710</b>. In some embodiments, baseband chip <b>702</b> is implemented by processor <b>610</b> and memory <b>620</b>, and radio frequency chip <b>704</b> is implemented by processor <b>610</b>, memory <b>620</b>, and transceiver <b>630</b>, as described above with respect to <figref idref="DRAWINGS">FIG. <b>6</b></figref>. Besides the on-chip memory (also known as &#x201c;internal memory&#x201d; or &#x201c;local memory,&#x201d; e.g., registers, buffers, or caches) on each chip <b>702</b>, <b>704</b>, or <b>706</b>, apparatus <b>700</b> may further include an external memory <b>708</b> (e.g., the system memory or main memory) that can be shared by each chip <b>702</b>, <b>704</b>, or <b>706</b> through the system/main bus. Although baseband chip <b>702</b> is illustrated as a standalone SoC in <figref idref="DRAWINGS">FIG. <b>7</b></figref>, it is understood that in one example, baseband chip <b>702</b> and radio frequency chip <b>704</b> may be integrated as one SoC; in another example, baseband chip <b>702</b> and host chip <b>706</b> may be integrated as one SoC; in still another example, baseband chip <b>702</b>, radio frequency chip <b>704</b>, and host chip <b>706</b> may be integrated as one SoC, as described above.</p><p id="p-0082" num="0080">In the uplink, host chip <b>706</b> may generate raw data and send it to baseband chip <b>702</b> for encoding, modulation, and mapping. Baseband chip <b>702</b> may also access the raw data generated by host chip <b>706</b> and stored in external memory <b>708</b>, for example, using the direct memory access (DMA). Baseband chip <b>702</b> may first encode (e.g., by source coding and/or channel coding) the raw data and modulate the coded data using any suitable modulation techniques, such as multi-phase pre-shared key (MPSK) modulation or quadrature amplitude modulation (QAM). Baseband chip <b>702</b> may perform any other functions, such as symbol or layer mapping, to convert the raw data into a signal that can be used to modulate the carrier frequency for transmission. In the uplink, baseband chip <b>702</b> may send the modulated signal to radio frequency chip <b>704</b>. Radio frequency chip <b>704</b>, through the transmitter (Tx), may convert the modulated signal in the digital form into analog signals, i.e., radio frequency signals, and perform any suitable front-end radio frequency functions, such as filtering, up-conversion, or sample-rate conversion. Antenna <b>710</b> (e.g., an antenna array) may transmit the radio frequency signals provided by the transmitter of radio frequency chip <b>704</b>.</p><p id="p-0083" num="0081">In the downlink, antenna <b>710</b> may receive radio frequency signals and pass the radio frequency signals to the receiver (Rx) of radio frequency chip <b>704</b>. Radio frequency chip <b>704</b> may perform any suitable front-end radio frequency functions, such as filtering, down-conversion, or sample-rate conversion, and convert the radio frequency signals into low-frequency digital signals (baseband signals) that can be processed by baseband chip <b>702</b>. In the downlink, baseband chip <b>702</b> may demodulate and decode the baseband signals to extract raw data that can be processed by host chip <b>706</b>. Baseband chip <b>702</b> may perform additional functions, such as error checking, de-mapping, channel estimation, descrambling, etc. The raw data provided by baseband chip <b>702</b> may be sent to host chip <b>706</b> directly or stored in external memory <b>708</b>.</p><p id="p-0084" num="0082">Baseband chip <b>702</b> in <figref idref="DRAWINGS">FIG. <b>7</b></figref> may correspond to baseband chip <b>802</b> in <figref idref="DRAWINGS">FIG. <b>8</b></figref>. Baseband chip <b>702</b> may implement the protocol stack shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref>, including MAC layer, RLC layer, and PDCP layer. Similarly, host chip <b>706</b> in <figref idref="DRAWINGS">FIG. <b>7</b></figref> may correspond to host chip <b>804</b> in <figref idref="DRAWINGS">FIG. <b>8</b></figref>. Likewise, external memory <b>708</b> in <figref idref="DRAWINGS">FIG. <b>7</b></figref> may correspond to external memory <b>806</b> in <figref idref="DRAWINGS">FIG. <b>8</b></figref>.</p><p id="p-0085" num="0083"><figref idref="DRAWINGS">FIG. <b>8</b></figref> illustrates a detailed block diagram of an example baseband chip <b>802</b> implementing Layer 2 uplink data processing using Layer 2 circuits <b>808</b> and an MCU <b>810</b>, according to some embodiments of the present disclosure. In some embodiments, Layer 2 circuits <b>808</b> include a service data adaptation protocol (SDAP) circuit <b>820</b>, a PDCP circuit <b>822</b>, an RLC circuit <b>824</b>, and a MAC circuit <b>826</b>. As explained above, PDCP circuit <b>822</b> may correspond to PDCP layer in <figref idref="DRAWINGS">FIG. <b>1</b></figref>, and RLC circuit <b>824</b> and MAC circuit <b>826</b> may similarly correspond to RLC layer and MAC layer in <figref idref="DRAWINGS">FIG. <b>1</b></figref>, respectively. In some embodiments, each of SDAP, PDCP, RLC, and MAC circuits <b>820</b>, <b>822</b>, <b>824</b>, or <b>826</b> is an integrated circuit (IC) dedicated to performing the functions of the respective layer in Layer 2 user plane. For example, each of SDAP, PDCP, RLC, and MAC circuits <b>820</b>, <b>822</b>, <b>824</b>, or <b>826</b> may be an application-specific integrated circuit (ASIC), which is customized for a particular use, rather than intended for general-purpose use, and thus, is known for its high speed, small die size, and low power consumption compared with a generic processor. As another alternative, a general purpose processor, such as microcontroller unit (MCU) <b>810</b>, can implement the PDCP layer, RLC layer, and MAC layer, as shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref>.</p><p id="p-0086" num="0084">Apparatus <b>800</b> may be any suitable node of wireless network <b>500</b> in <figref idref="DRAWINGS">FIG. <b>5</b></figref>, such as user equipment <b>510</b> or access node <b>520</b> (e.g., a base station including eNB in LTE or gNB in NR). As shown in <figref idref="DRAWINGS">FIG. <b>8</b></figref>, apparatus <b>800</b> may include baseband chip <b>802</b>, a host chip <b>804</b>, an external memory <b>806</b>, and a main bus <b>838</b> (also known as a &#x201c;system bus&#x201d;) operatively coupling baseband chip <b>802</b>, host chip <b>804</b>, and external memory <b>806</b>. That is, baseband chip <b>802</b>, host chip <b>804</b>, and external memory <b>806</b> may exchange data through main bus <b>838</b>. The baseband chip <b>802</b> may implement the methods shown in <figref idref="DRAWINGS">FIGS. <b>2</b>, <b>3</b>, and <b>4</b></figref> and the architecture shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref>. For example, SDAP circuit <b>820</b> may be configured, alone or together with MCU <b>810</b>, to perform the mini-token bucket scheme, prior to passing the data on to PDCP circuit <b>822</b>. Other implementations are also permitted. SDAP circuit <b>820</b> may also be able to access and utilize external memory <b>806</b> and local memory <b>814</b> using, for example, main bus <b>838</b>.</p><p id="p-0087" num="0085">As shown in <figref idref="DRAWINGS">FIG. <b>8</b></figref>, baseband chip <b>802</b> may also include a plurality of direct memory access (DMA) channels including a first DMA channel (DMA CH1) <b>816</b> and a second DMA channel (DMA CH2) <b>818</b>. Each DMA channel <b>816</b> or <b>818</b> can allow certain Layer 2 circuits <b>808</b> to access external memory <b>806</b> directly independent of host chip <b>804</b>. In some embodiments, DMA channels <b>816</b> and <b>818</b> may include a DMA controller and any other suitable input/output (I/O) circuits. As shown in <figref idref="DRAWINGS">FIG. <b>8</b></figref>, baseband chip <b>802</b> may further include a local memory <b>814</b>, such as an on-chip memory on baseband chip <b>802</b>, which is distinguished from external memory <b>806</b> that is an off-chip memory not on baseband chip <b>802</b>. In some embodiments, local memory <b>814</b> includes one or more L1, L2, L3, or L4 caches. Layer 2 circuits <b>808</b> may access local memory <b>814</b> through main bus <b>838</b> as well.</p><p id="p-0088" num="0086">As shown in <figref idref="DRAWINGS">FIG. <b>8</b></figref>, baseband chip <b>802</b> may further include a local bus <b>840</b>. In some embodiments, MCU <b>810</b> is operatively coupled to Layer 2 circuits <b>808</b> and main bus <b>838</b> through local bus <b>840</b>.</p><p id="p-0089" num="0087">Referring to Layer 2 circuits <b>808</b>, Layer 2 circuits <b>808</b> may be configured to provide Layer 1 transport blocks (as the outputs of Layer 2 circuits <b>808</b>) and provide Layer 3 data packets (as the inputs of Layer 2 circuits <b>808</b>) to the Layer 1 transport blocks in an in-line manner In some embodiments, Layer 2 circuits <b>808</b> are configured to pass data through each layer of Layer 2 circuits <b>808</b> without storing the data in external memory <b>806</b>. The data may flow from upper to lower layers in Layer 2 (e.g., PDCP circuit <b>822</b>, RLC circuit <b>824</b>, and MAC circuit <b>826</b>).</p><p id="p-0090" num="0088">As shown in <figref idref="DRAWINGS">FIG. <b>8</b></figref>, MAC-PHY interface <b>830</b> may be operatively coupled to in-line control buffer <b>828</b> and configured to provide the Layer 1 transport blocks to Layer 1 (e.g., the PHY layer). The operations of MAC-PHY interface <b>830</b> may be controlled based on a set of interface commands from MCU <b>810</b>. Each Layer 1 transport block may contain data from the previous radio subframe, having multiple or partial packets, depending on scheduling and modulation. Each Layer 1 transport block may correspond to a MAC PDU and include a payload (e.g., having encrypted data) and multiple headers (e.g., MAC header, RLC header, and PDCP header).</p><p id="p-0091" num="0089">As shown in <figref idref="DRAWINGS">FIG. <b>8</b></figref>, in-line control buffer <b>828</b> may be operatively coupled to MAC-PHY interface <b>830</b> and configured to store the Layer 1 transport blocks sent by MAC-PHY interface <b>830</b>. In-line control buffer <b>828</b> may be a separate physical memory component or part of local memory <b>814</b> (e.g., a logical partition thereof) dedicated to Layer 2 uplink data processing. Layer 2 circuits <b>808</b> in baseband chip <b>802</b> may perform Layer 2 uplink data processing in an in-line manner without access to external memory <b>806</b>.</p><p id="p-0092" num="0090">As shown in <figref idref="DRAWINGS">FIG. <b>8</b></figref>, MAC circuit <b>826</b> may be operatively coupled to in-line control buffer <b>828</b> and RLC circuit <b>824</b> and configured to prepare the MAC headers of the Layer 1 transport blocks to be stored in in-line control buffer <b>828</b>. The preparation of the MAC headers by MAC circuit <b>826</b> may be controlled based on a set of MAC commands from MCU <b>810</b>.</p><p id="p-0093" num="0091">As shown in <figref idref="DRAWINGS">FIG. <b>8</b></figref>, RLC circuit <b>824</b> may be operatively coupled to MAC circuit <b>826</b> and PDCP circuit <b>822</b> and configured to prepare the RLC headers of the Layer 1 transport blocks to provided to MAC circuit <b>826</b>. The preparation of the RLC headers may be controlled based on a set of RLC commands from MCU <b>810</b>.</p><p id="p-0094" num="0092">As shown in <figref idref="DRAWINGS">FIG. <b>8</b></figref>, PDCP circuit <b>822</b> may be operatively coupled to RLC circuit <b>824</b> and SDAP circuit <b>820</b> and configured to prepare the PDCP headers of the Layer 1 transport blocks to be provided to RLC circuit <b>824</b>. The preparation of the PDCP headers may be controlled based on a set of PDCP commands from MCU <b>810</b>.</p><p id="p-0095" num="0093">According to one aspect of the present disclosure, a method for packet preparation for uplink transmission can include determining, by a user equipment, a quality of service identifier associated with a quality of service flow. The method can also include mapping, by the user equipment, the quality of service identifier to a group token level. The method can further include processing, by the user equipment, the quality of service flow in accordance with the group token level.</p><p id="p-0096" num="0094">In some embodiments, the determining can be performed during quality of service flow setup for the quality of service flow.</p><p id="p-0097" num="0095">In some embodiments, the quality of service identifier can be a fifth-generation (5G) quality of service identifier.</p><p id="p-0098" num="0096">In some embodiments, the mapping can include calculating the group token level based on a plurality of attributes of the quality of service flow.</p><p id="p-0099" num="0097">In some embodiments, the plurality of attributes can include at least one of priority of level of the quality of service flow, resource type, or packet delay budget.</p><p id="p-0100" num="0098">In some embodiments, each of the plurality of attributes can be separately weighted in the calculating the group token level.</p><p id="p-0101" num="0099">In some embodiments, the method can further include allocating a highest priority queue with a maximum priority and an unlimited bucket size.</p><p id="p-0102" num="0100">In some embodiments, the processing can include sorting the quality of service flow in order of priority access based on the group token level.</p><p id="p-0103" num="0101">In some embodiments, the method can further include receiving a grant for uplink communication. The grant can include a grant size of bytes. The method can also include distributing the grant size of bytes across a plurality of logical channels. The method can additionally include distributing the grant size of bytes among a plurality of quality of service flows comprising the quality of service flows. The distributing the grant size of bytes among the plurality of quality of service flows can be performed based on respective group token levels of respective quality of service flows.</p><p id="p-0104" num="0102">In some embodiments, the distributing the grant size of bytes among the plurality of quality of service flows can be performed on a per logical channel basis.</p><p id="p-0105" num="0103">In some embodiments, the distributing the grant size of bytes among the plurality of quality of service flows can include calculating a number of bytes per group token level based on a sum of group token levels for all of the plurality of quality of service flows.</p><p id="p-0106" num="0104">In some embodiments, the distributing the grant size of bytes among the plurality of quality of service flows can further include assigning mini token buckets proportionally among the plurality of quality of service flows.</p><p id="p-0107" num="0105">In some embodiments, the distributing the grant size of bytes among the plurality of quality of service flows can further include assigning leftover from a higher priority quality of service flow bucket to a lower priority quality of service flow bucket.</p><p id="p-0108" num="0106">In some embodiments, the method can further include dequeueing data from each of the plurality of quality of service flows in order of the respective group token levels.</p><p id="p-0109" num="0107">In some embodiments, the distributing the grant size of bytes across the plurality of logical channels can include assigning remaining grant size of bytes from a first logical channel to a next logical channel after distributing the grant size of bytes among the plurality of quality of service flows in the first logical channel.</p><p id="p-0110" num="0108">According to another aspect of the present disclosure, an apparatus for packet preparation for uplink transmission can include at least one processor and at least one memory including computer program code. The at least one memory and the computer program code can be configured to, with the at least one processor, cause the apparatus at least to determine a quality of service identifier associated with a quality of service flow. The at least one memory and the computer program code can also be configured to, with the at least one processor, cause the apparatus at least to map the quality of service identifier to a group token level. The at least one memory and the computer program code can further be configured to, with the at least one processor, cause the apparatus at least to process the quality of service flow in accordance with the group token level.</p><p id="p-0111" num="0109">In some embodiments, the at least one memory and the computer program code can be configured to, with the at least one processor, cause the apparatus at least to map the quality of service identifier to the group token level by calculating the group token level based on a plurality of attributes of the quality of service flow.</p><p id="p-0112" num="0110">In some embodiments, the at least one memory and the computer program code can be further configured to, with the at least one processor, cause the apparatus at least to receive a grant for uplink communication. The grant can include a grant size of bytes. The at least one memory and the computer program code can also be further configured to, with the at least one processor, cause the apparatus at least to distribute the grant size of bytes across a plurality of logical channels. The at least one memory and the computer program code can be additionally configured to, with the at least one processor, cause the apparatus at least to distribute the grant size of bytes among a plurality of quality of service flows comprising the quality of service flows. The distributing the grant size of bytes among the plurality of quality of service flows can be performed based on respective group token levels of respective quality of service flows.</p><p id="p-0113" num="0111">In some embodiments, the at least one memory and the computer program code can be further configured to, with the at least one processor, cause the apparatus at least to dequeue data from each of the plurality of quality of service flows in order of the respective group token levels.</p><p id="p-0114" num="0112">In some embodiments, the at least one memory and the computer program code are configured to, with the at least one processor, cause the apparatus at least to distribute the grant size of bytes across the plurality of logical channels by assigning remaining grant size of bytes from a first logical channel to a next logical channel after distributing the grant size of bytes among the plurality of quality of service flows in the first logical channel.</p><p id="p-0115" num="0113">According to a further aspect of the present disclosure, a non-transitory computer-readable medium can be encoded with instructions that, when executed by a processor, cause the processor at least to perform a process for packet preparation for uplink transmission. The process can include determining, by the user equipment, a quality of service identifier associated with a quality of service flow. The process can also include mapping, by the user equipment, the quality of service identifier to a group token level. The process can further include processing, by the user equipment, the quality of service flow in accordance with the group token level.</p><p id="p-0116" num="0114">According to yet another aspect of the present disclosure, a baseband chip for packet preparation for uplink transmission can include a service data adaptation protocol circuit, a packet data convergence protocol circuit, and a medium access control circuit. The service data adaptation protocol circuit can be configured to determine a quality of service identifier associated with a quality of service flow, map the quality of service identifier to a group token level, process the quality of service flow in accordance with the group token level, and provide the quality of service flow to the packet data convergence protocol circuit to passed toward the medium access control circuit for transmission by a physical layer circuit.</p><p id="p-0117" num="0115">The foregoing description of the specific embodiments will so reveal the general nature of the present disclosure that others can, by applying knowledge within the skill of the art, readily modify and/or adapt for various applications such specific embodiments, without undue experimentation, without departing from the general concept of the present disclosure. Therefore, such adaptations and modifications are intended to be within the meaning and range of equivalents of the disclosed embodiments, based on the teaching and guidance presented herein. It is to be understood that the phraseology or terminology herein is for the purpose of description and not of limitation, such that the terminology or phraseology of the present specification is to be interpreted by the skilled artisan in light of the teachings and guidance.</p><p id="p-0118" num="0116">Embodiments of the present disclosure have been described above with the aid of functional building blocks illustrating the implementation of specified functions and relationships thereof. The boundaries of these functional building blocks have been arbitrarily defined herein for the convenience of the description. Alternate boundaries can be defined so long as the specified functions and relationships thereof are appropriately performed.</p><p id="p-0119" num="0117">The Summary and Abstract sections may set forth one or more but not all exemplary embodiments of the present disclosure as contemplated by the inventor(s), and thus, are not intended to limit the present disclosure and the appended claims in any way.</p><p id="p-0120" num="0118">Various functional blocks, modules, and steps are disclosed above. The particular arrangements provided are illustrative and without limitation. Accordingly, the functional blocks, modules, and steps may be re-ordered or combined in different ways than in the examples provided above. Likewise, certain embodiments include only a subset of the functional blocks, modules, and steps, and any such subset is permitted.</p><p id="p-0121" num="0119">The breadth and scope of the present disclosure should not be limited by any of the above-described example embodiments, but should be defined only in accordance with the following claims and their equivalents.</p><?detailed-description description="Detailed Description" end="tail"?></description><us-claim-statement>What is claimed is:</us-claim-statement><claims id="claims"><claim id="CLM-00001" num="00001"><claim-text><b>1</b>. A method for packet preparation for uplink transmission, comprising:<claim-text>determining, by a user equipment, a quality of service identifier associated with a quality of service flow;</claim-text><claim-text>mapping, by the user equipment, the quality of service identifier to a group token level; and</claim-text><claim-text>processing, by the user equipment, the quality of service flow in accordance with the group token level.</claim-text></claim-text></claim><claim id="CLM-00002" num="00002"><claim-text><b>2</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the determining is performed during quality of service flow setup for the quality of service flow.</claim-text></claim><claim id="CLM-00003" num="00003"><claim-text><b>3</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the quality of service identifier comprises a fifth-generation (5G) quality of service identifier.</claim-text></claim><claim id="CLM-00004" num="00004"><claim-text><b>4</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the mapping comprises calculating the group token level based on a plurality of attributes of the quality of service flow.</claim-text></claim><claim id="CLM-00005" num="00005"><claim-text><b>5</b>. The method of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the plurality of attributes comprise at least one of priority of level of the quality of service flow, resource type, or packet delay budget.</claim-text></claim><claim id="CLM-00006" num="00006"><claim-text><b>6</b>. The method of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein each of the plurality of attributes is separately weighted in the calculating the group token level.</claim-text></claim><claim id="CLM-00007" num="00007"><claim-text><b>7</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:<claim-text>allocating a highest priority queue with a maximum priority and an unlimited bucket size.</claim-text></claim-text></claim><claim id="CLM-00008" num="00008"><claim-text><b>8</b>. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:<claim-text>receiving a grant for uplink communication, wherein the grant comprises a grant size of bytes;</claim-text><claim-text>distributing the grant size of bytes across a plurality of logical channels; and</claim-text><claim-text>distributing the grant size of bytes among a plurality of quality of service flows comprising the quality of service flows, wherein the distributing the grant size of bytes among the plurality of quality of service flows is performed based on respective group token levels of respective quality of service flows.</claim-text></claim-text></claim><claim id="CLM-00009" num="00009"><claim-text><b>9</b>. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the distributing the grant size of bytes among the plurality of quality of service flows is performed on a per logical channel basis.</claim-text></claim><claim id="CLM-00010" num="00010"><claim-text><b>10</b>. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the distributing the grant size of bytes among the plurality of quality of service flows comprises calculating a number of bytes per group token level based on a sum of group token levels for all of the plurality of quality of service flows.</claim-text></claim><claim id="CLM-00011" num="00011"><claim-text><b>11</b>. The method of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein the distributing the grant size of bytes among the plurality of quality of service flows further comprises assigning mini token buckets proportionally among the plurality of quality of service flows.</claim-text></claim><claim id="CLM-00012" num="00012"><claim-text><b>12</b>. The method of <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein the distributing the grant size of bytes among the plurality of quality of service flows further comprises assigning leftover from a higher priority quality of service flow bucket to a lower priority quality of service flow bucket.</claim-text></claim><claim id="CLM-00013" num="00013"><claim-text><b>13</b>. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref>, further comprising:<claim-text>dequeueing data from each of the plurality of quality of service flows in order of the respective group token levels.</claim-text></claim-text></claim><claim id="CLM-00014" num="00014"><claim-text><b>14</b>. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the distributing the grant size of bytes across the plurality of logical channels comprises assigning remaining grant size of bytes from a first logical channel to a next logical channel after distributing the grant size of bytes among the plurality of quality of service flows in the first logical channel.</claim-text></claim><claim id="CLM-00015" num="00015"><claim-text><b>15</b>. An apparatus for packet preparation for uplink transmission, comprising:<claim-text>at least one processor; and</claim-text><claim-text>at least one memory including computer program code,</claim-text><claim-text>wherein the at least one memory and the computer program code are configured to, with the at least one processor, cause the apparatus at least to:</claim-text><claim-text>determine a quality of service identifier associated with a quality of service flow;</claim-text><claim-text>map the quality of service identifier to a group token level; and</claim-text><claim-text>process the quality of service flow in accordance with the group token level.</claim-text></claim-text></claim><claim id="CLM-00016" num="00016"><claim-text><b>16</b>. The apparatus of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the at least one memory and the computer program code are configured to, with the at least one processor, cause the apparatus at least to map the quality of service identifier to the group token level by calculating the group token level based on a plurality of attributes of the quality of service flow.</claim-text></claim><claim id="CLM-00017" num="00017"><claim-text><b>17</b>. The apparatus of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the at least one memory and the computer program code are further configured to, with the at least one processor, cause the apparatus at least to:<claim-text>receive a grant for uplink communication, wherein the grant comprises a grant size of bytes;</claim-text><claim-text>distribute the grant size of bytes across a plurality of logical channels; and</claim-text><claim-text>distribute the grant size of bytes among a plurality of quality of service flows comprising the quality of service flows, wherein the distributing the grant size of bytes among the plurality of quality of service flows is performed based on respective group token levels of respective quality of service flows.</claim-text></claim-text></claim><claim id="CLM-00018" num="00018"><claim-text><b>18</b>. The apparatus of <claim-ref idref="CLM-00017">claim 17</claim-ref>, wherein the at least one memory and the computer program code are further configured to, with the at least one processor, cause the apparatus at least to:<claim-text>dequeue data from each of the plurality of quality of service flows in order of the respective group token levels.</claim-text></claim-text></claim><claim id="CLM-00019" num="00019"><claim-text><b>19</b>. The apparatus of <claim-ref idref="CLM-00017">claim 17</claim-ref>, wherein the at least one memory and the computer program code are configured to, with the at least one processor, cause the apparatus at least to distribute the grant size of bytes across the plurality of logical channels by assigning remaining grant size of bytes from a first logical channel to a next logical channel after distributing the grant size of bytes among the plurality of quality of service flows in the first logical channel.</claim-text></claim><claim id="CLM-00020" num="00020"><claim-text><b>20</b>. A baseband chip for packet preparation for uplink transmission, comprising:<claim-text>a service data adaptation protocol (SDAP) circuit;</claim-text><claim-text>a packet data convergence protocol (PDCP) circuit; and</claim-text><claim-text>a medium access control (MAC) circuit,</claim-text><claim-text>wherein the SDAP circuit is configured to</claim-text><claim-text>determine a quality of service identifier associated with a quality of service flow;</claim-text><claim-text>map the quality of service identifier to a group token level;</claim-text><claim-text>process the quality of service flow in accordance with the group token level; and</claim-text><claim-text>provide the quality of service flow to the PDCP circuit to passed toward the MAC circuit for transmission by a physical layer circuit.</claim-text></claim-text></claim></claims></us-patent-application>