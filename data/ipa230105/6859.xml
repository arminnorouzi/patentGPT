<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230006860A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230006860</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17756927</doc-number><date>20201117</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><priority-claims><priority-claim sequence="01" kind="national"><country>JP</country><doc-number>2019-221517</doc-number><date>20191206</date></priority-claim></priority-claims><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>L</subclass><main-group>12</main-group><subgroup>40</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>B</section><class>60</class><subclass>R</subclass><main-group>16</main-group><subgroup>023</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>L</subclass><main-group>12</main-group><subgroup>40013</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc><further-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>B</section><class>60</class><subclass>R</subclass><main-group>16</main-group><subgroup>0231</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>L</subclass><main-group>2012</main-group><subgroup>40215</subgroup><symbol-position>L</symbol-position><classification-value>A</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>L</subclass><main-group>2012</main-group><subgroup>40273</subgroup><symbol-position>L</symbol-position><classification-value>A</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></further-cpc></classifications-cpc><invention-title id="d2e61">DETERMINATION DEVICE, DETERMINATION PROGRAM, AND DETERMINATION METHOD</invention-title><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>AutoNetworks Technologies, Ltd.</orgname><address><city>Yokkaichi-shi, Mie</city><country>JP</country></address></addressbook><residence><country>JP</country></residence></us-applicant><us-applicant sequence="01" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>Sumitomo Wiring Systems, Ltd.</orgname><address><city>Yokkaichi-shi, Mie</city><country>JP</country></address></addressbook><residence><country>JP</country></residence></us-applicant><us-applicant sequence="02" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>Sumitomo Electric Industries, Ltd.</orgname><address><city>Osaka-shi Osaka</city><country>JP</country></address></addressbook><residence><country>JP</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>AIBA</last-name><first-name>Shinichi</first-name><address><city>Yokkaichi-shi, Mie</city><country>JP</country></address></addressbook></inventor><inventor sequence="01" designation="us-only"><addressbook><last-name>UEDA</last-name><first-name>Hiroshi</first-name><address><city>Yokkaichi-shi, Mie</city><country>JP</country></address></addressbook></inventor><inventor sequence="02" designation="us-only"><addressbook><last-name>ADACHI</last-name><first-name>Naoki</first-name><address><city>Yokkaichi-shi, Mie</city><country>JP</country></address></addressbook></inventor><inventor sequence="03" designation="us-only"><addressbook><last-name>KAMIGUCHI</last-name><first-name>Shogo</first-name><address><city>Yokkaichi-shi, Mie</city><country>JP</country></address></addressbook></inventor><inventor sequence="04" designation="us-only"><addressbook><last-name>ISHIKAWA</last-name><first-name>Fumiya</first-name><address><city>Yokkaichi-shi, Mie</city><country>JP</country></address></addressbook></inventor></inventors></us-parties><pct-or-regional-filing-data><document-id><country>WO</country><doc-number>PCT/JP2020/042793</doc-number><date>20201117</date></document-id><us-371c12-date><date>20220606</date></us-371c12-date></pct-or-regional-filing-data></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">A control unit of a determination device obtains a plurality of pieces of first data and second data, derives determination data based on the first data, specifies, from among a plurality of combinations of identifiers for respectively identifying the pieces of first data and an identifier for identifying the second data, based on the second data and the determination data, a valid combination including the identifiers of valid first data and second data, and an invalid combination including the identifiers of invalid first data or second data, and determines, based on a plurality of identifiers included in the specified invalid combination and a plurality of identifiers included in the valid combination, whether the first data or the second data is invalid.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="90.17mm" wi="158.75mm" file="US20230006860A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="221.23mm" wi="142.75mm" orientation="landscape" file="US20230006860A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="219.71mm" wi="149.78mm" orientation="landscape" file="US20230006860A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="102.70mm" wi="132.42mm" file="US20230006860A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="225.64mm" wi="143.34mm" orientation="landscape" file="US20230006860A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00005" num="00005"><img id="EMI-D00005" he="225.21mm" wi="156.04mm" orientation="landscape" file="US20230006860A1-20230105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00006" num="00006"><img id="EMI-D00006" he="253.49mm" wi="172.13mm" file="US20230006860A1-20230105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="lead"?><heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATIONS</heading><p id="p-0002" num="0001">This application is the U.S. national stage of PCT/JP2020/042793 filed on Nov. 17, 2020, which claims priority of Japanese Patent Application No. JP 2019-221517 filed on Dec. 6, 2019, the contents of which are incorporated herein.</p><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="tail"?><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0002" level="1">TECHNICAL FIELD</heading><p id="p-0003" num="0002">The present disclosure relates to a determination device, a determination program, and a determination method.</p><heading id="h-0003" level="1">BACKGROUND</heading><p id="p-0004" num="0003">Conventionally, the CAN communication protocol is broadly used in communication between a plurality of vehicle-mounted ECUs (Electronic Control Units) mounted in vehicles. In accordance with an increase in functionalities and sophistication of vehicles, the number of vehicle-mounted ECUs mounted in the vehicles tends to increase. The vehicle-mounted ECUs are divided into groups (segments) to form a vehicle network, the plurality of vehicle-mounted ECUs in the same group are connected by a common communication line and performs transmission/reception of data among each other, and transmission/reception of data between the vehicle-mounted ECUs of different groups are relayed by a vehicle-mounted relay device (gateway) (e.g., JP 2013-131907A).</p><p id="p-0005" num="0004">The vehicle network described in JP 2013-131907A includes, in addition to a vehicle-mounted relay device (gateway), a vehicle network monitoring device that is connected to segments of the vehicle network and detects invalid data (messages) that is present in the vehicle network. When detecting invalid data (messages), the vehicle network monitoring device transmits warning information (message codes) to vehicle-mounted control devices (vehicle-mounted ECUs).</p><p id="p-0006" num="0005">The vehicle network monitoring device described in JP 2013-131907A gives no consideration to determination of data that has become invalid due to an attack when any of a plurality of pieces of data that are associated with each other is subjected to an attack.</p><heading id="h-0004" level="1">SUMMARY</heading><p id="p-0007" num="0006">An object of the present disclosure is to provide a determination device and the like, with which data that has become invalid due to an attack can be determined when any of a plurality of pieces of data associated with each other has been subjected to an attack.</p><p id="p-0008" num="0007">A determination device according to an aspect of the present disclosure is a determination device that is mounted in a vehicle and connected to a plurality of vehicle-mounted ECUs so that they can communicate with the determination device, the determination device including a control unit configured to perform control regarding determination of whether data transmitted from the plurality of vehicle-mounted ECUs is valid, and the data includes first data and second data, and the control unit is configured to obtain a plurality of pieces of the first data and the second data that are transmitted from the plurality of vehicle-mounted ECUs, derives determination data based on the first data, and specify, from among a plurality of combinations of identifiers for identifying the first data and identifiers for identifying the second data, valid combinations including identifiers of valid first data and second data and invalid combinations including identifiers of invalid first data or second data, based on the second data and the determination data, and determine, based on the plurality of identifiers included in the specified invalid combinations and the plurality of identifiers included in the valid combinations, whether the first data or the second data of any identifier included in the specified invalid combinations is invalid.</p><heading id="h-0005" level="1">Effects of the Present Disclosure</heading><p id="p-0009" num="0008">According to an aspect of the present disclosure, it is possible to provide a determination device and the like with which, data that has become invalid due to an attack is determined when any of a plurality of pieces of data associated with each other has been attacked.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0006" level="1">BRIEF DESCRIPTION OF DRAWINGS</heading><p id="p-0010" num="0009"><figref idref="DRAWINGS">FIG. <b>1</b></figref> is a schematic diagram showing an exemplary system configuration including a determination device according to a first embodiment.</p><p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a block diagram showing an exemplary internal configuration of the determination device.</p><p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. <b>3</b></figref> is an illustrative diagram showing an exemplary correlation between a plurality of identifiers.</p><p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. <b>4</b></figref> is an illustrative diagram showing a plurality of combinations (combination table) of identifiers for identifying first data and second data.</p><p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is a functional block diagram showing exemplary functional units included in a control unit of the determination device.</p><p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is a flowchart showing exemplary processing performed by the control unit of the determination device.</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><heading id="h-0007" level="1">DETAILED DESCRIPTION OF PREFERRED EMBODIMENTS</heading><p id="p-0016" num="0015">First, aspects of the present disclosure will be listed and described. At least some of the embodiments described below may be combined as appropriate.</p><heading id="h-0008" level="2">First Aspect</heading><p id="p-0017" num="0016">A determination device according to a first aspect of the present disclosure is a determination device that is mounted in a vehicle and connected to a plurality of vehicle-mounted ECUs so that they can communicate with the determination device, the determination device including a control unit configured to perform control regarding determination of whether data transmitted from the plurality of vehicle-mounted ECUs is valid, and the data includes first data and second data, and the control unit is configured to obtain a plurality of pieces of the first data and the second data that are transmitted from the plurality of vehicle-mounted ECUs, derives determination data based on the first data, and specify, from among a plurality of combinations of identifiers for identifying the first data and identifiers for identifying the second data, valid combinations including identifiers of valid first data and second data and invalid combinations including identifiers of invalid first data or second data, based on the second data and the determination data, and determine, based on the plurality of identifiers included in the specified invalid combinations and the plurality of identifiers included in the valid combinations, whether the first data or the second data of any identifier included in the specified invalid combinations is invalid.</p><p id="p-0018" num="0017">With the first aspect, based on the first data, the second data, and the determination data, the determination device specifies, from among the plurality of combinations of identifiers for identifying a plurality of pieces of first data and second data, a valid combination including only identifiers of valid first data and valid second data, and an invalid combination including identifier of invalid first data or second data. Accordingly, the determination device can specify valid data from among the plurality of pieces of data associated with each other. Based on the first data or the second data of the identifier included in the invalid combination and the specified valid data (the first data and second data of the identifiers included in the valid combination), the determination device determines whether any of the first data and second data of the identifiers included in the invalid combinations is invalid. Accordingly, even when any of the plurality of pieces of data associated with each other is subjected to an attack, the data that has become invalid due to the attack can be specified.</p><heading id="h-0009" level="2">Second Aspect</heading><p id="p-0019" num="0018">In the determination device according to a second aspect of the present disclosure, each of the plurality of combinations may also include a plurality of identifiers for respectively identifying a plurality of pieces of the first data and an identifier of the second data, and the same identifier may also be redundantly included in two or more of the combinations.</p><p id="p-0020" num="0019">With the second aspect, the combinations are each constituted by a data set including a plurality of identifiers respectively indicating the plurality of pieces of first data and a single identifier of the second data, and the same identifier is redundantly included in two or more combinations. Accordingly these combinations can be linked and associated with each other based on any one of the identifiers, and determination of the first and second data of the identifiers included in the other combination can be efficiently performed using the identifiers of the first or second data included in the combination determined as the valid combination.</p><heading id="h-0010" level="2">Third Aspect</heading><p id="p-0021" num="0020">In the determination device according to a third aspect of the present disclosure, if a difference between determination data derived based on first data with an identifier included in one of the plurality of combinations and second data with an identifier included in that one combination is within a predetermined value, then the control unit may also specify that the one combination is a valid combination.</p><p id="p-0022" num="0021">With the third aspect, in the plurality of combinations, when the difference between the determination data derived based on the plurality of pieces of first data included in one combination and the second data included in that combination is within a predetermined value, the determination device specifies that the combination is the valid combination. Since whether the first and second data included in the combination is valid is determined for each combination in this manner, determination can be efficiently performed for each combination. The predetermined value means a threshold for determining that the determination data and the second data have substantially the same value with respect to the accuracy of determination processing performed by the determination device when comparing the determination data with the second data.</p><heading id="h-0011" level="2">Fourth Aspect</heading><p id="p-0023" num="0022">In the determination device according to a fourth aspect of the present disclosure, if a difference between determination data derived based on the first data with an identifier included in one of the plurality of combinations and the second data with an identifier included in that one combination is greater than a predetermined value, the control unit may also specify that the one combination is an invalid combination.</p><p id="p-0024" num="0023">With the fourth aspect, in the plurality of combinations, when the difference between the determination data derived based on the plurality of pieces of first data included in one combination and the second data included in that combination is greater than a predetermined value, the determination device specifies that the combination is the invalid combination. Since whether the first and second data included in the combination is valid or invalid is determined for each combination in this manner, determination can be efficiently performed for each combination.</p><heading id="h-0012" level="2">Fifth Aspect</heading><p id="p-0025" num="0024">In the determination device according to a fifth aspect of the present disclosure, from among the identifiers included in the invalid combination, the control unit may also determine that the first data or the second data with an identifier that is different from the identifier included in the valid determination combination is invalid data.</p><p id="p-0026" num="0025">With the fifth aspect, the first data and the second data of the identifiers included in the valid combination have already been determined as the valid data. By contrast, the first data or the second data of the identifier included in the invalid combination is assumed to be invalid data. In view of this, even when the data is the first data or the second data of the identifiers included in the invalid combination, the same data as the first data and the second data of the identifiers included in the valid combination can be determined to be the valid data. Accordingly, in the first data and the second data of the identifiers included in the invalid combination, by determining the data that is different from the first data or the second data of the identifiers included in the valid combination as the invalid data, it is possible to efficiently determine which of the data, from among the first data and the second data of the identifiers included in the invalid combination, is invalid.</p><heading id="h-0013" level="2">Sixth Aspect</heading><p id="p-0027" num="0026">In the determination device according to a sixth aspect of the present disclosure, a configuration is also possible in which, in identifiers of the plurality of first data included in the invalid combinations, the control unit is configured to derive the determination data based on the first data with identifiers excluding any identifier of data determined as invalid in another invalid combination, and determine whether the first data and the second data included in the invalid combination is valid, based on the determination data and the second data with an identifier included in the invalid combination.</p><p id="p-0028" num="0027">With the sixth aspect, in the plurality of pieces of first data of the identifiers that are included in one of the invalid combinations, the determination data is derived based on the first data excluding the identifier of the data determined as invalid in the other invalid combination. Then, the determination device determines whether the first data and the second data are valid based on the first data excluding the data determined as invalid, the determination data itself, and the second data of the identifier that is included in the invalid combination. Since the first data used for deriving the determination data is the first data excluding the identifiers of the data determined as invalid in the other invalid combination, it is likely that such first data is the valid data. Accordingly, based on the determination data derived using the first data excluding the data determined as invalid and the second data, whether the first and second data are valid can be efficiently determined.</p><heading id="h-0014" level="2">Seventh Aspect</heading><p id="p-0029" num="0028">In the determination device according to a seventh aspect of the present disclosure, a configuration is also possible in which, information regarding a plurality of combinations is stored in a predetermined storage area which is accessible from the determination device, and the control unit obtains the information regarding the plurality of combinations by referencing the predetermined storage area.</p><p id="p-0030" num="0029">With the seventh aspect, the information regarding the plurality of combinations is stored not only in the storage unit included in the determination device but also in a predetermined storage area that is accessible from the determination device, such as an external server connected to the determination device so that they can communicate with each other, and thus the information regarding the combinations can be efficiently obtained.</p><heading id="h-0015" level="2">Eighth Aspect</heading><p id="p-0031" num="0030">In the determination device according to an eighth aspect of the present disclosure, the first data and the second data corresponding to the identifiers constituting the combination may also be correlated with each other, and an absolute value of a correlation coefficient of the first data and the second data may also be at least 0.7.</p><p id="p-0032" num="0031">With the eighth aspect, the first data and the second data corresponding to the identifiers constituting the combination are correlated with each other, and by setting a predetermined value of the absolute value of the correlation coefficient between the first data and the second data to 0.7, it is possible to determine whether the date is valid using the second data of which the absolute value of the correlation coefficient with the first data is 0.7 or more, and improve the accuracy of the result of determination.</p><heading id="h-0016" level="2">Ninth Aspect</heading><p id="p-0033" num="0032">A determination program according to a ninth aspect of the present disclosure is a determination program for causing a computer to execute processing for obtaining a plurality of pieces of the first data and the second data that are transmitted from the plurality of vehicle-mounted ECUs, deriving determination data based on the first data, obtaining information regarding a plurality of combination of identifiers for identifying the first data and second data, specifying, from among a plurality of combinations, valid combinations including identifiers of valid first data and second data and invalid combinations including identifiers of invalid first data or second data, based on the obtained second data and the determination data, and determining, based on the plurality of identifiers included in the specified invalid combinations and the plurality of identifiers included in the valid combinations, whether the first data or the second data of any identifier included in the specified invalid combinations is invalid.</p><p id="p-0034" num="0033">With the ninth aspect, a computer can function as the determination device.</p><heading id="h-0017" level="2">Tenth Aspect</heading><p id="p-0035" num="0034">A determination method according to a tenth aspect of the present disclosure is a determination method for causing a computer to execute processing for obtaining a plurality of pieces of the first data and the second data that are transmitted from the plurality of vehicle-mounted ECUs, deriving determination data based on the first data, obtaining information regarding a plurality of combination of identifiers for identifying the first data and second data, specifying, from among a plurality of combinations, valid combinations including identifiers of valid first data and second data and invalid combinations including identifiers of invalid first data or second data, based on the obtained second data and the determination data, and determining, based on the plurality of identifiers included in the specified invalid combination and the plurality of identifiers included in the valid combinations, whether the first data or the second data of any identifier included in the specified invalid combinations is invalid.</p><p id="p-0036" num="0035">With the tenth aspect, a determination method can be provided, according to which when any of the plurality of pieces of data that are in association with each other is subjected to an attack, the data that has become invalid due to the attack can be determined.</p><p id="p-0037" num="0036">In the following, the present disclosure will be described in detail with reference to the drawings showing embodiments thereof. A vehicle-mounted determination device <b>2</b> according to embodiments of the present disclosure will be described below with reference to the drawings. It should be noted that the present disclosure is not limited to these examples, but is defined by the claims, and is intended to include all modifications which fall within the scope of the claims and the meaning and scope of equivalents thereof.</p><heading id="h-0018" level="1">First Embodiment</heading><p id="p-0038" num="0037">Hereinafter, an embodiment will be described with reference to the drawings. <figref idref="DRAWINGS">FIG. <b>1</b></figref> is a schematic diagram showing an exemplary system configuration including the determination device <b>2</b> according to a first embodiment. <figref idref="DRAWINGS">FIG. <b>2</b></figref> is a block diagram showing an exemplary internal configuration of the determination device <b>2</b> and the like. An external communication device <b>1</b>, the determination device <b>2</b>, and a plurality of vehicle-mounted ECUs <b>3</b> connected to the determination device <b>2</b> so that the vehicle-mounted ECUs <b>3</b> can communicate with the determination device <b>2</b>, are mounted in a vehicle C.</p><p id="p-0039" num="0038">The determination device <b>2</b> determines whether data such as a message that is output (transmitted) by these vehicle-mounted ECUs <b>3</b> is valid. The determination device <b>2</b> functions as a vehicle-mounted relay device such as a CAN gateway or an Ethernet switch (registered trademark) that relays data exchanged between these vehicle-mounted ECUs <b>3</b>. Furthermore, the determination device <b>2</b> may also function as a vehicle-mounted relay device for communicating with an external server S<b>1</b> (program providing device) connected to an external network N via the external communication device <b>1</b>. The determination device <b>2</b> may also function as a reprogramming master that transmits programs or data obtained from the external server S<b>1</b> to the vehicle-mounted ECUs <b>3</b> (Electronic Control Units) mounted in the vehicle C. The determination device <b>2</b> may also perform a series of determination processing (described later) in cooperation with the external server S<b>1</b>.</p><p id="p-0040" num="0039">The external server S<b>1</b> is, for example, a computer such as a server connected to the external network N, such as the Internet or a public network, and includes a storage unit S<b>11</b> constituted by a RAM (Random Access Memory), a ROM (Read Only Memory), a hard disk or the like. A program and/or data for controlling the vehicle-mounted ECUs <b>3</b>, created by the manufacturer of the vehicle-mounted ECUs <b>3</b> or the like, are stored in the storage unit S<b>11</b> of the external server S<b>1</b>. The program or data may also be transmitted to the vehicle C as an update program and used for updating a program or data of the vehicle-mounted ECUs <b>3</b> mounted in the vehicle C. The external server S<b>1</b> (program providing device) configured as above may also be referred to as an OTA (Over The Air) server. The vehicle-mounted ECUs <b>3</b> mounted in the vehicle obtain an update program transmitted from the external server S<b>1</b> via wireless communication, and apply this update program as the program to be executed, and thus the vehicle-mounted ECUs <b>3</b> can update (reprogram) the program executed by themselves. Furthermore, a program or data for performing a series of determination processing in cooperation with the determination device <b>2</b> may also be stored in the storage unit S<b>11</b> of the external server S<b>1</b>.</p><p id="p-0041" num="0040">The external communication device <b>1</b>, the determination device <b>2</b>, a display device <b>5</b>, and the plurality of vehicle-mounted ECUs <b>3</b> for controlling various vehicle-mounted devices are mounted in the vehicle C. The external communication device <b>1</b> is connected to the determination device <b>2</b> by a wire harness such as a serial cable so that they can communicate with each other. The determination device <b>2</b> and the vehicle-mounted ECUs <b>3</b> are connected via an in-vehicle LAN <b>4</b> compatible with a communication protocol such as CAN (Control Area Network/registered trademark) or TCP/IP so that they can communicate with each other.</p><p id="p-0042" num="0041">The external communication device <b>1</b> includes an external communication unit <b>11</b> and an input/output I/F <b>12</b> for communicating with the determination device <b>2</b>. The external communication unit <b>11</b> is a communication device for performing wireless communication using a mobile communication protocol such as 3G, LTE, 4G, or Wi-Fi, and exchanges data with the external server S<b>1</b> via an antenna <b>13</b> connected to the external communication unit <b>11</b>. The communication between the external communication device <b>1</b> and the external server S<b>1</b> is performed via the external network, such as a public network or the Internet.</p><p id="p-0043" num="0042">The input/output I/F <b>12</b> is a communication interface for performing, for example, serial communication with the determination device <b>2</b>. The external communication device <b>1</b> and the determination device <b>2</b> communicate with each other via the input/output I/F <b>12</b> and a wire harness such as a serial cable connected to the input/output I/F <b>12</b>. In the present embodiment, the external communication device <b>1</b> is a device that is separate from the determination device <b>2</b>, and these devices are connected to each other via the input/output I/F <b>12</b> and the like so that they can communicate with each other. However, there is no limitation to this. The external communication device <b>1</b> may be built in the determination device <b>2</b> as a constituent part of the determination device <b>2</b>.</p><p id="p-0044" num="0043">The determination device <b>2</b> includes a control unit <b>20</b>, a storage unit <b>21</b>, in-vehicle communication units <b>23</b>, and an input/output I/F <b>24</b>. The determination device <b>2</b> is an vehicle-mounted relay device such as a gateway or an Ethernet switch that generally controls segments including a plurality of communication lines <b>41</b> (CAN buses, Ethernet (registered trademark) cables) of a plurality of systems such as the vehicle-mounted ECUs <b>3</b> of a control system, the vehicle-mounted ECUs <b>3</b> of a safety system, and the vehicle-mounted ECUs <b>3</b> of a body system, and that relays communication between the vehicle-mounted ECUs <b>3</b> between these segments. The determination device <b>2</b> may also be configured as a functional unit of a body ECU that performs overall control of the vehicle C. The determination device <b>2</b> may also be configured as a device separate from the vehicle-mounted relay device, and connected to the vehicle-mounted relay device so that they can communicate with each other. The determination device <b>2</b> may also be configured to obtain data such as messages and the like, that is output by the vehicle-mounted ECUs <b>3</b> via the vehicle-mounted relay device, and determine whether the data is valid.</p><p id="p-0045" num="0044">The storage unit <b>21</b> is formed by a volatile memory device such as a RAM (Random Access Memory) or a nonvolatile memory device such as a ROM (Read Only Memory), an EEPROM (Electrically Erasable Programmable ROM), or a flash memory, and a control program and data that is referred to during processing are stored in advance in the storage unit <b>21</b>. The control program stored in the storage unit <b>21</b> may be a control program read out from a recording medium <b>22</b> that can be read by the determination device <b>2</b>. Alternatively, the control program may also be downloaded from an external computer (not shown) connected to a communication network (not shown), and be stored in the storage unit <b>21</b>. Configuration information of all the vehicle-mounted ECUs <b>3</b> mounted in the vehicle C and relay path information (routing table) used for performing relay processing are stored in the storage unit <b>21</b>. Further, information regarding a combination table (described later) is stored in the storage unit <b>21</b>.</p><p id="p-0046" num="0045">The in-vehicle communication units <b>23</b> are, for example, input/output interfaces (CAN transceivers) using a communication protocol such as CAN (Controller Area Network) or TCP/IP, and the control unit <b>20</b> communicates, via the in-vehicle communication unit <b>23</b>, with the vehicle-mounted ECUs <b>3</b> connected to the in-vehicle communication unit LAN <b>4</b>, or other vehicle-mounted devices such as a relay device. The plurality (three in the drawings) of the in-vehicle communication units <b>23</b> are provided, and the communication lines <b>41</b> constituting the in-vehicle LAN <b>4</b> are respectively connected to the in-vehicle communication units <b>23</b>. By providing the plurality of in-vehicle communication units <b>23</b> in this manner, the in-vehicle LAN <b>4</b> is divided into a plurality of segments, and the vehicle-mounted ECUs <b>3</b> are connected to the segments according to the function (control system function, safety system function, or body system function) of the vehicle-mounted ECUs <b>3</b>.</p><p id="p-0047" num="0046">When the in-vehicle communication units <b>23</b> use the CAN communication protocol, the data obtained by the determination device from the vehicle-mounted ECUs is given as CAN messages. When the in-vehicle communication units <b>23</b> use the TCP/IP communication protocol, the data obtained by the determination device from the vehicle-mounted ECUs is given as IP packets.</p><p id="p-0048" num="0047">The control unit <b>20</b> is formed by a CPU (Central Processing Unit) or an MPU (Micro Processing Unit) or the like, and is configured to perform various types of control processing and arithmetic processing or the like by reading out and executing a control program and data that are stored in advance in the storage unit <b>21</b>. The control unit <b>20</b> is configured to receive data such as a message transmitted from the vehicle-mounted ECUs <b>3</b> respectively connected to the communication lines <b>41</b>, or transmit data such as a message to the vehicle-mounted ECUs <b>3</b>, and functions as a CAN controller, for example. Further, the control unit <b>20</b> references a message identifier such as a CAN-ID included in the received message, and specifies the in-vehicle communication unit <b>23</b> corresponding to the segment that is the transmission destination, based on the referenced message identifier (CAN-ID) and the route information (routing table) stored in the storage unit <b>21</b>. The control unit <b>20</b> functions as a CAN gateway for relaying the message by transmitting the received message from the specified in-vehicle communication unit <b>23</b>. The control unit <b>20</b> functions as a CAN controller, but there is no limitation to this. The in-vehicle communication units <b>23</b> may also function as a CAN transceiver and a CAN controller. Alternatively, the control unit <b>20</b> may also function as an Ethernet switch of a layer <b>2</b> or a layer <b>3</b> for receiving and performing relay processing on data such as IP packets transmitted from the vehicle-mounted ECUs <b>3</b>.</p><p id="p-0049" num="0048">The control unit <b>20</b> determines whether the data is valid by, for example, analyzing the data such as a message obtained (received) from the vehicle-mounted ECUs <b>3</b>. In determination of whether the data is valid, &#x201c;invalid data&#x201d; means data such as a message transmitted from an invalid vehicle-mounted ECU <b>3</b> such as a vehicle-mounted ECU <b>3</b> that has entered an abnormal state due to a virus that has intruded from outside of the vehicle via the external communication device <b>1</b>, or a vehicle-mounted ECU <b>3</b> that has been exchanged without authorization. Although details will be described later, the control unit <b>20</b> can determine whether the received data is valid by analyzing the data, and can determine a message transmitted from an invalid (abnormal) vehicle-mounted ECU <b>3</b> that mimics a valid (normal) vehicle-mounted ECU <b>3</b>, or a vehicle-mounted ECU <b>3</b> that has become abnormal due to an attack from the outside, as an invalid message, for example. The control unit <b>20</b> specifies the identifier (e.g., message identifier of the CAN-ID or the like) included in the data of the message and the like that is determined to be invalid, and performs, for example, defensive processing such as prohibiting relay processing of any data including the specified identifier.</p><p id="p-0050" num="0049">The vehicle-mounted ECUs <b>3</b> each include a control unit <b>30</b>, a storage unit <b>31</b>, and an in-vehicle communication unit <b>32</b>. The storage unit <b>31</b> is formed by a volatile memory device such as a RAM (Random Access Memory), or a nonvolatile memory device such as a ROM (Read Only Memory), an EEPROM (Electrically Erasable Programmable ROM), or a flash memory and a program or data for the vehicle-mounted ECU <b>3</b> is stored in the storage unit <b>31</b>.</p><p id="p-0051" num="0050">The display device <b>5</b> is, for example, an HMI (Human Machine Interface) device such as a car navigation display. The display device <b>5</b> is connected to the input/output I/F <b>24</b> of the determination device <b>2</b> by a wire harness such as a serial cable so that they can communicate with each other. Data or information that is output from the control unit <b>20</b> of the determination device <b>2</b> via the input/output I/F <b>24</b> is displayed in the display device <b>5</b>. As described above, if it is determined that the received message is an invalid message, the determination device <b>2</b> may also transmit information such as the identifier included in the invalid message to the display device <b>5</b> and cause the display device <b>5</b> to display this information. By causing the display device <b>5</b> to display the information, the determination device <b>2</b> can notify the detection of the invalid message to an operator of the vehicle C. The form of connection between the display device <b>5</b> and the determination device <b>2</b> is not limited to a connection via the input/output I/F <b>24</b> and the like. The display device <b>5</b> and the determination device <b>2</b> may also be connected to each other via the in-vehicle LAN <b>4</b>.</p><p id="p-0052" num="0051"><figref idref="DRAWINGS">FIG. <b>3</b></figref> is an illustrative diagram showing an exemplary correlation between a plurality of identifiers. <figref idref="DRAWINGS">FIG. <b>4</b></figref> is an illustrative diagram relating to a plurality of combinations (combination table <b>211</b>) of identifiers for identifying first data and second data.</p><p id="p-0053" num="0052">Data that is output (transmitted) from the vehicle-mounted ECUs <b>3</b> includes identifiers for identifying the data. If the data that is output from the vehicle-mounted ECUs <b>3</b> is a CAN message, a message identifier (CAN-ID number) stored in the CAN-ID field included in the frame of the CAN message corresponds to the identifier. Data of a plurality of identifiers are correlated with each other. &#x201c;Being correlated with each other&#x201d; means that, in any two pieces of data with identifiers, the absolute value of the correlation coefficient of these pieces of data is at least a predetermined value. The correlation coefficient may also be calculated based on information relating to the value or content stored in the payloads of the CAN messages or the IP packets.</p><p id="p-0054" num="0053">The predetermined value may be 0.7, for example, and by setting the predetermined value to 0.7, a plurality of pieces of data that have a state quantity with a relatively high correlation can be extracted from a group of data that is output from an obtaining unit <b>201</b>. In order to improve the estimation accuracy, it is preferable that the predetermined value is set to 0.9. More preferably, the predetermined value is set to 0.97. The correlation coefficient can be calculated for example using the expression:</p><p id="p-0055" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?>correlation coefficient=covariance of the value of the first data included in the plurality of pieces of data and the value of the second data that is other than the first data included in the plurality of pieces of data/(standard variation of the value of the first data&#xd7;standard variation of the value of the second data)<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0056" num="0000">By setting the absolute values of the correlation coefficients to a predetermined value or more, pieces of data that have a state quantity with a relatively high positive or negative correlation can be extracted. When the second data has a negative correlation with the first data, the correlation coefficient has a negative value. By multiplying &#x2212;1 by this value, the value can be used as second data having a positive correlation.</p><p id="p-0057" num="0054">The drawings in the present embodiment show an exemplary correlation between eight identifiers. In other words, in <figref idref="DRAWINGS">FIGS. <b>3</b> and <b>4</b></figref>, when the identifiers are CAN-IDs, a correlation between messages (data) with the CAN-IDs of <b>100</b>, <b>110</b>, <b>120</b>, <b>130</b>, <b>140</b>, <b>150</b>, <b>160</b>, and <b>170</b> is illustrated. As shown in <figref idref="DRAWINGS">FIG. <b>3</b></figref>, a message of any identifier has a correlation with the messages of other identifiers. In other words, messages with the plurality of identifiers have a correlation with each other so that these messages are linked via other messages.</p><p id="p-0058" num="0055">For example, the identifier with the CAN-ID of <b>170</b> has a correlation in which links are formed via other messages of at least two routes, namely, a route that returns to the same identifier (<b>170</b>) via <b>160</b>, and <b>140</b>, and a route that returns to the same identifier (<b>170</b>) via <b>120</b>, <b>150</b>, and <b>110</b>. Accordingly, if any of the identifiers is subjected to an attack, using the relation with the other identifiers linked via the plurality of routes, it is possible to determine for which identifier the data is invalid data, and to specify any invalid identifiers.</p><p id="p-0059" num="0056"><figref idref="DRAWINGS">FIG. <b>4</b></figref> shows combinations of correlations between the plurality of identifiers in a table format (combination table <b>211</b>). Note that, in <figref idref="DRAWINGS">FIG. <b>4</b></figref>, comments regarding whether the data with these identifiers (first identifiers or second identifier) included in these combinations is valid are given for each combination. Those comments will be described later.</p><p id="p-0060" num="0057">The combination table <b>211</b> includes the items &#x201c;combination No.&#x201d;, &#x201c;plurality of first identifiers&#x201d;, and &#x201c;second identifier&#x201d;, as the content items (meta data). Management numbers for specifying the combinations are stored in the item (field) called &#x201c;combination No.&#x201d;. In the present embodiment, as an example, the eight identifiers (<b>100</b>, <b>110</b>, <b>120</b>, <b>130</b>, <b>140</b>, <b>150</b>, <b>160</b>, <b>170</b> and <b>180</b>) constitute the eight combinations (No. 1 to No. 8) in the combination table <b>211</b>. Thus, the number of combinations may be the same as the number of identifiers of the data to be determined. The identifiers (second identifiers) of the data to be compared with determination data (described later) are stored in the item (field) called &#x201c;second identifier&#x201d;. The identifiers (first identifiers) of the data which has a correlation with the data of the second identifiers are stored in the item (field) called &#x201c;first identifier&#x201d;. The data including the first identifiers is data used to derive determination data to be compared with the data of the second identifier.</p><p id="p-0061" num="0058">As described above, a message with any identifier has a correlation with messages with other identifiers, and as illustrated in the combination table <b>211</b>, all identifiers are each included in at least two combinations. For example, the identifier with the CAN-ID of <b>100</b> is included in the combination No. 1 as the second identifier, and included in the combinations 1, 2, and 7 as the first identifier. In other words, the combinations of the identifiers are each constituted by a dataset formed by a plurality of identifiers respectively indicating a plurality of pieces of first data and a single identifier of second data. On that basis, the combinations are configured so that the same identifier is redundantly included in at least two combinations.</p><p id="p-0062" num="0059">The combination table <b>211</b> may also further include the absolute values of the correlation coefficients between the first identifiers and the second identifiers. The correlation coefficients or the absolute values of the correlation coefficients between the corresponding first identifiers and the second identifiers are stored in the item (field) called &#x201c;absolute value of correlation coefficient&#x201d;.</p><p id="p-0063" num="0060">Although the present embodiment describes that the identifier for identifying the data is a message identifier given by the CAN-ID, there is no limitation to this. If the communication protocol used by the vehicle-mounted ECUs <b>3</b> and the determination device <b>2</b> is TCP/IP, for example, the identifier for identifying the data may also be the transmission source address, the transmission destination address or the port number that are included in the IP packet, or a combination of any of these.</p><p id="p-0064" num="0061"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is a functional block diagram illustrating functional units included in the control unit <b>20</b> of the determination device <b>2</b>. By executing the control program stored in the storage unit <b>21</b>, the control unit <b>20</b> of the vehicle-mounted determination device <b>2</b> functions as the obtaining unit <b>201</b>, an output unit <b>202</b>, and a relay processing unit <b>203</b>. Further, by executing the control program stored in the storage unit <b>21</b>, the control unit <b>20</b> of the vehicle-mounted determination device <b>2</b> functions as a data classification unit <b>204</b>, a determination data deriving unit <b>205</b>, a comparison unit <b>206</b>, a specification unit <b>207</b>, and a determination unit <b>208</b>, determines whether the obtained data is valid, and specifies valid identifiers and invalid identifiers in the identifiers included in the data.</p><p id="p-0065" num="0062">The obtaining unit <b>201</b> obtains a plurality of pieces of data such as messages and the like that are output (transmitted) from the vehicle-mounted ECUs <b>3</b> via the in-vehicle communication unit <b>23</b>. The obtaining unit <b>201</b> outputs the obtained data to the relay processing unit <b>203</b> and the data classification unit <b>204</b>.</p><p id="p-0066" num="0063">By referencing the route information stored in the storage unit <b>21</b>, the relay processing unit <b>203</b> specifies the in-vehicle communication unit <b>23</b> that is the relay destination of the data, based on the CAN-ID included in data such as the obtained message and the like, or the transmission address, and outputs the data to the output unit <b>202</b>.</p><p id="p-0067" num="0064">The output unit <b>202</b> outputs the data that is output from the relay processing unit <b>203</b> via the in-vehicle communication unit <b>23</b> that is specified as the relay destination, and data relay processing is performed by the obtaining unit <b>201</b>, the relay processing unit <b>203</b>, and the output unit <b>202</b>.</p><p id="p-0068" num="0065">The data classification unit <b>204</b> obtains a plurality of pieces of data such as messages that are output (transmitted) from the vehicle-mounted ECUs <b>3</b> via the obtaining unit <b>201</b>. By referencing the combination table <b>211</b> stored in the storage unit <b>21</b>, the data classification unit <b>204</b> classifies the obtained pieces of data into data including the first identifiers (first data) and data including the second identifier (second data) for each combination, based on the first identifiers and second identifier included in each combination. As described above, the data classification unit <b>204</b> uses the CAN-IDs included in the CAN messages or the transmission addresses included in the IP packets as the identifiers (first or second identifiers), for example. In this manner, by using the CAN-IDs (CAN messages), transmission destination addresses (IP packets) or the like that are used in relay processing as the identifiers for identifying the data, identification of the data can be performed as processing accompanying relay processing, and an increase in processing load of the determination device <b>2</b> can be suppressed.</p><p id="p-0069" num="0066">The data classification unit <b>204</b> performs the classification (categorization) of the first data and the second data for each combination. In other words, the data classification unit <b>204</b> generates a data set constituted by a plurality of pieces of first data and the second data for each combination.</p><p id="p-0070" num="0067">The data classification unit <b>204</b> outputs the plurality of pieces of first data with the first identifiers included in a combination (one combination) to the determination data deriving unit <b>205</b>, and outputs the second data with the second identifier included in the combination (the one combination) to the comparison unit <b>206</b>. In other words, the data classification unit <b>204</b> sequentially or successively repeats processing times of the number of the plurality of combinations, in which the classification unit <b>204</b> outputs, to the determination data deriving unit <b>205</b>, the first data with the first identifiers included in the one combination, and outputs, to the comparison unit <b>206</b>, the second data with the second identifier included in the one combination.</p><p id="p-0071" num="0068">The determination data deriving unit <b>205</b> derives the determination data, based on the first data for each combination that is output from the data classification unit <b>204</b>. That is, by using a transformation function that outputs the determination data as an output value using each of the pieces of first data with the first identifiers (<b>120</b>, <b>130</b>, <b>140</b>) included in the combination No. 1 as an input value, the determination data deriving unit <b>205</b> derives the determination data corresponding to the second data including the second identifier (<b>100</b>) included in the combination No. 1. Alternatively, the determination data deriving unit <b>205</b> may also be constituted by a learning model such as a DNN (deep neural network) that has been trained to output the determination data in response to input of a plurality of pieces of first data, for example. The determination data deriving unit <b>205</b> may also include a learning model such as the DNN, and derive the determination data by inputting a plurality of pieces of first data to the learning model and obtaining the determination data output from the learning model. In this manner, the first data with the first identifier and the second data with the second identifier that are correlated with each other are in a correspondence relationship with respect to the determination data. When the second identifier is a protected CAN-ID to be protected from an attack, the first identifier corresponds to an associated CAN-ID that is associated with the second identifier in assuming the data with the second identifier. The determination data deriving unit <b>205</b> outputs the derived determination data to the comparison unit <b>206</b>.</p><p id="p-0072" num="0069">The comparison unit <b>206</b> compares the determination data obtained from the determination data deriving unit <b>205</b> with the second data that is output from the data classification unit <b>204</b>, for all the combinations. The comparison unit <b>206</b> outputs, to the specification unit <b>207</b>, information regarding the difference, such as whether the determination data matches the second data, or whether the difference between the determination data and the second data is within a predetermined value, as the comparison result.</p><p id="p-0073" num="0070">If the difference between the determination data and the second data is within a predetermined value, such as in the case where the determination data matches the second data, the specification unit <b>207</b> determines that the plurality of pieces of first data, that are the source data of the determination data, and the second data are valid (normal) data, and specifies the combination including the first identifiers of the first data and the second identifier of the second data as a valid combination. A predetermined value is a threshold for determining that the determination data and the second data have substantially the same value with respect to the accuracy of determination processing performed by the determination device <b>2</b>, when comparing the determination data with the second data.</p><p id="p-0074" num="0071">If the difference between the determination data and the second data is greater than a predetermined value, such as in the case where the determination data and the second data do not match, the specification unit <b>207</b> determines that the plurality of pieces of first data that are source data of the determination data, and the second data are invalid (abnormal) data, and specifies the combination including the first identifiers of the first data and the second identifier of the second data as an invalid combination. The specification unit <b>207</b> outputs, to the determination unit <b>208</b>, the specification result for each combination, that is, the result of specifying whether each of the combinations is a valid combination or an invalid combination.</p><p id="p-0075" num="0072">The determination unit <b>208</b> obtains the specification result for each of the combinations that are output from the specification unit <b>207</b>. By referencing the combination table <b>211</b>, the determination unit <b>208</b> obtains the information regarding the first identifiers and the second identifier included in each of the combinations. The determination unit <b>208</b> determines that the first identifiers and the second identifier included in the valid combination are valid (normal) identifiers and the data including the identifiers is valid (normal) data.</p><p id="p-0076" num="0073">As illustrated in <figref idref="DRAWINGS">FIG. <b>3</b></figref> of the present embodiment, for example, if data of the identifiers <b>100</b> and <b>140</b> have been subjected to an attack and have become invalid data, the difference between the determination data and the second data falls within a predetermined value in the combination No. 6 that does not include the identifiers (<b>100</b>, <b>140</b>) of the invalid data. In other words, the data with the first identifiers (<b>120</b>, <b>130</b>) and the second identifier (<b>150</b>) included in the combination No. 6 are determined to be valid (normal) data.</p><p id="p-0077" num="0074">In contrast, in the other combinations (No. 1, 2, 3, 4, 5, 7, and 8) that include the identifiers <b>100</b> and <b>140</b> as the first identifier or the second identifier, the difference between the determination data and the second data is greater than a predetermined value, and the data with the first identifier and the second identifier are determined to be invalid (abnormal) data. As described above, these other combinations are specified as invalid combinations.</p><p id="p-0078" num="0075">Regarding the first identifiers and the second identifiers included in the invalid combinations, if, as a result of excluding the identifiers already determined as valid (normal) as the first identifiers and the second identifier included in the valid combination, a single identifier remains, the determination unit <b>208</b> determines (specifies) that the remaining identifier as an invalid identifier. In the present embodiment, for example, regarding the first identifiers (<b>120</b>, <b>140</b>) and the second identifier (<b>130</b>) included in the combination No. 4, the identifiers <b>120</b> and <b>130</b> are identifiers that are also included in combination No. 6 that is a valid combination, and have already been determined as valid (normal) identifiers. Accordingly the identifier <b>140</b> corresponds to the remaining single identifier as a result of excluding the identifiers determined as valid (normal). In other words, due to the identifier <b>140</b> being invalid, the difference between the determination data and the second data with the second identifier in the combination No. 4 is not within a predetermined value, and thus the combination No. 4 is specified as an invalid combination.</p><p id="p-0079" num="0076">If, as a result of excluding the identifiers already determined as valid (normal) from the invalid combinations, a single identifier remains, the determination unit <b>208</b> determines that the remaining identifier is an invalid identifier and that the data including the invalid identifier is invalid data. In this manner, the determination unit <b>208</b> can efficiently determine whether the first data or the second data of identifiers included in the invalid combinations is invalid, based on the plurality of identifiers included in the valid combinations.</p><p id="p-0080" num="0077">The determination unit <b>208</b> performs loop processing by outputting, to the determination data deriving unit <b>205</b>, information regarding the invalid combinations and the identifiers determined as invalid. In other words, the information regarding the invalid combinations and the identifiers determined as invalid is returned from the determination unit <b>208</b> to the determination data deriving unit <b>205</b>, and processing for deriving the determination data is performed again by the determination data deriving unit <b>205</b>.</p><p id="p-0081" num="0078">The determination data deriving unit <b>205</b> obtains the information regarding the invalid combinations and the identifiers determined as invalid that is output from the determination unit <b>208</b>. The determination data deriving unit <b>205</b> derives, for each invalid combination, the determination data based on the first data that includes the first identifiers excluding the identifiers already determined as invalid from the plurality of first identifiers of the invalid combination.</p><p id="p-0082" num="0079">In the present embodiment, for example, in the first identifiers (<b>110</b>, <b>140</b>) included in the combination No. 8, the identifier <b>140</b> has been already determined as an invalid identifier, and the determination data deriving unit <b>205</b> derives the determination data based on the first identifiers excluding the invalid identifier (<b>140</b>). In this manner, on the basis of the first data with the first identifiers excluding the identifier already determined as invalid, it is possible to derive the determination data for which the difference from the second data with the second identifier is likely to fall within a predetermined value.</p><p id="p-0083" num="0080">The comparison unit <b>206</b>, the specification unit <b>207</b> and the determination unit <b>208</b> perform the same processing as the previous processing, based on the determination data that is derived again by the determination data deriving unit <b>205</b>, and determine whether the first identifiers excluding the identifier determined as invalid and the second identifier are valid, for each invalid combination. The comparison unit <b>206</b> compares the determination data derived based on the first identifiers excluding the identifier determined as invalid with the second data with the second identifier, and outputs, to the determination unit <b>208</b>, information regarding the difference, such as whether the difference between the determination data and the second data with the second identifier is within a predetermined value, as the comparison result.</p><p id="p-0084" num="0081">If the difference between the determination data and the second data with the second identifier is within a predetermined value, such as in the case where the determination data derived based on the first identifiers excluding the identifier determined as invalid matches the second data with the second identifier, the determination unit <b>208</b> determines that the first identifiers excluding the identifier determined as invalid and the second identifier are valid identifiers, and the data including the valid identifiers is valid data. By recursively repeating such determination processing in this manner, the determination unit <b>208</b> continues to add the identifiers determined as valid, and can increase the number of the valid identifiers, that is, the reliable identifiers. When the identifiers determined as valid are excluded again from the invalid combination and a single identifier remains, the determination unit <b>208</b> determines that the remaining identifier is an invalid identifier, and the data including the invalid identifier is invalid data. By repeating this processing on the data with all the identifiers included in the plurality of combinations, the determination unit <b>208</b> and the like determine, for all the identifiers, whether the identifiers are valid.</p><p id="p-0085" num="0082">The determination unit <b>208</b> outputs information regarding the results of determination of the identifiers to the display device <b>5</b>. By outputting the information regarding the results of determination to the display device <b>5</b>, the determination device <b>208</b> can notify the fact that the data with any identifier has been subjected to an attack and becomes invalid (abnormal), to the operator of the vehicle C, for example. The determination unit <b>208</b> outputs, to the relay processing unit <b>203</b>, information regarding any identifiers determined as invalid, or a signal (relay prohibiting signal) for prohibiting relay of data with an identifier determined as invalid. By outputting the relay prohibiting signal or the like to the relay processing unit <b>203</b>, the determination unit <b>208</b> can prohibit relay of the data with an identifier that has been subjected to an attack and become invalid (abnormal), and perform defensive processing against invalid data.</p><p id="p-0086" num="0083">In the above description, the data classification unit <b>204</b>, the determination data deriving unit <b>205</b>, the comparison unit <b>206</b>, the specification unit <b>207</b>, and the determination unit <b>208</b> are functional units in the control unit <b>20</b> of the determination device <b>2</b>, but there is no limitation to this. Part of these functional units may also be configured as one functional unit of a cloud server, such as the external server S<b>1</b> connected to the determination device <b>2</b> so that they can communicate with each other or a vehicle computer mounted in the vehicle C, and the determination device <b>2</b> may also cooperate with the external server S<b>1</b>, the vehicle computer or the like, to perform a series of processing performed by these functional units.</p><p id="p-0087" num="0084"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is a flowchart illustrating processing performed by the control unit <b>20</b> of the determination device <b>2</b>. The control unit <b>20</b> of the determination device <b>2</b> constantly performs the following processing in an activated state (when the IG switch is ON) or a stopped state (when the IG switch is OFF) of a vehicle CC.</p><p id="p-0088" num="0085">The control unit <b>20</b> of the determination device <b>2</b> obtains a plurality of pieces of data (first data and second data) transmitted from the vehicle-mounted ECUs <b>3</b> (S<b>101</b>). The control unit <b>20</b> obtains the plurality of pieces of data transmitted from the vehicle-mounted ECUs <b>3</b>. The data obtained by the control unit <b>20</b> is data classified as first data with a first identifier or second data with a second identifier included in individual combinations, in accordance with a plurality of combinations of the identifiers. Accordingly, the data obtained by the control unit <b>20</b> includes the first data and the second data of various combination.</p><p id="p-0089" num="0086">The control unit <b>20</b> of the determination device <b>2</b> obtains information regarding a plurality of combinations of the identifiers for specifying the first data and the second data (S<b>102</b>). The control unit <b>20</b> references the storage unit <b>21</b> and obtains information regarding the plurality of combinations stored in the storage unit <b>21</b>. The information regarding the plurality of combinations is stored in a predetermined storage area which can be accessed by the control unit <b>20</b> of the determination device <b>2</b>, such as the storage unit <b>21</b> of the external server S<b>1</b>, and the control unit <b>20</b> may also obtain the information regarding the plurality of combinations from the external server S<b>1</b> by communicating with the external server S<b>1</b> via the external communication device <b>1</b>.</p><p id="p-0090" num="0087">The control unit <b>20</b> of the determination device <b>2</b> derives the determination data corresponding to the second data for each combination, based on the first data in each combination (S<b>103</b>). The control unit <b>20</b> derives the determination data based on the first data with the first identifiers included in each combination of the plurality of combinations. The control unit <b>20</b> extracts the identifiers such as the CAN-IDs or the like included in the obtained data, and specifies, as the first data, the data for which the extracted identifier is the same as the first identifier included in the combination. The control unit <b>20</b> extracts the identifiers such as the CAN-IDs or the like included in the obtained data, and specifies, as the second data, the data for which the extracted identifier is the same as the second identifier included in the combination.</p><p id="p-0091" num="0088">Since the combinations each include the plurality of first identifiers, the control unit <b>20</b> specifies the plurality of pieces of first data based on the plurality of first identifiers. The control unit <b>20</b> inputs the specified plurality of pieces of first data to a transform function or the like, for example, and derives the determination data corresponding to the second data. The control unit <b>20</b> derives the determination data corresponding to the second data for each of the combinations.</p><p id="p-0092" num="0089">The control unit <b>20</b> of the determination device <b>2</b> determines whether the difference between the second data and the determination data is within a predetermined value, for each of the combinations (S<b>104</b>). The control unit <b>20</b> determines whether the second data matches the determination data, or whether the difference between the second data and the determination data is within a predetermined value, for each of the combinations. A predetermined value is a threshold for determining that the determination data and the second data have substantially the same value with respect to the accuracy of determination processing performed by the determination device <b>2</b> when comparing the determination data with the second data. Alternatively, the control unit <b>20</b> may also use the degree of coincidence (matching degree) of the determination data and the second data as the reference, and if the degree of coincidence is a predetermined value or more, the control unit <b>20</b> may determine that the determination data and the second data have substantially the same value.</p><p id="p-0093" num="0090">If the difference is a predetermined value or less (S<b>104</b>: YES), the control unit <b>20</b> of the determination device <b>2</b> specifies a valid combination that includes the identifiers of the valid first data and second data (S<b>105</b>). If the difference is a predetermined value or less, the control unit <b>20</b> specifies, as the valid combination, the first identifiers that indicate the plurality of pieces of first data, that are the source data of the determination data, and the second identifier that indicates the second data. In other words, it is determined that the first identifiers and the second identifier included in the valid combination are valid identifiers and the data including the valid identifiers is valid data.</p><p id="p-0094" num="0091">If the difference is not a predetermined value or less (S<b>104</b>: NO), that is, if the difference is greater than the predetermined value, the control unit <b>20</b> of the determination device <b>2</b> specifies the invalid combination including the identifier of the invalid first data or second data (S<b>1051</b>). If the difference is greater than the predetermined value, the control unit <b>20</b> specifies, as the invalid combination, the combination including the first identifiers that indicate the plurality of pieces of first data, that are the source data of the determination data, and the second identifier that indicates the second data. In other words, it is determined that the first identifier or the second identifier included in the invalid combination is invalid identifiers, and the data including the invalid identifier is invalid data.</p><p id="p-0095" num="0092">The control unit <b>20</b> of the determination device <b>2</b> extracts the identifiers of the first data or the second data that are determined as valid or invalid (S<b>106</b>). The control unit <b>20</b> determines (specifies) that the identifiers indicating the first data and the second data included in the valid combination are valid identifiers, and extract the identifiers. If a single identifier remains as a result of excluding the identifiers already determined as normal from the identifiers indicating the first data and the second data included in the invalid combination, the control unit <b>20</b> determines (specifies) the remaining identifier as the invalid identifier, and extracts the identifier. Accordingly the control unit <b>20</b> can determine the identifier of the first data or the second data that is included in the specified invalid combination, based on the plurality of identifiers included in the valid combination, and extracts the identifier.</p><p id="p-0096" num="0093">The control unit <b>20</b> of the determination device <b>2</b> derives the determination data based on the first data excluding the identifier of the data determined as invalid in the other invalid combination from the identifiers of the plurality of pieces of first data included in the invalid combination (S<b>107</b>). The control unit <b>20</b> again derives the determination data, based on the data that include the first identifiers excluding the identifier already determined as invalid from the first identifiers of the invalid combinations, for each invalid combination. Based on the first identifiers excluding the identifier already determined as invalid, the control unit <b>20</b> can derive the determination data for which the difference from the data with the second identifier is likely within a predetermined value.</p><p id="p-0097" num="0094">The control unit <b>20</b> of the determination device <b>2</b> determines whether the difference between the second data included in the invalid combination and the derived determination data is within a predetermined value (S<b>108</b>). Similarly to the above processing of S<b>104</b>, the control unit <b>20</b> compares the second data included in the invalid combination with the determination data derived based on the data of the first identifiers excluding the identifier already determines as invalid, and determines whether the difference between the second data and the determination data is within a predetermined value.</p><p id="p-0098" num="0095">If the difference is a predetermined value or smaller (S<b>108</b>: YES), the control unit <b>20</b> of the determination device <b>2</b> determines that the identifiers of the first data and the second data are valid (S<b>109</b>). For each invalid combination, the control unit <b>20</b> determines that the first identifiers excluding the identifier already determined as invalid and the second identifier are valid identifiers, and the data including the valid identifiers is valid data. By recursively repeating such determination processing, the control unit <b>20</b> can continue to add the identifiers determined as valid and increase the number of the valid identifiers, in other words, the reliable identifiers.</p><p id="p-0099" num="0096">If the difference is not a predetermined value or smaller (S<b>108</b>:NO), in other words, if the difference is greater than the predetermined value, the control unit <b>20</b> of the determination device <b>2</b> determines that the identifiers of the first data and the second data are invalid (S<b>1091</b>). For each invalid combination, the control unit <b>20</b> determines that any of the first identifiers excluding the identifier already determined as invalid and the second identifier is an invalid identifier, and the data with the invalid identifier is invalid data.</p><p id="p-0100" num="0097">The control unit <b>20</b> of the determination device <b>2</b> determines whether all the identifiers have been determined (S<b>110</b>). The control unit <b>20</b> stores, in the storage unit <b>21</b>, the results of determination of the validity of the data of all the identifiers included in the combinations, and determines whether all the identifiers have been determined by referencing the results of determination.</p><p id="p-0101" num="0098">If all the identifiers have not been determined (S<b>110</b>: NO), the control unit performs loop processing from S<b>107</b> to S<b>110</b> by executing the processing from S<b>107</b> again. By recursively repeating such determination processing of S<b>107</b>, S<b>108</b> and so on, the control unit <b>20</b> can continue to add the identifiers determined as valid and increase the number of the valid identifiers, in other words, the reliable identifiers. If a single identifier remains as a result of excluding the identifiers determined as valid from each invalid combination, the control unit <b>20</b> determines that the remaining identifier is an invalid identifier, and thus can reliably specify the invalid identifier and increase the number of the specified invalid identifiers.</p><p id="p-0102" num="0099">If all the identifiers have been determined (S<b>110</b>: YES), the control unit <b>20</b> outputs the results of determination to the display device <b>5</b> or the like (S<b>111</b>). By outputting the information regarding the results of determination the display device <b>5</b> or the like, in the plurality of identifiers correlated with each other, for example, whether the individual identifier is valid, or the fact that the data with any identifier has been subjected to an attack and become invalid (abnormal) can be notified to the operator of the vehicle C. The control unit <b>20</b> may also output, to the relay processing unit <b>203</b>, a signal (relay prohibiting signal) for prohibiting relay of data of the identifier determined as invalid. By outputting the relay prohibiting signal or the like to the relay processing unit <b>203</b>, it is possible to prohibit relay of data of the identifier that has been subjected to an attack and become invalid (abnormal) and perform defensive processing against the attack using the invalid data.</p><p id="p-0103" num="0100">According to the present embodiment, the determination device <b>2</b> determines which of the first data or the second data of the identifier included in the invalid combination is invalid, based on the first data with the first identifiers and the second data with the second identifier included in the specified invalid combination, and the first data of the first identifiers and the second data of the second identifier included in the specified valid combination. Accordingly, in the pieces of data including the plurality of identifiers correlated with each other, even if any data has been subjected to an attack, the identifier of the data that has become invalid due to the attack can be specified.</p><p id="p-0104" num="0101">According to the present embodiment, each combination is constituted by a dataset formed by the plurality of first identifiers respectively indicating the plurality of pieces of first data and the second identifier indicating a single second data, and the same identifier is redundantly included in two or more combinations. The combinations can be linked and correlated with each other based on any identifier, and determination of the first identifiers and the second identifier included in the other combinations can be efficiently performed, using the first identifiers or the second identifier of the second data included in the combination determined as a valid combination.</p><p id="p-0105" num="0102">According to the present embodiment, in the first identifiers included in any one of the invalid combinations, the determination data is derived again based on the first data with the first identifiers excluding the identifier determined as invalid in the other invalid combinations. Then, the determination device <b>2</b> repeatedly execute processing for determining whether the first identifiers excluding the identifier of the data determined as invalid and the second identifier are valid, based on the difference between the derived determination data and the second data with the second identifier included in that invalid combination. Accordingly determination of whether all the identifiers included in each of the combinations are valid can be efficiently performed, and the identifier that is invalid can be specified from among the plurality of identifiers that are correlated with each other.</p><p id="p-0106" num="0103">It should be appreciated that the embodiments disclosed herein are to be construed in all respects as illustrative and not limiting. The scope of the present disclosure is defined by the claims, rather than by the description preceding them, and is intended to include all modifications which fall within the scope of the claims and the meaning and scope of equivalents thereof.</p><?detailed-description description="Detailed Description" end="tail"?></description><claims id="claims"><claim id="CLM-00001" num="00001"><claim-text><b>1</b>. A determination device that is mounted in a vehicle and connected to a plurality of vehicle-mounted ECUs so that they can communicate with the determination device, the determination device comprising:<claim-text>a control unit configured to perform control regarding determination of whether data transmitted from the plurality of vehicle-mounted ECUs is valid,</claim-text><claim-text>wherein the data includes first data and second data, and</claim-text><claim-text>the control unit is configured to:<claim-text>obtain a plurality of pieces of the first data and the second data that are transmitted from the plurality of vehicle-mounted ECUs;</claim-text><claim-text>derives determination data based on the first data; and</claim-text><claim-text>specify, from among a plurality of combinations of identifiers for identifying the first data and identifiers for identifying the second data, valid combinations including identifiers of valid first data and second data and invalid combinations including identifiers of invalid first data or second data, based on the second data and the determination data, and</claim-text><claim-text>determine, based on the plurality of identifiers included in the specified invalid combinations and the plurality of identifiers included in the valid combinations, whether the first data or the second data of any identifier included in the specified invalid combinations is invalid.</claim-text></claim-text></claim-text></claim><claim id="CLM-00002" num="00002"><claim-text><b>2</b>. The determination device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein each of the plurality of combinations includes a plurality of identifiers for respectively identifying a plurality of pieces of the first data and an identifier of the second data, and<claim-text>the same identifier is redundantly included in two or more of the combinations.</claim-text></claim-text></claim><claim id="CLM-00003" num="00003"><claim-text><b>3</b>. The determination device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein, if a difference between determination data derived based on first data with an identifier included in one of the plurality of combinations and second data with an identifier included in that one combination is within a predetermined value, then the control unit specifies that the one combination is a valid combination.</claim-text></claim><claim id="CLM-00004" num="00004"><claim-text><b>4</b>. The determination device according to <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein, if a difference between determination data derived based on the first data with an identifier included in one of the plurality of combinations and the second data with an identifier included in that one combination is greater than a predetermined value, the control unit specifies that the one combination is an invalid combination.</claim-text></claim><claim id="CLM-00005" num="00005"><claim-text><b>5</b>. The determination device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein, from among the identifiers included in the invalid combination, the control unit determines that the first data or the second data with an identifier that is different from the identifier included in the valid determination combination is invalid data.</claim-text></claim><claim id="CLM-00006" num="00006"><claim-text><b>6</b>. The determination device according to <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein, in identifiers of the plurality of first data included in the invalid combinations, the control unit is configured to:<claim-text>derive the determination data based on the first data with identifiers excluding any identifier of data determined as invalid in another invalid combination, and</claim-text><claim-text>determine whether the first data and the second data included in the invalid combination is valid, based on the determination data and the second data with an identifier included in the invalid combination.</claim-text></claim-text></claim><claim id="CLM-00007" num="00007"><claim-text><b>7</b>. The determination device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein information regarding a plurality of combinations is stored in a predetermined storage area which is accessible from the determination device, and<claim-text>the control unit obtains the information regarding the plurality of combinations by referencing the predetermined storage area.</claim-text></claim-text></claim><claim id="CLM-00008" num="00008"><claim-text><b>8</b>. The determination device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the first data and the second data corresponding to the identifiers constituting the combination are correlated with each other, and<claim-text>an absolute value of a correlation coefficient of the first data and the second data is at least 0.7.</claim-text></claim-text></claim><claim id="CLM-00009" num="00009"><claim-text><b>9</b>. A determination program for causing a computer to execute processing for:<claim-text>obtaining a plurality of pieces of the first data and the second data that are transmitted from the plurality of vehicle-mounted ECUs;</claim-text><claim-text>deriving determination data based on the first data;</claim-text><claim-text>obtaining information regarding a plurality of combination of identifiers for identifying the first data and second data;</claim-text><claim-text>specifying, from among a plurality of combinations, valid combinations including identifiers of valid first data and second data and invalid combinations including identifiers of invalid first data or second data, based on the obtained second data and the determination data, and</claim-text><claim-text>determining, based on the plurality of identifiers included in the specified invalid combinations and the plurality of identifiers included in the valid combinations, whether the first data or the second data of any identifier included in the specified invalid combinations is invalid.</claim-text></claim-text></claim><claim id="CLM-00010" num="00010"><claim-text><b>10</b>. A determination method for causing a computer to execute processing for:<claim-text>obtaining a plurality of pieces of the first data and the second data that are transmitted from the plurality of vehicle-mounted ECUs;</claim-text><claim-text>deriving determination data based on the first data;</claim-text><claim-text>obtaining information regarding a plurality of combination of identifiers for identifying the first data and second data;</claim-text><claim-text>specifying, from among a plurality of combinations, valid combinations including identifiers of valid first data and second data and invalid combinations including identifiers of invalid first data or second data, based on the obtained second data and the determination data, and</claim-text><claim-text>determining, based on the plurality of identifiers included in the specified invalid combination and the plurality of identifiers included in the valid combinations, whether the first data or the second data of any identifier included in the specified invalid combinations is invalid.</claim-text></claim-text></claim></claims></us-patent-application>