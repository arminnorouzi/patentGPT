<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230007269A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230007269</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17899248</doc-number><date>20220830</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>N</subclass><main-group>19</main-group><subgroup>137</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>N</subclass><main-group>19</main-group><subgroup>105</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>N</subclass><main-group>19</main-group><subgroup>132</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>N</subclass><main-group>19</main-group><subgroup>159</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>N</subclass><main-group>19</main-group><subgroup>176</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>N</subclass><main-group>19</main-group><subgroup>186</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>N</subclass><main-group>19</main-group><subgroup>46</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20141101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>N</subclass><main-group>19</main-group><subgroup>137</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc><further-cpc><classification-cpc><cpc-version-indicator><date>20141101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>N</subclass><main-group>19</main-group><subgroup>105</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20141101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>N</subclass><main-group>19</main-group><subgroup>132</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20141101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>N</subclass><main-group>19</main-group><subgroup>159</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20141101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>N</subclass><main-group>19</main-group><subgroup>176</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20141101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>N</subclass><main-group>19</main-group><subgroup>186</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20141101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>N</subclass><main-group>19</main-group><subgroup>46</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></further-cpc></classifications-cpc><invention-title id="d2e43">DMVR-BASED INTER PREDICTION METHOD AND APPARATUS</invention-title><us-related-documents><continuation><relation><parent-doc><document-id><country>US</country><doc-number>17478605</doc-number><date>20210917</date></document-id><parent-grant-document><document-id><country>US</country><doc-number>11470328</doc-number></document-id></parent-grant-document></parent-doc><child-doc><document-id><country>US</country><doc-number>17899248</doc-number></document-id></child-doc></relation></continuation><continuation><relation><parent-doc><document-id><country>US</country><doc-number>PCT/KR2020/001863</doc-number><date>20200211</date></document-id><parent-status>PENDING</parent-status></parent-doc><child-doc><document-id><country>US</country><doc-number>17478605</doc-number></document-id></child-doc></relation></continuation><us-provisional-application><document-id><country>US</country><doc-number>62822729</doc-number><date>20190322</date></document-id></us-provisional-application></us-related-documents><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>LG Electronics Inc.</orgname><address><city>Seoul</city><country>KR</country></address></addressbook><residence><country>KR</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>PARK</last-name><first-name>Naeri</first-name><address><city>Seoul</city><country>KR</country></address></addressbook></inventor><inventor sequence="01" designation="us-only"><addressbook><last-name>NAM</last-name><first-name>Junghak</first-name><address><city>Seoul</city><country>KR</country></address></addressbook></inventor><inventor sequence="02" designation="us-only"><addressbook><last-name>JANG</last-name><first-name>Hyeongmoon</first-name><address><city>Seoul</city><country>KR</country></address></addressbook></inventor></inventors></us-parties></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">A video decoding method comprises: deriving L0 and L1 motion vectors of a current block; deriving decoder-side motion vector refinement (DMVR) flag information indicating whether to apply a DMVR to the current block; when the DMVR flag information indicates that the DMVR is to be applied to the current block, deriving refined L0 and L1 motion vectors based on the L0 and L1 motion vectors by applying the DMVR to the current block; deriving prediction samples of the current block based on the refined L0 and L1 motion vectors; and generating reconstructed samples of the current block based on the predicted samples, wherein deriving DMVR flag information comprises deriving the DMVR flag information by applying the DMVR to the current block when the height of the current block is 8 or more, and when the values of L0 and L1 luma weighted prediction flag information are both 0.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="75.10mm" wi="95.50mm" file="US20230007269A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="124.54mm" wi="97.54mm" file="US20230007269A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="197.61mm" wi="136.23mm" orientation="landscape" file="US20230007269A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="192.79mm" wi="130.81mm" orientation="landscape" file="US20230007269A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="167.47mm" wi="137.92mm" orientation="landscape" file="US20230007269A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00005" num="00005"><img id="EMI-D00005" he="165.86mm" wi="111.00mm" orientation="landscape" file="US20230007269A1-20230105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00006" num="00006"><img id="EMI-D00006" he="172.55mm" wi="130.05mm" orientation="landscape" file="US20230007269A1-20230105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00007" num="00007"><img id="EMI-D00007" he="172.55mm" wi="131.83mm" orientation="landscape" file="US20230007269A1-20230105-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00008" num="00008"><img id="EMI-D00008" he="172.55mm" wi="131.91mm" orientation="landscape" file="US20230007269A1-20230105-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00009" num="00009"><img id="EMI-D00009" he="143.26mm" wi="115.15mm" file="US20230007269A1-20230105-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00010" num="00010"><img id="EMI-D00010" he="185.93mm" wi="126.41mm" file="US20230007269A1-20230105-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00011" num="00011"><img id="EMI-D00011" he="166.62mm" wi="126.41mm" file="US20230007269A1-20230105-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00012" num="00012"><img id="EMI-D00012" he="173.99mm" wi="153.08mm" orientation="landscape" file="US20230007269A1-20230105-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00013" num="00013"><img id="EMI-D00013" he="206.42mm" wi="153.75mm" orientation="landscape" file="US20230007269A1-20230105-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00014" num="00014"><img id="EMI-D00014" he="173.99mm" wi="159.85mm" orientation="landscape" file="US20230007269A1-20230105-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00015" num="00015"><img id="EMI-D00015" he="193.89mm" wi="158.58mm" orientation="landscape" file="US20230007269A1-20230105-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00016" num="00016"><img id="EMI-D00016" he="198.37mm" wi="154.52mm" orientation="landscape" file="US20230007269A1-20230105-D00016.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00017" num="00017"><img id="EMI-D00017" he="189.57mm" wi="125.98mm" orientation="landscape" file="US20230007269A1-20230105-D00017.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00018" num="00018"><img id="EMI-D00018" he="139.36mm" wi="119.55mm" file="US20230007269A1-20230105-D00018.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="lead"?><heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATIONS</heading><p id="p-0002" num="0001">This application is a continuation of U.S. application Ser. No. 17/478,605, filed on Sep. 17, 2021, which is a continuation Pursuant to 35 U.S.C. &#xa7; 119(e) of International Application PCT/KR2020/001863, with an international filing date of Feb. 11, 2020, which claims the benefit of U.S. Provisional Patent Application No. 62/822,729, filed on Mar. 22, 2019, the contents of which are hereby incorporated by reference herein in their entirety.</p><?cross-reference-to-related-applications description="Cross Reference To Related Applications" end="tail"?><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0002" level="1">BACKGROUND OF THE DISCLOSURE</heading><heading id="h-0003" level="1">Field of the Disclosure</heading><p id="p-0003" num="0002">This document relates to an image coding technology, and more specifically, to a method and an apparatus for performing inter prediction based on a Decoder-side Motion Vector Refinement (DMVR).</p><heading id="h-0004" level="1">Related Art</heading><p id="p-0004" num="0003">131 The demands for high-resolution and high-quality images and video, such as an ultra-high definition (UHD) image and video of 4K or 8K or more, are recently increasing in various fields. As image and video data become high resolution and high quality, the amount of information or the number of bits that is relatively transmitted is increased compared to the existing image and video data. Accordingly, if image data is transmitted using a medium, such as the existing wired or wireless wideband line, or image and video data are stored using the existing storage medium, transmission costs and storage costs are increased.</p><p id="p-0005" num="0004">Furthermore, interests and demands for immersive media, such as virtual reality (VR), artificial reality (AR) content or a hologram, are recently increasing. The broadcasting of an image and video having image characteristics different from those of real images, such as game images, is increasing.</p><p id="p-0006" num="0005">Accordingly, there is a need for a high-efficiency image and video compression technology in order to effectively compress and transmit or store and playback information of high-resolution and high-quality images and video having such various characteristics.</p><heading id="h-0005" level="1">SUMMARY</heading><p id="p-0007" num="0006">This document provides a method and an apparatus for increasing image coding efficiency.</p><p id="p-0008" num="0007">This document also provides a method and an apparatus of an efficient inter prediction.</p><p id="p-0009" num="0008">This document also provides a method and an apparatus for performing an inter prediction based on a decoder-side motion Vector refinement (DMVR).</p><p id="p-0010" num="0009">This document also provides a method and an apparatus for performing an inter prediction based on a bi-directional optical flow (BDOF).</p><p id="p-0011" num="0010">This document also provides a method and an apparatus for enhancing prediction performance by providing a condition for determining whether to apply a DMVR for enhancing image coding efficiency and/or a condition for determining whether to apply a BDOF.</p><p id="p-0012" num="0011">According to one exemplary embodiment of this document, an image decoding method performed by a decoding apparatus is provided. The method includes: deriving an L0 motion vector and an L1 motion vector of a current block; deriving decoder-side motion vector refinement (DMVR) flag information indicating whether to apply DMVR to the current block; deriving a refined L0 motion vector and a refined L1 motion vector based on the L0 motion vector and the L1 motion vector by applying the DMVR to the current block, when the DMVR flag information indicates that the DMVR is applied to the current block; deriving prediction samples for the current block based on the refined L0 motion vector and the refined L1 motion vector; and generating reconstructed samples for the current block based on the prediction samples, wherein in the deriving of the DMVR flag information, when a height of the current block is equal to or larger than 8, and when a value of L0 luma weight prediction flag information and a value of L1 luma weight prediction flag information are both equal to 0, the DMVR flag information is derived to apply the DMVR to the current block, wherein w % ben the value of L0 luma weight prediction flag information is equal to 0, it represents that a weight factor for a luma component of an L0 prediction is not present, and wherein when the value of L1 luma weight prediction flag information is equal to 0, it represents that a weight factor for a luma component of an L1 prediction is not present.</p><p id="p-0013" num="0012">According to another exemplary embodiment of this document, an image encoding method performed by an encoding apparatus is provided. The method includes: deriving an L0 motion vector and an L1 motion vector of a current block; deriving decoder-side motion vector refinement (DMVR) flag information indicating whether to apply DMVR to the current block; deriving a refined L0 motion vector and a refined L1 motion vector based on the L0 motion vector and the L1 motion vector by applying the DMVR to the current block, when the DMVR flag information indicates that the DMVR is applied to the current block; deriving prediction samples for the current block based on the refined L0 motion vector and the refined L1 motion vector; deriving residual samples based on the prediction samples; and encoding image information including information on the residual samples, wherein in the deriving of the DMVR flag information, when a height of the current block is equal to or larger than 8, and when a value of L0 luma weight prediction flag information and a value of L1 luma weight prediction flag information are both equal to 0, the DMVR flag information is derived to apply the DMVR to the current block, wherein when the value of L0 luma weight prediction flag information is equal to 0, it represents that a weight factor for a luma component of an L0 prediction is not present, and wherein when the value of L luma weight prediction flag information is equal to 0, it represents that a weight factor for a luma component of an L1 prediction is not present.</p><p id="p-0014" num="0013">According to this document, overall image/video compression efficiency can be increased.</p><p id="p-0015" num="0014">According to this document, calculation complexity can be reduced and overall coding efficiency can be enhanced through an efficient inter prediction.</p><p id="p-0016" num="0015">According to this document, various application conditions are proposed in applying a DMVR and/or BDOF of refining motion information during a motion compensation process to enhance efficiency in terms of complexity and performance.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0006" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. <b>1</b></figref> schematically illustrates an example of a video/image coding system that is applicable to embodiments of this document.</p><p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a diagram schematically explaining the configuration of a video/image encoding apparatus that is applicable to embodiments of this document.</p><p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. <b>3</b></figref> is a diagram schematically explaining the configuration of a video/image decoding apparatus that is applicable to embodiments of this document.</p><p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. <b>4</b></figref> is a diagram explaining an embodiment of a process of performing decoder-side motion vector refinement (DMVR) in a true bi-prediction.</p><p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is a diagram explaining an embodiment of a process of performing decoder-side motion vector refinement (DMVR) using a sum of absolute differences (SAD).</p><p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. <b>6</b></figref> illustrates an example representing a method for performing a decoding process through checking of application conditions of DMVR and BDOF.</p><p id="p-0023" num="0022"><figref idref="DRAWINGS">FIGS. <b>7</b> and <b>8</b></figref> illustrate another example representing a method for performing a decoding process through checking of application conditions of DMVR and BDOF.</p><p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. <b>9</b></figref> is a diagram illustrated to explain the concept of BDOF.</p><p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. <b>10</b></figref> is a flowchart schematically illustrating an encoding method that can be performed by an encoding apparatus according to an embodiment of this document.</p><p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. <b>11</b></figref> is a flowchart schematically illustrating a decoding method that can be performed by a decoding apparatus according to an embodiment of this document.</p><p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. <b>12</b></figref> illustrates an example of a content streaming system to which embodiments disclosed in this document are applicable.</p><p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. <b>13</b></figref> is a diagram schematically illustrating one example of a service system including a digital device.</p><p id="p-0029" num="0028"><figref idref="DRAWINGS">FIG. <b>14</b></figref> is a block diagram illustrated for describing one embodiment of a digital device.</p><p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. <b>15</b></figref> is a block diagram illustrated for describing another embodiment of a digital device.</p><p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. <b>16</b></figref> is a block diagram illustrating another embodiment of a digital device.</p><p id="p-0032" num="0031"><figref idref="DRAWINGS">FIG. <b>17</b></figref> is a block diagram illustrating an embodiment of a specific configuration of the controller of <figref idref="DRAWINGS">FIG. <b>14</b></figref> to <figref idref="DRAWINGS">FIG. <b>16</b></figref>.</p><p id="p-0033" num="0032"><figref idref="DRAWINGS">FIG. <b>18</b></figref> illustrates an example in which a screen of a digital device simultaneously displays a main image and a sub-image according to an embodiment.</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><heading id="h-0007" level="1">DESCRIPTION OF EXEMPLARY EMBODIMENTS</heading><p id="p-0034" num="0033">This document may be modified in various ways and may have various embodiments, and specific embodiments will be illustrated in the drawings and described in detail. However, this does not intend to limit this document to the specific embodiments. Terms commonly used in this specification are used to describe a specific embodiment and is not used to limit the technical spirit of this document. An expression of the singular number includes plural expressions unless evidently expressed otherwise in the context. A term, such as &#x201c;include&#x201d; or &#x201c;have&#x201d; in this specification, should be understood to indicate the existence of a characteristic, number, step, operation, element, part, or a combination of them described in the specification and not to exclude the existence or the possibility of the addition of one or more other characteristics, numbers, steps, operations, elements, parts or a combination of them.</p><p id="p-0035" num="0034">Meanwhile, elements in the drawings described in this document are independently illustrated for convenience of description related to different characteristic functions. This does not mean that each of the elements is implemented as separate hardware or separate software. For example, at least two of elements may be combined to form a single element, or a single element may be divided into a plurality of elements. An embodiment in which elements are combined and/or separated is also included in the scope of rights of this document unless it deviates from the essence of this document.</p><p id="p-0036" num="0035">Hereinafter, preferred embodiments of this document are described more specifically with reference to the accompanying drawings. Hereinafter, in the drawings, the same reference numeral is used in the same element, and a redundant description of the same element may be omitted.</p><p id="p-0037" num="0036"><figref idref="DRAWINGS">FIG. <b>1</b></figref> schematically illustrates an example of a video/image coding system to which embodiments of this document may be applied.</p><p id="p-0038" num="0037">Referring to <figref idref="DRAWINGS">FIG. <b>1</b></figref>, a video/image coding system may include a first device (source device) and a second device (receiving device). The source device may deliver encoded video/image information or data in the form of a file or streaming to the receiving device via a digital storage medium or network.</p><p id="p-0039" num="0038">The source device may include a video source, an encoding apparatus, and a transmitter. The receiving device may include a receiver, a decoding apparatus, and a renderer. The encoding apparatus may be called a video/image encoding apparatus, and the decoding apparatus may be called a video/image decoding apparatus. The transmitter may be included in the encoding apparatus. The receiver may be included in the decoding apparatus. The renderer may include a display, and the display may be configured as a separate device or an external component.</p><p id="p-0040" num="0039">The video source may acquire video/image through a process of capturing, synthesizing, or generating the video/image. The video source may include a video/image capture device and/or a video/image generating device. The video/image capture device may include, for example, one or more cameras, video/image archives including previously captured video/images, and the like. The video/image generating device may include, for example, computers, tablets and smartphones, and may (electronically) generate video/images. For example, a virtual video/image may be generated through a computer or the like. In this case, the video/image capturing process may be replaced by a process of generating related data.</p><p id="p-0041" num="0040">The encoding apparatus may encode input video/image. The encoding apparatus may perform a series of procedures such as prediction, transform, and quantization for compression and coding efficiency. The encoded data (encoded video/image information) may be output in the form of a bitstream.</p><p id="p-0042" num="0041">The transmitter may transmit the encoded image/image information or data output in the form of a bitstream to the receiver of the receiving device through a digital storage medium or a network in the form of a file or streaming. The digital storage medium may include various storage mediums such as USB, SD, CD, DVD, Blu-ray, HDD, SSD, and the like. The transmitter may include an element for generating a media file through a predetermined file format and may include an element for transmission through a broadcast/communication network. The receiver may receive/extract the bitstream and transmit the received bitstream to the decoding apparatus.</p><p id="p-0043" num="0042">The decoding apparatus may decode the video/image by performing a series of procedures such as dequantization, inverse transform, and prediction corresponding to the operation of the encoding apparatus.</p><p id="p-0044" num="0043">The renderer may render the decoded video/image. The rendered video/image may be displayed through the display.</p><p id="p-0045" num="0044">This document relates to video/image coding. For example, the methods/embodiments disclosed in this document may be applied to a method disclosed in the versatile video coding (VVC), the EVC (essential video coding) standard, the AOMedia Video 1 (AV1) standard, the 2nd generation of audio video coding standard (AVS2), or the next generation video/image coding standard (ex. H.267 or H.268, etc.).</p><p id="p-0046" num="0045">This document presents various embodiments of video/image coding, and the embodiments may be performed in combination with each other unless otherwise mentioned.</p><p id="p-0047" num="0046">In this document, video may refer to a series of images over time. Picture generally refers to a unit representing one image in a specific time zone, and a slice/tile is a unit constituting part of a picture in coding. The slice/tile may include one or more coding tree units (CTUs). One picture may consist of one or more slices/tiles. One picture may consist of one or more tile groups. One tile group may include one or more tiles. A brick may represent a rectangular region of CTU rows within a tile in a picture. A tile may be partitioned into multiple bricks, each of which consisting of one or more CTU rows within the tile. A tile that is not partitioned into multiple bricks may be also referred to as a brick. A brick scan is a specific sequential ordering of CTUs partitioning a picture in which the CTUs are ordered consecutively in CTU raster scan in a brick, bricks within a tile are ordered consecutively in a raster scan of the bricks of the tile, and tiles in a picture are ordered consecutively in a raster scan of the tiles of the picture. A tile is a rectangular region of CTUs within a particular tile column and a particular tile row in a picture. The tile column is a rectangular region of CTUs having a height equal to the height of the picture and a width specified by syntax elements in the picture parameter set. The tile row is a rectangular region of CTUs having a height specified by syntax elements in the picture parameter set and a width equal to the width of the picture. A tile scan is a specific sequential ordering of CTUs partitioning a picture in which the CTUs are ordered consecutively in CTU raster scan in a tile whereas tiles in a picture are ordered consecutively in a raster scan of the tiles of the picture. A slice includes an integer number of bricks of a picture that may be exclusively contained in a single NAL unit. A slice may consists of either a number of complete tiles or only a consecutive sequence of complete bricks of one tile. Tile groups and slices may be used interchangeably in this document. For example, in this document, a tile group/tile group header may be called a slice/slice header.</p><p id="p-0048" num="0047">A pixel or a pel may mean a smallest unit constituting one picture (or image). Also, &#x2018;sample&#x2019; may be used as a term corresponding to a pixel. A sample may generally represent a pixel or a value of a pixel, and may represent only a pixel/pixel value of a luma component or only a pixel/pixel value of a chroma component.</p><p id="p-0049" num="0048">A unit may represent a basic unit of image processing. The unit may include at least one of a specific region of the picture and information related to the region. One unit may include one luma block and two chroma (ex. cb, cr) blocks. The unit may be used interchangeably with terms such as block or area in some cases. In a general case, an M&#xd7;N block may include samples (or sample arrays) or a set (or array) of transform coefficients of M columns and N rows.</p><p id="p-0050" num="0049">In this document, the term &#x201c;/&#x201d; and &#x201c;,&#x201d; should be interpreted to indicate &#x201c;and/or.&#x201d; For instance, the expression &#x201c;A/B&#x201d; may mean &#x201c;A and/or B.&#x201d; Further, &#x201c;A, B&#x201d; may mean &#x201c;A and/or B.&#x201d; Further, &#x201c;A/B/C&#x201d; may mean &#x201c;at least one of A, B, and/or C.&#x201d; Also, &#x201c;A, B, C&#x201d; may mean &#x201c;at least one of A, B, and/or C.&#x201d;</p><p id="p-0051" num="0050">Further, in the document, the term &#x201c;or&#x201d; should be interpreted to indicate &#x201c;and/or.&#x201d; For instance, the expression &#x201c;A or B&#x201d; may comprise 1) only A, 2) only B, and/or 3) both A and B. In other words, the term &#x201c;or&#x201d; in this document should be interpreted to indicate &#x201c;additionally or alternatively.&#x201d;</p><p id="p-0052" num="0051"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a schematic diagram illustrating a configuration of a video/image encoding apparatus to which the embodiment(s) of the present document may be applied. Hereinafter, the video encoding apparatus may include an image encoding apparatus.</p><p id="p-0053" num="0052">Referring to <figref idref="DRAWINGS">FIG. <b>2</b></figref>, the encoding apparatus <b>200</b> includes an image partitioner <b>210</b>, a predictor <b>220</b>, a residual processor <b>230</b>, and an entropy encoder <b>240</b>, an adder <b>250</b>, a filter <b>260</b>, and a memory <b>270</b>. The predictor <b>220</b> may include an inter predictor <b>221</b> and an intra predictor <b>222</b>. The residual processor <b>230</b> may include a transformer <b>232</b>, a quantizer <b>233</b>, a dequantizer <b>234</b>, and an inverse transformer <b>235</b>. The residual processor <b>230</b> may further include a subtractor <b>231</b>. The adder <b>250</b> may be called a reconstructor or a reconstructed block generator. The image partitioner <b>210</b>, the predictor <b>220</b>, the residual processor <b>230</b>, the entropy encoder <b>240</b>, the adder <b>250</b>, and the filter <b>260</b> may be configured by at least one hardware component (ex. an encoder chipset or processor) according to an embodiment. In addition, the memory <b>270</b> may include a decoded picture buffer (DPB) or may be configured by a digital storage medium. The hardware component may further include the memory <b>270</b> as an internal/external component.</p><p id="p-0054" num="0053">The image partitioner <b>210</b> may partition an input image (or a picture or a frame) input to the encoding apparatus <b>200</b> into one or more processors. For example, the processor may be called a coding unit (CU). In this case, the coding unit may be recursively partitioned according to a quad-tree binary-tree ternary-tree (QTBTTT) structure from a coding tree unit (CTU) or a largest coding unit (LCU). For example, one coding unit may be partitioned into a plurality of coding units of a deeper depth based on a quad tree structure, a binary tree structure, and/or a ternary structure. In this case, for example, the quad tree structure may be applied first and the binary tree structure and/or ternary structure may be applied later. Alternatively, the binary tree structure may be applied first. The coding procedure according to this document may be performed based on the final coding unit that is no longer partitioned. In this case, the largest coding unit may be used as the final coding unit based on coding efficiency according to image characteristics, or if necessary, the coding unit may be recursively partitioned into coding units of deeper depth and a coding unit having an optimal size may be used as the final coding unit. Here, the coding procedure may include a procedure of prediction, transform, and reconstruction, which will be described later. As another example, the processor may further include a prediction unit (PU) or a transform unit (TU). In this case, the prediction unit and the transform unit may be split or partitioned from the aforementioned final coding unit. The prediction unit may be a unit of sample prediction, and the transform unit may be a unit for deriving a transform coefficient and/or a unit for deriving a residual signal from the transform coefficient.</p><p id="p-0055" num="0054">The unit may be used interchangeably with terms such as block or area in some cases. In a general case, an M&#xd7;N block may represent a set of samples or transform coefficients composed of M columns and N rows. A sample may generally represent a pixel or a value of a pixel, may represent only a pixel/pixel value of a luma component or represent only a pixel/pixel value of a chroma component. A sample may be used as a term corresponding to one picture (or image) for a pixel or a pel.</p><p id="p-0056" num="0055">In the encoding apparatus <b>200</b>, a prediction signal (predicted block, prediction sample array) output from the inter predictor <b>221</b> or the intra predictor <b>222</b> is subtracted from an input image signal (original block, original sample array) to generate a residual signal residual block, residual sample array), and the generated residual signal is transmitted to the transformer <b>232</b>. In this case, as shown, a unit for subtracting a prediction signal (predicted block, prediction sample array) from the input image signal (original block, original sample array) in the encoder <b>200</b> may be called a subtractor <b>231</b>. The predictor may perform prediction on a block to be processed (hereinafter, referred to as a current block) and generate a predicted block including prediction samples for the current block. The predictor may determine whether intra prediction or inter prediction is applied on a current block or CU basis. As described later in the description of each prediction mode, the predictor may generate various information related to prediction, such as prediction mode information, and transmit the generated information to the entropy encoder <b>240</b>. The information on the prediction may be encoded in the entropy encoder <b>240</b> and output in the form of a bitstream.</p><p id="p-0057" num="0056">The intra predictor <b>222</b> may predict the current block by referring to the samples in the current picture. The referred samples may be located in the neighborhood of the current block or may be located apart according to the prediction mode. In the intra prediction, prediction modes may include a plurality of non-directional modes and a plurality of directional modes. The non-directional mode may include, for example, a DC mode and a planar mode. The directional mode may include, for example, 33 directional prediction modes or 65 directional prediction modes according to the degree of detail of the prediction direction. However, this is merely an example, more or less directional prediction modes may be used depending on a setting. The intra predictor <b>222</b> may determine the prediction mode applied to the current block by using a prediction mode applied to a neighboring block.</p><p id="p-0058" num="0057">The inter predictor <b>221</b> may derive a predicted block for the current block based on a reference block (reference sample array) specified by a motion vector on a reference picture. Here, in order to reduce the amount of motion information transmitted in the inter prediction mode, the motion information may be predicted in units of blocks, subblocks, or samples based on correlation of motion information between the neighboring block and the current block. The motion information may include a motion vector and a reference picture index. The motion information may further include inter prediction direction (L0 prediction, L1 prediction, Bi prediction, etc.) information. In the case of inter prediction, the neighboring block may include a spatial neighboring block present in the current picture and a temporal neighboring block present in the reference picture. The reference picture including the reference block and the reference picture including the temporal neighboring block may be the same or different. The temporal neighboring block may be called a collocated reference block, a co-located CU (colCU), and the like, and the reference picture including the temporal neighboring block may be called a collocated picture (colPic). For example, the inter predictor <b>221</b> may configure a motion information candidate list based on neighboring blocks and generate information indicating which candidate is used to derive a motion vector and/or a reference picture index of the current block. Inter prediction may be performed based on various prediction modes. For example, in the case of a skip mode and a merge mode, the inter predictor <b>221</b> may use motion information of the neighboring block as motion information of the current block. In the skip mode, unlike the merge mode, the residual signal may not be transmitted. In the case of the motion vector prediction (MVP) mode, the motion vector of the neighboring block may be used as a motion vector predictor and the motion vector of the current block may be indicated by signaling a motion vector difference.</p><p id="p-0059" num="0058">The predictor <b>220</b> may generate a prediction signal based on various prediction methods described below. For example, the predictor may not only apply intra prediction or inter prediction to predict one block but also simultaneously apply both intra prediction and inter prediction. This may be called combined inter and intra prediction (CIIP). In addition, the predictor may be based on an intra block copy (IBC) prediction mode or a palette mode for prediction of a block. The IBC prediction mode or palette mode may be used for content image/video coding of a game or the like, for example, screen content coding (SCC). The IBC basically performs prediction in the current picture but may be performed similarly to inter prediction in that a reference block is derived in the current picture. That is, the IBC may use at least one of the inter prediction techniques described in this document. The palette mode may be considered as an example of intra coding or intra prediction. When the palette mode is applied, a sample value within a picture may be signaled based on information on the palette table and the palette index.</p><p id="p-0060" num="0059">The prediction signal generated by the predictor (including the inter predictor <b>221</b> and/or the intra predictor <b>222</b>) may be used to generate a reconstructed signal or to generate a residual signal. The transformer <b>232</b> may generate transform coefficients by applying a transform technique to the residual signal. For example, the transform technique may include at least one of a discrete cosine transform (DCT), a discrete sine transform (DST), a karhunen-love transform (KLT), a graph-based transform (GBT), or a conditionally non-linear transform (CNT). Here, the GBT means transform obtained from a graph when relationship information between pixels is represented by the graph. The CNT refers to transform generated based on a prediction signal generated using all previously reconstructed pixels. In addition, the transform process may be applied to square pixel blocks having the same size or may be applied to blocks having a variable size rather than square.</p><p id="p-0061" num="0060">The quantizer <b>233</b> may quantize the transform coefficients and transmit them to the entropy encoder <b>240</b> and the entropy encoder <b>240</b> may encode the quantized signal (information on the quantized transform coefficients) and output a bitstream. The information on the quantized transform coefficients may be referred to as residual information. The quantizer <b>233</b> may rearrange block type quantized transform coefficients into a one-dimensional vector form based on a coefficient scanning order and generate information on the quantized transform coefficients based on the quantized transform coefficients in the one-dimensional vector form. Information on transform coefficients may be generated. The entropy encoder <b>240</b> may perform various encoding methods such as, for example, exponential Golomb, context-adaptive variable length coding (CAVLC), context-adaptive binary arithmetic coding (CABAC), and the like. The entropy encoder <b>240</b> may encode information necessary for video/image reconstruction other than quantized transform coefficients (ex. values of syntax elements, etc.) together or separately. Encoded information (ex. encoded video/image information) may be transmitted or stored in units of NALs (network abstraction layer) in the form of a bitstream. The video/image information may further include information on various parameter sets such as an adaptation parameter set (APS), a picture parameter set (PPS), a sequence parameter set (SPS), or a video parameter set (VPS). In addition, the video/image information may further include general constraint information. In this document, information and/or syntax elements transmitted/signaled from the encoding apparatus to the decoding apparatus may be included in video/picture information. The video/image information may be encoded through the above-described encoding procedure and included in the bitstream. The bitstream may be transmitted over a network or may be stored in a digital storage medium. The network may include a broadcasting network and/or a communication network, and the digital storage medium may include various storage media such as USB, SD, CD, DVD, Blu-ray, HDD, SSD, and the like. A transmitter (not shown) transmitting a signal output from the entropy encoder <b>240</b> and/or a storage unit (not shown) storing the signal may be included as internal/external element of the encoding apparatus <b>200</b>, and alternatively, the transmitter may be included in the entropy encoder <b>240</b>.</p><p id="p-0062" num="0061">The quantized transform coefficients output from the quantizer <b>233</b> may be used to generate a prediction signal. For example, the residual signal (residual block or residual samples) may be reconstructed by applying dequantization and inverse transform to the quantized transform coefficients through the dequantizer <b>234</b> and the inverse transformer <b>235</b>. The adder <b>250</b> adds the reconstructed residual signal to the prediction signal output from the inter predictor <b>221</b> or the intra predictor <b>222</b> to generate a reconstructed signal (reconstructed picture, reconstructed block, reconstructed sample array). If there is no residual for the block to be processed, such as a case where the skip mode is applied, the predicted block may be used as the reconstructed block. The adder <b>250</b> may be called a reconstructor or a reconstructed block generator. The generated reconstructed signal may be used for intra prediction of a next block to be processed in the current picture and may be used for inter prediction of a next picture through filtering as described below.</p><p id="p-0063" num="0062">Meanwhile, luma mapping with chroma scaling (LMCS) may be applied during picture encoding and/or reconstruction.</p><p id="p-0064" num="0063">The filter <b>260</b> may improve subjective/objective image quality by applying filtering to the reconstructed signal. For example, the filter <b>260</b> may generate a modified reconstructed picture by applying various filtering methods to the reconstructed picture and store the modified reconstructed picture in the memory <b>270</b>, specifically, a DPB of the memory <b>270</b>. The various filtering methods may include, for example, deblocking filtering, a sample adaptive offset, an adaptive loop filter, a bilateral filter, and the like. The filter <b>260</b> may generate various information related to the filtering and transmit the generated information to the entropy encoder <b>240</b> as described later in the description of each filtering method. The information related to the filtering may be encoded by the entropy encoder <b>240</b> and output in the form of a bitstream.</p><p id="p-0065" num="0064">The modified reconstructed picture transmitted to the memory <b>270</b> may be used as the reference picture in the inter predictor <b>221</b>. When the inter prediction is applied through the encoding apparatus, prediction mismatch between the encoding apparatus <b>200</b> and the decoding apparatus may be avoided and encoding efficiency may be improved.</p><p id="p-0066" num="0065">The DPB of the memory <b>270</b> DPB may store the modified reconstructed picture for use as a reference picture in the inter predictor <b>221</b>. The memory <b>270</b> may store the motion information of the block from which the motion information in the current picture is derived (or encoded) and/or the motion information of the blocks in the picture that have already been reconstructed. The stored motion information may be transmitted to the inter predictor <b>221</b> and used as the motion information of the spatial neighboring block or the motion information of the temporal neighboring block. The memory <b>270</b> may store reconstructed samples of reconstructed blocks in the current picture and may transfer the reconstructed samples to the intra predictor <b>222</b>.</p><p id="p-0067" num="0066"><figref idref="DRAWINGS">FIG. <b>3</b></figref> is a schematic diagram illustrating a configuration of a video/image decoding apparatus to which the embodiment(s) of the present document may be applied.</p><p id="p-0068" num="0067">Referring to <figref idref="DRAWINGS">FIG. <b>3</b></figref>, the decoding apparatus <b>300</b> may include an entropy decoder <b>310</b>, a residual processor <b>320</b>, a predictor <b>330</b>, an adder <b>340</b>, a filter <b>350</b>, a memory <b>360</b>. The predictor <b>330</b> may include an inter predictor <b>331</b> and an intra predictor <b>332</b>. The residual processor <b>320</b> may include a dequantizer <b>321</b> and an inverse transformer <b>321</b>. The entropy decoder <b>310</b>, the residual processor <b>320</b>, the predictor <b>330</b>, the adder <b>340</b>, and the filter <b>350</b> may be configured by a hardware component (ex, a decoder chipset or a processor) according to an embodiment. In addition, the memory <b>360</b> may include a decoded picture buffer (DPB) or may be configured by a digital storage medium. The hardware component may further include the memory <b>360</b> as an internal/external component.</p><p id="p-0069" num="0068">When a bitstream including video/image information is input, the decoding apparatus <b>300</b> may reconstruct an image corresponding to a process in which the video/image information is processed in the encoding apparatus of <figref idref="DRAWINGS">FIG. <b>2</b></figref>. For example, the decoding apparatus <b>300</b> may derive units/blocks based on block partition related information obtained from the bitstream. The decoding apparatus <b>300</b> may perform decoding using a processor applied in the encoding apparatus. Thus, the processor of decoding may be a coding unit, for example, and the coding unit may be partitioned according to a quad tree structure, binary tree structure and/or ternary tree structure from the coding tree unit or the largest coding unit. One or more transform units may be derived from the coding unit. The reconstructed image signal decoded and output through the decoding apparatus <b>300</b> may be reproduced through a reproducing apparatus.</p><p id="p-0070" num="0069">The decoding apparatus <b>300</b> may receive a signal output from the encoding apparatus of <figref idref="DRAWINGS">FIG. <b>2</b></figref> in the form of a bitstream, and the received signal may be decoded through the entropy decoder <b>310</b>. For example, the entropy decoder <b>310</b> may parse the bitstream to derive information (ex. video/image information) necessary for image reconstruction (or picture reconstruction). The video/image information may further include information on various parameter sets such as an adaptation parameter set (APS), a picture parameter set (PPS), a sequence parameter set (SPS), or a video parameter set (VPS). In addition, the video/image information may further include general constraint information. The decoding apparatus may further decode picture based on the information on the parameter set and/or the general constraint information. Signaled/received information and/or syntax elements described later in this document may be decoded may decode the decoding procedure and obtained from the bitstream. For example, the entropy decoder <b>310</b> decodes the information in the bitstream based on a coding method such as exponential Golomb coding, CAVLC, or CABAC, and output syntax elements required for image reconstruction and quantized values of transform coefficients for residual. More specifically, the CABAC entropy decoding method may receive a bin corresponding to each syntax element in the bitstream, determine a context model using a decoding target syntax element information, decoding information of a decoding target block or information of a symbol/bin decoded in a previous stage, and perform an arithmetic decoding on the bin by predicting a probability of occurrence of a bin according to the determined context model, and generate a symbol corresponding to the value of each syntax element. In this case, the CABAC entropy decoding method may update the context model by using the information of the decoded symbol/bin for a context model of a next symbol/bin after determining the context model. The information related to the prediction among the information decoded by the entropy decoder <b>310</b> may be provided to the predictor (the inter predictor <b>332</b> and the intra predictor <b>331</b>), and the residual value on which the entropy decoding was performed in the entropy decoder <b>310</b>, that is, the quantized transform coefficients and related parameter information, may be input to the residual processor <b>320</b>. The residual processor <b>320</b> may derive the residual signal (the residual block, the residual samples, the residual sample array). In addition, information on filtering among information decoded by the entropy decoder <b>310</b> may be provided to the filter <b>350</b>. Meanwhile, a receiver (not shown) for receiving a signal output from the encoding apparatus may be further configured as an internal/external element of the decoding apparatus <b>300</b>, or the receiver may be a component of the entropy decoder <b>310</b>. Meanwhile, the decoding apparatus according to this document may be referred to as a video/image/picture decoding apparatus, and the decoding apparatus may be classified into an information decoder (video/image/picture information decoder) and a sample decoder (video/image/picture sample decoder). The information decoder may include the entropy decoder <b>310</b>, and the sample decoder may include at least one of the dequantizer <b>321</b>, the inverse transformer <b>322</b>, the adder <b>340</b>, the filter <b>350</b>, the memory <b>360</b>, the inter predictor <b>332</b>, and the intra predictor <b>331</b>.</p><p id="p-0071" num="0070">The dequantizer <b>321</b> may dequantize the quantized transform coefficients and output the transform coefficients. The dequantizer <b>321</b> may rearrange the quantized transform coefficients in the form of a two-dimensional block form. In this case, the rearrangement may be performed based on the coefficient scanning order performed in the encoding apparatus. The dequantizer <b>321</b> may perform dequantization on the quantized transform coefficients by using a quantization parameter (ex. quantization step size information) and obtain transform coefficients.</p><p id="p-0072" num="0071">The inverse transformer <b>322</b> inversely transforms the transform coefficients to obtain a residual signal (residual block, residual sample array).</p><p id="p-0073" num="0072">The predictor may perform prediction on the current block and generate a predicted block including prediction samples for the current block. The predictor may determine whether intra prediction or inter prediction is applied to the current block based on the information on the prediction output from the entropy decoder <b>310</b> and may determine a specific intra/inter prediction mode.</p><p id="p-0074" num="0073">The predictor <b>320</b> may generate a prediction signal based on various prediction methods described below. For example, the predictor may not only apply intra prediction or inter prediction to predict one block but also simultaneously apply intra prediction and inter prediction. This may be called combined inter and intra prediction (CIIP). In addition, the predictor may be based on an intra block copy (IBC) prediction mode or a palette mode for prediction of a block. The IBC prediction mode or palette mode may be used for content image/video coding of a game or the like, for example, screen content coding (SCC). The IBC basically performs prediction in the current picture but may be performed similarly to inter prediction in that a reference block is derived in the current picture. That is, the IBC may use at least one of the inter prediction techniques described in this document. The palette mode may be considered as an example of intra coding or intra prediction. When the palette mode is applied, a sample value within a picture may be signaled based on information on the palette table and the palette index.</p><p id="p-0075" num="0074">The intra predictor <b>331</b> may predict the current block by referring to the samples in the current picture. The referenced samples may be located in the neighborhood of the current block or may be located apart according to the prediction mode. In intra prediction, prediction modes may include a plurality of non-directional modes and a plurality of directional modes. The intra predictor <b>331</b> may determine the prediction mode applied to the current block by using the prediction mode applied to the neighboring block.</p><p id="p-0076" num="0075">The inter predictor <b>332</b> may derive a predicted block for the current block based on a reference block (reference sample array) specified by a motion vector on a reference picture. In this case, in order to reduce the amount of motion information transmitted in the inter prediction mode, motion information may be predicted in units of blocks, subblocks, or samples based on correlation of motion information between the neighboring block and the current block. The motion information may include a motion vector and a reference picture index. The motion information may further include inter prediction direction (L0 prediction, L1 prediction, Bi prediction, etc.) information. In the case of inter prediction, the neighboring block may include a spatial neighboring block present in the current picture and a temporal neighboring block present in the reference picture. For example, the inter predictor <b>332</b> may configure a motion information candidate list based on neighboring blocks and derive a motion vector of the current block and/or a reference picture index based on the received candidate selection information. Inter prediction may be performed based on various prediction modes, and the information on the prediction may include information indicating a mode of inter prediction for the current block.</p><p id="p-0077" num="0076">The adder <b>340</b> may generate a reconstructed signal (reconstructed picture, reconstructed block, reconstructed sample array) by adding the obtained residual signal to the prediction signal (predicted block, predicted sample array) output from the predictor (including the inter predictor <b>332</b> and/or the intra predictor <b>331</b>). If there is no residual for the block to be processed, such as when the skip mode is applied, the predicted block may be used as the reconstructed block.</p><p id="p-0078" num="0077">The adder <b>340</b> may be called reconstructor or a reconstructed block generator. The generated reconstructed signal may be used for intra prediction of a next block to be processed in the current picture, may be output through filtering as described below, or may be used for inter prediction of a next picture.</p><p id="p-0079" num="0078">Meanwhile, luma mapping with chroma scaling (LMCS) may be applied in the picture decoding process.</p><p id="p-0080" num="0079">The filter <b>350</b> may improve subjective/objective image quality by applying filtering to the reconstructed signal. For example, the filter <b>350</b> may generate a modified reconstructed picture by applying various filtering methods to the reconstructed picture and store the modified reconstructed picture in the memory <b>360</b>, specifically, a DPB of the memory <b>360</b>. The various filtering methods may include, for example, deblocking filtering, a sample adaptive offset, an adaptive loop filter, a bilateral filter, and the like.</p><p id="p-0081" num="0080">The (modified) reconstructed picture stored in the DPB of the memory <b>360</b> may be used as a reference picture in the inter predictor <b>332</b>. The memory <b>360</b> may store the motion information of the block from which the motion information in the current picture is derived (or decoded) and/or the motion information of the blocks in the picture that have already been reconstructed. The stored motion information may be transmitted to the inter predictor <b>260</b> so as to be utilized as the motion information of the spatial neighboring block or the motion information of the temporal neighboring block. The memory <b>360</b> may store reconstructed samples of reconstructed blocks in the current picture and transfer the reconstructed samples to the intra predictor <b>331</b>.</p><p id="p-0082" num="0081">In the present disclosure, the embodiments described in the filter <b>260</b>, the inter predictor <b>221</b>, and the intra predictor <b>222</b> of the encoding apparatus <b>200</b> may be the same as or respectively applied to correspond to the filter <b>350</b>, the inter predictor <b>332</b>, and the intra predictor <b>331</b> of the decoding apparatus <b>300</b>. The same may also apply to the unit <b>332</b> and the intra predictor <b>331</b>.</p><p id="p-0083" num="0082">As described above, in performing video coding, a prediction is performed to enhance compression efficiency. A predicted block including prediction samples for a current block, that is, a target coding block, can be generated through the prediction. In this case, the predicted block includes the prediction samples in a spatial domain (or pixel domain). The predicted block is identically derived in the encoding apparatus and the decoding apparatus. The encoding apparatus can enhance image coding efficiency by signaling, to the decoding apparatus, information on a residual (residual information) between the original block not an original sample value itself of the original block and the predicted block. The decoding apparatus may derive a residual block including residual samples based on the residual information, may generate a reconstructed including reconstructed samples by adding the residual block and the predicted block, and may generate a reconstructed picture including the reconstructed blocks.</p><p id="p-0084" num="0083">The residual information may be generated through a transform and quantization procedure. For example, the encoding apparatus may derive the residual block between the original block and the predicted block, may derive transform coefficients by performing a transform procedure on the residual samples (residual sample array) included in the residual block, may derive quantized transform coefficients by performing a quantization procedure on the transform coefficients, and may signal related residual information to the decoding apparatus (through a bitstream). In this case, the residual information may include information, such as value information, location information, transform scheme, transform kernel, and quantization parameter of the quantized transform coefficients. The decoding apparatus may perform a dequantization/inverse transform procedure based on the residual information, and may derive residual samples (or residual block). The decoding apparatus may generate a reconstructed picture based on the predicted block and the residual block. Furthermore, the encoding apparatus may derive a residual block by dequantizing/inverse-transforming the quantized transform coefficients for reference to the inter prediction of a subsequent picture, and may generate a reconstructed picture.</p><p id="p-0085" num="0084">Meanwhile, as described above, the intra prediction or inter prediction may be applied when performing the prediction on the current block. Hereinafter, a case of applying the inter prediction to the current block will be described.</p><p id="p-0086" num="0085">The predictor (more specifically, inter predictor) of the encoding/decoding apparatus may derive prediction samples by performing the inter prediction in units of the block. The inter prediction may represent prediction derived by a method dependent to the data elements (e.g., sample values or motion information) of a picture(s) other than the current picture. When the inter prediction is applied to the current block, a predicted block (prediction sample array) for the current block may be derived based on a reference block (reference sample array) specified by the motion vector on the reference picture indicated by the reference picture index. In this case, in order to reduce an amount of motion information transmitted in the inter-prediction mode, the motion information of the current block may be predicted in units of a block, a subblock, or a sample based on a correlation of the motion information between the neighboring block and the current block. The motion information may include the motion vector and the reference picture index. The motion information may further include inter-prediction type (L0 prediction, L1 prediction, Bi prediction, etc.) information. In the case of applying the inter prediction, the neighboring block may include a spatial neighboring block which is present in the current picture and a temporal neighboring block which is present in the reference picture. A reference picture including the reference block and a reference picture including the temporal neighboring block may be the same as each other or different from each other. The temporal neighboring block may be referred to as a name such as a collocated reference block, a collocated CU (colCU), etc., and the reference picture including the temporal neighboring block may be referred to as a collocated picture (colPic). For example, a motion information candidate list may be configured based on the neighboring blocks of the current block and a flag or index information indicating which candidate is selected (used) may be signaled in order to derive the motion vector and./or reference picture index of the current block. The inter prediction may be performed based on various prediction modes and for example, in the case of a skip mode and a merge mode, the motion information of the current block may be the same as the motion information of the selected neighboring block. In the case of the skip mode, the residual signal may not be transmitted unlike the merge mode. In the case of a motion vector prediction (MVP) mode, the motion vector of the selected neighboring block may be used as a motion vector predictor and a motion vector difference may be signaled. In this case, the motion vector of the current block may be derived by using a sum of the motion vector predictor and the motion vector difference.</p><p id="p-0087" num="0086">The motion information may further include L0 motion information and/or L1 motion information according to the inter-prediction type (L0 prediction, L1 prediction, Bi prediction, etc.). A L0-direction motion vector may be referred to as an L0 motion vector or MVL0 and an L1-direction motion vector may be referred to as an L1 motion vector or MVL1. A prediction based on the L0 motion vector may be referred to as an L0 prediction, a prediction based on the L1 motion vector may be referred to as an L1 prediction, and a prediction based on both the L0 motion vector and the L1 motion vector may be referred to as a bi-prediction. Here, the L0 motion vector may indicate a motion vector associated with a reference picture list L0 and the L1 motion vector may indicate a motion vector associated with a reference picture list L1. The reference picture list L0 may include pictures prior to the current picture in an output order and the reference picture list L1 may include pictures subsequent to the current picture in the output order, as the reference pictures. The prior pictures may be referred to as a forward (reference) picture and the subsequent pictures may be referred to as a reverse (reference) picture. The reference picture list L0 may further include the pictures subsequent to the current picture in the output order as the reference pictures. In this case, the prior pictures may be first indexed in the reference picture list L0 and the subsequent pictures may then be indexed. The reference picture list L1 may further include the pictures prior to the current picture in the output order as the reference pictures. In this case, the subsequent pictures may be first indexed in the reference picture list L1 and the prior pictures may then be indexed. Here, the output order may correspond to a picture order count (POC) order.</p><p id="p-0088" num="0087">Further, various inter prediction modes may be used in applying the inter prediction to the current block. For example, various modes including a merge mode, a skip mode, a motion vector prediction (MVP) mode, an affine mode, a historical motion vector prediction (HMVP) mode, and the like may be used. A decoder side motion vector refinement (DMVR) mode, an adaptive motion vector resolution (AMVR) mode, a bi-directional optical flow (BDOF) etc., may be further used as an ancillary mode. The affine mode may be referred to as an affine motion prediction mode. The MVP mode may be referred to as an advanced motion vector prediction (AMVP) mode. In the present disclosure, some modes and/or motion information candidates derived by some modes may be included in one of motion information related candidates of other modes.</p><p id="p-0089" num="0088">The prediction mode information indicating the inter prediction mode of the current block may be signaled from the encoding apparatus to the decoding apparatus. In this case, the prediction mode information may be included in the bitstream and received by the decoding apparatus. The prediction mode information may include index information indicating one of multiple candidate modes. Alternatively, the inter prediction mode may be indicated through a hierarchical signaling of flag information. In this case, the prediction mode information may include one or more flags. For example, whether to apply the skip mode may be indicated by signaling a skip flag, whether to apply the merge mode may be indicated by signaling a merge flag when the skip mode is not applied, and it is indicated that the MVP mode is applied or a flag for additional distinguishing may be further signaled when the merge mode is not applied. The affine mode may be signaled as an independent mode or signaled as a dependent mode on the merge mode or the MVP mode. For example, the affine mode may include an affine merge mode and an affine MVP mode.</p><p id="p-0090" num="0089">Further, the motion information of the current block may be used in applying the inter prediction to the current block. The encoding device may derive optimal motion information for the current block through a motion estimation procedure. For example, the encoding device may search a similar reference block having a high correlation in units of a fractional pixel within a predetermined search range in the reference picture by using an original block in an original picture for the current block and derive the motion information through the searched reference block. The similarity of the block may be derived based on a difference of phase based sample values. For example, the similarity of the block may be calculated based on a sum of absolute differences (SAD) between the current block (or a template of the current block) and the reference block (or the template of the reference block). In this case, the motion information may be derived based on a reference block having a smallest SAD in a search area. The derived motion information may be signaled to the decoding device according to various methods based on the inter prediction mode.</p><p id="p-0091" num="0090">A predicted block for the current block may be derived based on the motion information derived according to the inter prediction mode. The predicted block may include prediction samples (prediction sample array) of the current block. When the motion vector (MV) of the current block indicates a fractional sample unit, an interpolation procedure may be performed and the prediction samples of the current block may be derived based on reference samples of the fractional sample unit in the reference picture through the interpolation procedure. When the affine inter prediction is applied to the current block, the prediction samples may be generated based on a sample/subblock-unit MV When the bi-prediction is applied, prediction samples derived through a weighted sum or a weighted average of prediction samples derived based on the L0 prediction (i.e., a prediction using a reference picture in the reference picture list L0 and MVL0) and prediction samples (according to a phase) derived based on the L1 prediction (i.e., a prediction using a reference picture in the reference picture list L1 and MVL1) may be used as the prediction samples of the current block. When the bi-prediction is applied, if the reference picture used for the L0 prediction and the reference picture used for the L1 prediction are located in different temporal directions based on the current picture (i.e., if the prediction corresponds to the bi-prediction and the bi-directional prediction), this may be referred to as a true bi-prediction.</p><p id="p-0092" num="0091">Reconstruction samples and reconstruction pictures may be generated based on the derived prediction samples and thereafter, the procedure such as in-loop filtering, etc., may be performed as described above.</p><p id="p-0093" num="0092">Meanwhile, since the motion of the current block is predicted based on the motion vector of the neighboring block without a motion vector difference (MVD) in the skip mode and/or the merge mode, the skip mode and/or the merge mode shows a limitation in a motion prediction. In order to improve the limitation of the skip mode and/or the merge mode, the motion vector may be refined by applying a Decoder-side Motion Vector Refinement (DMVR) mode, a Bi-directional optical flow (BDOF) mode, etc. The DMVR and BDOF modes may be used when the true bi-prediction is applied to the current block.</p><p id="p-0094" num="0093"><figref idref="DRAWINGS">FIG. <b>4</b></figref> is a diagram for describing an embodiment of a process of performing a Decoder-side Motion Vector Refinement (DMVR) in a true pair prediction.</p><p id="p-0095" num="0094">The DMVR is a method in which the decoder performs the motion prediction by refining the motion information of the neighboring block. When the DMVR is applied, the decoder may derive the refined motion information through cost comparison based on a template generated by using the motion information of the neighboring block in the merge/skip mode. In this case, precision of the motion prediction may be increased and compression performance may be enhanced without additional signaling information.</p><p id="p-0096" num="0095">In the present disclosure, for convenience of description, the decoding apparatus is mainly described, but the DMVR according to the embodiment of the present disclosure may be performed in the same method even in the encoding apparatus. [%] Referring to <figref idref="DRAWINGS">FIG. <b>4</b></figref>, the decoding apparatus may derive prediction blocks (i.e., reference blocks) identified by list0 and list1-direction initial motion vectors (or motion information) (e.g., MV0 and MV1) and generate a template (or a bilateral template) by a weighted sum (e.g., averaging) of the derived prediction samples (step 1). Here, the initial motion vectors (MV0 and MV1) may represent motion vectors derived by using the motion information of the neighboring block in the merge/skip mode.</p><p id="p-0097" num="0096">In addition, the decoding apparatus may derive motion vectors (e.g., MV0&#x2032; and MV1&#x2032;) for minimizing a difference between the template and the sample area of the reference picture through a template matching operation (step 2). Here, the sample area may indicate a neighboring area of an initial prediction block in the reference picture and the sample area may be referred to as the neighboring area, a reference area, a search area, a search range, a search space, etc. The template matching operation may include an operation of calculating a cost measurement value between the template and the sample area of the reference picture. For example, the sum of absolute differences (SAD) may be used for the cost measurement. As one example, as a cost function, the normalized SAD may be used. In this case, matching cost may be given as SAD(T&#x2212;mean(T). 2*P[x]&#x2212;2*mean(P[x])). Here, T represents the template and P[x] represents the block in the search area. In addition, a motion vector for calculating minimum template cost for each of two reference pictures may be considered as an updated motion vector (replacing the initial motion vector). As illustrated in <figref idref="DRAWINGS">FIG. <b>8</b></figref>, the decoding apparatus may generate a final bilateral prediction result (i.e. a final bilateral prediction block) by using the updated motion vectors MV0&#x2032; and MV1&#x2032;. As an embodiment, multi-iteration for deriving the updated (or new) motion vector may e used for acquiring the final bilateral prediction result.</p><p id="p-0098" num="0097">In an embodiment, the decoding apparatus may call a DMVR process in order to enhance accuracy of an initial motion compensation prediction (i.e., the motion compensation prediction through the conventional merge/skip mode). For example, the decoding apparatus may perform the DMVR process when the prediction mode of the current block is the merge mode or the skip mode and the bilateral bi-prediction in which the bilateral reference pictures are located at opposite directions based on the current picture in a display order is applied to the current block.</p><p id="p-0099" num="0098"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is a diagram for describing an embodiment of a process of performing a Decoder-side Motion Vector Refinement (DMVR) by using sum of absolute differences (SAD).</p><p id="p-0100" num="0099">As described above, the decoding apparatus may measure matching cost by using the SAD in performing the DMVR. As an embodiment, in <figref idref="DRAWINGS">FIG. <b>5</b></figref>, a method for refining the motion vector by calculating a mean sum of absolute difference (MRSAD) between the prediction samples in two reference pictures without generating the template will be described. In other words, the method of <figref idref="DRAWINGS">FIG. <b>5</b></figref> shows an embodiment of bilateral matching using the MRSAD.</p><p id="p-0101" num="0100">Referring to <figref idref="DRAWINGS">FIG. <b>5</b></figref>, the decoding apparatus may derive an adjacent pixel of a pixel (sample) indicated by the list0 (L0) direction motion vector MV0 on the L0 reference picture and derive an adjacent pixel of a pixel (sample) indicated by the list1 (L1) direction motion vector MV1 on the L1 reference picture. In addition, the decoding apparatus may measure the matching cost by calculating the MRSAD between the L0 prediction block (i.e., L0 reference block) identified by the motion vector indicating the adjacent pixel derived on the L0 reference picture and the L1 prediction block (i.e., L1 reference block) identified by the motion vector indicating the adjacent pixel derived on the L1 reference picture. In this case, the decoding apparatus may select a search point (i.e., a search area having the minimum SAD between the L0 prediction block and the L1 prediction block) having minimum cost as a refined motion vector pair. In other words, the refined motion vector pair may include a refined L0 motion vector indicating a pixel position (L0 prediction block) having the minimum cost in the L0 reference picture and a refined L1 motion vector indicating a pixel position (L1 prediction block) having the minimum cost in the L1 reference picture.</p><p id="p-0102" num="0101">As the embodiment, in calculating the matching cost, after the search area of the reference picture is set, a unilateral prediction may be performed by using a regular 8 tap DCTIF interpolation filter. Further, as one example, 16-bit precision may be used for calculation of the MRSAD and clipping and/or rounding operations may not be applied before the calculation of the MRSAD by considering an internal buffer.</p><p id="p-0103" num="0102">When the true bi-prediction is applied to the current block as described above, the BDOF may be used in order to refine a bi-prediction signal. When the bi-prediction is applied to the current block, the bi-directional optical flow (BDOF) may be used to calculate improved motion information and generate the prediction samples based on the calculated motion information. For example, the BDOF may be applied at a 4&#xd7;4 subblock level. In other words, the BDOF may be performed in units of 4&#xd7;4 subblocks in the current block. Alternatively, the BDOF may be applied only to a luma component. Alternatively, the BDOF may be applied only to a chroma component and applied to the luma component and the chroma component.</p><p id="p-0104" num="0103">The BDOF mode is based on an optical flow concept assuming that an object motion is smooth as indicated by a name of the BDOF mode. A motion refinement (vx, vv) may be calculated by minimizing a difference value between the L0 and L1 prediction samples for each of 4&#xd7;4 subblocks. In addition, the motion refinement may be used for adjusting the bi-prediction sample values in 4&#xd7;4 subblocks.</p><p id="p-0105" num="0104">More specifically, in refining a prediction signal by applying the BDOF, horizontal and vertical gradients of the L0 prediction samples and the L1 prediction samples may be first calculated. In this case, the horizontal and vertical gradients may be calculated based on a difference two adjacent samples positioned adjacent the prediction sample (i, j) and calculated as shown in Equation 1 below.</p><p id="p-0106" num="0000"><maths id="MATH-US-00001" num="00001"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <mrow>      <mrow>       <mrow>        <mfrac>         <mrow>          <mo>&#x2202;</mo>          <msup>           <mi>I</mi>           <mrow>            <mo>(</mo>            <mi>k</mi>            <mo>)</mo>           </mrow>          </msup>         </mrow>         <mrow>          <mo>&#x2202;</mo>          <mi>x</mi>         </mrow>        </mfrac>        <mo>&#x2062;</mo>        <mrow>         <mo>(</mo>         <mrow>          <mi>i</mi>          <mo>,</mo>          <mi>j</mi>         </mrow>         <mo>)</mo>        </mrow>       </mrow>       <mo>=</mo>       <mrow>        <mo>(</mo>        <mrow>         <mrow>          <msup>           <mi>I</mi>           <mrow>            <mo>(</mo>            <mi>k</mi>            <mo>)</mo>           </mrow>          </msup>          <mo>(</mo>          <mrow>           <mrow>            <mi>i</mi>            <mo>+</mo>            <mn>1</mn>           </mrow>           <mo>,</mo>           <mi>j</mi>          </mrow>          <mo>)</mo>         </mrow>         <mo>-</mo>         <mrow>          <msup>           <mi>I</mi>           <mrow>            <mo>(</mo>            <mi>k</mi>            <mo>)</mo>           </mrow>          </msup>          <mo>(</mo>          <mrow>           <mrow>            <mi>i</mi>            <mo>-</mo>            <mn>1</mn>           </mrow>           <mo>,</mo>           <mi>j</mi>          </mrow>          <mo>)</mo>         </mrow>        </mrow>        <mo>)</mo>       </mrow>      </mrow>      <mo>&#x3e;&#x3e;</mo>      <mn>4</mn>     </mrow>     <mo>&#x2062;</mo>     <mtext></mtext>     <mrow>      <mrow>       <mrow>        <mfrac>         <mrow>          <mo>&#x2202;</mo>          <msup>           <mi>I</mi>           <mrow>            <mo>(</mo>            <mi>k</mi>            <mo>)</mo>           </mrow>          </msup>         </mrow>         <mrow>          <mo>&#x2202;</mo>          <mi>y</mi>         </mrow>        </mfrac>        <mo>&#x2062;</mo>        <mrow>         <mo>(</mo>         <mrow>          <mi>i</mi>          <mo>,</mo>          <mi>j</mi>         </mrow>         <mo>)</mo>        </mrow>       </mrow>       <mo>=</mo>       <mrow>        <mo>(</mo>        <mrow>         <mrow>          <msup>           <mi>I</mi>           <mrow>            <mo>(</mo>            <mi>k</mi>            <mo>)</mo>           </mrow>          </msup>          <mo>(</mo>          <mrow>           <mi>i</mi>           <mo>,</mo>           <mrow>            <mi>j</mi>            <mo>+</mo>            <mn>1</mn>           </mrow>          </mrow>          <mo>)</mo>         </mrow>         <mo>-</mo>         <mrow>          <msup>           <mi>I</mi>           <mrow>            <mo>(</mo>            <mi>k</mi>            <mo>)</mo>           </mrow>          </msup>          <mo>(</mo>          <mrow>           <mi>i</mi>           <mo>,</mo>           <mrow>            <mi>j</mi>            <mo>-</mo>            <mn>1</mn>           </mrow>          </mrow>          <mo>)</mo>         </mrow>        </mrow>        <mo>)</mo>       </mrow>      </mrow>      <mo>&#x3e;&#x3e;</mo>      <mn>4</mn>     </mrow>    </mrow>   </mtd>   <mtd>    <mrow>     <mo>[</mo>     <mrow>      <mi>Equation</mi>      <mo>&#x2062;</mo>      <mtext>   </mtext>      <mn>1</mn>     </mrow>     <mo>]</mo>    </mrow>   </mtd>  </mtr> </mtable></math></maths></p><p id="p-0107" num="0105">Here,</p><p id="p-0108" num="0000"><maths id="MATH-US-00002" num="00002"><math overflow="scroll"> <mrow>  <mfrac>   <mrow>    <mo>&#x2202;</mo>    <msup>     <mi>I</mi>     <mrow>      <mo>(</mo>      <mi>k</mi>      <mo>)</mo>     </mrow>    </msup>   </mrow>   <mrow>    <mo>&#x2202;</mo>    <mi>x</mi>   </mrow>  </mfrac>  <mo>&#x2062;</mo>  <mrow>   <mo>(</mo>   <mrow>    <mi>i</mi>    <mo>,</mo>    <mi>j</mi>   </mrow>   <mo>)</mo>  </mrow> </mrow></math></maths></p><p id="p-0109" num="0000">represents the horizontal gradient and</p><p id="p-0110" num="0000"><maths id="MATH-US-00003" num="00003"><math overflow="scroll"> <mrow>  <mfrac>   <mrow>    <mo>&#x2202;</mo>    <msup>     <mi>I</mi>     <mrow>      <mo>(</mo>      <mi>k</mi>      <mo>)</mo>     </mrow>    </msup>   </mrow>   <mrow>    <mo>&#x2202;</mo>    <mi>y</mi>   </mrow>  </mfrac>  <mo>&#x2062;</mo>  <mrow>   <mo>(</mo>   <mrow>    <mi>i</mi>    <mo>,</mo>    <mi>j</mi>   </mrow>   <mo>)</mo>  </mrow> </mrow></math></maths></p><p id="p-0111" num="0000">represents the vertical gradient. Further, I<sup>(k)</sup>(i, j) represents a prediction value in coordinate (i, j) of the prediction sample in list k (k=0, 1).</p><p id="p-0112" num="0106">Next, an auto-correlation and a cross-correlation of the horizontal and vertical gradients may be calculated as shown in Equations 2 and 3 below.</p><p id="p-0113" num="0000"><maths id="MATH-US-00004" num="00004"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <mrow>      <mrow>       <msub>        <mi>S</mi>        <mn>1</mn>       </msub>       <mo>=</mo>       <mrow>        <msub>         <mo>&#x2211;</mo>         <mrow>          <mrow>           <mo>(</mo>           <mrow>            <mi>i</mi>            <mo>,</mo>            <mi>j</mi>           </mrow>           <mo>)</mo>          </mrow>          <mo>&#x2208;</mo>          <mi>&#x3a9;</mi>         </mrow>        </msub>        <mrow>         <mrow>          <msub>           <mi>&#x3c8;</mi>           <mi>x</mi>          </msub>          <mo>(</mo>          <mrow>           <mi>i</mi>           <mo>,</mo>           <mi>j</mi>          </mrow>          <mo>)</mo>         </mrow>         <mo>&#xb7;</mo>         <mrow>          <msub>           <mi>&#x3c8;</mi>           <mi>x</mi>          </msub>          <mo>(</mo>          <mrow>           <mi>i</mi>           <mo>,</mo>           <mi>j</mi>          </mrow>          <mo>)</mo>         </mrow>        </mrow>       </mrow>      </mrow>      <mo>,</mo>      <mtext></mtext>      <mrow>       <msub>        <mi>S</mi>        <mn>3</mn>       </msub>       <mo>=</mo>       <mrow>        <msub>         <mo>&#x2211;</mo>         <mrow>          <mrow>           <mo>(</mo>           <mrow>            <mi>i</mi>            <mo>,</mo>            <mi>j</mi>           </mrow>           <mo>)</mo>          </mrow>          <mo>&#x2208;</mo>          <mi>&#x3a9;</mi>         </mrow>        </msub>        <mrow>         <mrow>          <mi>&#x3b8;</mi>          <mo>&#x2061;</mo>          <mo>(</mo>          <mrow>           <mi>i</mi>           <mo>,</mo>           <mi>j</mi>          </mrow>          <mo>)</mo>         </mrow>         <mo>&#xb7;</mo>         <mrow>          <msub>           <mi>&#x3c8;</mi>           <mi>x</mi>          </msub>          <mo>(</mo>          <mrow>           <mi>i</mi>           <mo>,</mo>           <mi>j</mi>          </mrow>          <mo>)</mo>         </mrow>        </mrow>       </mrow>      </mrow>     </mrow>     <mo>&#x2062;</mo>     <mtext></mtext>     <mrow>      <msub>       <mi>S</mi>       <mn>2</mn>      </msub>      <mo>=</mo>      <mrow>       <msub>        <mo>&#x2211;</mo>        <mrow>         <mrow>          <mo>(</mo>          <mrow>           <mi>i</mi>           <mo>,</mo>           <mi>j</mi>          </mrow>          <mo>)</mo>         </mrow>         <mo>&#x2208;</mo>         <mi>&#x3a9;</mi>        </mrow>       </msub>       <mrow>        <mrow>         <msub>          <mi>&#x3c8;</mi>          <mi>x</mi>         </msub>         <mo>(</mo>         <mrow>          <mi>i</mi>          <mo>,</mo>          <mi>j</mi>         </mrow>         <mo>)</mo>        </mrow>        <mo>&#xb7;</mo>        <mrow>         <msub>          <mi>&#x3c8;</mi>          <mi>y</mi>         </msub>         <mo>(</mo>         <mrow>          <mi>i</mi>          <mo>,</mo>          <mi>j</mi>         </mrow>         <mo>)</mo>        </mrow>       </mrow>      </mrow>     </mrow>     <mo>&#x2062;</mo>     <mtext></mtext>     <mrow>      <msub>       <mi>S</mi>       <mn>5</mn>      </msub>      <mo>=</mo>      <mrow>       <msub>        <mo>&#x2211;</mo>        <mrow>         <mrow>          <mo>(</mo>          <mrow>           <mi>i</mi>           <mo>,</mo>           <mi>j</mi>          </mrow>          <mo>)</mo>         </mrow>         <mo>&#x2208;</mo>         <mi>&#x3a9;</mi>        </mrow>       </msub>       <mrow>        <mrow>         <msub>          <mi>&#x3c8;</mi>          <mi>y</mi>         </msub>         <mo>(</mo>         <mrow>          <mi>i</mi>          <mo>,</mo>          <mi>j</mi>         </mrow>         <mo>)</mo>        </mrow>        <mo>&#xb7;</mo>        <mrow>         <msub>          <mi>&#x3c8;</mi>          <mi>y</mi>         </msub>         <mo>(</mo>         <mrow>          <mi>i</mi>          <mo>,</mo>          <mi>j</mi>         </mrow>         <mo>)</mo>        </mrow>       </mrow>      </mrow>     </mrow>     <mo>&#x2062;</mo>     <mtext></mtext>     <mrow>      <msub>       <mi>S</mi>       <mn>6</mn>      </msub>      <mo>=</mo>      <mrow>       <msub>        <mo>&#x2211;</mo>        <mrow>         <mrow>          <mo>(</mo>          <mrow>           <mi>i</mi>           <mo>,</mo>           <mi>j</mi>          </mrow>          <mo>)</mo>         </mrow>         <mo>&#x2208;</mo>         <mi>&#x3a9;</mi>        </mrow>       </msub>       <mrow>        <mrow>         <mi>&#x3b8;</mi>         <mo>&#x2061;</mo>         <mo>(</mo>         <mrow>          <mi>i</mi>          <mo>,</mo>          <mi>j</mi>         </mrow>         <mo>)</mo>        </mrow>        <mo>&#xb7;</mo>        <mrow>         <msub>          <mi>&#x3c8;</mi>          <mi>y</mi>         </msub>         <mo>(</mo>         <mrow>          <mi>i</mi>          <mo>,</mo>          <mi>j</mi>         </mrow>         <mo>)</mo>        </mrow>       </mrow>      </mrow>     </mrow>    </mrow>   </mtd>   <mtd>    <mrow>     <mo>[</mo>     <mrow>      <mi>Equation</mi>      <mo>&#x2062;</mo>      <mtext>   </mtext>      <mn>2</mn>     </mrow>     <mo>]</mo>    </mrow>   </mtd>  </mtr> </mtable></math></maths><maths id="MATH-US-00004-2" num="00004.2"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <mrow>      <mrow>       <mrow>        <msub>         <mi>&#x3c8;</mi>         <mi>x</mi>        </msub>        <mo>(</mo>        <mrow>         <mi>i</mi>         <mo>,</mo>         <mi>j</mi>        </mrow>        <mo>)</mo>       </mrow>       <mo>=</mo>       <mrow>        <mo>(</mo>        <mrow>         <mrow>          <mfrac>           <mrow>            <mo>&#x2202;</mo>            <msup>             <mi>I</mi>             <mrow>              <mo>(</mo>              <mn>1</mn>              <mo>)</mo>             </mrow>            </msup>           </mrow>           <mrow>            <mo>&#x2202;</mo>            <mi>x</mi>           </mrow>          </mfrac>          <mo>&#x2062;</mo>          <mrow>           <mo>(</mo>           <mrow>            <mi>i</mi>            <mo>,</mo>            <mi>j</mi>           </mrow>           <mo>)</mo>          </mrow>         </mrow>         <mo>+</mo>         <mrow>          <mfrac>           <mrow>            <mo>&#x2202;</mo>            <msup>             <mi>I</mi>             <mrow>              <mo>(</mo>              <mn>0</mn>              <mo>)</mo>             </mrow>            </msup>           </mrow>           <mrow>            <mo>&#x2202;</mo>            <mi>x</mi>           </mrow>          </mfrac>          <mo>&#x2062;</mo>          <mrow>           <mo>(</mo>           <mrow>            <mi>i</mi>            <mo>,</mo>            <mi>j</mi>           </mrow>           <mo>)</mo>          </mrow>         </mrow>        </mrow>        <mo>)</mo>       </mrow>      </mrow>      <mo>&#x3e;&#x3e;</mo>      <msub>       <mi>n</mi>       <mi>a</mi>      </msub>     </mrow>     <mo>&#x2062;</mo>     <mtext></mtext>     <mrow>      <mrow>       <mrow>        <msub>         <mi>&#x3c8;</mi>         <mi>y</mi>        </msub>        <mo>(</mo>        <mrow>         <mi>i</mi>         <mo>,</mo>         <mi>j</mi>        </mrow>        <mo>)</mo>       </mrow>       <mo>=</mo>       <mrow>        <mo>(</mo>        <mrow>         <mrow>          <mfrac>           <mrow>            <mo>&#x2202;</mo>            <msup>             <mi>I</mi>             <mrow>              <mo>(</mo>              <mn>1</mn>              <mo>)</mo>             </mrow>            </msup>           </mrow>           <mrow>            <mo>&#x2202;</mo>            <mi>y</mi>           </mrow>          </mfrac>          <mo>&#x2062;</mo>          <mrow>           <mo>(</mo>           <mrow>            <mi>i</mi>            <mo>,</mo>            <mi>j</mi>           </mrow>           <mo>)</mo>          </mrow>         </mrow>         <mo>+</mo>         <mrow>          <mfrac>           <mrow>            <mo>&#x2202;</mo>            <msup>             <mi>I</mi>             <mrow>              <mo>(</mo>              <mn>0</mn>              <mo>)</mo>             </mrow>            </msup>           </mrow>           <mrow>            <mo>&#x2202;</mo>            <mi>y</mi>           </mrow>          </mfrac>          <mo>&#x2062;</mo>          <mrow>           <mo>(</mo>           <mrow>            <mi>i</mi>            <mo>,</mo>            <mi>j</mi>           </mrow>           <mo>)</mo>          </mrow>         </mrow>        </mrow>        <mo>)</mo>       </mrow>      </mrow>      <mo>&#x3e;&#x3e;</mo>      <msub>       <mi>n</mi>       <mi>a</mi>      </msub>     </mrow>     <mo>&#x2062;</mo>     <mtext></mtext>     <mrow>      <mrow>       <mi>&#x3b8;</mi>       <mo>&#x2061;</mo>       <mo>(</mo>       <mrow>        <mi>i</mi>        <mo>,</mo>        <mi>j</mi>       </mrow>       <mo>)</mo>      </mrow>      <mo>=</mo>      <mrow>       <mrow>        <mo>(</mo>        <mrow>         <mrow>          <msup>           <mi>I</mi>           <mrow>            <mo>(</mo>            <mn>1</mn>            <mo>)</mo>           </mrow>          </msup>          <mo>(</mo>          <mrow>           <mi>i</mi>           <mo>,</mo>           <mi>j</mi>          </mrow>          <mo>)</mo>         </mrow>         <mo>&#x3e;&#x3e;</mo>         <msub>          <mi>n</mi>          <mi>b</mi>         </msub>        </mrow>        <mo>)</mo>       </mrow>       <mo>-</mo>       <mrow>        <mo>(</mo>        <mrow>         <mrow>          <msup>           <mi>I</mi>           <mrow>            <mo>(</mo>            <mn>0</mn>            <mo>)</mo>           </mrow>          </msup>          <mo>(</mo>          <mrow>           <mi>i</mi>           <mo>,</mo>           <mi>j</mi>          </mrow>          <mo>)</mo>         </mrow>         <mo>&#x3e;&#x3e;</mo>         <msub>          <mi>n</mi>          <mi>b</mi>         </msub>        </mrow>        <mo>)</mo>       </mrow>      </mrow>     </mrow>    </mrow>   </mtd>   <mtd>    <mrow>     <mo>[</mo>     <mrow>      <mi>Equation</mi>      <mo>&#x2062;</mo>      <mtext>   </mtext>      <mn>3</mn>     </mrow>     <mo>]</mo>    </mrow>   </mtd>  </mtr> </mtable></math></maths></p><p id="p-0114" num="0107">Here, &#x3a9; represents a 6&#xd7;6 window adjacent to 4&#xd7;4 subblocks.</p><p id="p-0115" num="0108">Next, the motion refinement (v<sub>x</sub>, v<sub>y</sub>) may be calculated by using the auto-correlation and the cross-correlation and calculated as shown in Equation 4 below.</p><p id="p-0116" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>v</i><sub>x</sub><i>=S</i><sub>1</sub>&#x3e;0?clip3(&#x2212;<i>th</i><sub>B10</sub><i>&#x2032;,th</i><sub>B10</sub>&#x2032;,&#x2212;((<i>S</i><sub>3</sub>&#xb7;2<sup>n</sup><sup><sub2>b</sub2></sup><sup>&#x2212;n</sup><sup><sub2>a</sub2></sup>)&#x3e;&#x3e;&#x2514; log<sub>2</sub><i>S</i><sub>1</sub>&#x2518;)):0<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0117" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?><i>v</i><sub>y</sub><i>=S</i><sub>5</sub>&#x3e;0?clip3(&#x2212;<i>th</i><sub>B10</sub><i>&#x2032;,th</i><sub>B10</sub>&#x2032;,&#x2212;((<i>S</i><sub>6</sub>&#xb7;2<sup>n</sup><sup><sub2>b</sub2></sup><sup>&#x2212;n</sup><sup><sub2>a</sub2></sup>)&#x2212;((<i>v</i><sub>x</sub><i>S</i><sub>2,m</sub>)&#x3c;&#x3c;<i>n</i><sub>s</sub><sub><sub2>2</sub2></sub><i>+v</i><sub>x</sub><i>S</i><sub>2,s</sub>)/2)&#x3e;&#x3e;&#x2514; log<sub>2</sub><i>S</i><sub>5</sub>&#x2518;)):0&#x2003;&#x2003;[Equation 4]<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0118" num="0109">Here,</p><p id="p-0119" num="0000"><maths id="MATH-US-00005" num="00005"><math overflow="scroll"> <mrow>  <mrow>   <msub>    <mi>S</mi>    <mrow>     <mn>2</mn>     <mo>,</mo>     <mi>s</mi>    </mrow>   </msub>   <mo>=</mo>   <mrow>    <mrow>     <msub>      <mi>S</mi>      <mn>2</mn>     </msub>     <mo>&#x26;</mo>    </mrow>    <mo>&#x2062;</mo>    <mrow>     <mo>(</mo>     <mrow>      <msup>       <mn>2</mn>       <msub>        <mi>n</mi>        <msub>         <mi>s</mi>         <mn>2</mn>        </msub>       </msub>      </msup>      <mo>-</mo>      <mn>1</mn>     </mrow>     <mo>)</mo>    </mrow>   </mrow>  </mrow>  <mo>,</mo> </mrow></math></maths></p><p id="p-0120" num="0000">and &#x2514;&#xb7;&#x2518; represents a floor function.</p><p id="p-0121" num="0110">Next, b(x, y) for refinement of the BDOF prediction sample may be calculated as shown in Equation 5 below based on the gradient and the motion refinement.</p><p id="p-0122" num="0000"><maths id="MATH-US-00006" num="00006"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <mrow>      <mi>b</mi>      <mo>&#x2061;</mo>      <mo>(</mo>      <mrow>       <mi>x</mi>       <mo>,</mo>       <mi>y</mi>      </mrow>      <mo>)</mo>     </mrow>     <mo>=</mo>     <mrow>      <mrow>       <mi>rnd</mi>       <mo>&#x2061;</mo>       <mo>(</mo>       <mrow>        <mrow>         <mo>(</mo>         <mrow>          <msub>           <mi>v</mi>           <mi>x</mi>          </msub>          <mo>(</mo>          <mrow>           <mfrac>            <mrow>             <mo>&#x2202;</mo>             <mrow>              <msup>               <mi>I</mi>               <mrow>                <mo>(</mo>                <mn>1</mn>                <mo>)</mo>               </mrow>              </msup>              <mo>(</mo>              <mrow>               <mi>x</mi>               <mo>,</mo>               <mi>y</mi>              </mrow>              <mo>)</mo>             </mrow>            </mrow>            <mrow>             <mo>&#x2202;</mo>             <mi>x</mi>            </mrow>           </mfrac>           <mo>-</mo>           <mfrac>            <mrow>             <mo>&#x2202;</mo>             <mrow>              <msup>               <mi>I</mi>               <mrow>                <mo>(</mo>                <mn>0</mn>                <mo>)</mo>               </mrow>              </msup>              <mo>(</mo>              <mrow>               <mi>x</mi>               <mo>,</mo>               <mi>y</mi>              </mrow>              <mo>)</mo>             </mrow>            </mrow>            <mrow>             <mo>&#x2202;</mo>             <mi>x</mi>            </mrow>           </mfrac>          </mrow>          <mo>)</mo>         </mrow>         <mo>)</mo>        </mrow>        <mo>/</mo>        <mn>2</mn>       </mrow>       <mo>)</mo>      </mrow>      <mo>+</mo>      <mrow>       <mi>rnd</mi>       <mo>&#x2061;</mo>       <mo>(</mo>       <mrow>        <mrow>         <mo>(</mo>         <mrow>          <msub>           <mi>v</mi>           <mi>y</mi>          </msub>          <mo>(</mo>          <mrow>           <mfrac>            <mrow>             <mo>&#x2202;</mo>             <mrow>              <msup>               <mi>I</mi>               <mrow>                <mo>(</mo>                <mn>1</mn>                <mo>)</mo>               </mrow>              </msup>              <mo>(</mo>              <mrow>               <mi>x</mi>               <mo>,</mo>               <mi>y</mi>              </mrow>              <mo>)</mo>             </mrow>            </mrow>            <mrow>             <mo>&#x2202;</mo>             <mi>y</mi>            </mrow>           </mfrac>           <mo>-</mo>           <mfrac>            <mrow>             <mo>&#x2202;</mo>             <mrow>              <msup>               <mi>I</mi>               <mrow>                <mo>(</mo>                <mn>0</mn>                <mo>)</mo>               </mrow>              </msup>              <mo>(</mo>              <mrow>               <mi>x</mi>               <mo>,</mo>               <mi>y</mi>              </mrow>              <mo>)</mo>             </mrow>            </mrow>            <mrow>             <mo>&#x2202;</mo>             <mi>y</mi>            </mrow>           </mfrac>          </mrow>          <mo>)</mo>         </mrow>         <mo>)</mo>        </mrow>        <mo>/</mo>        <mn>2</mn>       </mrow>       <mo>)</mo>      </mrow>     </mrow>    </mrow>   </mtd>   <mtd>    <mrow>     <mo>[</mo>     <mrow>      <mi>Equation</mi>      <mo>&#x2062;</mo>      <mtext>   </mtext>      <mn>5</mn>     </mrow>     <mo>]</mo>    </mrow>   </mtd>  </mtr> </mtable></math></maths></p><p id="p-0123" num="0111">In addition, last, the BDOF prediction samples (i.e., prediction sample values refined by applying the BDOF) may be calculated as shown in Equation 6 below.</p><p id="p-0124" num="0000"><br/><?in-line-formulae description="In-line Formulae" end="lead"?>pred<sub>BDOF</sub>(<i>x,y</i>)=(<i>I</i><sup>(0)</sup>)(<i>x,y</i>)+<i>I</i><sup>(1)</sup>)(<i>x,y</i>)+<i>b</i>(<i>x,y</i>)+<i>o</i><sub>offset</sub>)&#x3e;&#x3e;shift&#x2003;&#x2003;[Equation 6]<?in-line-formulae description="In-line Formulae" end="tail"?></p><p id="p-0125" num="0112">Meanwhile, it can be seen that the DMVR and the BDOF as techniques that perform the prediction by refining the motion information (in this case, the true bi-prediction represents a case of performing the motion prediction/compensation in a reference picture of the other direction based on the picture of the current block) at the time of applying the true bi-prediction is a refinement technique having a similar concept in that it is assumed that the motion of an object in the picture is made at a predetermined speed and in a predetermined direction. However, when the true bi-prediction is performed, since a condition for applying the DMVR and a condition for applying the BDOF are different from each other, a process of checking the conditions repeatedly multiple times for each technique should be performed. Therefore, the present disclosure proposes a method that may enhance efficiency in terms of decoder complexity and performance by improving the process of checking the condition in determining the prediction mode applied to the current block.</p><p id="p-0126" num="0113">Table 1 below shows a condition for applying the DMVR during the conventional true bi-prediction. When all conditions listed below are satisfied, the DMVR may be applied.</p><p id="p-0127" num="0000"><tables id="TABLE-US-00001" num="00001"><table frame="none" colsep="0" rowsep="0" pgwide="1"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="7pt" align="left"/><colspec colname="2" colwidth="259pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 1</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_dmvr_enabled_flag is set to 1. : Signaling in SPS</entry></row><row><entry>-</entry><entry>merge_flag[ xCb ][ yCb ] is equal to 1. : Applied in case of MERGE/SKIP</entry></row><row><entry>-</entry><entry>mmvd_flag[ xCb ][ yCb ] is equal to 0. : Applied in case of not MMVD</entry></row><row><entry>-</entry><entry>predFlagL0[0][0]=1 and pred FlagL0[1 ][1 ] = 1. : Bi-directional prediction</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt (currPic, RefPicList0 [refIdxL0] &#x2212; DiffPicOrderCnt (currPic,</entry></row><row><entry/><entry>RefPicList1 [ refidxL1 ] ) is equal to 0. : TrueBi, and distances from current picture</entry></row><row><entry/><entry>and bi-directional reference picture are equal to each other (hereinafter, &#x201c;reference</entry></row><row><entry/><entry>picture distance&#x201d; may represent the above-described meaning).</entry></row><row><entry>-</entry><entry>CbHeight is greater than or equal to 8. : In case that the block length (or size) is</entry></row><row><entry/><entry>larger than Threshold (ex. 8) (here, Threshold may be variously exemplified)</entry></row><row><entry>-</entry><entry>CbHeight*CbWidth is greater than or equal to 64. : In case that the block size (or</entry></row><row><entry/><entry>magnitude) is larger than Threshold (ex. 64) (here, Threshold may be variously</entry></row><row><entry/><entry>exemplified)</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0128" num="0114">Referring to Table 1, 1) whether to apply the DMVR may be determined based on flag information (e.g., sps_dmvr_enabled_flag) signaled in a sequence parameter set (SPS) syntax. Here, the flag information (e.g., sps_dmvr_enabled_flag) may represent whether the true bi-prediction based DMVR is enabled. For example, when sps_dmvr_enabled_flag is 1 (i.e., when the true bi-prediction based DMVR is enabled), it may be determined that a condition for whether the DMVR is enabled is satisfied.</p><p id="p-0129" num="0115">2) Whether to apply the DMVR may be determined based on flag information (e.g., merge_flag) representing whether the inter prediction is performed by using the merge mode/skip mode. For example, when merge_flag is 1 (i.e., when the inter prediction is performed by using the merge mode/skip mode), it may be determined that a condition for whether to apply the merge mode/skip mode is satisfied.</p><p id="p-0130" num="0116">3) Whether to apply the DMVR may be determined based on flag information (e.g., mmvd_flag) representing whether the inter prediction is performed by using the merge mode with motion vector difference (MMVD) mode. For example, when mmvd_flag is 0 (i.e., when the MMVD mode is not used), it may be determined that a condition for whether to apply the MMVD mode is satisfied.</p><p id="p-0131" num="0117">4) Whether to apply the DMVR may be determined based on whether the bilateral prediction (bi-prediction) is used. Here, the bilateral prediction may represent an inter prediction performed based on reference pictures which exist in different directions based on the current picture. For example, when predFlagL0[0][0]=1 and predFlagL0[1][1]=1, it may be determined that the bilateral prediction is applied and it may be determined that a condition for whether to perform the bilateral prediction is satisfied.</p><p id="p-0132" num="0118">5) Whether to apply the DMVR may be determined based on whether the true bi-prediction is performed and the distances between the current picture and the bilateral reference pictures are the same as each other. In other words, it may be determined whether a distance between the current picture and an L0 reference picture (i.e., a reference picture in the reference picture list L0) and a distance between the current picture and an L1 reference picture (i.e., a reference picture in the reference picture list L1) are the same as each other. For example, when DiffPicOrderCnt(currPic, RefPicList0 [refIdxL0]) &#x2212;DiffPicOrderCnt(currPic, RefPicList1 [refIdxL1])=0, it is determined that the true bi-prediction is performed and the distances between the current picture and the bilateral reference pictures are the same as each other to determine that a condition for whether the distances of the bilateral reference pictures are the same as each other is satisfied.</p><p id="p-0133" num="0119">6) Whether to apply the DMVR may be determined based on whether a height of a current block is larger than a threshold. For example, when the height of the current block is equal to or larger than 8, it may be determined that a current block size (height) condition is satisfied.</p><p id="p-0134" num="0120">7) Whether to apply the DMVR may be determined based on whether the size of the current block is larger than the threshold. For example, when the size of the current block, height*width is equal to or larger than 64, it may be determined that the current block size (height*width) condition is satisfied.</p><p id="p-0135" num="0121">The decoding apparatus may determine whether to apply the DMVR according to whether conditions 1) to 7) of Table 1 above are satisfied. In other words, when conditions 1) to 7) of Table 1 above are satisfied, the decoding apparatus may perform the true bi-prediction by applying the DMVR and when even any one of the conditions of Table 1 above is not satisfied, the decoding apparatus does not apply the DMVR.</p><p id="p-0136" num="0122">Table 2 below shows a condition for applying the BDOF during the conventional true bi-prediction. When all conditions listed below are satisfied, the BDOF may be applied.</p><p id="p-0137" num="0000"><tables id="TABLE-US-00002" num="00002"><table frame="none" colsep="0" rowsep="0" pgwide="1"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="7pt" align="left"/><colspec colname="2" colwidth="252pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 2</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_bdof_enabled_flag is equal to 1. : Signaling through SPS</entry></row><row><entry>-</entry><entry>predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1[ xSbIdx ][ ySbIdx ] are both equal to</entry></row><row><entry/><entry>1. : Bi-directional prediction</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt( currPic, refPicList0[ refIdxL0 ] ) * DiffPicOrderCnt( currPic,</entry></row><row><entry/><entry>refPicList1[ refIdxL1 ] ) is less than 0. : TrueBi</entry></row><row><entry>-</entry><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0. : In case of not affine</entry></row><row><entry>-</entry><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0. : subblock &#x26;&#x26; w &#x3e; = 8 &#x26;&#x26; h &#x3e; = 8</entry></row><row><entry>-</entry><entry>GbiIdx[ xCb ][ yCb ] is equal to 0. : In case that GBi index is default</entry></row><row><entry>-</entry><entry>cIdx is equal to 0. : Applied to Luma only</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0138" num="0123">Referring to Table 2 above, 1) whether to apply the BDOF may be determined based on flag information (e.g., sps_bdof_enabled_flag) signaled in the sequence parameter set (SPS) syntax. Here, the flag information (e.g., sps_dmvr_enabled_flag) may represent whether the true bi-prediction based BDOF is enabled. For example, when sps_bdof_enabled_flag is 1 (i.e., when the true bi-prediction based BDOF is enabled), it may be determined that a condition for whether the BDOF is enabled is satisfied.</p><p id="p-0139" num="0124">2) Whether to apply the BDOF may be determined based on whether the bilateral prediction is used. Here, the bilateral prediction may represent an inter prediction performed based on reference pictures which exist in different directions based on the current picture. For example, when both predFlagL0] and predFlagL1 are 1, it may be determined that the bilateral prediction is applied and it may be determined that a condition for whether to perform the bilateral prediction is satisfied.</p><p id="p-0140" num="0125">3) Whether to apply the BDOF may be determined based on whether the true bi-prediction is performed. In other words, it may be determined whether the L0 reference picture (i.e., the reference picture in the reference picture list L0) and the L1 reference picture (i.e., the reference picture in the reference picture list L1) are located in temporally different directions based on the current picture. For example, when DiffPicOrderCnt(currPic, refPicList0[refIdxL0])*DiffPicOrderCnt(currPic, refPicList1[refIdxL1]) is smaller 0, it is determined that the bilateral reference pictures are located in different directions based on the current picture to determine that the condition for whether the true vi-prediction is performed is satisfied.</p><p id="p-0141" num="0126">4) Whether to apply the BDOF may be determined based on whether the affine mode is used. Here, whether the affine mode is used may be determined by deriving MotionModelIdc. For example, when the derived MotionModelIdc is 0, it may be determined that the affine mode is not used and in this case, it may be determined that a condition for whether to apply the affine mode is satisfied.</p><p id="p-0142" num="0127">5) Whether to apply the BDOF may be determined based on flag information (e.g., merge_subblock_flag) representing whether the inter prediction is performed in units of the subblocks. For example, when merge_subblock_flag is 0 (i.e., when the merge mode is not applied in units of the subblocks), it may be determined that a condition for whether to apply the merge mode in units of the subblocks is satisfied.</p><p id="p-0143" num="0128">6) Whether to apply the BDOF may be determined based on whether GBi exists. Here, whether the GBi exists may be determined based on GBi index information (e.g., GbiIdx). For example, when GbiIdx is 0 (i.e., when the GbiIdx is default), it may be determined that a condition for whether the GBi exists is satisfied.</p><p id="p-0144" num="0129">7) Whether to apply the BDOF may be determined based on whether the current block is a luma block including the luma component. For example, when an index (e.g., cIdx) indicating whether the current block is the luma block (i.e., when the current block is the luma block), it may be determined that a condition for whether the current block is the luma block is satisfied.</p><p id="p-0145" num="0130">The decoding apparatus may determine whether to apply the DMVR according to whether conditions 1) to 7) of Table 2 above are satisfied. In other words, when conditions 1) to 7) of Table 2 above are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF and when even any one of the conditions of Table 2 above is not satisfied, the decoding apparatus does not apply the BDOF.</p><p id="p-0146" num="0131">Here, the GBi may represent a generalized bi-prediction in which different weights may be applied to the L0 prediction and the L1 prediction and may be represented by using GbiIdx, for example. The GbiIdx may exist in the case of the bi-prediction and represent a bi-prediction weight index. In the present disclosure, the motion information may further include GbiIdx. For example, GbiIdx may be derived from the neighboring block in the case of the merge mode or signaled from the encoding apparatus to the decoding apparatus through a GbiIdx syntax element (e.g., gbi_idx) in the case of the MVP mode. As one example, GbiIdx may indicate a weight w applied to the L1 prediction and in this case, a weight of (1&#x2212;w) may be applied to the L0 prediction. As another example, GbiIdx may indicate the weight w applied to the L0 prediction and in this case, the weight 1-w may be applied to the L1 prediction. The weight indicated by GbiIdx may be variously configured and may be configured as shown in Tables 3 and 4 below, for example.</p><p id="p-0147" num="0000"><tables id="TABLE-US-00003" num="00003"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="3"><colspec colname="offset" colwidth="49pt" align="left"/><colspec colname="1" colwidth="63pt" align="left"/><colspec colname="2" colwidth="105pt" align="left"/><thead><row><entry/><entry namest="offset" nameend="2" rowsep="1">TABLE 3</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row><row><entry/><entry>GBi </entry><entry/></row><row><entry/><entry>Index</entry><entry>Weight value of w<sub>1</sub></entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry/></row></tbody></tgroup><tgroup align="left" colsep="0" rowsep="0" cols="3"><colspec colname="offset" colwidth="49pt" align="left"/><colspec colname="1" colwidth="63pt" align="left"/><colspec colname="2" colwidth="105pt" align="center"/><tbody valign="top"><row><entry/><entry>0</entry><entry>&#x2009;&#x2009;&#xbd;</entry></row><row><entry/><entry>1</entry><entry>&#x2212;&#xbc;</entry></row><row><entry/><entry>2</entry><entry>&#x2009;&#x2009;&#x215c;</entry></row><row><entry/><entry>3</entry><entry>&#x2009;&#x2009;&#x215d;</entry></row><row><entry/><entry>4</entry><entry>&#x2009;&#x2009; 5/4</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0148" num="0000"><tables id="TABLE-US-00004" num="00004"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="3"><colspec colname="offset" colwidth="49pt" align="left"/><colspec colname="1" colwidth="63pt" align="left"/><colspec colname="2" colwidth="105pt" align="left"/><thead><row><entry/><entry namest="offset" nameend="2" rowsep="1">TABLE 4</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row><row><entry/><entry>GBi </entry><entry/></row><row><entry/><entry>index</entry><entry>Weight value of w<sub>1</sub></entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry/></row></tbody></tgroup><tgroup align="left" colsep="0" rowsep="0" cols="3"><colspec colname="offset" colwidth="49pt" align="left"/><colspec colname="1" colwidth="63pt" align="left"/><colspec colname="2" colwidth="105pt" align="center"/><tbody valign="top"><row><entry/><entry>0</entry><entry>&#x2212;&#xbc;</entry></row><row><entry/><entry>1</entry><entry>&#x2009;&#x2009;&#x215c;</entry></row><row><entry/><entry>2</entry><entry>&#x2009;&#x2009;&#xbd;</entry></row><row><entry/><entry>3</entry><entry>&#x2009;&#x2009;&#x215d;</entry></row><row><entry/><entry>4</entry><entry>&#x2009;&#x2009; 5/4</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0149" num="0132">Referring to Tables 3 and 4 above, a weight of w1 may represent a weight applied to the L1 prediction and the GbiIdx value may indicate the weight w1 applied to the L1 prediction. For example, according to the embodiment of Table 3, when the value of GbiIdx represents 0, a &#xbd; weight may be applied to the L1 prediction and the &#xbd; weight which is a value of (1-w1) may be applied to the L0 prediction. According to the embodiment, the weight of w1 may represent the weight applied to the L0 prediction and in this case, the GbiIdx value may indicate the weight w1 applied to the L0 prediction.</p><p id="p-0150" num="0133">As described above, some of the application conditions of the DMVR and the BDOF are the same and some are similar or different. In the conventional scheme, since condition check is performed for each technique even when the condition is the same, complexity for performing the bi-prediction increases. Therefore, the present disclosure proposes an efficient condition for applying the DMVR and the BDOF during the bi-prediction.</p><p id="p-0151" num="0134">When the merge/skip mode is compared with the AMVP mode, the merge/skip mode has relatively lower accuracy than the AMVP mode, and as a result, refining the motion information by using the DMVR method is effective in terms of the performance. However, the BDOF mode may be applied even in the AMVP mode in addition to the merge/skip mode unlike the DMVR and as such, complexity for performing the BDOF compared with the performance may increase when applying the BDOF in the AMVP mode. Accordingly, the embodiment proposes a method for applying even the BDOF in the merge/skip mode similarly to the DMVR.</p><p id="p-0152" num="0135">In this case, as an embodiment proposed in the present disclosure, the application condition of the BDOF may include conditions presented in Table 5 below.</p><p id="p-0153" num="0000"><tables id="TABLE-US-00005" num="00005"><table frame="none" colsep="0" rowsep="0" pgwide="1"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="7pt" align="left"/><colspec colname="2" colwidth="252pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 5</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>-</entry><entry>merge_flag[ xCb ][ yCb ] is equal to 1.</entry></row><row><entry>-</entry><entry>predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1[ xSbIdx ][ ySbIdx ] </entry></row><row><entry/><entry>are both equal to 1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt( currPic, refPicList0[ refIdxL0 ] ) * DiffPicOrderCnt ( currPic,</entry></row><row><entry/><entry>refPicList1[ refIdxL1 ] ) is less than 0.</entry></row><row><entry>-</entry><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>cIdx is equal to 0.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0154" num="0136">Referring to Table 5 above, whether to apply the BDOF may be determined based on flag information (e.g., merge_flag) representing whether the inter prediction is performed by using the merge mode/skip mode. For example, when merge_flag is 1 (i.e., when the inter prediction is performed by using the merge mode/skip mode), it may be determined that a condition for whether to apply the merge mode/skip mode is satisfied. Accordingly, the BDOF may also be applied in the merge/skip mode similarly to the DMVR.</p><p id="p-0155" num="0137">In other words, in the embodiment, together with a condition applied in the case of the merge/skip mode, whether to apply the BDOF may be determined based on a condition applied when the BDOF is enabled, a condition applied in the case of the bilateral prediction, a condition applied when the true bi-prediction is performed, a condition applied when the affine prediction is used, a condition applied when the subblock based merge mode is not applied, a condition applied when the GBi index is default, and a condition applied when the current block is the luma block.</p><p id="p-0156" num="0138">Accordingly, the decoding apparatus may determine whether all conditions listed in Table 5 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 5 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 5 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0157" num="0139">The method for performing the true bi-prediction based on the conditions listed in Table 5 above may be independently applied to the DMVR and the BDOF or may be applied under the same condition for the DMVR and the BDOF.</p><p id="p-0158" num="0140">Meanwhile, when the conditions listed in the embodiment are the same as the conditions described in Tables 1 and 2 above, a detailed operation or meaning is similarly applied, and as a result, a detailed description for each condition will be omitted. Further, duplicated contents even in embodiments to be described below will be omitted.</p><p id="p-0159" num="0141">The encoding/decoding apparatus may be configured by various hardware and a preference of a ratio of complexity to performance may be different. Therefore, the embodiment proposes a method that may refine the motion information by applying the DMVR even in the AMVP mode in addition to the merge/skip mode.</p><p id="p-0160" num="0142">In this case, as an embodiment proposed in the present disclosure, the application condition of the DMVR may include conditions presented in Table 6 below.</p><p id="p-0161" num="0000"><tables id="TABLE-US-00006" num="00006"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="14pt" align="left"/><colspec colname="2" colwidth="203pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 6</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_dmvr_enabled_flag is set to 1.</entry></row><row><entry>-</entry><entry>(Delete conditions limited to MERGE / SKIP mode)</entry></row><row><entry>-</entry><entry>mmvd_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>predFlagL0[0][0]=1 and predFlagL0[1][1]=1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt (currPic, RefPicList0 [refIdxL0] &#x2212; DiffPicOrderCnt </entry></row><row><entry/><entry>(currPic, RefPicList1 [ refIdxL1 ] ) is equal to 0.</entry></row><row><entry>-</entry><entry>CbHeight is greater than or equal to 8.</entry></row><row><entry>-</entry><entry>CbHeight*CbWidth is greater than or equal to 64.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0162" num="0143">Referring to Table 6 above, a process of determining whether to apply the DMVR may be omitted based on the flag information (e.g., merge_flag) representing whether the inter prediction is performed by using the merge mode/skip mode. As such, by omitting a condition for whether to apply the merge mode/skip mode, the DMVR may be applied even in the AMVP mode in addition to the merge mode/skip mode.</p><p id="p-0163" num="0144">According to Table 6 above, whether to apply the DMVR may be determined based on a condition applied when the DMVR is enabled, a condition applied when the MMVD mode is not used, a condition applied in the case of the bilateral prediction, a condition applied in the case of the true bi-prediction in which the distances between the current picture and the bilateral reference pictures are the same as each other, a condition applied when the height of the current block is equal to or larger than 8, and a condition applied when the size (height*width) of the current block is equal to or larger than 64.</p><p id="p-0164" num="0145">In other words, the decoding apparatus may determine whether all conditions listed in Table 6 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the DMVR. When even any of the conditions listed in Table 6 above is not satisfied, the decoding apparatus may not apply the DMVR. The encoding apparatus may also apply the conditions of Table 6 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0165" num="0146">The method for performing the true bi-prediction based on the conditions listed in Table 6 above may be independently applied to the DMVR and the BDOF or may be applied under the same condition for the DMVR and the BDOF</p><p id="p-0166" num="0147">Meanwhile, as an embodiment of the present disclosure, both the DMVR and the BDOF may be applied to a normal merge mode. In other words, the DMVR and the BDOF may be applied when the advanced temporal motion vector prediction (ATMVP) mode is not used, the affine mode is not used, and the CPR is not used. In this case, the application condition of the DMVR may include conditions presented in Table 7 below.</p><p id="p-0167" num="0000"><tables id="TABLE-US-00007" num="00007"><table frame="none" colsep="0" rowsep="0" pgwide="1"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="7pt" align="left"/><colspec colname="2" colwidth="252pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 7</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_dmvr_enabled_flag is set to 1.</entry></row><row><entry>-</entry><entry>merge_flag[ xCb ][ yCb ] is equal to 1.</entry></row><row><entry>-</entry><entry>mmvd_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>predFlagL0[0][0]=1 and predFlagL0[1][1]=1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt (currPic, RefPicList0 [refIdxL0]) &#x2212; DiffPicOrderCnt (currPic,</entry></row><row><entry/><entry>RefPicList1 [ refIdxL1 ]) is equal to 0.</entry></row><row><entry>-</entry><entry>CbHeight is greater than or equal to 8.</entry></row><row><entry>-</entry><entry>CbHeight*CbWidth is greater than or equal to 64.</entry></row><row><entry>-</entry><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0. : 1 Affine</entry></row><row><entry>-</entry><entry>merge_subblock_flag[ xCb ][ yCb] is equal to 0. : subblock &#x26;&#x26; w &#x3e; = 8 &#x26;&#x26; h &#x3e; = 8</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0168" num="0148">Referring to Table 7 above, whether the condition applied when the affine mode is not used (e.g., when MotionModelIdc is 0) and the condition applied when the subblock based merge mode is not used (e.g., when merge_subblock_flag is 0) are satisfied is determined to apply the DMVR only in the normal merge mode.</p><p id="p-0169" num="0149">Further, in the embodiment, together with the condition for whether the affine mode is used and the condition for whether the subblock based merge mode is used, whether to apply the DMVR may be determined based on the condition applied when the DMVR is enabled, the condition applied when the merge mode/skip mode is used, the condition applied when the MMVD mode is not used, the condition applied in the case of the bilateral prediction, the condition applied in the case of the true bi-prediction in which the distances between the current picture and the bilateral reference pictures are the same as each other, the condition applied when the height of the current block is equal to or larger than 8, and the condition applied when the size (height*width) of the current block is equal to or larger than 64.</p><p id="p-0170" num="0150">In other words, the decoding apparatus may determine whether all conditions listed in Table 7 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the DMVR. When even any of the conditions listed in Table 7 above is not satisfied, the decoding apparatus may not apply the DMVR. The encoding apparatus may also apply the conditions of Table 7 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0171" num="0151">The condition for whether to apply the subblock based merge mode (e.g., merge_subblock_flag) among the application conditions of Table 7 above includes a duplicated condition among the conventional DMVR application conditions. Accordingly, as an embodiment of the present disclosure, a condition duplicated with the condition (e.g., merge_subblock_flag) for whether to apply the subblock based merge mode may be removed. In this case, the corresponding condition may be removed as proposed in Table 8 below.</p><p id="p-0172" num="0000"><tables id="TABLE-US-00008" num="00008"><table frame="none" colsep="0" rowsep="0" pgwide="1"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="7pt" align="left"/><colspec colname="2" colwidth="252pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 8</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_dmvr_enabled_flag is set to 1.</entry></row><row><entry>-</entry><entry>merge_flag[ xCb ][ yCb ] is equal to 1.</entry></row><row><entry>-</entry><entry>mmvd_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>predFlagL0[0][0]=1 and predFlagL0[1][1]=1</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt (currPic, RefPicList0 [refIdxL0] &#x2212; DiffPicOrderCnt (currPic,</entry></row><row><entry/><entry>RefPicList1 [ refidxL1 ] ) is equal to 0.</entry></row><row><entry>-</entry><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0. : !Affine</entry></row><row><entry>-</entry><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0. : subblock &#x26;&#x26; w &#x3e; = 8 &#x26;&#x26; h &#x3e; = 8</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0173" num="0152">Referring to Table 8 above, the subblock based merge mode may be applied when the size of the current block is equal to or larger than 8&#xd7;8. Accordingly, since the condition (e.g., merge_subblock_flag=0) for whether to apply the subblock based merge mode includes a condition related to the size of the current block, conditions (e.g., CbHeight and CbHeight*CbWidth) related to the size of the current block among the application conditions of the conventional DMVR may be excluded. For example, the condition for whether the height of the current block is equal to or larger than 8 and the condition for whether the height*width of the current block is equal to or larger than 64 may be omitted and whether to apply the DMVR may be determined by using the remaining conditions listed in Table 8 above.</p><p id="p-0174" num="0153">In other words, the decoding apparatus may determine whether all conditions listed in Table 8 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the DMVR. When even any of the conditions listed in Table 8 above is not satisfied, the decoding apparatus may not apply the DMVR. The encoding apparatus may also apply the conditions of Table 8 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0175" num="0154">The method for performing the true bi-prediction based on the conditions listed in Table 7 or 8 above may be independently applied to the DMVR and the BDOF or may be applied under the same condition for the DMVR and the BDOF.</p><p id="p-0176" num="0155">As an embodiment of the present disclosure, in order to increase the accuracy of the motion vector in low complexity, when the size of the block is small, the refinement techniques such as the DMVR and the BDOF may not be applied. In the conventional scheme, the refinement technique may be applied when the current block is a block which is equal to or larger than 8&#xd7;8 and in the case of the DMVR of the refinement techniques, when the size of the current block is large, the refinement is applied by separating the current block into 16&#xd7;16 units, and as a result, the DMVR may not be applied to a block which is smaller than 16&#xd7;16. In this case, the application condition of the DMVR may include conditions presented in Table 9 below.</p><p id="p-0177" num="0000"><tables id="TABLE-US-00009" num="00009"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="14pt" align="left"/><colspec colname="2" colwidth="203pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 9</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_dmvr_enabled_flag is set to 1.</entry></row><row><entry>-</entry><entry>merge_flag[ xCb ][ yCb ] is equal to 1.</entry></row><row><entry>-</entry><entry>mmvd_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>predFlagL0[0][0]=1 and predFlagL0[1][1]=1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt (currPic, RefPicList0 [refidxL0]) &#x2212; DiffPicOrderCnt </entry></row><row><entry/><entry>(currPic, RefPicList1 [ refIdxL1 ] ) is equal to 0.</entry></row><row><entry>-</entry><entry>CbHeight is greater than or equal to 16.</entry></row><row><entry>-</entry><entry>CbWidth is greater than or equal to 16.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0178" num="0156">Referring to Table 9 above, the DMVR may not be applied to the block which is smaller than 16&#xd7;16 by changing the conditions (e.g., CbHeight and CbWidth) related to the size of the current block. For example, a condition applied when the height of the current block (e.g., CbHeight) is equal to or larger than 16 and a condition applied when the width of the current block (e.g., CbWidth) is equal to or larger than 16 may be used. When the application conditions related to the size of the current block are satisfied (i.e., when the size of the current block is equal to or larger than 16&#xd7;16, the DMVR may be applied and when the application conditions related to the size of the current block are not satisfied (i.e., when the size of the current block is smaller than 16&#xd7;16), the DMVR may not be applied.</p><p id="p-0179" num="0157">Further, in the embodiment, together with the conditions (e.g., CbHeight and CbWidth) related to the size of the current block, whether to apply the DMVR may be determined based on the remaining application conditions listed in Table 9 above.</p><p id="p-0180" num="0158">In other words, the decoding apparatus may determine whether all conditions listed in Table 9 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the DMVR. When even any of the conditions listed in Table 9 above is not satisfied, the decoding apparatus may not apply the DMVR. The encoding apparatus may also apply the conditions of Table 9 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0181" num="0159">As an embodiment of the present disclosure, when the current block is the block which is smaller than 16&#xd7;16, the BDOF may not be applied in addition to the DMVR. In this case, the application condition of the BDOF may include conditions presented in Table below.</p><p id="p-0182" num="0000"><tables id="TABLE-US-00010" num="00010"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="14pt" align="left"/><colspec colname="2" colwidth="203pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 10</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>-</entry><entry>predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1[ xSbIdx ][ ySbIdx ] </entry></row><row><entry/><entry>are both equal to 1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt( currPic, refPicList0[ refIdxL0 ] ) * DiffPicOrderCnt</entry></row><row><entry/><entry>( currPic, refPicList1[ refidxL1 ] ) is less than 0.</entry></row><row><entry>-</entry><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>CbHeight is greater than or equal to 16</entry></row><row><entry>-</entry><entry>CbWidth is greater than or equal to 16</entry></row><row><entry>-</entry><entry>GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>cIdx is equal to 0.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0183" num="0160">Referring to Table 10 above, the BDOF may not be applied to the block which is smaller than 16&#xd7;16 by changing the conditions (e.g., CbHeight and CbWidth) related to the size of the current block. For example, a condition applied when the height of the current block (e.g., CbHeight) is equal to or larger than 16 and a condition applied when the width of the current block (e.g., CbWidth) is equal to or larger than 16 may be used. When the application conditions related to the size of the current block are satisfied (i.e., when the size of the current block is equal to or larger than 16&#xd7;16, the BDOF may be applied and when the application conditions related to the size of the current block are not satisfied (i.e., when the size of the current block is smaller than 16&#xd7;16), the BDOF may not be applied.</p><p id="p-0184" num="0161">Further, in the embodiment, together with the conditions (e.g., CbHeight and CbWidth) related to the size of the current block, whether to apply the BDOF may be determined based on the remaining application conditions listed in Table 10 above.</p><p id="p-0185" num="0162">In other words, the decoding apparatus may determine whether all conditions listed in Table 10 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 10 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 10 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0186" num="0163">The method for performing the true bi-prediction based on the conditions listed in Table 9 or 10 above may be independently applied to the DMVR and the BDOF or may be applied under the same condition for the DMVR and the BDOF.</p><p id="p-0187" num="0164">As described above, the DMVR is applied when the distances between the current picture and the bilateral reference pictures are the same as each other, w % bile the BDOF is continuously applied in the case of the true bi-prediction even though the distances between the current picture and the bilateral reference pictures are different from each other. Accordingly, the present disclosure proposes a method that may integrally apply the condition related to the bilateral reference picture distance to the DMVR and the BDOF in order to increase coding efficiency.</p><p id="p-0188" num="0165">As an embodiment proposed in the present disclosure, the application condition of the BDOF may include conditions presented in Table 11 below.</p><p id="p-0189" num="0000"><tables id="TABLE-US-00011" num="00011"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="14pt" align="left"/><colspec colname="2" colwidth="203pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 11</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>-</entry><entry>predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1[ xSbIdx ][ ySbIdx ] </entry></row><row><entry/><entry>are both equal to 1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt (currPic, RefPicList0 [refidxL0]) &#x2212; DiffPicOrderCnt </entry></row><row><entry/><entry>(currPic, RefPicList1 [ refIdxL1 ] ) is equal to 0 : True bi, and </entry></row><row><entry/><entry>bi-directional reference picture distances are equal to each other</entry></row><row><entry>-</entry><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>cIdx is equal to 0.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0190" num="0166">Referring to Table 11 above, a condition related to the reference picture distance among the application conditions of the BDOF (e.g., DiffPicOrderCnt) is changed to similarly apply the corresponding condition to the DMVR and the BDOF. For example, whether DiffPicOrderCnt(currPic, RefPicList0 [refIdxL0])&#x2212;DifTPicOrderCnt(currPic, RefPicList1 [refIdxL1]) is 0 is determined to determine whether a distance between the current picture and an L0 reference picture (i.e., a reference picture in the reference picture list L0) and a distance between the current picture and an L1 reference picture (i.e., a reference picture in the reference picture list L1) are the same as each other. In other words, the BDOF may be applied only when the distances between the current picture and the bilateral reference pictures are the same as each other. As such, as a condition in which the true bi-prediction is performed and the bilateral reference picture distances are the same as each other is added, a BDOF application range is limited, thereby saving decoding complexity.</p><p id="p-0191" num="0167">Further, in the embodiment, together with the conditions (e.g., DiffPicOrderCnt) related to the reference picture distance, whether to apply the BDOF may be determined based on the remaining application conditions listed in Table 11 above.</p><p id="p-0192" num="0168">In other words, the decoding apparatus may determine whether all conditions listed in Table 11 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 11 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 11 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0193" num="0169">As an embodiment proposed in the present disclosure, the application condition of the DMVR may include conditions presented in Table 12 below.</p><p id="p-0194" num="0000"><tables id="TABLE-US-00012" num="00012"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="3"><colspec colname="offset" colwidth="21pt" align="left"/><colspec colname="1" colwidth="28pt" align="left"/><colspec colname="2" colwidth="168pt" align="left"/><thead><row><entry/><entry namest="offset" nameend="2" rowsep="1">TABLE 12</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry/><entry>-</entry><entry>sps_dmvr_enabled_flag is set to 1.</entry></row><row><entry/><entry>-</entry><entry>merge_flag[ xCb ][ yCb ] is equal to 1.</entry></row><row><entry/><entry>-</entry><entry>mmvd_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry/><entry>-</entry><entry>predFlagL0[0][0]=1 and predFlagL0[1][1]=1.</entry></row><row><entry/><entry>-</entry><entry>DiffPicOrderCnt( currPic, refPicList0[ refIdxL0 ] )</entry></row><row><entry/><entry/><entry>refPicList1[ refIdxL1 ] ) is less than 0. : TrueBi</entry></row><row><entry/><entry>-</entry><entry>CbHeight is greater than or equal to 8</entry></row><row><entry/><entry>-</entry><entry>CbHeight*CbWidth is greater than or equal to 64</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0195" num="0170">Referring to Table 12 above, a condition related to the reference picture distance among the application conditions of the DMVR (e.g., DiffPicOrderCnt) is changed to similarly apply the corresponding condition to the DMVR and the BDOF. For example, it is determined whether DiffPicOrderCnt(currPic, refPicList0[refIdxL0])*DiffPicOrderCnt(currPic, refPicList1[refIdxL1]) is smaller 0 to determine whether a true bi-prediction is performed in which the bilateral reference pictures are located in different directions based on the current picture. In other words, the DMVR may be continuously applied in the case of the true bi-prediction even though the distances between the current picture and the bilateral reference pictures are not the same as each other. As such, as the condition for whether the true bi-prediction is performed is applied, a motion vector derived by considering the decoding complexity may be used without scaling even when the bilateral reference picture distances are different.</p><p id="p-0196" num="0171">Further, in the embodiment, together with the condition (e.g., DiffPicOrderCnt) related to the reference picture distance, whether to apply the DMVR may be determined based on the remaining application conditions listed in Table 12 above.</p><p id="p-0197" num="0172">In other words, the decoding apparatus may determine whether all conditions listed in Table 12 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the DMVR. When even any of the conditions listed in Table 12 above is not satisfied, the decoding apparatus may not apply the DMVR. The encoding apparatus may also apply the conditions of Table 12 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0198" num="0173">The method for performing the true bi-prediction based on the conditions listed in Table 11 or 12 above may be independently applied to the DMVR and the BDOF or may be applied under the same condition for the DMVR and the BDOF.</p><p id="p-0199" num="0174">Meanwhile, in each reference block, a case here motion compensation is performed by a weighted sum by a change in light may occur. In this case, since a phenomenon may be determined by GBi or local illumination compensation (LIC), the application conditions of the DMVR and the BDOF may be determined by considering the GBi or LIC condition.</p><p id="p-0200" num="0175">As an embodiment of the present disclosure, proposed is a method for determining whether to apply the DMVR by considering the GBi and LC conditions. In this case, the application condition of the DMVR may include conditions presented in Table 13 below.</p><p id="p-0201" num="0000"><tables id="TABLE-US-00013" num="00013"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="14pt" align="left"/><colspec colname="2" colwidth="203pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 13</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_dmvr_enabled_flag is set to 1.</entry></row><row><entry>-</entry><entry>merge_flag[ xCb ][ yCb ] is equal to 1.</entry></row><row><entry>-</entry><entry>mmvd_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>predFlagL0[0][0]=1 and predFlagL0[1][1]=1</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt (currPic, RefPicList0 [refIdxL0]) &#x2212; DiffPicOrderCnt </entry></row><row><entry/><entry>(currPic, RefPicList1[ refIdxL1 ] ) is equal to 0.</entry></row><row><entry>-</entry><entry>CbHeight is greater than or equal to 8.</entry></row><row><entry>-</entry><entry>CbHeight*CbWidth is greater than or equal to 64.</entry></row><row><entry>-</entry><entry>GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>LICFlag is equal to 0.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0202" num="0176">Referring to Table 13 above, whether to apply the DMVR may be determined by adding the GBi condition (e.g., GbiIdx) and the LIC condition (e.g., LICFlag). For example, when GbiIdx is 0 (i.e., when GbiIdx is default), it is determined that the condition for whether GBi exists is satisfied and when LICFlag is 0 (i.e., when LIC exists), it may be determined that a condition for whether LIC exists is satisfied.</p><p id="p-0203" num="0177">Further, in the embodiment, together with the GBi condition (e.g., GbiIdx) and the LIC condition (e.g., LICFlag), whether to apply the DMVR may be determined based on the remaining application conditions listed in Table 13 above.</p><p id="p-0204" num="0178">In other words, the decoding apparatus may determine whether all conditions listed in Table 13 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the DMVR. When even any of the conditions listed in Table 13 above is not satisfied, the decoding apparatus may not apply the DMVR. The encoding apparatus may also apply the conditions of Table 13 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0205" num="0179">As an embodiment of the present disclosure, proposed is a method for determining whether to apply the BDOF by considering the GBi and LIC conditions. In this case, the application condition of the BDOF may include conditions presented in Table 14 below.</p><p id="p-0206" num="0000"><tables id="TABLE-US-00014" num="00014"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="14pt" align="left"/><colspec colname="2" colwidth="203pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 14</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>-</entry><entry>predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1[ xSbIdx ][ ySbIdx ] </entry></row><row><entry/><entry>are both equal to 1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt( currPic, refPicList0[ refIdxL0 ] ) * DiffPicOrderCnt</entry></row><row><entry/><entry>( currPic, refPicList1[ refIdxL1 ] ) is less than 0.</entry></row><row><entry>-</entry><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>LICFlag is equal to 0.</entry></row><row><entry>-</entry><entry>cIdx is equal to 0.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0207" num="0180">According to Table 14 above, whether to apply the BDOF may be determined by adding an LIC condition (e.g., LICFlag) together with the conventional GBi condition (e.g., GbiIdx). For example, when GbiIdx is 0 (i.e., when GbiIdx is default), it is determined that the condition for whether GBi exists is satisfied and when LICFlag is 0 (i.e., when LIC exists), it may be determined that a condition for whether LIC exists is satisfied.</p><p id="p-0208" num="0181">Accordingly, in the embodiment, together with the GBi condition (e.g., GbiIdx) and the LIC condition (e.g., LICFlag), whether to apply the BDOF may be determined based on the remaining application conditions listed in Table 14 above.</p><p id="p-0209" num="0182">In other words, the decoding apparatus may determine whether all conditions listed in Table 14 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 14 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 14 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0210" num="0183">The method for performing the true bi-prediction based on the conditions listed in Table 13 or 14 above may be independently applied to the DMVR and the BDOF or may be applied under the same condition for the DMVR and the BDOF.</p><p id="p-0211" num="0184">Meanwhile, since the DMVR and the BDOF derive the motion information through the refinement process in the decoding apparatus, a decoding complexity problem occurs. Accordingly, the present disclosure proposes a method that may reduce the decoding complexity by allowing whether to apply the DMVR and the BDOF to be determined by using the merge index. In this case, since both the DMVR and the BDOF perform refinement of the motion vector in a limited range, an effect of refinement may be reduced when the motion vector is inaccurate. Accordingly, the present disclosure proposes a method that may limitatively apply the DMVR and the BDOF only when a value indicating the merge index is small by considering efficiency of the refinement.</p><p id="p-0212" num="0185">Here, the merge index may be a syntax element signaled from the encoding apparatus to the decoding apparatus. For example, the encoding/decoding apparatus may configure the merge candidate list based on the neighboring blocks of the current block when the merge mode/skip mode is applied to the current block. In this case, the encoding apparatus may select an optimal merge candidate among the merge candidates included in the merge candidate list based on rate-distortion (RD) cost and signal merge index information indicating the selected merge candidate to the decoding apparatus. The decoding apparatus may select the merge candidate applied to the current block based on the merge candidate list and the merge index information.</p><p id="p-0213" num="0186">As an embodiment of the present disclosure, a method for determining whether to apply the DMVR by using the merge index may include conditions presented in Table 15 below.</p><p id="p-0214" num="0000"><tables id="TABLE-US-00015" num="00015"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="14pt" align="left"/><colspec colname="2" colwidth="203pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 15</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_dmvr_enabled_flag is set to 1.</entry></row><row><entry>-</entry><entry>merge_flag[ xCb][ yCb ] is equal to 1.</entry></row><row><entry>-</entry><entry>mmvd_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>merge_idx[ xCb ][ yCb ] &#x3c; 2.</entry></row><row><entry>-</entry><entry>predFlagL0[0][0]=1 and predFlagL0[1][1]=1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt (currPic, RefPicList0 [refIdxL0]) &#x2212; DiffPicOrderCnt </entry></row><row><entry/><entry>(currPic, RefPicList1 [ refIdxL1 ] ) is equal to 0.</entry></row><row><entry>-</entry><entry>CbHeight is greater than or equal to 8.</entry></row><row><entry>-</entry><entry>CbHeight*CbWidth is greater than or equal to 64.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0215" num="0187">Referring to Table 15 above, whether to apply the DMVR may be determined by adding a merge index condition (e.g., merge_idx). For example, when the merge index (e.g., merge_idx) is smaller than 2, it may be determined that the merge index condition is satisfied. Here, a value (threshold) of the merge index may be set to 2, but this is just one example and the corresponding value may be changed according to the coding efficiency.</p><p id="p-0216" num="0188">Accordingly, in the embodiment, together with the merge index condition (e.g., merge_idx), whether to apply the DMVR may be determined based on the remaining application conditions listed in Table 15 above.</p><p id="p-0217" num="0189">In other words, the decoding apparatus may determine whether all conditions listed in Table 15 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the DMVR. When even any of the conditions listed in Table 15 above is not satisfied, the decoding apparatus may not apply the DMVR. The encoding apparatus may also apply the conditions of Table 15 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0218" num="0190">As an embodiment of the present disclosure, a method for determining whether to apply the BDOF by using the merge index may include conditions presented in Table 16 below.</p><p id="p-0219" num="0000"><tables id="TABLE-US-00016" num="00016"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="14pt" align="left"/><colspec colname="2" colwidth="203pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 16</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>-</entry><entry>predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1[ xSbIdx ][ ySbIdx ] </entry></row><row><entry/><entry>are both equal to 1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt( currPic, refPicList0[ refIdxL0 ] ) * DiffPicOrderCnt</entry></row><row><entry/><entry>( currPic, refPicList1[ refIdxL1 ] ) is less than 0.</entry></row><row><entry>-</entry><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>!(merge_flag[ xCb ][ yCb ] is equal to 1 &#x26;&#x26; merge_idx</entry></row><row><entry/><entry>[ xCb ][ yCb ] &#x3e;= 2)</entry></row><row><entry>-</entry><entry>cIdx is equal to 0.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0220" num="0191">Referring to Table 16 above, whether to apply the BDOF may be determined by adding the condition for whether the merge mode/skip mode is applied (e.g., merge_flag) and the merge index condition (e.g., merge_idx). For example, when merge_flag is not 1 (i.e., when the inter prediction is performed by using the merge mode/skip mode) and merge_idex is not equal to or larger than 2, only if the value of the merge index is small, it may be determined that the condition for limitatively applying the BDOF is satisfied. In other words, when merge_flag is 1 (i.e., when the inter prediction is performed by using the merge mode/skip mode) and merge_idex is smaller than 2, only if the value of the merge index is small, it may be determined that the merge index condition is satisfied and the BDOF may be applied. Here, the value (threshold) of the merge index may be set to 2, but this is just one example and the corresponding value may be changed according to the coding efficiency.</p><p id="p-0221" num="0192">In other words, in the embodiment, together with the condition for whether the merge mode/skip mode is applied (e.g., merge_flag) and the merge index condition (e.g., merge_idx), whether to apply the BDOF may be determined based on the remaining application conditions listed in Table 16 above.</p><p id="p-0222" num="0193">In other words, the decoding apparatus may determine whether all conditions listed in Table 16 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 16 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 16 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0223" num="0194">The method for performing the true bi-prediction based on the conditions listed in Table 15 or 16 above may be independently applied to the DMVR and the BDOF or may be applied under the same condition for the DMVR and the BDOF.</p><p id="p-0224" num="0195">Meanwhile, in the merge/skip mode, the motion information may be refined through the MMVD and in this case, since the decoding complexity increases, the DMVR is not performed when the MMVD is applied. However, when the DMVR is applied without considering the MMVD, the DMVR may be applied without the MMVD condition by considering performance enhancement. In this case, according to an embodiment of the present disclosure, the application condition of the DMVR may include conditions presented in Table 17 below.</p><p id="p-0225" num="0000"><tables id="TABLE-US-00017" num="00017"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="14pt" align="left"/><colspec colname="2" colwidth="203pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 17</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_dmvr_enabled_flag is set to 1.</entry></row><row><entry>-</entry><entry>merge_flag[ xCb ][ yCb ] is equal to 1.</entry></row><row><entry>-</entry><entry>predFlagL0[0][0]=1 and predFlagL0[1][1]=1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt (currPic, RefPicList0[refIdxL0) &#x2212; DiffPicOrderCnt</entry></row><row><entry/><entry>(currPic, RefPicList1[ refIdxL1 ] ) is equal to 0.</entry></row><row><entry>-</entry><entry>CbHeight is greater than or equal to 8.</entry></row><row><entry>-</entry><entry>CbHeight*CbWidth is greater than or equal to 64.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0226" num="0196">Referring to Table 17 above, a condition (e.g., mmvd_flag) for whether to apply the MMVD mode among the application conditions of the conventional DMVR may be excluded. In other words, a process of determining whether mmvd_flag is 0 (i.e., whether the MMVD mode is not used) may be omitted and whether to apply the DMVR may be determined based on the conditions listed in Table 17 above.</p><p id="p-0227" num="0197">In other words, the decoding apparatus may determine whether all conditions listed in Table 17 above are satisfied (excluding the condition (e.g., mmvd_flag) for whether to apply the MMVD mode) and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the DMVR. When even any of the conditions listed in Table 17 above is not satisfied, the decoding apparatus may not apply the DMVR. The encoding apparatus may also apply the conditions of Table 17 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0228" num="0198">Further, contrary to the embodiment of Table 17 described above, when the motion information is refined through the MMVD in the merge/skip mode, whether to perform the BDOF may be determined by considering the decoding complexity. Accordingly, the present disclosure proposes a method for determining whether to apply the BDOF by considering the MMVD condition. In this case, according to an embodiment of the present disclosure, the application condition of the BDOF may include conditions presented in Table 18 below.</p><p id="p-0229" num="0000"><tables id="TABLE-US-00018" num="00018"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="14pt" align="left"/><colspec colname="2" colwidth="203pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 18</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>-</entry><entry>predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1[ xSbIdx ][ ySbIdx ] </entry></row><row><entry/><entry>are both equal to 1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt( currPic, refPicList0[ refIdxL0 ] ) * DiffPicOrderCnt</entry></row><row><entry/><entry>( currPic, refPicList1[ refIdxL1 ] ) is less than 0.</entry></row><row><entry>-</entry><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>mmvd_flag[ xCb ][ yCb ] is equal to 0</entry></row><row><entry>-</entry><entry>cIdx is equal to 0.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0230" num="0199">Referring to Table 18 above, the BDOF may not be applied when the motion information is refined through the MMVD by adding the condition (e.g., mmvd_flag) for whether to apply the MMVD mode. For example, when mmvd_flag is 0 (i.e., when the MMVD mode is not used), it may be determined that the condition for whether to apply the MMVD mode is satisfied.</p><p id="p-0231" num="0200">Accordingly, in the embodiment, together with the condition (e.g., mmvd_flag) for whether to apply the MMVD mode, whether to apply the BDOF may be determined based on the remaining application conditions listed in Table 18 above.</p><p id="p-0232" num="0201">In other words, the decoding apparatus may determine whether all conditions listed in Table 18 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 18 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 18 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0233" num="0202">The method for performing the true bi-prediction based on the conditions listed in Table 17 or 18 above may be independently applied to the DMVR and the BDOF or may be applied under the same condition for the DMVR and the BDOF.</p><p id="p-0234" num="0203">Meanwhile, in the case of the AMVP, an Adaptive Motion Vector Resolution (AMVR) technique may be applied. In this case, when a resolution of the motion vector is high, i.e., when an integer-pel rounding or 4 integer-pel rounding is provided, it may not be appropriate to apply the technique in the case of the BDOF of performing the refinement in the limited area. Accordingly, the present disclosure proposes a method that may determine performing the BDOF according to the AMVR condition. In this case, according to an embodiment of the present disclosure, the application condition of the BDOF may include conditions presented in Table 19 below.</p><p id="p-0235" num="0000"><tables id="TABLE-US-00019" num="00019"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="14pt" align="left"/><colspec colname="2" colwidth="203pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 19</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>-</entry><entry>predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1[ xSbIdx ][ ySbIdx ] </entry></row><row><entry/><entry>are both equal to 1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt( currPic, refPicList0[ refIdxL0 ] ) * DiffPicOrderCnt</entry></row><row><entry/><entry>( currPic, refPicList1[ refIdxL1 ] ) is less than 0.</entry></row><row><entry>-</entry><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>amvr_flag != 0</entry></row><row><entry>-</entry><entry>GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>cIdx is equal to 0.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0236" num="0204">Referring to Table 19 above, whether to apply the BDOF may be determined by adding the AMVR condition (e.g., amvr_flag). Here, amvr_flag may be information representing the solution of a motion vector difference (MVD). For example, in a case where amvr_flag is 0, the case may indicate that the resolution of the MVD is derived in units of &#xbc; sample (quarter-luma-sample) and in a case where amvr_flag is not 0, the case may indicate that the resolution of the MVD is derived in units of integer-luma-sample or four-luma-sample. Alternatively, a reverse case thereto may be determined. According to an embodiment, as presented in Table 19 above, in the case where amvr_flag is not 0, the condition that the BDOF is applied may be set. In other words, in the case where amvr_flag is 0, the BDOF may be limited not to be applied.</p><p id="p-0237" num="0205">Accordingly, in the embodiment, together with the AMVR condition (e.g., amvr_flag), whether to apply the BDOF may be determined based on the remaining application conditions listed in Table 19 above.</p><p id="p-0238" num="0206">In other words, the decoding apparatus may determine whether all conditions listed in Table 19 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 19 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 19 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0239" num="0207">Meanwhile, the DMVR and the BDOF may be each signaled in a sequence parameter set (SPS) syntax. Table 20 below shows one example of a syntax element indicating whether the DMVR signaled through the SPS syntax is enabled and whether the BDOF is enabled.</p><p id="p-0240" num="0000"><tables id="TABLE-US-00020" num="00020"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="3"><colspec colname="offset" colwidth="28pt" align="left"/><colspec colname="1" colwidth="84pt" align="left"/><colspec colname="2" colwidth="105pt" align="center"/><thead><row><entry/><entry namest="offset" nameend="2" rowsep="1">TABLE 20</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row><row><entry/><entry>seq_parameter_set_rbsp( ) {</entry><entry>Descriptor</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry/><entry>&#x2003;......</entry><entry>. . . . . .</entry></row><row><entry/><entry>&#x2003;sps_dmvr_enabled_flag</entry><entry>u(1)</entry></row><row><entry/><entry>&#x2003;sps_bdof_enabled_flag</entry><entry>u(1)</entry></row><row><entry/><entry>&#x2003;......</entry><entry>. . . . . .</entry></row><row><entry/><entry>}</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0241" num="0208">Referring to Table 20 above, sps_dmvr_enabled_flag may be signaled in the SPS syntax and whether true bi-prediction based DMVR is enabled may be represented based on the syntax element. For example, in a case where sps_dmvr_enabled_flag is 1, the case may indicate that the true bi-prediction based DMVR is enabled and in a case where sps_dmvr_enabled_flag is 0, the case may indicate that the true bi-prediction based DMVR is not enabled.</p><p id="p-0242" num="0209">Further, sps_bdof_enabled_flag may be signaled in the SPS syntax and whether true bi-prediction based BDOF is enabled may be represented based on the syntax element. For example, in a case where sps_bdof_enabled_flag is 1, the case may indicate that the true bi-prediction based BDOF is enabled and in a case where sps_bdof_enabled_flag is 0, the case may indicate that the true bi-prediction based BDOF is not enabled.</p><p id="p-0243" num="0210">As shown in Table 20, the application conditions of the DMVR and the BDOF may be checked by using a syntax element (e.g., sps_dmvr_enabled_flag) representing whether the DMVR is enabled and a syntax element (e.g., sps_bdof_enabled_flag) representing whether the BDOF is enabled.</p><p id="p-0244" num="0211"><figref idref="DRAWINGS">FIG. <b>6</b></figref> illustrates one example illustrating a method for performing a decoding process by checking application conditions of a DMVR and a BDOF.</p><p id="p-0245" num="0212">As shown in Table 20, the method of <figref idref="DRAWINGS">FIG. <b>6</b></figref> may be applied when using a syntax element (e.g., sps_dmvr_enabled_flag) representing whether the DMVR is enabled and a syntax element (e.g., sps_bdof_enabled_flag) representing whether the BDOF is enabled.</p><p id="p-0246" num="0213">Referring to <figref idref="DRAWINGS">FIG. <b>6</b></figref>, the decoding apparatus may derive motion information (e.g., a motion vector, a reference picture index, etc.) for a current block (S<b>600</b>).</p><p id="p-0247" num="0214">The decoding apparatus may check an application of the DMVR (S<b>610</b>). In this case, the application condition of the DMVR may be checked based on the syntax element (e.g., sps_dmvr_enabled_flag) representing whether the DMVR is enabled. For example, when the DMVR is enabled (e.g., when sps_dmvr_enabled_flag is 1), the application condition of the DMVR may be checked.</p><p id="p-0248" num="0215">The decoding apparatus may determine whether to apply a DMVR process according to whether the application condition of the DMVR is satisfied (S<b>620</b>).</p><p id="p-0249" num="0216">When all application conditions of the DMVR are satisfied, the decoding apparatus may derive refined motion information by applying the DMVR process (S<b>630</b>). When at least one of the application conditions of the DMVR is not satisfied, the decoding apparatus may not apply the DMVR process.</p><p id="p-0250" num="0217">The decoding apparatus may derive prediction samples of the current block based on motion information derived (not refined) when refined motion information or DMVR derived when applying the DMVR is not applied (S<b>640</b>).</p><p id="p-0251" num="0218">In addition, the decoding apparatus may check an application condition of the BDOF (S<b>650</b>). In this case, the application condition of the BDOF DMVR may be checked based on the syntax element (e.g., sps_bdof_enabled_flag) representing whether the BDOF is enabled. For example, when the DMVR is enabled (e.g., when sps_bdof_enabled_flag is 1), the application condition of the DMVR may be checked.</p><p id="p-0252" num="0219">When all application conditions of the BDOF are satisfied, the decoding apparatus may refine prediction samples by applying the BDOF process (S<b>670</b>). When at least one of the application conditions of the BDOF is not satisfied, the decoding apparatus may not apply the BDOF process.</p><p id="p-0253" num="0220">The decoding apparatus may derive the residual samples for the current block (S<b>680</b>) and derive reconstructed samples based on the refined prediction samples derived when applying the residual samples and the BDOF or prediction samples (not refined) derived when not applying the BDOF (S<b>690</b>).</p><p id="p-0254" num="0221">The present disclosure proposes various embodiments that may enhance coding efficiency and reduce complexity by harmonizing mutual application conditions of the DMVR and the BDOF at the time of applying the DMVR and the BDOF as described above. In checking the application conditions of the DMVR and the BDOF according to the embodiments of the present disclosure and applying the application conditions to a decoding process, respective conditions may be separately checked and applied, but the application conditions may be checked at once in order to enhance the coding efficiency. In other words, the present disclosure proposes a method that may integrate and check the application conditions of the DMVR and the BDOF at once.</p><p id="p-0255" num="0222">As an embodiment of the present disclosure, information (e.g., sps_refinement_enabled_flag) indicating whether to apply the refinement in the decoding apparatus in the sequence parameter set (SPS) syntax is signaled to perform a process of checking the application condition of the DMVR/BDOF. Next, Table 21 shows one example of a syntax element (e.g., sps_refinement_enabled_flag) representing whether to apply the refinement in the decoding apparatus signaled through the SPS syntax.</p><p id="p-0256" num="0000"><tables id="TABLE-US-00021" num="00021"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="3"><colspec colname="offset" colwidth="21pt" align="left"/><colspec colname="1" colwidth="105pt" align="left"/><colspec colname="2" colwidth="91pt" align="center"/><thead><row><entry/><entry namest="offset" nameend="2" rowsep="1">TABLE 21</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row><row><entry/><entry>seq_parameter_set_rbsp( ) {</entry><entry>Descriptor</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry/><entry>&#x2003;. . . . . .</entry><entry>. . . . . .</entry></row><row><entry/><entry>&#x2003;sps_refinement_enabled_flag</entry><entry>u(1)</entry></row><row><entry/><entry>&#x2003;if(sps_refinement_enabled_flag) {</entry><entry/></row><row><entry/><entry>&#x2003;&#x2003;sps_dmvr_enabled_flag</entry><entry>u(1)</entry></row><row><entry/><entry>&#x2003;&#x2003;sps_bdof_enabled_flag</entry><entry>u(1)</entry></row><row><entry/><entry>&#x2003;}</entry><entry/></row><row><entry/><entry>&#x2003;. . . . . .</entry><entry>. . . . . .</entry></row><row><entry/><entry>}</entry><entry/></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0257" num="0223">Referring to Table 21 above, sps_refinement_enabled_flag may be signaled in the SPS syntax and may represent whether the refinement is applicable in the decoding apparatus based on the syntax element. For example, when sps_refinement_enabled_flag exists (i.e., when sps_refinement_enabled_flag is true), it may be determined that the refinement is applicable in the decoding apparatus. In this case, the decoding apparatus obtains the sps_dmvr_enabled_flag syntax element representing whether the DMVR is enabled and the sps_bdof_enabled_flag syntax element representing whether the BDOF is enabled to determine the application conditions of the DMVR and the BDOF.</p><p id="p-0258" num="0224"><figref idref="DRAWINGS">FIGS. <b>7</b> and <b>8</b></figref> illustrate another example illustrating a method for performing a decoding process by checking application conditions of a DMVR and a BDOF.</p><p id="p-0259" num="0225">The method of <figref idref="DRAWINGS">FIG. <b>7</b></figref> and the method of <figref idref="DRAWINGS">FIG. <b>8</b></figref> may be applied when the syntax element (e.g., sps_refinement_enabled_flag) representing whether the refinement is applicable in the decoding apparatus is used as shown in Table 21 above. Further, description of duplicated contents of <figref idref="DRAWINGS">FIGS. <b>7</b> and <b>8</b></figref> with <figref idref="DRAWINGS">FIG. <b>6</b></figref> described above will be omitted.</p><p id="p-0260" num="0226">Referring to <figref idref="DRAWINGS">FIG. <b>7</b></figref>, it can be seen that the application conditions are checked at once in the previous stage without checking the respective application conditions of the DMVR and the BDOF by comparing with the process of <figref idref="DRAWINGS">FIG. <b>6</b></figref> above. As an embodiment, in step S<b>710</b> of <figref idref="DRAWINGS">FIG. <b>7</b></figref>, the decoding apparatus may check a refinement application condition. In this case, the refinement application condition may be checked based on sps_refinement_enabled_flag shown in Table 21 above. For example, the decoding apparatus may obtain the sps_dmvr_enabled_flag syntax element representing whether the DMVR is enabled and the sps_bdof_enabled_flag syntax element representing whether the BDOF is enabled when sps_refinement_enabled_flag is 1 and check the application conditions of the DMVR and the BDOF based on the obtained syntax elements.</p><p id="p-0261" num="0227">Further, referring to <figref idref="DRAWINGS">FIG. <b>8</b></figref>, the application conditions are checked at once in the previous stage without checking the respective application conditions of the DMVR and the BDOF by comparing with the process of <figref idref="DRAWINGS">FIG. <b>6</b></figref> above and a simple checking process (the application condition of the BDOF) may be performed with respect to a different condition. As an embodiment, in step S<b>810</b> of <figref idref="DRAWINGS">FIG. <b>8</b></figref>, the decoding apparatus may check the refinement application condition. Thereafter, in step S<b>850</b> of <figref idref="DRAWINGS">FIG. <b>8</b></figref>, the decoding apparatus may additionally simply check the application condition of the BDOF having a condition different from the refinement application condition.</p><p id="p-0262" num="0228">Meanwhile, when the height or the size (Height*Width) of the current block is smaller than a specific length or a specific size, a calculation ratio of multiplication/addition for motion compensation increases. Accordingly, in an embodiment of the present disclosure, the application of the BDOF to a block having a small height or a small size may be limited as in the application condition of the DMVR in order to reduce a worst case. In this case, the application condition of the BDOF may include conditions presented in Table 22 below.</p><p id="p-0263" num="0000"><tables id="TABLE-US-00022" num="00022"><table frame="none" colsep="0" rowsep="0" pgwide="1"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="7pt" align="left"/><colspec colname="2" colwidth="259pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 22</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>-</entry><entry>predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1[ xSbIdx ][ ySbIdx ] are both equal to</entry></row><row><entry/><entry>1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt( currPic, refPicList0[ refIdxL0 ] ) * DiffPicOrderCnt( currPic,</entry></row><row><entry/><entry>refPicList1[ refIdxL1 ] ) is less than 0.</entry></row><row><entry>-</entry><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>CbHeight is greater than or equal to 8. : In case that block length (or size) is larger</entry></row><row><entry/><entry>than Threshold (here, Threshold may be variously exemplified)</entry></row><row><entry>-</entry><entry>CbHeight*CbWidth is greater than or equal to 64. : In case that block size (or</entry></row><row><entry/><entry>magnitude) is larger than Threshold (here, Threshold may be variously exemplified)</entry></row><row><entry>-</entry><entry>cIdx is equal to 0.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0264" num="0229">Referring to Table 22 above, the BDOF may not be applied to a block which is smaller than a specific size by adding the conditions (e.g., CbHeight and CbWidth) related to the size of the current block. For example, a condition applied when the height of the current block (e.g., CbHeight) is equal to or larger than 8 and a condition applied when the size of the current block (e.g., CbHeight*CbWidth) is equal to or larger than 64 may be used. When the application conditions related to the size of the current block are satisfied (i.e., when the height of the current block is equal to or larger than 8 and the height*width of the current block is equal to or larger than 64), the BDOF may be applied and when the application conditions related to the size of the current block are not satisfied, the BDOF may not be applied.</p><p id="p-0265" num="0230">Further, in the embodiment, together with the conditions (e.g., CbHeight and CbHeight*CbWidth) related to the size of the current block, whether to apply the BDOF may be determined based on the remaining application conditions listed in Table 22 above.</p><p id="p-0266" num="0231">In other words, the decoding apparatus may determine whether all conditions listed in Table 22 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 22 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 22 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0267" num="0232">Meanwhile, when the MMVD is applied to the current block, the motion information may be derived based on information (e.g., mmvd index) on the MMVD. Here, the information on the MMVD may include an index of a base MV, a distance index, a direction index, and the like. In particular, the distance index (more specifically, mmvd_distance_index[xCb][yCb]) may be used for representing a distance from the base MV and for example, distance indexes 0 to 7 may be represented as {&#xbc;, &#xbd;, 1, 2, 4, 8, 16, 32}, respectively. In determining refinement of the motion information in the DMVR and the BDOF, whether the refinement is performed by considering an adjacent pixel (adjacent sample) and in this case, when a distance between the adjacent pixel and the base MV is far, the value of the distance index also increases. In such a case, it is difficult that considering the adjacent pixel helps performance enhancement of the DMVR and the BDOF.</p><p id="p-0268" num="0233">Accordingly, the present disclosure proposes a method that may determine whether to apply the DMVR and the BDOF according to the distance index (more specifically, mmvd_distance_index[xCb][yCb]) value.</p><p id="p-0269" num="0234">As an embodiment of the present disclosure, whether to apply the DMVR may be determined by considering the distance index and in this case, the application condition of the DMVR may include conditions presented in Table 23 below.</p><p id="p-0270" num="0000"><tables id="TABLE-US-00023" num="00023"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="14pt" align="left"/><colspec colname="2" colwidth="203pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 23</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_dmvr_enabled_flag is set to 1.</entry></row><row><entry>-</entry><entry>merge_flag[ xCb ][ yCb ] is equal to 1.</entry></row><row><entry>-</entry><entry>mmvd_flag[ xCb ][ yCb ] is equal to 1 and mmvd_distance_index</entry></row><row><entry/><entry>[ xCb ][ yCb ] &#x3e; 4.</entry></row><row><entry>-</entry><entry>predFlagL0[0][0]=1 and predFlagL0[1][1]=1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt (currPic, RefPicList0[refIdxL0] ) &#x2212; DiffPicOrderCnt </entry></row><row><entry/><entry>(currPic, RefPicList1 [ refIdxL1 ] ) is equal to 0.</entry></row><row><entry>-</entry><entry>CbHeight is greater than or equal to 8.</entry></row><row><entry>-</entry><entry>CbHeight*CbWidth is greater than or equal to 64.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0271" num="0235">Referring to Table 23 above, a condition (e.g., mmvd_flag) related to the MMVD among the application conditions of the DMVR is changed to limitatively apply the DMVR in the MMVD mode. For example, when mmvd_flag is 1 and mmvd_distance_index is larger than 4, it may be determined that a distance index condition of the MMVD is satisfied. Accordingly, when the MMVD mode is applied, whether to apply the DMVR may be determined according to the distance index (more specifically, mmvd_distance_index[xCb][yCb]) value.</p><p id="p-0272" num="0236">Here, the value (threshold) of mmvd_distance_index may be set to 4, but this is just one example and the corresponding value may be changed to various values according to the performance and the coding efficiency.</p><p id="p-0273" num="0237">Accordingly, in the embodiment, together with the condition (e.g., mmvd_flag) for whether to apply the MMVD and the distance index condition (e.g., mmvd_distance_index) of the MMVD, whether to apply the DMVR may be determined based on the remaining application conditions listed in Table 23 above.</p><p id="p-0274" num="0238">In other words, the decoding apparatus may determine whether all conditions listed in Table 23 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the DMVR. When even any of the conditions listed in Table 23 above is not satisfied, the decoding apparatus may not apply the DMVR. The encoding apparatus may also apply the conditions of Table 23 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0275" num="0239">Further, as an embodiment of the present disclosure, whether to apply the BDOF may be determined by considering the distance index and in this case, the application condition of the BDOF ma include conditions presented in Table 24 below</p><p id="p-0276" num="0000"><tables id="TABLE-US-00024" num="00024"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="14pt" align="left"/><colspec colname="2" colwidth="203pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 24</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>-</entry><entry>predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1[ xSbIdx ][ ySbIdx ] </entry></row><row><entry/><entry>are both equal to 1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt( currPic, refPicList0[ refIdxL0 ] ) * DiffPicOrderCnt</entry></row><row><entry/><entry>( currPic, refPicList1[ refIdxL1 ] ) is less than 0.</entry></row><row><entry>-</entry><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>!merge_flag || (merge_flag &#x26;&#x26; mmvd_flag[ xCb ][ yCb ] </entry></row><row><entry/><entry>is equal to 1 </entry></row><row><entry/><entry>and mmvd_distance_index[ xCb ][ yCb ] &#x3e; 4)</entry></row><row><entry>-</entry><entry>GbiIdx[ xCb 11 yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>cIdx is equal to 0.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0277" num="0240">Referring to Table 24 above, the BDOF may be limitatively applied in the MMVD mode by adding the condition for whether the merge mode/skip mode is applied (e.g., merge_flag) and conditions (e.g., mmvd_flag and mmvd_distance_index) related to the MMVD. For example, when merge_flag does not exist (i.e., when merge_flag is not 1) or when merge_flag is 1, mmvd_flag is 1, and mmvd_distance_index is larger than 4, it may be determined that the condition of limitatively applying the BDOF in the MMVD mode is satisfied. Accordingly, when the MMVD mode is applied, whether to apply the BDOF may be determined according to the distance index (e.g., mmvd_distance_index[xCb][yCb]) value.</p><p id="p-0278" num="0241">Here, the value (threshold) of mmvd_distance_index may be set to 4, but this is just one example and the corresponding value may be changed to various values according to the performance and the coding efficiency.</p><p id="p-0279" num="0242">Accordingly, in the embodiment, together with the condition for whether the merge mode/skip mode is applied (e.g., merge_flag) and the condition related to the MMVD (e.g., mmvd_flag, mmvd_distance_index), whether to apply the BDOF may be determined based on the remaining application conditions listed in Table 24 above.</p><p id="p-0280" num="0243">In other words, the decoding apparatus may determine whether all conditions listed in Table 24 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 24 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 24 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0281" num="0244">The method for performing the true bi-prediction based on the conditions listed in Table 23 or 24 above may be independently applied to the DMVR and the BDOF or may be applied under the same condition for the DMVR and the BDOF.</p><p id="p-0282" num="0245">Meanwhile, a combined intra-inter prediction (CIIP) mode of simultaneously performing the intra prediction and the inter prediction may be applied to the current block as described above. In this case, a prediction block (inter block) in which the inter prediction is performed is combined with an intra prediction method to finally generate prediction sample values, thereby enhancing prediction accuracy. However, since the DMVR and the BDOF are techniques of refining the inter block, application of the CIIP mode may not be required in terms of the performance compared with the complexity. Accordingly, the present disclosure proposes a method that may determine whether to apply the DMVR and the BDOF by considering the CIIP.</p><p id="p-0283" num="0246">As an embodiment of the present disclosure, whether to apply the DMVR may be determined by considering the CIP and in this case, the application condition of the DMVR may include conditions presented in Table 25 below.</p><p id="p-0284" num="0000"><tables id="TABLE-US-00025" num="00025"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="14pt" align="left"/><colspec colname="2" colwidth="203pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 25</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_dmvr_enabled_flag is set to 1.</entry></row><row><entry>-</entry><entry>merge_flag[ xCb ][ yCb ] is equal to 1.</entry></row><row><entry>-</entry><entry>mmvd_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>predFlagL0[0][0]=1 and predFlagL0[1][1]=1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt (currPic, RefPicList0 [refIdxL0]) &#x2212; DiffPicOrderCnt </entry></row><row><entry/><entry>(currPic, RefPicList1 [ refIdxL1 ] ) is equal to 0.</entry></row><row><entry>-</entry><entry>CbHeight is greater than or equal to 8.</entry></row><row><entry>-</entry><entry>CbHeight*CbWidth is greater than or equal to 64.</entry></row><row><entry>-</entry><entry>ciip_flag is equal to 0. : That is, when CHP is not applied, DMVR </entry></row><row><entry/><entry>may be applied.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0285" num="0247">Referring to Table 25 above, the DMVR may be limitatively applied according to whether to apply the CIIP by adding a condition for whether to apply the CIIP mode (e.g., ciip_flag). For example, when ciip_flag is 0 (i.e., when the CIIP mode is not applied), the DMVR may be applied by determining that the condition for whether to apply the CIP mode is satisfied.</p><p id="p-0286" num="0248">Accordingly, in the embodiment, together with the condition (e.g., ciip_flag) for whether to apply the CIIP mode, whether to apply the DMVR may be determined based on the remaining application conditions listed in Table 25 above.</p><p id="p-0287" num="0249">In other words, the decoding apparatus may determine whether all conditions listed in Table 25 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the DMVR. When even any of the conditions listed in Table 25 above is not satisfied, the decoding apparatus may not apply the DMVR. The encoding apparatus may also apply the conditions of Table 25 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0288" num="0250">Further, as an embodiment of the present disclosure, whether to apply the BDOF may be determined by considering the CIP and in this case, the application condition of the BDOF may include conditions presented in Table 26 below.</p><p id="p-0289" num="0000"><tables id="TABLE-US-00026" num="00026"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="14pt" align="left"/><colspec colname="2" colwidth="203pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 26</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>-</entry><entry>sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>-</entry><entry>predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1[ xSbIdx ][ ySbIdx ] </entry></row><row><entry/><entry>are both equal to 1.</entry></row><row><entry>-</entry><entry>DiffPicOrderCnt( currPic, refPicList0[ refIdxL0 ] ) * DiffPicOrderCnt</entry></row><row><entry/><entry>( currPic, refPicList1[ refIdxL1 ] ) is less than 0.</entry></row><row><entry>-</entry><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>-</entry><entry>ciip_flag is equal to 0. : That is, when CIIP is not applied, BDOF </entry></row><row><entry/><entry>may be applied.</entry></row><row><entry>-</entry><entry>cIdx is equal to 0.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0290" num="0251">Referring to Table 26 above, the BDOF may be limitatively applied according to whether to apply the CIIP by adding the condition for whether to apply the CIIP mode (e.g., ciip_flag). For example, when ciip_flag is 0 (i.e., when the CIIP mode is not applied), the BDOF may be applied by determining that the condition for whether to apply the CIP mode is satisfied.</p><p id="p-0291" num="0252">Accordingly, in the embodiment, together with the condition (e.g., ciip_flag) for whether to apply the CIIP mode, whether to apply the BDOF may be determined based on the remaining application conditions listed in Table 26 above.</p><p id="p-0292" num="0253">In other words, the decoding apparatus may determine whether all conditions listed in Table 26 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 26 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 26 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0293" num="0254">The method for performing the true bi-prediction based on the conditions listed in Table 25 or 26 above may be independently applied to the DMVR and the BDOF or may be applied under the same condition for the DMVR and the BDOF.</p><p id="p-0294" num="0255">The methods listed in Tables 5 to 26 according to the embodiment of the present disclosure described above may be applied in combination. In other words, whether to apply the DMVR and the BDOF may be determined by checking the refinement application condition and conditions shown in Table 27 below may be applied.</p><p id="p-0295" num="0000"><tables id="TABLE-US-00027" num="00027"><table frame="none" colsep="0" rowsep="0" pgwide="1"><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="49pt" align="left"/><colspec colname="2" colwidth="210pt" align="left"/><thead><row><entry namest="1" nameend="2" rowsep="1">TABLE 27</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>DMVR</entry><entry>sps_dmvr_enabled_flag is set to 1.</entry></row><row><entry/><entry>merge_flag[ xCb ][ yCb ] is eqaul to 1.</entry></row><row><entry/><entry>mmvd_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry/><entry>predFlagL0[0][0]=1 and predFlagL0[1][1]=1.</entry></row><row><entry/><entry>DiffPicOrderCnt (currPic, RefPicList0 [refIdxL0]) &#x2212; DiffPicOrderCnt</entry></row><row><entry/><entry>(currPic, RefPicList1 [ refIdxL1 ] ) is equal to 0.</entry></row><row><entry/><entry>CbHeight is greater than or equal to 8.</entry></row><row><entry/><entry>CbHeight*CbWidth is greater than or equal to 64.</entry></row><row><entry>BDOF</entry><entry>sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry/><entry>predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1[ xSbIdx ][ ySbIdx ]</entry></row><row><entry/><entry>are both equal to 1.</entry></row><row><entry/><entry>DiffPicOrderCnt( currPic, refPicList0[ refIdxL0 ] ) *</entry></row><row><entry/><entry>DiffPicOrderCnt( currPic, refPicList1[ refIdxL1 ] ) is less than 0.</entry></row><row><entry/><entry>MotionModelIdc[ xCb ][ ySb ] is equal to 0.</entry></row><row><entry/><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry/><entry>GBiIdx[ xCb [ yCb ] is equal to 0.</entry></row><row><entry/><entry>cIdx is equal to 0.</entry></row><row><entry>DMVR +</entry><entry>predFlagL0[0][0]=1 and predFlagL0[1][1]=1.</entry></row><row><entry>BDOF</entry><entry>DiffPicOrderCnt (currPic, RefPicList0 [refIdxL0]) &#x2212; DiffPicOrderCnt</entry></row><row><entry/><entry>(currPic, RefPicList1 [ refIdxL1 ] ) is equal to 0.</entry></row><row><entry/><entry>mmvd_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry/><entry>MotionModelIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry/><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry/><entry>GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0296" num="0256">Referring to Table 27 above, a condition in the bilateral prediction when the DMVR or BDOF is applied, a condition applied in the case of the true bi-prediction in which the distances between the current picture and the bilateral reference pictures are the same as each other, a condition applied when the MMVD mode is not used, a condition applied when the affine prediction is not performed, a condition applied when the subblock based merge mode is applied, and a condition applied when the GBi index is default may be used. In other words, whether to apply the DMVR or BDOF may be determined according to whether the conditions are satisfied.</p><p id="p-0297" num="0257">Further, a condition for determining whether the merge mode is applied for the DMVR or determining whether the current block is the luma block for the BDOF may be added.</p><p id="p-0298" num="0258">The application conditions listed in Table 27 above are examples and it is apparent that various conditions listed in the aforementioned embodiments (the embodiments in Tables to 26 above) may be used in combination.</p><p id="p-0299" num="0259">Meanwhile, in the DMVR, an SAD function is adopted as a cost function instead of a mean-removed SAD (MRSAD) function by considering the decoding complexity. However when the GBi index is not default (e.g., when GbiIdx is not 0), two reference blocks may have different weighting factors, and as a result, DMVR using the SAD may not be preferable. Accordingly, the condition of the DMVR may be fixed by considering the GBi index. According to an experimental result, a 0.00% RD-rate change is shown with 100% encoding and decoding run-time by comparing with VVC Test Model (VTM) 4.0.</p><p id="p-0300" num="0260">In the case of versatile video coding (VVC), the DMVR process may be performed when all conditions listed in Table 28 below are satisfied.</p><p id="p-0301" num="0000"><tables id="TABLE-US-00028" num="00028"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="217pt" align="left"/><thead><row><entry namest="1" nameend="1" rowsep="1">TABLE 28</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>sps_dmvr_enabled_flag is equal to 1</entry></row><row><entry>merge flag [ xCb ][ yCb ] is equal to 1</entry></row><row><entry>both predFlagL0[ 0 ][ 0 ] and predFlagL1[ 0 ][ 0 ] are equal to 1</entry></row><row><entry>mmvd_flag[ xCb ][ yCb ] is equal to 0</entry></row><row><entry>DiffPicOrderCnt( currPic, RefPicList[ 0 ][ refIdxL0 ]) is equal to</entry></row><row><entry>DiffPicOrderCnt( RefPicList[ 1 ][ refIdxL1 ], currPic )</entry></row><row><entry>cbHeight is greater than or equal to 8</entry></row><row><entry>cbHeight*cbWidth is greater than or equal to 64</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0302" num="0261">In current DMVR, a block which is not matched may be searched by comparing with SAD of reference blocks to be weighted and averaged later. In the present disclosure, since two reference blocks may have different weights, the condition of the DMVR may be determined by considering such a case. According to an embodiment of the present disclosure, the DMVR may not be performed for the block in which the GBi index is not default. In this case, the application condition of the DMVR may be shown in Table 29 below.</p><p id="p-0303" num="0000"><tables id="TABLE-US-00029" num="00029"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="217pt" align="left"/><thead><row><entry namest="1" nameend="1" rowsep="1">TABLE 29</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>sps_dmvr_enabled_flag is equal to 1</entry></row><row><entry>merge flag] xCb ][ yCb ] is equal to 1</entry></row><row><entry>both predFlagL0[ 0 ][ 0 ] and predFlagL1[ 0 ][ 0 ] are equal to 1</entry></row><row><entry>mmvd_flag[ xCb ][ yCb ] is equal to 0</entry></row><row><entry>Gbildx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>DiffPicOrderCnt( currPic, RefPicList[ 0 ][ refIdxL0 ]) is equal to</entry></row><row><entry>DiffPicOrderCnt( RefPicList[ 1 ][ refIdxL1 ], currPic )</entry></row><row><entry>cbHeight is greater than or equal to 8</entry></row><row><entry>cbHeight*cb Width is greater than or equal to 64</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0304" num="0262">As shown in Table 29 above, when the value of the GBi index (e.g., GbiIdx) is 0, a condition of performing the DMVR may be added. In other words, when the value of the GBi index (e.g., GbiIdx) is not 0, different weights are applied to tow reference blocks (i.e., a reference block referred for L0 prediction and a reference block referred for L1 prediction), and as a result, in this case, the DMVR may be limited not to be performed.</p><p id="p-0305" num="0263">Meanwhile, the BDOF is performed when the current block (i.e., a current coding unit; a current CU) satisfies a true bi-prediction condition. When it is considered that an optical flow equation is designed to predict a motion of an object which moves at a predetermined speed (i.e., momentum), the current true bi-prediction condition is not an optimal condition for applying the BDOF. Accordingly, the condition of the BDOF may be fixed by considering the distance of the reference picture. According to an experimental result, a 0.01% RD-rate change is shown with 100% encoding and decoding run-time by comparing with VVC Test Model (VTM) <b>4</b>.<b>0</b>.</p><p id="p-0306" num="0264"><figref idref="DRAWINGS">FIG. <b>9</b></figref> is a diagram illustrated for describing a concept of a BDOF.</p><p id="p-0307" num="0265">As described above, the BDOF is designed to enhance the performance of the motion compensation by using an optical flow concept. According to the BDOF, as illustrated in <figref idref="DRAWINGS">FIG. <b>9</b></figref>, it may be assumed that the object moves at a predetermined speed (constant motion) and while the object moves, the luminance of each pixel is not changed. In the case of the assumption, the optical flow equation may be expressed as Equation 7 below.</p><p id="p-0308" num="0000"><maths id="MATH-US-00007" num="00007"><math overflow="scroll"> <mtable>  <mtr>   <mtd>    <mrow>     <mtext>&#x205f;</mtext>     <mtable>      <mtr>       <mtd>        <mrow>         <mrow>          <mi>&#x394;</mi>          <mo>&#x2061;</mo>          <mo>(</mo>          <mrow>           <mi>i</mi>           <mo>,</mo>           <mi>j</mi>          </mrow>          <mo>)</mo>         </mrow>         <mo>=</mo>         <malignmark/>         <mrow>          <mi>A</mi>          <mo>-</mo>          <mi>B</mi>         </mrow>        </mrow>       </mtd>      </mtr>      <mtr>       <mtd>        <mrow>         <mo>=</mo>         <malignmark/>         <mrow>          <mrow>           <mn>1</mn>           <mo>&#x2062;</mo>           <mrow>            <mo>(</mo>            <mrow>             <mrow>              <mi>x</mi>              <mo>+</mo>              <mrow>               <mi>&#x3b4;</mi>               <mo>&#x2062;</mo>               <mi>x</mi>              </mrow>             </mrow>             <mo>,</mo>             <mrow>              <mi>y</mi>              <mo>+</mo>              <mrow>               <mi>&#x3b4;</mi>               <mo>&#x2062;</mo>               <mi>y</mi>              </mrow>             </mrow>             <mo>,</mo>             <mrow>              <mi>t</mi>              <mo>+</mo>              <mrow>               <mi>&#x3b4;</mi>               <mo>&#x2062;</mo>               <mi>t</mi>              </mrow>             </mrow>            </mrow>            <mo>)</mo>           </mrow>          </mrow>          <mo>-</mo>          <mrow>           <mi>I</mi>           <mo>&#x2061;</mo>           <mo>(</mo>           <mrow>            <mrow>             <mi>x</mi>             <mo>-</mo>             <mrow>              <mi>&#x3b4;</mi>              <mo>&#x2062;</mo>              <mi>x</mi>             </mrow>            </mrow>            <mo>,</mo>            <mrow>             <mi>y</mi>             <mo>-</mo>             <mrow>              <mi>&#x3b4;</mi>              <mo>&#x2062;</mo>              <mi>y</mi>             </mrow>            </mrow>            <mo>,</mo>            <mrow>             <mi>t</mi>             <mo>-</mo>             <mrow>              <mi>&#x3b4;</mi>              <mo>&#x2062;</mo>              <mi>t</mi>             </mrow>            </mrow>           </mrow>           <mo>)</mo>          </mrow>         </mrow>        </mrow>       </mtd>      </mtr>     </mtable>    </mrow>   </mtd>   <mtd>    <mrow>     <mo>[</mo>     <mrow>      <mi>Equation</mi>      <mo>&#x2062;</mo>      <mtext>   </mtext>      <mn>7</mn>     </mrow>     <mo>]</mo>    </mrow>   </mtd>  </mtr> </mtable></math></maths></p><p id="p-0309" num="0266">As described above, when the current CU satisfies the true bi-prediction condition the BDOF is performed. However, the true bi-prediction condition does not mean a case where the object moves at a predetermined speed. Accordingly, the present disclosure proposes a method that may apply the BDOF when the object has a predetermined motion and may enhance the performance of the motion compensation.</p><p id="p-0310" num="0267">According to an embodiment of the present disclosure, in Equation 1 above, as &#x3b4;t, the BDOF may be applied when the distance from the L0 reference picture (reference 0 of <figref idref="DRAWINGS">FIG. <b>9</b></figref>) and the distance from the L1 reference picture (reference of <figref idref="DRAWINGS">FIG. <b>9</b></figref>) based on the current picture are the same as each other. In this case, the application condition of the BDOF may be changed as shown in Table 30 below.</p><p id="p-0311" num="0000"><tables id="TABLE-US-00030" num="00030"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="217pt" align="left"/><thead><row><entry namest="1" nameend="1" rowsep="1">TABLE 30</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>The variable currPic specifies the current picture and the variable </entry></row><row><entry>bdofFlag is derived as follows:</entry></row><row><entry>- If all of the following conditions are true, bdofFlag is set equal to TRUE.</entry></row><row><entry>&#x2003;sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>&#x2003;predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1[ xSbIdx ][ ySbIdx ] </entry></row><row><entry>&#x2003;&#x2003;are both equal to 1.</entry></row><row><entry>&#x2003;DiffPicOrderCnt( currPic, RefPicList[ 0 ][ refIdx ]) is equal to</entry></row><row><entry>&#x2003;&#x2003;DiffPicOrderCnt( RefPicList[ 1 ][ refIdxL1 ], currPic )</entry></row><row><entry>&#x2003;MotionModelIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>&#x2003;merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>&#x2003;GBiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>&#x2003;cIdx is equal to 0.</entry></row><row><entry>- Otherwise, bdofFlag is set to FALSE.</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0312" num="0268">Referring to Table 30 above, a condition related to the reference picture distance among the application conditions of the BDOF (e.g., DiffPicOrderCnt) is changed to apply the BDOF only when the object has a predetermined motion speed. For example, whether DiffPicOrderCnt(currPic, RefPicList[0][refIdxL0]) and DiffPicOrderCnt(RefPicList[1][refIdxL1], currPic) are the same as each other is determined to determine whether a distance between the current picture and an L0 reference picture (i.e., a reference picture in the reference picture list L0) and a distance between the current picture and an L1 reference picture (i.e., a reference picture in the reference picture list L1) are the same as each other. In other words, the BDOF may be applied only when the distance from the L0 reference picture and the distance from the L1 reference picture based on the current picture are the same as each other. As such, a condition in which the bilateral reference picture distances are the same based on the current picture is used to determine whether the true bi-prediction is performed and an object which moves at a predetermined speed is included. The BDOF is applied to the block satisfying the condition to obtain a more enhanced motion information refinement result.</p><p id="p-0313" num="0269">Further, in the embodiment, together with the conditions (e.g., DiffPicOrderCnt) related to the reference picture distance, whether to apply the BDOF may be determined based on the remaining application conditions listed in Table 30 above.</p><p id="p-0314" num="0270">In other words, the decoding apparatus may determine whether all conditions listed in Table 30 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 30 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 30 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0315" num="0271">Meanwhile, the present disclosure proposes a method for determining whether to apply the BDOF according to the block size. Table 31 below shows a case where a block size limit according to an embodiment of the present disclosure is included as the application condition.</p><p id="p-0316" num="0000"><tables id="TABLE-US-00031" num="00031"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="217pt" align="left"/><thead><row><entry namest="1" nameend="1" rowsep="1">TABLE 31</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>The variable currPic specifies the current picture and </entry></row><row><entry>the variable bdofFLag is derived as follows:</entry></row><row><entry>- If all of the following conditions are true, bdofFlag is set equal to TRUE.</entry></row><row><entry>&#x2003;sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>&#x2003;predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1[ xSbIdx ][ ySbIdx ] </entry></row><row><entry>&#x2003;&#x2003;are both equal to 1.</entry></row><row><entry>&#x2003;DiffPicOrderCnt( currPic, RefPicList[ 0 ][ refIdxL0 ] ) *</entry></row><row><entry>&#x2003;&#x2003;DffPicOrderCnt( currPic, RefPicList[ 1 ][ refIdxL1 ]) is less than 0.</entry></row><row><entry>&#x2003;MotionModelIdc[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>&#x2003;merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>&#x2003;GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>&#x2003;cIdx is equal to 0.</entry></row><row><entry>&#x2003;cbHeight is greater than or equal to 8</entry></row><row><entry>&#x2003;cbHeight*cbWidth is greater than or equal to 64</entry></row><row><entry>- Otherwise, bdofFlag is set equal to FALSE.</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0317" num="0272">Referring to Table 31 above, in applying the BDOF, when the height of the current block (e.g., CbHeight) is equal to or larger than 8, a case where the size (e.g., CbHeight*CbWidth) of the current block is equal to or larger than 64 may be added as the condition.</p><p id="p-0318" num="0273">Accordingly, in the embodiment, together with the condition for whether the height of the current block is equal to or larger than 8 and the condition for whether the height*width of the current block is equal to or larger than 64, whether to apply the BDOF may be determined by using the remaining conditions listed in Table 31 above.</p><p id="p-0319" num="0274">In other words, the decoding apparatus may determine whether all conditions listed in Table 31 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 31 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 31 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0320" num="0275">The DMVR process described in the present disclosure may be implemented according to a specification shown in Table 32 below. Table 32 below shows one example of a motion vector refinement process based on the SAD as an embodiment of the present disclosure.</p><p id="p-0321" num="0000"><tables id="TABLE-US-00032" num="00032"><table frame="none" colsep="0" rowsep="0" pgwide="1"><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="294pt" align="left"/><thead><row><entry namest="1" nameend="1" rowsep="1">TABLE 32</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>8.5.3.1 General</entry></row><row><entry>Inputs to this process are:</entry></row><row><entry>-&#x2003;a luma location ( xSb, ySb ) specifying the top-left sample of the current</entry></row><row><entry>coding subblock relative to the top left luma sample of the current picture.</entry></row><row><entry>-&#x2003;a variable sbWidth specifying the width of the current coding subblock in luma samples,</entry></row><row><entry>-&#x2003;a variable sbHeight specifying the height of the current subblock in luma samples,</entry></row><row><entry>-&#x2003;the luma motion vectors 1/16 fractional-sample accuracy mvL0 and mvL1.</entry></row><row><entry>-&#x2003;the selected luma reference picture sample arrays refPicL0L and refPicL1L.</entry></row><row><entry>Outputs of this process are:</entry></row><row><entry>-&#x2003;delta luma motion vectors dMvL0 and dMvL1.</entry></row><row><entry>The variable SubPelFlag is set to 0. and the variables srRange, offsetH0, offsetH1,</entry></row><row><entry>offsetV0, and offsetV1 are all set equal to 2.</entry></row><row><entry>Both components of the delta luma motion vectors dMcL0 and dMvL1 are set equal to zero</entry></row><row><entry>and modified as follows:</entry></row><row><entry>-&#x2003;For each X being 0 or 1, the ( sbWidth + 2 * srRange ) &#xd7; ( sbHeight + 2 * srRange ) array</entry></row><row><entry>predSampleLXL of prediction luma sample values is derived by invoking the fractional</entry></row><row><entry>sample bilinear interpolation process specified in 8.5.3.2.1 with the luma location </entry></row><row><entry>( xSb, ySb ), the prediction block width set equal to ( sbWidth + 2 * srRange ), the </entry></row><row><entry>prediction block height set equal to ( sbHeight + 2 * srRange ), the reference picture sample</entry></row><row><entry>array refPicLXL, the motion vector mvLX and the refinement search range srRange as inputs.</entry></row><row><entry>-&#x2003;The list sadList[ i ] with i=0.8 is derived by invoking the sum of absolute difference </entry></row><row><entry>calculation process specified in 8.5.3.3 with sbWidth, sbHeight, offsetH0, offsetH1, </entry></row><row><entry>offsetV0, offsetV1, predSamplesL0L and predSamplesL1L as inputs.</entry></row><row><entry>-&#x2003;When sadList[ 4 ] is greater than or equal to 4 * (sbHeight &#x3e;&#x3e; 1) *</entry></row><row><entry>sbWidth, the following applies:</entry></row><row><entry>-&#x2003;The variable bestIdx is derived by invoking the array entry selection process specified in clause </entry></row><row><entry>8.5.3.4 with the list sadList[ i ] with i=0..8 as input.</entry></row><row><entry>-&#x2003;If bestIdx is equal to 4, subPelFlag is set equal to 1.</entry></row><row><entry>-&#x2003;Otherwise, the following applies:</entry></row></tbody></tgroup><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="175pt" align="left"/><colspec colname="2" colwidth="119pt" align="left"/><tbody valign="top"><row><entry>dX = bestIdx % 3 &#x2212; 1</entry><entry>&#x2003;(8 436)</entry></row><row><entry>dY = bestIdx / 3 &#x2212; 1</entry><entry>&#x2003;(8 437)</entry></row><row><entry>dMvL0[ 0 ] += 16 * dX</entry><entry>&#x2003;(8 438)</entry></row><row><entry>dMvL0[ 1 ] += 16 * dY</entry><entry>&#x2003;(8 439)</entry></row><row><entry>offsetH0 += dX</entry><entry>(8 440)</entry></row><row><entry>offsetV0 += dY</entry><entry>(8 441)</entry></row><row><entry>offsetH1 &#x2212;= dX</entry><entry>(8 442)</entry></row><row><entry>offsetV1 &#x2212;= dY</entry><entry>(8 443)</entry></row></tbody></tgroup><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="294pt" align="left"/><tbody valign="top"><row><entry>-&#x2003;The list sadList[ i ] with i=0..8 is modified by invoking the sum of absolute differences calculation</entry></row><row><entry>process specified in 8.5.3.3 with sbWidth, sbHeight, offsetH0, offsetH1, offsetV0, offsetV1, </entry></row><row><entry>predSamplesL0L and predSamplesL1L as inputs.</entry></row><row><entry>-&#x2003;The variable bestIdx is modifed by invoking the array entry selection specified in clause</entry></row><row><entry>8.5.3.4 with the list sadList[ i ] with i=0..8 as input.</entry></row><row><entry>-&#x2003;if bestIdx is equal to 4, subPelFlag is set equal to 1</entry></row><row><entry>-&#x2003;Otherwise (bestIdx is not equal to 4), the following applies:</entry></row></tbody></tgroup><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="175pt" align="left"/><colspec colname="2" colwidth="119pt" align="left"/><tbody valign="top"><row><entry>dMvL0[ 0 ] += 16 * ( bestIdx % 3 &#x2212; 1)</entry><entry>&#x2003;&#x2003;(8 444)</entry></row><row><entry>dMvL0[ 1 ] += 16 * ( bestIdx / 3 &#x2212; 1)</entry><entry>&#x2003;&#x2003;(8 445)</entry></row></tbody></tgroup><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="294pt" align="left"/><tbody valign="top"><row><entry>-&#x2003;When subPelFlag is equal to 1, the parametric motion vector refinement process specified </entry></row><row><entry>in clause 8.5.3.5 is invoked with the list sadList[ i ] with i=0..8, and the delta motion </entry></row><row><entry>vector dMvL0 as inputs and the modified dMVL0 as output. </entry></row><row><entry>-&#x2003;The delta motion vector dMvL1 is derivd as follows:</entry></row></tbody></tgroup><tgroup align="left" colsep="0" rowsep="0" cols="2"><colspec colname="1" colwidth="175pt" align="left"/><colspec colname="2" colwidth="119pt" align="left"/><tbody valign="top"><row><entry>dMvL1[ 0 ] = &#x2212;dMvL0[ 0 ]</entry><entry>&#x2003;(8 446)</entry></row><row><entry>dMvL1[ 1 ] = &#x2212;dMvL0[ 1 ]</entry><entry>&#x2003;(8 447)</entry></row><row><entry namest="1" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0322" num="0276">Meanwhile, as described above, in the DMVR, the SAD function is adopted as the cost function instead of the mean-removed SAD (MRSAD) function by considering the decoding complexity. However, when the GBi index is not default (e.g., when GbiIdx is not 0) and a weighting flag by an explicit weight prediction is not 0, the DMVR using the SAD may not be preferable. Accordingly, the condition of the DMVR may be fixed by considering the GBi index and the weighting flag of the explicit weight prediction. Further, the same condition may be applied even to the BDOF. According to the experimental result, a 0.000% RD-rate change is shown with 100% encoding and decoding run-time by comparing with VVC Test Model (VTM) 4.0.</p><p id="p-0323" num="0277">In the current DMVR, a block which is not matched may be searched by comparing with SAD of reference blocks to be weighted and averaged later. In the present disclosure, since two reference blocks may have different weights, the condition of the DMVR may be determined by considering such a case. According to an embodiment of the present disclosure, the DMVR may not be performed for the block in which the GBi index is not default. Further, the DMVR may not be performed for a block in which the weighting flag by the explicit weight prediction is not 0.</p><p id="p-0324" num="0278">In an embodiment of the present disclosure, proposed is a method that may determine whether to apply the DMVR by considering the weighted bi-prediction is performed. In this case, the application condition of the DMVR may include conditions presented in Table 33 below.</p><p id="p-0325" num="0000"><tables id="TABLE-US-00033" num="00033"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="217pt" align="left"/><thead><row><entry namest="1" nameend="1" rowsep="1">TABLE 33</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>sps_dmvr_enabled_flag is equal to 1</entry></row><row><entry>merge_flag[ xCb ][ yCb ] is equal to 1</entry></row><row><entry>both predFlagL0[ 0 ][ 0 ] and predFlagL1[ 0 ][ 0 ] are equal to 1</entry></row><row><entry>mmvd _flag[ xCb ][ yCb ] is equal to 0</entry></row><row><entry>GbiIdx[ xCb ][ yCb ] is equal to 0</entry></row><row><entry>luma_weight_10_flag[ refIdxL0 ] and </entry></row><row><entry>luma_weight_11_flag[ refIdxL1 ] are equal to 0</entry></row><row><entry>DifPicOrderCnt( currPic, RefPicList[ 0 ][ refldxL0 ]) is equal to</entry></row><row><entry>DifPicOrderCnt( RefPicList[ 1 ][ refldxL1 ], currPic )</entry></row><row><entry>cbHeight is greater than or equal to 8</entry></row><row><entry>cbHeight*cbWidth is greater than or equal to 64</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0326" num="0279">Referring to Table 33 above, a condition indicating whether the weight is explicitly applied to the L0 prediction and the L1 prediction (e.g., luma_weight_10_flag and luma_weight_11_flag) and an index condition (e.g., GbiIdx) indicating weights applied to the L0 prediction and the L1 prediction are added to determine whether to apply the DMVR according to whether the weighted bi-prediction is performed.</p><p id="p-0327" num="0280">For example, it may be determined whether the explicit weight prediction is applied to the current block based on flag information (e.g., luma_weight_10_flag) representing whether to explicitly apply the weight to the L0 prediction and flag information (e.g., luma_weight_11_flag) representing whether to explicitly apply the weight to the L1 prediction. In other words, when the value of luma_weight_10_flag is 0 and the value of luma_weight_11_flag is 0, the DMVR may be limitatively applied. In other words, when the weight prediction is not explicitly applied to the L0 and L1 predictions, it may be determined that the DMVR is applied.</p><p id="p-0328" num="0281">Further, whether bi-prediction (i.e., L0 prediction and L1 prediction) of using different weights is applied to the current block may be determined based on a value of a bi-prediction weight index (e.g., GbiIdx) representing the weights applied to the L0 prediction and the L1 prediction. In other words, the case where the value of the bi-prediction weight index (e.g., GbiIdx) is 0 may be a default case in which different weights are not applied to the L0 prediction and the L1 prediction as described in the embodiment of Table 3 above. Accordingly, when the value of the bi-prediction weight index (e.g., GbiIdx) is 0, the DMVR may be limitatively applied.</p><p id="p-0329" num="0282">According to the embodiment, when the weight prediction is not explicitly applied to the L0 and L1 predictions (when the value of luma_weight_10_flag is 0 and when the value of luma_weight_11_flag is 0), information on the bi-prediction weight index (e.g., GbiIdx) is further obtained to determine whether the value of the bi-prediction weight index (e.g., GbiIdx) is 0.</p><p id="p-0330" num="0283">In the embodiment, together with the condition indicating whether the weight is explicitly applied to the L0 prediction and the L1 prediction (e.g., luma_weight_10_flag and luma_weight_11_flag) and the index condition (e.g., GbiIdx) indicating weights applied to the L0 prediction and the L1 prediction, it may be determined whether to apply the DMVR based on the remaining conditions listed in Table 33 above.</p><p id="p-0331" num="0284">In other words, the decoding apparatus may determine whether all conditions listed in Table 33 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the DMVR. When even any of the conditions listed in Table 33 above is not satisfied, the decoding apparatus may not apply the DMVR. The encoding apparatus may also apply the conditions of Table 33 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0332" num="0285">Meanwhile, in the case of the BDOF, the GBi index is considered, but the weighting flag of the explicit weight prediction is not considered. Accordingly, the present disclosure proposes a method for determining whether to apply the BDOF by considering the GBi index and the weighting flag of the explicit weight prediction.</p><p id="p-0333" num="0286">As an embodiment of the present disclosure, whether to apply the BDOF may be determined by considering whether the weighted bi-prediction is performed and in this case, the application condition of the BDOF may include conditions presented in Table 34 below.</p><p id="p-0334" num="0000"><tables id="TABLE-US-00034" num="00034"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="217pt" align="left"/><thead><row><entry namest="1" nameend="1" rowsep="1">TABLE 34</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1</entry></row><row><entry>[ xSbIdx ][ ySbIdx ] are both equal to 1.</entry></row><row><entry>DifPicOrderCnt( currPic, RefPicList[ 0 ][ refldxL0 ] ) * </entry></row><row><entry>DiffPicOrderCnt( currPic,</entry></row><row><entry>RefPicList[ 1 ][ refldxL1 ]) is less than 0.</entry></row><row><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>merge_subblock_flag[ xCb ][ yCb ]is equal to 0.</entry></row><row><entry>GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>luma_weight_10_flag[ refIdxL0 ] and </entry></row><row><entry>luma_weight_11_flag[ refIdxL1 ] are equal to 0.</entry></row><row><entry>cIdx is equal to 0.</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0335" num="0287">Referring to Table 34 above, a condition indicating whether the weight is explicitly applied to the L0 prediction and the L1 prediction (e.g., luma_weight_10 flag and luma_weight_11_flag) is added to determine whether to apply the BDOF according to whether the weighted bi-prediction is performed.</p><p id="p-0336" num="0288">For example, it may be determined whether the explicit weight prediction is applied to the current block based on flag information (e.g., luma_weight_10_flag) representing whether to explicitly apply the weight to the L0 prediction and flag information (e.g., luma_weight_11_flag) representing whether to explicitly apply the weight to the L1 prediction. In other words, when the value of luma_weight_10_flag is 0 and the value of luma_weight_11_flag is 0, the BDOF may be limitatively applied. In other words, when the weight prediction is not explicitly applied to the L0 and L1 predictions, it may be determined that the BDOF is applied.</p><p id="p-0337" num="0289">In the embodiment, together with a condition indicating whether the weight is explicitly applied to the L0 prediction and the L1 prediction (e.g., luma_weight_10_flag and luma_weight_11_flag), whether to apply the BDOF may be determined based on the remaining conditions listed in Table 34 above.</p><p id="p-0338" num="0290">In other words, the decoding apparatus may determine whether all conditions listed in Table 34 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 34 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 34 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0339" num="0291">The method for performing the true bi-prediction based on the conditions listed in Table 33 or 34 above may be independently applied to the DMVR and the BDOF or may be applied under the same condition for the DMVR and the BDOF.</p><p id="p-0340" num="0292">As described above, whether to apply the DMVR and the BDOF may be determined by considering a weight factor of the explicit weight prediction in addition to the GBi index. In this case, in order to determine whether to apply the explicit weight prediction, it is considered whether the weight prediction is performed for the luma component by using luma_weight_1X_flag (here, X is 0 or 1) but whether the weight prediction is performed may be considered even for the chroma component. Accordingly, the present disclosure proposes a method for determining whether to apply the DMVR and the BDOF by considering the weight factor of the chroma component in addition to the weight factor of the luma component.</p><p id="p-0341" num="0293">As an embodiment of the present disclosure, whether to apply the DMVR may be determined by considering the weight factor of the explicit weight prediction for the luma component and the chroma component of the current block and in this case, the application condition of the DMVR may include conditions presented in Table 35 below.</p><p id="p-0342" num="0000"><tables id="TABLE-US-00035" num="00035"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="217pt" align="left"/><thead><row><entry namest="1" nameend="1" rowsep="1">TABLE 35</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>sps_dmvr_enabled_flag is equal to 1</entry></row><row><entry>merge_flag[ xCb ][ yCb ] is equal to 1</entry></row><row><entry>both predFlagL0[ 0 ][ 0 ] and predFlagL1[ 0 ][ 0 ] are equal to 1</entry></row><row><entry>mmvd_flag[ xCb ][ yCb ] is equal to 0</entry></row><row><entry>GbiIdx[ xCb ][ yCb ] is equal to 0</entry></row><row><entry>luma_weight_10_flag[ refIdxL0 ] and luma_weight_11_flag</entry></row><row><entry>[ refIdxL1 ] are equal to 0</entry></row><row><entry>chroma_weight_10-flag[ refIdxL0 ] and c</entry></row><row><entry>hroma_weight_11_flag[ refIdxL1 ] are equal to 0</entry></row><row><entry>DiffPicOrderCnt( currPic, RefPicList[ 0 ][ refIdxL0 ]) is equal to</entry></row><row><entry>DifPicOrderCnt( RefPicList[ 1 ][ refIdxL1 ], currPic )</entry></row><row><entry>cbHeight is greater than or equal to 8</entry></row><row><entry>cbHeight*cbWidth is greater than or equal to 64</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0343" num="0294">Referring to Table 35 above, a condition (e.g., luma_weight_10_flag, luma_weight_11_flag) indicating whether to explicitly apply the weight to the luma component (luma prediction value) of the L0 prediction and the luma component (luma prediction value) of the L1 prediction, a condition (e.g., chroma_weight_10_flag, chroma_weight_11_flag) indicating whether to explicitly apply the weight to the chroma component (chroma prediction value) of the L0 prediction and the chroma component (chroma prediction value) of the L1 prediction, and the index condition (e.g., GbiIdx) indicating the weights applied to the L0 prediction and the L1 prediction are added to limitatively apply the DMVR only when the weights (i.e., weight factors) to both the luma and chroma components.</p><p id="p-0344" num="0295">For example, it may be determined whether the weight factor of the explicit weight prediction is applied to the luma component of the current block based on flag information (e.g., luma_weight_10_flag) representing whether to explicitly apply the weight to the luma component (luma prediction value) of the L0 prediction and flag information (e.g., luma_weight_11_flag) representing whether to explicitly apply the weight to the luma component (luma prediction value) of the L1 prediction.</p><p id="p-0345" num="0296">Further, it may be determined whether the weight factor of the explicit weight prediction is applied to the chroma component of the current block based on flag information (e.g., chroma_weight_10 flag) representing whether to explicitly apply the weight to the chroma component (chroma prediction value) of the L0 prediction and flag information (e.g., chroma_weight_11_flag) representing whether to explicitly apply the weight to the chroma component (chroma prediction value) of the L1 prediction.</p><p id="p-0346" num="0297">In other words, when the value of luma_weight_0_flag is 0 and the value of luma_weight_11_flag is 0, it may be determined that the weight factor does not explicitly exist for the luma component and when the value of chroma_weight_10 flag is 0 and the value of chroma_weight_11_flag is 0, it may be determined that the weight factor does not explicitly exist for the chroma component. As such, when the explicit weight factor does not exist for both the luma component and the chroma component, the DMVR may be limitatively applied.</p><p id="p-0347" num="0298">Further, whether bi-prediction (i.e., L0 prediction and L1 prediction) of using different weights is applied to the current block may be determined based on a value of a bi-prediction weight index (e.g., GbiIdx) representing the weights applied to the L0 prediction and the L1 prediction. In other words, the case where the value of the bi-prediction weight index (e.g., GbiIdx) is 0 may be a default case in which different weights are not applied to the L0 prediction and the L1 prediction as described in the embodiment of Table 4 above. Accordingly, when the value of the bi-prediction weight index (e.g., GbiIdx) is 0, the DMVR may be limitatively applied.</p><p id="p-0348" num="0299">According to the embodiment, when the weight prediction is not explicitly applied to the L0 and L1 predictions of the luma component (when the value of luma_weight_10_flag is 0 and the value of luma_weight_1l_flag is 0) and when the weight prediction is not explicitly applied to the L0 and L1 predictions of the chroma component (when the value of chroma_weight_10_flag is 0 and the value of chroma_weight_11 flag is 0), information on the bi-prediction weight index (e.g., GbiIdx) is further obtained to determine whether the value of the bi-prediction weight index (e.g., GbiIdx) is 0.</p><p id="p-0349" num="0300">In the embodiment, together with the condition indicating whether the weight is explicitly applied to the L0 prediction and the L1 prediction of the luma component (e.g., luma_weight_10_flag and luma_weight_11_flag), the condition indicating whether to explicitly apply the weight to the L0 prediction and the L1 prediction of the chroma component, and the index condition (e.g., GbiIdx) indicating weights applied to the L0 prediction and the L1 prediction, it may be determined whether to apply the DMVR based on the remaining conditions listed in Table 36 above.</p><p id="p-0350" num="0301">In other words, the decoding apparatus may determine whether all conditions listed in Table 35 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the DMVR. When even any of the conditions listed in Table 35 above is not satisfied, the decoding apparatus may not apply the DMVR. The encoding apparatus may also apply the conditions of Table 35 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0351" num="0302">Further, as an embodiment of the present disclosure, whether to apply the BDOF may be determined by considering the weight factor of the explicit weight prediction for the luma component and the chroma component of the current block and in this case, the application condition of the BDOF may include conditions presented in Table 36 below</p><p id="p-0352" num="0000"><tables id="TABLE-US-00036" num="00036"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="217pt" align="left"/><thead><row><entry namest="1" nameend="1" rowsep="1">TABLE 36</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1</entry></row><row><entry>[ xSbIdx ][ ySbIdx ] are both equal to 1</entry></row><row><entry>DifPicOrderCnt( currPic, RefPicList[ 0 ][ refIdxL0 ] ) * </entry></row><row><entry>DiffPicOrderCnt( currPic,</entry></row><row><entry>RefPicList[ 1 ][ refldxL1 ] ) is less than 0.</entry></row><row><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>luma_weight_10_flag[ refIdxL0 ] and luma_weight_11_flag</entry></row><row><entry>[ refIdxL1 ] are equal to 0.</entry></row><row><entry>chroma_weight_10_flag[ refIdxL0 ] and </entry></row><row><entry>chroma_weight_11_flag[ refIdxL1 ] are equal to 0.</entry></row><row><entry>cIdx is equal to 0.</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0353" num="0303">Referring to Table 36 above, a condition (e.g., luma_weight_10_flag, luma_weight_11_flag) indicating whether to explicitly apply the weight to the luma component (luma prediction value) of the L0 prediction and the luma component (luma prediction value) of the L1 prediction and a condition (e.g., chroma_weight_10_flag, chroma_weight_11_flag) indicating whether to explicitly apply the weight to the chroma component (chroma prediction value) of the L0 prediction and the chroma component (chroma prediction value) of the L1 prediction are added to limitatively apply the BDOF only when the weights (i.e., weight factors) to both the luma and chroma components.</p><p id="p-0354" num="0304">For example, it may be determined that the weight factors of the L0 prediction and the L1 prediction for the luma component of the current block do not explicitly exist when the value of the flag information (e.g., luma_weight_10_flag) representing whether to explicitly apply the weight to the luma component (luma prediction value) of the L0 prediction is 0 and the value of the flag information (e.g., luma_weight_11_flag) representing whether to explicitly apply the weight to the luma component (luma prediction value) of the L1 prediction is 0.</p><p id="p-0355" num="0305">Further, it may be determined that the weight factors of the L0 prediction and the L1 prediction for the chroma component of the current block do not explicitly exist when the value of the flag information (e.g., chroma_weight_10_flag) representing whether to explicitly apply the weight to the chroma component (chroma prediction value) of the L0 prediction is 0 and the value of the flag information (e.g., chroma_weight_11_flag) representing whether to explicitly apply the weight to the chroma component (chroma prediction value) of the L1 prediction is 0.</p><p id="p-0356" num="0306">As such, when the weight factor does not exist for both the luma component and the chroma component, the BDOF may be limitatively applied.</p><p id="p-0357" num="0307">In the embodiment, together with the condition indicating whether the weight is explicitly applied to the L0 prediction and the L1 prediction of the luma component (e.g., luma_weight_10_flag and luma_weight_11_flag) and the condition indicating whether to explicitly apply the weight to the L0 prediction and the L1 prediction of the chroma component (e.g., chroma_weight_10 flag and chroma_weight_11_flag), it may be determined whether to apply the BDOF based on the remaining conditions listed in Table 37 above.</p><p id="p-0358" num="0308">In other words, the decoding apparatus may determine whether all conditions listed in Table 36 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 36 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 36 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0359" num="0309">The method for performing the true bi-prediction based on the conditions listed in Table 35 or 36 above may be independently applied to the DMVR and the BDOF or may be applied under the same condition for the DMVR and the BDOF.</p><p id="p-0360" num="0310">Meanwhile, as described above according to embodiments of the present disclosure, whether to apply the DMVR and the BDOF may be determined by considering the explicit weight prediction. In this case, in order to determine whether to apply the explicit weight prediction, a type of slice may be considered. Accordingly, the present disclosure proposes a method for determining whether to apply the DMVR and the BDOF by considering the slice type and whether to apply the weight prediction accordingly.</p><p id="p-0361" num="0311">As an embodiment of the present disclosure, whether to apply the DMVR and the BDOF may be determined by using flag information indicating whether to apply the weight prediction according to the type of current slice. Here, the flag information indicating whether to apply the weight prediction according to the type of current slice may be signaled from the encoding apparatus to the decoding apparatus through the picture parameter set (PPS) or sequence parameter set (SPS) syntax. As one example, Table 37 below shows the flag information signaled through the PPS syntax.</p><p id="p-0362" num="0000"><tables id="TABLE-US-00037" num="00037"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="3"><colspec colname="offset" colwidth="28pt" align="left"/><colspec colname="1" colwidth="119pt" align="left"/><colspec colname="2" colwidth="70pt" align="left"/><thead><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row><row><entry/><entry>pic_parameter_set_rbsp( ) {</entry><entry>Descriptor</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry/><entry>weighted_pred_flag</entry><entry>u(1)</entry></row><row><entry/><entry>weighted_bipred_flag</entry><entry>u(1)</entry></row><row><entry/><entry namest="offset" nameend="2" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0363" num="0312">Referring to Table 37 above, weighted_pred_flag and weighted_bipred_flag may be signaled from the encoding apparatus to the decoding apparatus. Here, weighted_pred_flag may be information indicating whether the weight prediction is applied to slice P and weighted_bipred_flag may be information indicating whether the weight prediction is applied to slice B.</p><p id="p-0364" num="0313">For example, when the value of weighted_pred_flag is 0, it may be indicated that the weight prediction is not applied to a P slice and when the value of weighted_pred_flag is 1, it may be indicated that the weight prediction is applied to the P slice. Further, when the value of weighted_bipred_flag is 0, it may be indicated that the weight prediction is not applied to a B slice and when the value of weighted_bipred_flag is 1, it may be indicated that the weight prediction is applied to the B slice.</p><p id="p-0365" num="0314">Here, the predictive (P) slice may mean a slice decoded based on an inter prediction (end) using one motion vector and one reference picture index. The bi-predictive (B) slice may mean a slice decoded based on an inter prediction using one or more, e.g., two motion vectors and reference picture indexes.</p><p id="p-0366" num="0315">As an embodiment of the present disclosure, whether to apply the DMVR may be determined based on flag information (e.g., weighted_pred_flag) indicating whether the weight prediction is applied to the P slice and flag information (e.g., weighted_bipred_flag) indicating whether the weight prediction is applied to the B slice and in this case, the application condition of the DMVR may include conditions presented in Table 38 below.</p><p id="p-0367" num="0000"><tables id="TABLE-US-00038" num="00038"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="217pt" align="left"/><thead><row><entry namest="1" nameend="1" rowsep="1">TABLE 38</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>sps_dmvr_enabled_flag is equal to 1</entry></row><row><entry>merge_flag[ xCb ][ yCb ] is equal to 1</entry></row><row><entry>both predFlagL0[ 0 ][ 0 ] and predFlagL1[ 0 ][ 0 ] are equal to 1</entry></row><row><entry>mmvd _flag[ xCb ][ yCb ] is equal to 0</entry></row><row><entry>GbiIdx[ xCb ][ yCb ] is equal to 0</entry></row><row><entry>!(weighted_pred_flag &#x26;&#x26; P_SLICE) &#x26;&#x26; </entry></row><row><entry>!(weighted_bipred_flag &#x26;&#x26; B_SLICE)</entry></row><row><entry>DiffPicOrderCnt( currPic, RefPicList[ 0 ][ refIdxL0 ] is equal to</entry></row><row><entry>DiffPicOrderCnt( RefPicList[ 1 ][ refIdxL1 ], currPic )</entry></row><row><entry>cbHeight is greater than or equal to 8</entry></row><row><entry>cbHeight*cbWidth is greater than or equal to 64</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0368" num="0316">Referring to Table 38 above, the condition (e.g., weighted_pred_flag) indicating whether the weight prediction is applied to the P slice, the condition (e.g., weighted_bipred_flag) indicating whether the weight prediction is applied to the B slice, and the index condition (e.g., GbiIdx) indicating the weights applied to the L0 prediction and the L1 prediction are added to limitatively apply the DMVR only when the weight prediction is not applied to the P slice and the B slice.</p><p id="p-0369" num="0317">For example, when the value of weighted_pred_flag is 1 and the current slice is not the P slice and when the value of weighted_bipred_flag is 1 and the current slice is not the B slice, the DMVR may be applied. In other words, when the weight prediction is not applied to the P slice and the weight prediction is not applied to the B slice, it may be determined that the DMVR is applied.</p><p id="p-0370" num="0318">Further, whether bi-prediction (i.e., L0 prediction and L1 prediction) of using different weights is applied to the current block may be determined based on a value of a bi-prediction weight index (e.g., GbiIdx) representing the weights applied to the L0 prediction and the L1 prediction. In other words, the case where the value of the bi-prediction weight index (e.g., GbiIdx) is 0 may be a default case in which different weights are not applied to the L0 prediction and the L1 prediction as described in the embodiment of Table 3 above. Accordingly, when the value of the bi-prediction weight index (e.g., GbiIdx) is 0, the DMVR may be limitatively applied.</p><p id="p-0371" num="0319">In the embodiment, together with the condition (e.g., weighted_pred_flag) indicating whether the weight prediction is applied to the P slice, the condition (e.g., weighted_bipred_flag) indicating whether the weight prediction is applied to the B slice, and the index condition (e.g., GbiIdx) indicating the weights applied to the L0 prediction and the L1 prediction, whether to apply the DMVR may be determined based on the remaining conditions listed in Table 39 above.</p><p id="p-0372" num="0320">In other words, the decoding apparatus may determine whether all conditions listed in Table 38 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the DMVR. When even any of the conditions listed in Table 38 above is not satisfied, the decoding apparatus may not apply the DMVR. The encoding apparatus may also apply the conditions of Table 38 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0373" num="0321">Further, as an embodiment of the present disclosure, whether to apply the BDOF may be determined based on flag information (e.g., weighted_pred_flag) indicating whether the weight prediction is applied to the P slice and flag information (e.g., weighted_bipred_flag) indicating whether the weight prediction is applied to the B slice and in this case, the application condition of the BDOF may include conditions presented in Table 39 below.</p><p id="p-0374" num="0000"><tables id="TABLE-US-00039" num="00039"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="217pt" align="left"/><thead><row><entry namest="1" nameend="1" rowsep="1">TABLE 39</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>predFlagL0[ xSbIdx ][ ySbIdx ]and predFlagL1</entry></row><row><entry>[ xSbIdx ][ ySbIdx ] are both equal to 1.</entry></row><row><entry>DiffPicOrderCnt( currPic, RefPicList[ 0 ][ refIdxL0 ] ) * </entry></row><row><entry>DiffPicOrderCnt( currPic,</entry></row><row><entry>RefPicList[ 1 ][ refIdxL1 ] ) is less than 0.</entry></row><row><entry>MotionModelIdc[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>!(weighted_pred_flag &#x26;&#x26; P_SLICE) &#x26;&#x26; </entry></row><row><entry>!(weighted_bipred_flag &#x26;&#x26; B_SLICE)</entry></row><row><entry>cIdx is equal to 0.</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0375" num="0322">Referring to Table 39 above, the condition (e.g., weighted_pred_flag) indicating whether the weight prediction is applied to the P slice and the condition (e.g., weighted_bipred_flag) indicating whether the weight prediction is applied to the B slice are added to limitatively apply the BDOF only when the weight prediction is not applied to the P slice and the B slice.</p><p id="p-0376" num="0323">For example, when the value of weighted_pred_flag is 1 and the current slice is not the P slice and when the value of weighted_bipred_flag is 1 and the current slice is not the B slice, the BDOF may be applied. In other words, when the weight prediction is not applied to the P slice and the weight prediction is not applied to the B slice, it may be determined that the BDOF is applied.</p><p id="p-0377" num="0324">In the embodiment, together with the condition (e.g., weighted_pred_flag) indicating whether the weight prediction is applied to the P slice, the condition (e.g., weighted_bipred_flag) indicating whether the weight prediction is applied to the B slice, and the index condition (e.g., GbiIdx) indicating the weights applied to the L0 prediction and the L1 prediction, whether to apply the BDOF may be determined based on the remaining conditions listed in Table 40 above.</p><p id="p-0378" num="0325">In other words, the decoding apparatus may determine whether all conditions listed in Table 39 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 39 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 39 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0379" num="0326">The method for performing the true bi-prediction based on the conditions listed in Table 38 or 39 above may be independently applied to the DMVR and the BDOF or may be applied under the same condition for the DMVR and the BDOF.</p><p id="p-0380" num="0327">Meanwhile, whether to perform bi-prediction or uni-prediction may be determined according to the block size. For example, when the size of the current block is small (e.g., a block having a size of 4&#xd7;8 or 8&#xd7;4), only the uni-prediction may be limited to be enabled and when the size of the current block is large, the bi-prediction may be configured to be enabled. As such, if only the uni-prediction is limited to be performed when the block size is small, the block size limited during the uni-prediction should be considered even for the DMVR and the BDOF performed in the case of the bi-prediction. For example, if only the uni-prediction is limited to be enabled when the size of the current block is 4&#xd7;8 or 8&#xd7;4, the bi-prediction may be performed when at least one of the height or the width of the current block is larger than 4. Accordingly, the present disclosure proposes a method for applying the DMVR and the BDOF by considering the block size applied during the bi-prediction or uni-prediction.</p><p id="p-0381" num="0328">As an embodiment of the present disclosure, proposed is a method for determining whether to apply the BDOF by considering the height (and/or width) of the current block. In this case, the application condition of the BDOF may include conditions presented in Table below.</p><p id="p-0382" num="0000"><tables id="TABLE-US-00040" num="00040"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="217pt" align="left"/><thead><row><entry namest="1" nameend="1" rowsep="1">TABLE 40</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>- The variable currPic specifies the current picture and </entry></row><row><entry>the variable bdofFlag is derived as follows:</entry></row><row><entry>&#x2003;- If all of the following conditions are true, </entry></row><row><entry>&#x2003;bdofFlag is set equal to TRUE.</entry></row><row><entry>&#x2003;&#x2003;- sps_bdof_enabled_flag is equal to 1.</entry></row><row><entry>&#x2003;&#x2003;- predFlagL0[ xSbIdx ][ ySbIdx ] and predFlagL1</entry></row><row><entry>&#x2003;&#x2003;&#x2003;[ xSbIdx ][ ySbdx ] are both equal to 1.</entry></row><row><entry>&#x2003;&#x2003;- DifPicOrderCnt( currPic, RefPicList[ 0 ][ refIdxL0 ] ) *</entry></row><row><entry>&#x2003;&#x2003;&#x2003;DffPicOrderCnt( currPic, RefPicList[ 1 ]</entry></row><row><entry>&#x2003;&#x2003;&#x2003;[ refIdxL1 ] ) is less than 0.</entry></row><row><entry>&#x2003;&#x2003;- MotionModelIdc[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>&#x2003;&#x2003;- merge_subblock_flag[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>&#x2003;&#x2003;GbiIdx[ xCb ][ yCb ] is equal to 0.</entry></row><row><entry>&#x2003;&#x2003;- cIdx is equal to 0.</entry></row><row><entry>&#x2003;&#x2003;- cbHeight is greater than 4</entry></row><row><entry>&#x2003;- Otherwise, bdofFlag is set equal to FALSE.</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0383" num="0329">Referring to Table 40 above, the BDOF may be applied to a block which is larger than a specific size by changing the conditions (e.g., cbHeight) related to the height (and/or width) of the current block. For example, when the height (e.g., CbHeight) of the current block is larger than 4, a condition of applying the BDOF may be used. Alternatively, when the width (e.g., CbWidth) of the current block is larger than 4, the condition of applying the BDOF may be used. When the condition related to the size of the current block (e.g., CbHeight or CbWidth) is satisfied (i.e., when the height of the current block is larger than 4), the BDOF may be applied and when the condition related to the size of the current block is not satisfied (i.e., when the height of the current block is equal to or smaller than 4), the BDOF may not be applied.</p><p id="p-0384" num="0330">Further, in the embodiment, together with the conditions (e.g., CbHeight and CbWidth) related to the size of the current block, whether to apply the BDOF may be determined based on the remaining application conditions listed in Table 40 above. In this case, bdofFlag may be derived according to the conditions listed in Table 41 above are satisfied. In this case, when all of the conditions listed in Table 41 above are satisfied, the value of bdofFlag may be derived as 1 (true), otherwise the value of bdofFlag may be derived as 0 (false). Here, bdofFlag may be flag information indicating whether the BDOF is applied to the current block.</p><p id="p-0385" num="0331">In other words, the decoding apparatus may determine whether all conditions listed in Table 40 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the BDOF. When even any of the conditions listed in Table 40 above is not satisfied, the decoding apparatus may not apply the BDOF. The encoding apparatus may also apply the conditions of Table 40 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0386" num="0332">Further, as an embodiment of the present disclosure, proposed is a method for determining whether to apply the DMVR by considering the height (and/or width) of the current block. In this case, the application condition of the DMVR may include conditions presented in Table 41 below.</p><p id="p-0387" num="0000"><tables id="TABLE-US-00041" num="00041"><table frame="none" colsep="0" rowsep="0"><tgroup align="left" colsep="0" rowsep="0" cols="1"><colspec colname="1" colwidth="217pt" align="left"/><thead><row><entry namest="1" nameend="1" rowsep="1">TABLE 41</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></thead><tbody valign="top"><row><entry>- The variable currPic specifies the current picture and the variable </entry></row><row><entry>dmvrFlag is derived as follows:</entry></row><row><entry>&#x2003;- If all of the following conditions are true, dmvrFlag </entry></row><row><entry>&#x2003;&#x2003;is set equal to TRUE.</entry></row><row><entry>&#x2003;&#x2003;- sps_dmvr_enabled_flag is equal to 1</entry></row><row><entry>&#x2003;&#x2003;- merge flag[ xCb ][ yCb ] is equal to 1</entry></row><row><entry>&#x2003;&#x2003;- both predFlag[ 0 ][ 0 ] and predFlagL1[ 0 ][ 0 ] are equal to 1</entry></row><row><entry>&#x2003;&#x2003;- mmvd_flag[ xCb ][ yCb ] is equal to 0</entry></row><row><entry>&#x2003;&#x2003;- DiffPicOrderCnt( currPic, RefPicList[ 0 ][ refIdxL0 ]) is equal to</entry></row><row><entry>&#x2003;&#x2003;DifPicOrderCnt( RefPicList[ 1 ][ refIdxL1 ], currPic )</entry></row><row><entry>&#x2003;&#x2003;- cbHeight is greater than 4</entry></row><row><entry>Otherwise, dmvrFlag is set equal to FALSE.</entry></row><row><entry namest="1" nameend="1" align="center" rowsep="1"/></row></tbody></tgroup></table></tables></p><p id="p-0388" num="0333">Referring to Table 41 above, the DMVR may be applied to a block which is larger than a specific size by changing the conditions (e.g., cbHeight) related to the height (and/or width) of the current block. For example, when the height (e.g., CbHeight) of the current block is larger than 4, a condition of applying the DMVR may be used. Alternatively, when the width (e.g., CbWidth) of the current block is larger than 4, the condition of applying the DMVR may be used. When the condition related to the size of the current block (e.g., CbHeight or CbWidth) is satisfied (i.e., when the height of the current block is larger than 4), the DMVR may be applied and when the condition related to the size of the current block is not satisfied (i.e., when the height of the current block is equal to or smaller than 4), the DMVR may not be applied.</p><p id="p-0389" num="0334">Further, in the embodiment, together with the conditions (e.g., CbHeight and CbWidth) related to the size of the current block, whether to apply the DMVR may be determined based on the remaining application conditions listed in Table 41 above. In this case, dmvrFlag may be derived according to the conditions listed in Table 41 above are satisfied. In this case, when all of the conditions listed in Table 41 above are satisfied, the value of dmvrFlag may be derived as 1 (true), otherwise the value of dmvrFlag may be derived as 0 (false). Here, dmvrFlag may be flag information indicating whether the DMVR is applied to the current block.</p><p id="p-0390" num="0335">In other words, the decoding apparatus may determine whether all conditions listed in Table 41 above are satisfied and when all conditions are satisfied, the decoding apparatus may perform the true bi-prediction by applying the DMVR. When even any of the conditions listed in Table 41 above is not satisfied, the decoding apparatus may not apply the DMVR. The encoding apparatus may also apply the conditions of Table 41 above and the encoding apparatus may perform the true bi-prediction by a corresponding method in the decoding apparatus.</p><p id="p-0391" num="0336">The method for performing the true bi-prediction based on the conditions listed in Table 40 or 41 above may be independently applied to the DMVR and the BDOF or may be applied under the same condition for the DMVR and the BDOF.</p><p id="p-0392" num="0337">In the present disclosure, DMVR flag information indicating whether to apply the DMVR and BDOF flag information indicating whether to apply the BDOF may be derived based on the application conditions of Tables 1 to 41 described above.</p><p id="p-0393" num="0338">For example, the DMVR flag information (e.g., dmvrFlag) may be derived based on the application conditions (at least one of the application conditions of Tables 1 to 41 or a combination of the application conditions). In this case, when the value of dmvrFlag is 1 (or true), it may be indicated that the DMVR is applied and when the value of dmvrFlag is 0 (or false), it may be indicated that the DMVR is not applied. Further, the BDOF flag information (e.g., bdofFlag) may be derived based on the application conditions (at least one of the application conditions of Tables 2 to 42 or a combination of the application conditions) of the BDOF. In this case, when the value of bdofFlag is 1 (or true), it may be indicated that the BDOF is applied and when the value of bdofFlag is 0 (or false), it may be indicated that the BDOF is not applied.</p><p id="p-0394" num="0339"><figref idref="DRAWINGS">FIG. <b>10</b></figref> is a flowchart schematically illustrating an encoding method that can be performed by an encoding apparatus according to an embodiment of this document.</p><p id="p-0395" num="0340">The method disclosed in <figref idref="DRAWINGS">FIG. <b>10</b></figref> may be performed by the encoding apparatus <b>200</b> disclosed in <figref idref="DRAWINGS">FIG. <b>2</b></figref>. Specifically, steps S<b>1000</b> to S<b>1030</b> of <figref idref="DRAWINGS">FIG. <b>10</b></figref> may be performed by the predictor <b>220</b> and the inter predictor <b>221</b> disclosed in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, and step S<b>1040</b> of <figref idref="DRAWINGS">FIG. <b>10</b></figref> may be performed by the residual processor <b>230</b> disclosed in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, step S<b>1050</b> of <figref idref="DRAWINGS">FIG. <b>10</b></figref> may be performed by the entropy encoder <b>240</b> disclosed in <figref idref="DRAWINGS">FIG. <b>2</b></figref>. Further, the method disclosed in <figref idref="DRAWINGS">FIG. <b>10</b></figref> may include the above-described embodiments in this document. Accordingly, the detailed explanation of the contents duplicate to the above-described embodiments in FIG. will be omitted or simplified.</p><p id="p-0396" num="0341">Referring to <figref idref="DRAWINGS">FIG. <b>10</b></figref>, the encoding apparatus may derive an L0 motion vector and an L1 motion vector of a current block (S<b>1000</b>).</p><p id="p-0397" num="0342">As an embodiment, when performing the inter prediction for the current block, the encoding apparatus may derive motion information (motion vector, reference picture index, etc.) of the current block. For example, the encoding apparatus may search a block similar to the current block in a predetermined area (search area) of reference pictures through motion estimation and derive a reference block in which a difference from the current block is minimum or is equal to or less than a predetermined criterion. A reference picture index indicating a reference picture at which the reference block is positioned may be derived based thereon and a motion vector may be derived based on a difference in location between the reference block and the current block.</p><p id="p-0398" num="0343">Further, the encoding apparatus may determine an inter prediction mode applied to the current block among various prediction modes. The encoding apparatus may compare RD cost for the various prediction modes and determine an optimal prediction mode for the current block.</p><p id="p-0399" num="0344">For example, the encoding apparatus may determine whether to apply the merge mode as an optimal prediction mode for the current block. When applying the merge mode to the current block, the encoding apparatus may configure a merge candidate list based on neighboring blocks of the current block and generate merge index information. Specifically, a reference block may be derived in which a difference from the current block is minimum or is equal to or less than a predetermined criterion among reference blocks (i.e., neighboring blocks) indicated by merge candidates included in the merge candidate list. In this case, a merge candidate associated with the derived reference block may be selected and merge index information indicating the selected merge candidate may be generated and signaled to the decoding apparatus. The motion information of the current block may be derived by using the motion information of the selected merge candidate.</p><p id="p-0400" num="0345">Here, the motion information may include information, such as a motion vector, a reference picture index, and the like, and may include L0 motion information and/or L1 motion information depending on an inter prediction type (L0 prediction, L1 prediction, Bi prediction, and the like). When a bi-prediction is applied to the current block, the motion information may include a motion vector (L0 motion vector) in an L0 direction and a motion vector (L1 motion vector) in an L1 direction. Further, the motion information may include an L0 reference picture index and an L0 reference picture indicated by the L0 reference picture index in an L0 reference picture list, and an L1 reference picture index and an L1 reference picture indicated by the L1 reference picture index in an L1 reference picture list.</p><p id="p-0401" num="0346">In other words, when the merge mode is applied, the encoding apparatus may derive the L0 motion vector and the L1 motion vector of the neighboring block indicated by the merge index information among the neighboring blocks of the current block and use the derived L0 and L1 motion vectors as the L0 and L1 motion vectors of the current block.</p><p id="p-0402" num="0347">The encoding apparatus may derive DMVR flag information related to indicating whether to apply DMVR to the current block (S<b>1010</b>).</p><p id="p-0403" num="0348">The encoding apparatus may determine whether to apply the DMVR to the current block in consideration of coding efficiency, complexity, prediction performance, and the like. That is, the encoding apparatus may apply the DMVR to the current block based on whether application conditions of the DMVR for the current block are satisfied. Here, the application conditions of the DMVR may be composed of some (or all) or specific combinations of the various application conditions described in Tables 1 to 41 above. Further, the encoding apparatus may derive the DMVR flag information according to whether the application conditions of the DMVR are satisfied. The DMVR flag information may be information (e.g., dmvrFlag described above) related to indicating whether to apply the DMVR to the current block.</p><p id="p-0404" num="0349">In an embodiment, the application conditions of the DMVR may include a case where a height of the current block is equal to or larger than 8. In this case, when the case where the height of the current block is equal to or larger than 8 is satisfied, the encoding apparatus may derive the DMVR flag information related to indicating that the DMVR is applied to the current block. For example, when the height of the current block is equal to or larger than 8, the DMVR flag information may be derived as a value (e.g., 1 or true) indicating that the DMVR is applied to the current block. Otherwise (i.e., when the height of the current block is less than 8), the DMVR flag information may be derived as a value (e.g., 0 or false) indicating that the DMVR is not applied to the current block.</p><p id="p-0405" num="0350">Further, according to an embodiment, the application conditions of the DMVR may include a case where a value of L0 luma weight prediction flag information and a value of L1 luma weight prediction flag information are both equal to 0. In this case, when the case where the value of the L0 luma weight prediction flag information (e.g., luma_weight_10_flag) and the value of the L1 luma weight prediction flag information (e.g., luma_weight_11_flag) are both equal to 0 is satisfied, the encoding apparatus may derive the DMVR flag information related to indicating that the DMVR is applied to the current block. For example, when both the value of the luma_weight_10_flag and the value of the luma_weight_11_flag are equal to 0, the DMVR flag information may be derived as a value (e.g., 1 or true) indicating that the DMVR is applied to the current block. Otherwise, the DMVR flag information may be derived as a value (e.g., 0 or false) indicating that the DMVR is not applied to the current block.</p><p id="p-0406" num="0351">Here, the L0 luma weight prediction flag information may be information related to indicating whether a weight factor of an L0 prediction for a luma component of the current block is present, and the L1 luma weight prediction flag information may be information related to indicating whether a weight factor of an L1 prediction for the luma component of the current block is present. For example, a case where the value of the L0 luma weight prediction flag information is equal to 0 may represent that the weight factor for the luma component of the L0 prediction is not present, and a case where the value of the L0 luma weight prediction flag information is equal to 1 may represent that the weight factor for the luma component of the L0 prediction is present. Further, a case where the value of the L1 luma weight prediction flag information is equal to 0 may represent that the weight factor for the luma component of the L1 prediction is not present, and a case where the value of the L1 luma weight prediction flag information is equal to 1 may represent that the weight factor for the luma component of the L1 prediction is present.</p><p id="p-0407" num="0352">Further, according to an embodiment, the encoding apparatus may include the case where the height of the current block is equal to or larger than 8 and the case where the value of the L0 luma weight prediction flag information and the value of the L1 luma weight prediction flag information are both equal to 0, as the application conditions of DMVR. In this case, when both conditions described above are satisfied, the encoding apparatus may derive the DMVR flag information related to indicating that the DMVR is applied to the current block.</p><p id="p-0408" num="0353">Further, according to an embodiment, the application conditions of the DMVR may include a condition in which a prediction mode (CIIP mode) in which an inter prediction and an intra prediction are combined is not applied to the current block In this case, when the case where the prediction mode in which the inter prediction and the intra prediction are combined is not applied to the current block (e.g., a case where a value of ciip_flag is equal to 0) is satisfied, the encoding apparatus may derive the DMVR flag information related to indicating that the DMVR is applied to the current block. For example, when the value of the ciip_flag is equal to 0, the DMVR flag information may be derived as a value (e.g., 1 or true) indicating that the DMVR is applied to the current block. When the value of the ciip_flag is equal to 1, the DMVR flag information may be derived as a value (e.g., 0 or false) indicating that the DMVR is not applied to the current block.</p><p id="p-0409" num="0354">Further, according to an embodiment, the application conditions of the DMVR may include a condition in which a value of bi-prediction weight index information of the current block is equal to 0. In this case, when the case where the value of the bi-prediction weight index information (e.g., GbiIdx) is equal to 0 is satisfied, the encoding apparatus may derive the DMVR flag information related to indicating that the DMVR is applied to the current block. For example, when the value of the GbiIdx is equal to 0, the DMVR flag information may be derived as a value (e.g., 1 or true) indicating that the DMVR is applied to the current block. Otherwise, the DMVR flag information may be derived as a value (e.g., 0 or false) indicating that the DMVR is not applied to the current block. Here, the case where the value of the bi-prediction weight index (e.g., GbiIdx) is equal to 0 may be a default case in which different weights are not applied to the L0 prediction and the L1 prediction. As one example, as shown in Table 3 above, the case where the value of the bi-prediction weight index information is equal to 0 may be a case where the &#xbd; weight is applied to each of the L0 prediction and the L1 prediction.</p><p id="p-0410" num="0355">Further, according to an embodiment, the application conditions of the DMVR may include conditions such as a case where DMVR-based inter bi-prediction is enabled, a case where bi-prediction performed based on an L0 reference picture and an L1 reference picture is applied to the current block, a case where a difference from an L0 reference picture and a difference from an L1 reference picture are the same with respect to the current picture, a case where a merge mode is applied to the current block, a case where a merge mode with motion vector difference (MMVD) mode is not applied to the current block.</p><p id="p-0411" num="0356">The encoding apparatus may include at least one of the above-described DMVR application conditions, and may derive the DMVR flag information based on the DMVR application conditions. In this case, when one or more conditions are included as the DMVR application conditions, the encoding apparatus may derive the value of the DMVR flag information as true or 1 when all of the DMVR application conditions are satisfied. Otherwise, the encoding apparatus may derive the value of the DMVR flag information as false or 0.</p><p id="p-0412" num="0357">Here, in deriving the DMVR flag information, the listed DMVR application conditions are just examples and the conditions of Tables 1 to 41 described above may be used in various combinations.</p><p id="p-0413" num="0358">When the DMVR flag information indicates that the DMVR is applied to the current block (e.g., when the DMVR flag information is derived as a value of true or 1), the encoding apparatus may derive a refined L0 motion vector and a refined L1 motion vector based on the L0 motion vector and the L1 motion vector by applying the DMVR to the current block (S<b>1020</b>).</p><p id="p-0414" num="0359">In an embodiment, the encoding apparatus may calculate a minimum sum of absolute differences (SAD) based on L0 prediction samples being derived based on the L0 motion vector and L1 prediction samples being derived based on the L1 motion vector. Further, the encoding apparatus may derive the refined L0 motion vector for the L0 motion vector and the refined L1 motion vector for the L1 motion vector based on a sample location corresponding to the minimum SAD.</p><p id="p-0415" num="0360">Here, the L0 prediction samples may be derived based on reference samples indicated by the L0 motion vector in the L0 reference picture, and the L1 prediction samples may be derived based on reference samples indicated by the L1 motion vector in the L1 reference picture. As described above, the L0 reference picture may be a reference picture indicated by the L0 reference picture index among the reference pictures included in the L0 reference picture list, and the L1 reference picture may be a reference picture indicated by the L1 reference picture index among the reference pictures included in the L1 reference picture list.</p><p id="p-0416" num="0361">Further, the refined L0 motion vector may be a motion vector related to indicating the sample location corresponding to the minimum SAD in the L0 reference picture, and the refined L1 motion vector may be a motion vector related to indicating the sample location corresponding to the minimum SAD in the L1 reference picture. Since the process of deriving the refined motion vector by applying the DMVR has been described in detail with reference to <figref idref="DRAWINGS">FIGS. <b>4</b> and <b>5</b></figref>, the explanation thereof will be omitted hereinafter.</p><p id="p-0417" num="0362">The encoding apparatus may derive prediction samples for the current block based on the refined L0 motion vector and the refined L1 motion vector (S<b>1030</b>).</p><p id="p-0418" num="0363">In an embodiment, the encoding apparatus may derive the prediction samples of the current block by weighted summing the L0 prediction samples derived based on the refined L0 motion vector and the L1 prediction samples derived based on the refined L1 motion vector.</p><p id="p-0419" num="0364">In deriving the prediction samples, the encoding apparatus may determine whether to apply BDOF to the current block in consideration of coding efficiency, complexity, prediction performance, and the like. That is, the encoding apparatus may apply the BDOF to the current block based on whether application conditions of the BDOF are satisfied for the current block. Here, the application conditions of the BDOF may be constituted by some (or all) or specific combinations of various application conditions described in Tables 1 to 41 above. Further, the encoding apparatus may derive BDOF flag information according to whether the application conditions of the BDOF are satisfied. The BDOF flag information may be information (e.g., bdofFlag described above) related to indicating whether to apply the BDOF to the current block.</p><p id="p-0420" num="0365">In an embodiment, the application conditions of the BDOF may include a case where a value of L0 luma weight prediction flag information and a value of L1 luma weight prediction flag information are both equal to 0. In this case, when the case where the value of the L0 luma weight prediction flag information (e.g., luma_weight_10_flag) and the value of the L1 luma weight prediction flag information (e.g., luma_weight_11_flag) are both equal to 0 is satisfied, the encoding apparatus may derive the BDOF flag information related to indicating that the BDOF is applied to the current block. For example, when both the value of the luma_weight_10_flag and the value of the luma_weight_11_flag are equal to 0, the BDOF flag information may be derived as a value (e.g., 1 or true) indicating that the BDOF is applied to the current block. Otherwise, the BDOF flag information may be derived as a value (e.g., 0 or false) indicating that the BDOF is not applied to the current block.</p><p id="p-0421" num="0366">Further, according to an embodiment, the application conditions of the BDOF may include a condition in which a prediction mode (CIIP mode) in which an inter prediction and an intra prediction are combined is not applied to the current block. In this case, when the case where the prediction mode in which the inter prediction and the intra prediction are combined is not applied to the current block (e.g., a case where a value of ciip_flag is equal to 0) is satisfied, the encoding apparatus may derive the BDOF flag information related to indicating that the BDOF is applied to the current block. For example, when the value of the ciip_flag is equal to 0, the BDOF flag information may be derived as a value (e.g., 1 or true) indicating that the BDOF is applied to the current block. When the value of the ciip_flag is equal to 1, the BDOF flag information may be derived as a value (e.g., 0 or false) indicating that the BDOF is not applied to the current block.</p><p id="p-0422" num="0367">Further, according to an embodiment, the application conditions of the BDOF may include a condition in which a first picture order count (POC) difference between the current picture and the L0 reference picture and a second POC difference between the current picture and the L1 reference picture are the same. In this case, when the case where the first POC difference (e.g., DiffPicOrderCnt(currPic, RefPicList0[refIdxL0])) and the second POC difference (e.g., DiffPicOrderCnt(currPic, RefPicList1 [refIdxL1])) are the same as each other is satisfied, the encoding apparatus may derive the BDOF flag information related to indicating that the BDOF is applied to the current block. For example, when DiffPicOrderCnt(currPic, RefPicList0 [refIdxL0])&#x2212;DiffPicOrderCnt(currPic, RefPicList1 [refIdxL1]) is equal to 0, the BDOF flag information may be derived as a value (e.g., 1 or true) indicating that the BDOF is applied to the current block. Otherwise, the BDOF flag information may be derived as a value (e.g., 0 or false) indicating that the BDOF is not applied to the current block.</p><p id="p-0423" num="0368">Further, according to an embodiment, the application conditions of the BDOF may include conditions such as a case where BDOF-based inter prediction is enabled, a case where bi-prediction performed based on an L0 reference picture and an L1 reference picture is applied to the current block, a case where a value of bi-prediction weight index information of the current block is equal to 0, a case where an affine mode is not applied to the current block, a case where a subblock-based merge mode is not applied to the current block, a case where the current block is a luma component, a case where a height of the current block is equal to or larger than 8.</p><p id="p-0424" num="0369">The encoding apparatus may include at least one of the above-described BDOF application conditions, and may derive the BDOF flag information based on the BDOF application conditions. In this case, when one or more conditions are included as the BDOF application conditions, the encoding apparatus may derive the value of the BDOF flag information as true or 1 when all of the BDOF application conditions are satisfied. Otherwise, the encoding apparatus may derive the value of the BDOF flag information as false or 0.</p><p id="p-0425" num="0370">Here, in deriving the BDOF flag information, the listed BDOF application conditions are just examples and the conditions of Tables 1 to 41 described above may be used in various combinations.</p><p id="p-0426" num="0371">When the BDOF flag information indicates that the BDOF is applied to the current block (e.g., when the BDOF flag information is derived as a value of true or 1), the encoding apparatus may derive the prediction samples by applying the BDOF to the current block.</p><p id="p-0427" num="0372">In an embodiment, the encoding apparatus may calculate a first gradient for the L0 prediction samples derived based on the refined L0 motion vector and a second gradient for the L1 prediction samples derived based on the refined L1 motion vector. In addition, the encoding apparatus may finally derive the prediction samples for the current block based on the L0 prediction samples, the L1 prediction samples, the first gradient, and the second gradient. For example, the process of deriving the prediction samples by applying the BDOF may use calculations such as Equations 1 to 6 described above.</p><p id="p-0428" num="0373">The encoding apparatus may derive residual samples for the current block based on the prediction samples (S<b>1040</b>), and encode image information including information on the residual samples (S<b>1050</b>).</p><p id="p-0429" num="0374">That is, the encoding apparatus may derive the residual samples based on the original samples of the current block and the prediction samples of the current block. And, the encoding apparatus may generate the information on the residual samples. Here, the information on the residual samples may include information, such as value information, location information, transform technique, transform kernel, and quantization parameter information of quantized transform coefficients derived by performing transform and quantization of the residual samples.</p><p id="p-0430" num="0375">The encoding apparatus may encode the information on the residual samples to output the encoded information in the form of a bitstream, and may transmit the bitstream to the decoding apparatus through a network or a storage medium.</p><p id="p-0431" num="0376">Further, the encoding apparatus may encode the image information derived through the above-described steps S<b>1000</b> to S<b>1050</b>, and may output the encoded information in the form of a bitstream. For example, merge flag information, merge index information, L0 reference picture index, L1 reference picture index, L0 luma weight flag information, L1 luma weight flag information, bi-prediction weight index information, etc. may be included in the image information to be encoded, and the encoded image information may be signaled to the decoding apparatus.</p><p id="p-0432" num="0377"><figref idref="DRAWINGS">FIG. <b>11</b></figref> is a flowchart schematically illustrating a decoding method that can be performed by a decoding apparatus according to an embodiment of this document.</p><p id="p-0433" num="0378">The method disclosed in <figref idref="DRAWINGS">FIG. <b>11</b></figref> may be performed by the decoding apparatus <b>300</b> disclosed in <figref idref="DRAWINGS">FIG. <b>3</b></figref>. Specifically, steps S<b>1100</b> to S<b>1130</b> of <figref idref="DRAWINGS">FIG. <b>11</b></figref> may be performed by the predictor <b>330</b> and the inter predictor <b>332</b> disclosed in <figref idref="DRAWINGS">FIG. <b>3</b></figref>, step S<b>1140</b> of <figref idref="DRAWINGS">FIG. <b>11</b></figref> may be performed by the adder <b>340</b> disclosed in <figref idref="DRAWINGS">FIG. <b>3</b></figref>. Further, the method disclosed in <figref idref="DRAWINGS">FIG. <b>11</b></figref> may include the above-described embodiments in this document. Accordingly, the detailed explanation of the contents duplicate to the above-described embodiments in <figref idref="DRAWINGS">FIG. <b>11</b></figref> will be omitted or simplified.</p><p id="p-0434" num="0379">Referring to <figref idref="DRAWINGS">FIG. <b>11</b></figref>, the decoding apparatus may derive an L0 motion vector and an L1 motion vector of a current block (Sl<b>100</b>).</p><p id="p-0435" num="0380">In an embodiment, the decoding apparatus may determine a prediction mode for the current block based on prediction information signaled from the encoding apparatus. And, the decoding apparatus may derive motion information (motion vector, reference picture index, etc.) of the current block based on the prediction mode. Here, the prediction mode may include a skip mode, a merge mode, and (A)MVP mode, and the like.</p><p id="p-0436" num="0381">For example, when the merge mode is applied to the current block, the decoding apparatus may construct a merge candidate list based on neighboring blocks of the current block and select one merge candidate from among merge candidates included in the merge candidate list. In this case, one merge candidate may be selected from the merge candidate list based on the above-described merge index information. The decoding apparatus may derive motion information of the current block by using motion information of the selected merge candidate. That is, the motion information of the merge candidate selected by the merge index among the merge candidates included in the merge candidate list may be used as the motion information of the current block.</p><p id="p-0437" num="0382">Here, the motion information may include information, such as a motion vector, a reference picture index, and the like, and may include L0 motion information and/or L1 motion information depending on an inter prediction type (L0 prediction, L1 prediction, Bi prediction, and the like). When a bi-prediction is applied to the current block, the motion information may include a motion vector (L0 motion vector) in an L0 direction and a motion vector (L1 motion vector) in an L1 direction. Further, the motion information may include an L0 reference picture index and an L0 reference picture indicated by the L0 reference picture index in an L0 reference picture list, and an L1 reference picture index and an L1 reference picture indicated by the L1 reference picture index in an L1 reference picture list.</p><p id="p-0438" num="0383">That is, the decoding apparatus may determine whether the merge mode is applied to the current block based on the prediction mode information of the current block (e.g., a merge flag (e.g., merge_flag) indicating whether the merge mode is applied). When the merge mode is applied to the current block based on the merge flag, the decoding apparatus may obtain merge index information. Further, the decoding apparatus may derive the L0 motion vector and the L1 motion vector of the neighboring block indicated by the merge index information among the neighboring blocks included in the merge candidate list, and use the L0 and L1 motion vectors of the neighboring block as the L0 and L1 motion vectors of the current block.</p><p id="p-0439" num="0384">The decoding apparatus may derive DMVR flag information related to indicating whether to apply DMVR to the current block (S<b>1110</b>).</p><p id="p-0440" num="0385">The decoding apparatus may determine whether to apply the DMVR to the current block in consideration of coding efficiency, complexity, prediction performance, and the like. That is, the decoding apparatus may apply the DMVR to the current block based on whether application conditions of the DMVR for the current block are satisfied. Here, the application conditions of the DMVR may be composed of some (or all) or specific combinations of the various application conditions described in Tables 1 to 41 above. Further, the decoding apparatus may derive the DMVR flag information according to whether the application conditions of the DMVR are satisfied. The DMVR flag information may be information (e.g., dmvrFlag described above) related to indicating whether to apply the DMVR to the current block.</p><p id="p-0441" num="0386">In an embodiment, the application conditions of the DMVR may include a case where a height of the current block is equal to or larger than 8. In this case, when the case where the height of the current block is equal to or larger than 8 is satisfied, the decoding apparatus may derive the DMVR flag information related to indicating that the DMVR is applied to the current block. For example, when the height of the current block is equal to or larger than 8, the DMVR flag information may be derived as a value (e.g., 1 or true) indicating that the DMVR is applied to the current block. Otherwise (i.e., when the height of the current block is less than 8), the DMVR flag information may be derived as a value (e.g., 0 or false) indicating that the DMVR is not applied to the current block.</p><p id="p-0442" num="0387">Further, according to an embodiment, the application conditions of the DMVR may include a case where a value of L0 luma weight prediction flag information and a value of L1 luma weight prediction flag information are both equal to 0. In this case, when the case where the value of the L0 luma weight prediction flag information (e.g., luma_weight_10_flag) and the value of the L1 luma weight prediction flag information (e.g., luma_weight_11_flag) are both equal to 0 is satisfied, the decoding apparatus may derive the DMVR flag information related to indicating that the DMVR is applied to the current block. For example, when both the value of the luma_weight_10_flag and the value of the luma_weight_11 flag are equal to 0, the DMVR flag information may be derived as a value (e.g., 1 or true) indicating that the DMVR is applied to the current block. Otherwise, the DMVR flag information may be derived as a value (e.g., 0 or false) indicating that the DMVR is not applied to the current block.</p><p id="p-0443" num="0388">Here, the L0 luma weight prediction flag information may be information related to indicating whether a weight factor of an L0 prediction for a luma component of the current block is present, and the L1 luma weight prediction flag information may be information related to indicating whether a weight factor of an L1 prediction for the luma component of the current block is present. For example, a case where the value of the L0 luma weight prediction flag information is equal to 0 may represent that the weight factor for the luma component of the L0 prediction is not present, and a case where the value of the L0 luma weight prediction flag information is equal to 1 may represent that the weight factor for the luma component of the L0 prediction is present. Further, a case where the value of the L1 luma weight prediction flag information is equal to 0 may represent that the weight factor for the luma component of the L1 prediction is not present, and a case where the value of the L1 luma weight prediction flag information is equal to 1 may represent that the weight factor for the luma component of the L1 prediction is present.</p><p id="p-0444" num="0389">Further, according to an embodiment, the decoding apparatus may include the case where the height of the current block is equal to or larger than 8 and the case where the value of the L0 luma weight prediction flag information and the value of the L1 luma weight prediction flag information are both equal to 0, as the application conditions of DMVR. In this case, when both conditions described above are satisfied, the decoding apparatus may derive the DMVR flag information related to indicating that the DMVR is applied to the current block.</p><p id="p-0445" num="0390">Further, according to an embodiment, the application conditions of the DMVR may include a condition in which a prediction mode (CIIP mode) in which an inter prediction and an intra prediction are combined is not applied to the current block. In this case, when the case where the prediction mode in which the inter prediction and the intra prediction are combined is not applied to the current block (e.g., a case where a value of ciip_flag is equal to 0) is satisfied, the decoding apparatus may derive the DMVR flag information related to indicating that the DMVR is applied to the current block. For example, when the value of the ciip_flag is equal to 0, the DMVR flag information may be derived as a value (e.g., 1 or true) indicating that the DMVR is applied to the current block. When the value of the ciip_flag is equal to 1, the DMVR flag information may be derived as a value (e.g., 0 or false) indicating that the DMVR is not applied to the current block.</p><p id="p-0446" num="0391">Further, according to an embodiment, the application conditions of the DMVR may include a condition in which a value of bi-prediction weight index information of the current block is equal to 0. In this case, when the case where the value of the bi-prediction weight index information (e.g., GbiIdx) is equal to 0 is satisfied, the decoding apparatus may derive the DMVR flag information related to indicating that the DMVR is applied to the current block. For example, when the value of the GbiIdx is equal to 0, the DMVR flag information may be derived as a value (e.g., 1 or true) indicating that the DMVR is applied to the current block. Otherwise, the DMVR flag information may be derived as a value (e.g., 0 or false) indicating that the DMVR is not applied to the current block. Here, the case where the value of the bi-prediction weight index (e.g., GbiIdx) is equal to 0 may be a default case in which different weights are not applied to the L0 prediction and the L1 prediction. As one example, as shown in Table 3 above, the case where the value of the bi-prediction weight index information is equal to 0 may be a case where the &#xbd; weight is applied to each of the L0 prediction and the L1 prediction.</p><p id="p-0447" num="0392">Further, according to an embodiment, the application conditions of the DMVR may include conditions such as a case where DMVR-based inter bi-prediction is enabled, a case where bi-prediction performed based on an L0 reference picture and an L1 reference picture is applied to the current block, a case where a difference from an L0 reference picture and a difference from an L1 reference picture are the same with respect to the current picture, a case where a merge mode is applied to the current block, a case where a merge mode with motion vector difference (MMVD) mode is not applied to the current block.</p><p id="p-0448" num="0393">The decoding apparatus may include at least one of the above-described DMVR application conditions, and may derive the DMVR flag information based on the DMVR application conditions. In this case, when one or more conditions are included as the DMVR application conditions, the decoding apparatus may derive the value of the DMVR flag information as true or 1 when all of the DMVR application conditions are satisfied. Otherwise, the decoding apparatus may derive the value of the DMVR flag information as false or 0.</p><p id="p-0449" num="0394">Here, in deriving the DMVR flag information, the listed DMVR application conditions are just examples and the conditions of Tables 1 to 41 described above may be used in various combinations.</p><p id="p-0450" num="0395">When the DMVR flag information indicates that the DMVR is applied to the current block (e.g., when the DMVR flag information is derived as a value of true or 1), the decoding apparatus may derive a refined L0 motion vector and a refined L1 motion vector based on the L0 motion vector and the L1 motion vector by applying the DMVR to the current block (S<b>1120</b>).</p><p id="p-0451" num="0396">In an embodiment, the decoding apparatus may calculate a minimum sum of absolute differences (SAD) based on L0 prediction samples being derived based on the L0 motion vector and L1 prediction samples being derived based on the L1 motion vector. Further, the decoding apparatus may derive the refined L0 motion vector for the L0 motion vector and the refined L1 motion vector for the L1 motion vector based on a sample location corresponding to the minimum SAD.</p><p id="p-0452" num="0397">Here, the L0 prediction samples may be derived based on reference samples indicated by the L0 motion vector in the L0 reference picture, and the L1 prediction samples may be derived based on reference samples indicated by the L1 motion vector in the L1 reference picture. As described above, the L0 reference picture may be a reference picture indicated by the L0 reference picture index among the reference pictures included in the L0 reference picture list, and the L1 reference picture may be a reference picture indicated by the L1 reference picture index among the reference pictures included in the L1 reference picture list.</p><p id="p-0453" num="0398">Further, the refined L0 motion vector may be a motion vector related to indicating the sample location corresponding to the minimum SAD in the L0 reference picture, and the refined L1 motion vector may be a motion vector related to indicating the sample location corresponding to the minimum SAD in the L1 reference picture. Since the process of deriving the refined motion vector by applying the DMVR has been described in detail with reference to <figref idref="DRAWINGS">FIGS. <b>4</b> and <b>5</b></figref>, the explanation thereof will be omitted hereinafter.</p><p id="p-0454" num="0399">The decoding apparatus may derive prediction samples for the current block based on the refined L0 motion vector and the refined L1 motion vector (S<b>1130</b>).</p><p id="p-0455" num="0400">In an embodiment, the decoding apparatus may derive the prediction samples of the current block by weighted summing the L0 prediction samples derived based on the refined L0 motion vector and the L1 prediction samples derived based on the refined L1 motion vector.</p><p id="p-0456" num="0401">In this case, in deriving the prediction samples, the decoding apparatus may determine whether to apply BDOF to the current block in consideration of coding efficiency, complexity, prediction performance, and the like. That is, the decoding apparatus may apply the BDOF to the current block based on whether application conditions of the BDOF are satisfied for the current block. Here, the application conditions of the BDOF may be constituted by some (or all) or specific combinations of various application conditions described in Tables 1 to 41 above. Further, the decoding apparatus may derive BDOF flag information according to whether the application conditions of the BDOF are satisfied. The BDOF flag information may be information (e.g., bdofFlag described above) related to indicating whether to apply the BDOF to the current block.</p><p id="p-0457" num="0402">In an embodiment, the application conditions of the BDOF may include a case where a value of L0 luma weight prediction flag information and a value of L1 luma weight prediction flag information are both equal to 0. In this case, when the case where the value of the L0 luma weight prediction flag information (e.g., luma_weight_10_flag) and the value of the L1 luma weight prediction flag information (e.g., luma_weight_11_flag) are both equal to 0 is satisfied, the decoding apparatus may derive the BDOF flag information related to indicating that the BDOF is applied to the current block. For example, when both the value of the luma_weight_10_flag and the value of the luma_weight_11_flag are equal to 0, the BDOF flag information may be derived as a value (e.g., 1 or true) indicating that the BDOF is applied to the current block. Otherwise, the BDOF flag information may be derived as a value (e.g., 0 or false) indicating that the BDOF is not applied to the current block.</p><p id="p-0458" num="0403">Further, according to an embodiment, the application conditions of the BDOF may include a condition in which a prediction mode (CIIP mode) in which an inter prediction and an intra prediction are combined is not applied to the current block. In this case, when the case where the prediction mode in which the inter prediction and the intra prediction are combined is not applied to the current block (e.g., a case where a value of ciip_flag is equal to 0) is satisfied, the decoding apparatus may derive the BDOF flag information related to indicating that the BDOF is applied to the current block. For example, when the value of the ciip_flag is equal to 0, the BDOF flag information may be derived as a value (e.g., 1 or true) indicating that the BDOF is applied to the current block. When the value of the ciip_flag is equal to 1, the BDOF flag information may be derived as a value (e.g., 0 or false) indicating that the BDOF is not applied to the current block.</p><p id="p-0459" num="0404">Further, according to an embodiment, the application conditions of the BDOF may include a condition in which a first picture order count (POC) difference between the current picture and the L0 reference picture and a second POC difference between the current picture and the L1 reference picture are the same. In this case, when the case where the first POC difference (e.g., DiffPicOrderCnt(currPic, RefPicList0 [refIdxL0])) and the second POC difference (e.g., DiffPicOrderCnt(currPic, RefPicList1 [refIdxL1])) are the same as each other is satisfied, the decoding apparatus may derive the BDOF flag information related to indicating that the BDOF is applied to the current block. For example, when DiffPicOrderCnt(currPic, RefPicList0 [refIdxL0])&#x2212;DiffPicOrderCnt(currPic, RefPicList1 [refIdxL1]) is equal to 0, the BDOF flag information may be derived as a value (e.g., 1 or true) indicating that the BDOF is applied to the current block. Otherwise, the BDOF flag information may be derived as a value (e.g., 0 or false) indicating that the BDOF is not applied to the current block.</p><p id="p-0460" num="0405">Further, according to an embodiment, the application conditions of the BDOF may include conditions such as a case where BDOF-based inter prediction is enabled, a case where bi-prediction performed based on an L0 reference picture and an L1 reference picture is applied to the current block, a case where a value of bi-prediction weight index information of the current block is equal to 0, a case where an affine mode is not applied to the current block, a case where a subblock-based merge mode is not applied to the current block, a case where the current block is a luma component, a case where a height of the current block is equal to or larger than 8.</p><p id="p-0461" num="0406">The decoding apparatus may include at least one of the above-described BDOF application conditions, and may derive the BDOF flag information based on the BDOF application conditions. In this case, when one or more conditions are included as the BDOF application conditions, the decoding apparatus may derive the value of the BDOF flag information as true or 1 when all of the BDOF application conditions are satisfied. Otherwise, the decoding apparatus may derive the value of the BDOF flag information as false or 0.</p><p id="p-0462" num="0407">Here, in deriving the BDOF flag information, the listed BDOF application conditions are just examples and the conditions of Tables 1 to 41 described above may be used in various combinations.</p><p id="p-0463" num="0408">When the BDOF flag information indicates that the BDOF is applied to the current block (e.g., when the BDOF flag information is derived as a value of true or 1), the decoding apparatus may derive the prediction samples by applying the BDOF to the current block.</p><p id="p-0464" num="0409">In an embodiment, the decoding apparatus may calculate a first gradient for the L0 prediction samples derived based on the refined L0 motion vector and a second gradient for the L1 prediction samples derived based on the refined L1 motion vector. In addition, the decoding apparatus may finally derive the prediction samples for the current block based on the L0 prediction samples, the L1 prediction samples, the first gradient, and the second gradient. For example, the process of deriving the prediction samples by applying the BDOF may use calculations such as Equations 1 to 6 described above.</p><p id="p-0465" num="0410">The decoding apparatus may generate reconstructed samples for the current block based on the prediction samples (S<b>1140</b>).</p><p id="p-0466" num="0411">In an embodiment, the decoding apparatus may directly use the prediction samples as the reconstructed samples according to the prediction mode, or may generate the reconstructed samples by adding the residual samples to the prediction samples.</p><p id="p-0467" num="0412">If the residual sample for the current block exists, the decoding apparatus may receive information on the residual for the current block. The information on the residual may include transform coefficients about the residual samples. The decoding apparatus may derive the residual samples (or residual sample array) for the current block based on the residual information. The decoding apparatus may generate the reconstructed samples based on the prediction samples and the residual samples, and may derive a reconstructed block or a reconstructed picture based on the reconstructed samples.</p><p id="p-0468" num="0413">In the aforementioned embodiments, although the methods have been described based on the flowcharts in the form of a series of steps or units, the embodiments of this document are not limited to the order of the steps, and some of the steps may be performed in a different order from that of other steps or may be performed simultaneous to other steps. Furthermore, those skilled in the art will understand that the steps shown in the flowchart are not exclusive and the steps may include additional steps or that one or more steps in the flowchart may be deleted without affecting the scope of rights of this document.</p><p id="p-0469" num="0414">The aforementioned method according to this document may be implemented in a software form, and the encoding apparatus and/or the decoding apparatus according to this document may be included in an apparatus for performing image processing, for example, TV a computer, a smartphone, a set-top box or a display device.</p><p id="p-0470" num="0415">In this document, when embodiments are implemented in a software form, the aforementioned method be implemented as a module (process, function, etc.) for performing the aforementioned function. The module may be stored in the memory and executed by the processor. The memory may be placed inside or outside the processor and connected to the processor by various well-known means. The processor may include application-specific integrated circuits (ASICs), other chipsets, logic circuits and/or data processing devices. The memory may include read-only memory (ROM), random access memory (RAM), flash memory, memory cards, storage media and/or other storage devices. That is, the embodiments described in this document may be implemented and performed on a processor, a micro processor, a controller or a chip. For example, the function units illustrated in the drawings may be implemented and performed on a computer, a processor, a micro processor, a controller or a chip. In this case, information (e.g., information on instructions) or an algorithm for such implementation may be stored in a digital storage medium.</p><p id="p-0471" num="0416">Furthermore, the decoding apparatus and the encoding apparatus to which this document is applied may be included in a multimedia broadcasting transmission and reception device, a mobile communication terminal, a home cinema video device, a digital cinema video device, a camera for monitoring, a video dialogue device, a real-time communication device such as video communication, a mobile streaming device, a storage medium, a camcorder, a video on-demand (VoD) service provision device, an over the top (OTT) video device, an Internet streaming service provision device, a three-dimensional (3D) video device, a virtual reality (VR) device, an augmented reality (AR) device, a video telephony device, transportation means terminal (e.g., a vehicle (including autonomous vehicle) terminal, an aircraft terminal, and a vessel terminal), and a medical video device, and may be used to process a video signal or a data signal. For example, the over the top (OTT) video device may include a game console, a Blueray player, Internet access TV, a home theater system, a smartphone, a tablet PC, and a digital video recorder (DVR).</p><p id="p-0472" num="0417">Furthermore, the processing method to which this document is applied may be produced in the form of a program executed by a computer, and may be stored in a computer-readable recording medium. Multimedia data having a data structure according to this document may also be stored in a computer-readable recording medium. The computer-readable recording medium includes all types of storage devices in which computer-readable data is stored. The computer-readable recording medium may include Blueray disk (BD), a universal serial bus (USB), a ROM, a PROM, an EPROM, an EEPROM, a RAM, a CD-ROM, a magnetic tape, a floppy disk, and an optical data storage device, for example. Furthermore, the computer-readable recording medium includes media implemented in the form of carriers (e.g., transmission through the Internet). Furthermore, a bit stream generated using an encoding method may be stored in a computer-readable recording medium or may be transmitted over wired and wireless communication networks.</p><p id="p-0473" num="0418">Furthermore, an embodiment of this document may be implemented as a computer program product using program code. The program code may be performed by a computer according to an embodiment of this document. The program code may be stored on a carrier readable by a computer.</p><p id="p-0474" num="0419"><figref idref="DRAWINGS">FIG. <b>12</b></figref> illustrates an example of a content streaming system to which embodiments disclosed in this document may be applied.</p><p id="p-0475" num="0420">Referring to <figref idref="DRAWINGS">FIG. <b>12</b></figref>, the content streaming system to which the embodiments of the present document are applied may basically include an encoding server, a streaming server, a web server, a media storage, a user device, and a multimedia input device.</p><p id="p-0476" num="0421">The encoding server compresses content input from multimedia input devices such as a smartphone, a camera, a camcorder, etc. into digital data to generate a bitstream and transmit the bitstream to the streaming server. As another example, when the multimedia input devices such as smartphones, cameras, camcorders, etc. directly generate a bitstream, the encoding server may be omitted.</p><p id="p-0477" num="0422">The bitstream may be generated by an encoding method or a bitstream generating method to which the embodiment(s) of the present document is applied, and the streaming server may temporarily store the bitstream in the process of transmitting or receiving the bitstream.</p><p id="p-0478" num="0423">The streaming server transmits the multimedia data to the user device based on a user's request through the web server, and the web server serves as a medium for informing the user of a service. When the user requests a desired service from the web server, the web server delivers it to a streaming server, and the streaming server transmits multimedia data to the user. In this case, the content streaming system may include a separate control server. In this case, the control server serves to control a command/response between devices in the content streaming system.</p><p id="p-0479" num="0424">The streaming server may receive content from a media storage and/or an encoding server. For example, when the content is received from the encoding server, the content may be received in real time. In this case, in order to provide a smooth streaming service, the streaming server may store the bitstream for a predetermined time.</p><p id="p-0480" num="0425">Examples of the user device may include a mobile phone, a smartphone, a laptop computer, a digital broadcasting terminal, a personal digital assistant (PDA), a portable multimedia player (PMP), navigation, a slate PC, tablet PCs, ultrabooks, wearable devices (ex. smartwatches, smart glasses, head mounted displays), digital TVs, desktops computer, digital signage, and the like.</p><p id="p-0481" num="0426">Each server in the content streaming system may be operated as a distributed server, in which case data received from each server may be distributed.</p><p id="p-0482" num="0427">Meanwhile, the decoding apparatus and the encoding apparatus to which the embodiment of the present disclosure is applied may be included in the digital device. The &#x201c;digital device&#x201d; includes, for example, all digital devices capable of performing at least one of transmitting, receiving, processing, and outputting data, contents, services, and the like. Here, processing the data, the contents, the service, and the like by the digital device includes an operation of encoding and/or decoding the data, the contents, the service, and the like. The digital device transmits/receives data by paring or connecting (hereinafter, referred to as &#x2018;paring&#x2019;) to another digital device, an external server, etc., through a wire/wireless network and converts the data as necessary.</p><p id="p-0483" num="0428">The digital device includes all of a standing device such as a network TV, a Hybrid Broadcast Broadband TV (HBBTV), a Smart TV, an Internet protocol television (IPTV), a Personal Computer (PC), etc., and a mobile device or handheld device such as a Personal Digital Assistant (PDA), a Smartphone, a Tablet PC, a notebook, a VR/AR device, etc., for example. In addition, the digital device may include a multimedia broadcasting transmitting and receiving device, a mobile communication terminal, a home cinema video device, a digital cinema video device, a surveillance camera, a video chat device, a real time communication device such as video communication, a mobile streaming device, storage media, a camcorder, a video on demand (VoD) service providing device, an (Over the top) OTT video device, an Internet streaming service providing devices, a 3 dimensional (3D) video device, a virtual reality (VR) device, an argument reality (AR) device, a video telephone video device, a transportation means terminal (e.g., a vehicle (including an autonomous vehicle) terminal, an airplane terminal, a ship terminal, etc.), and a medical video device, etc. In the present disclosure, for convenience, a digital TV is illustrated in <figref idref="DRAWINGS">FIG. <b>16</b></figref>, which will be described later, and a mobile device is illustrated and described as an embodiment of a digital device in <figref idref="DRAWINGS">FIG. <b>15</b></figref>.</p><p id="p-0484" num="0429">Meanwhile, the &#x201c;wired/wireless network&#x201d; described in the present disclosure is collectively referred to as a communication network that supports various communication standards or protocols for interconnection or/and data transmission/reception between the digital devices or between the digital device and the external server. The wired/wireless networks may include both communication networks currently supported or to be supported in the future by the standard and communication protocols therefor and may be formed by communication standards or protocols for wired communication, such as Radio Frequency Identification (RFID), infrared Data Association (IrDA), Ultra Wideband (UWB), ZigBee. Digital Living Network Alliance (DLNA), Wireless LAN (WLAN) (Wi-Fi), Wireless broadband (Wibro), World Interoperability for Microwave Access (Wimax), High Speed Downlink Packet Access (HSDPA), Long Term Evolution (LTE), or Wi-Fi Direct, for example.</p><p id="p-0485" num="0430">Hereinafter, in the present disclosure, when being just referred to as the digital device, the digital device may mean the standing device or the mobile device or mean both the standing device and the mobile device.</p><p id="p-0486" num="0431">Meanwhile, the digital device as an intelligent device that supports a broadcast receiving function, a computer function or support, and at least one external input, for example, may support e-mail, web browsing, banking, a game, an application, etc. Moreover, the digital device may include an interface for supporting at least one input or control means (hereinafter, referred to as input means) such as a manual input device, a touch screen, a space remote controller, etc. The digital device may use a standardized universal operating system (OS). For example, the digital device may add, delete, amend, update, etc., various applications on a universal OS kernel and configure, and configure and provide a more user-friendly environment through the addition, deletion, and amendment of various applications.</p><p id="p-0487" num="0432">Meanwhile, the external input described in the present disclosure includes all input means or digital devices which are connected to an external input device, i.e., the digital device wiredly/wirelessly to transmit/receive related data through the wired/wireless connection and process the transmitted/received data. Here, the external input includes all digital devices such as a High Definition Multimedia Interface (HDMI), a game device such as a play station or an X-box, a smartphone, a tablet PC, a printer device, and a smart TV, for example.</p><p id="p-0488" num="0433">Further, the &#x201c;server&#x201d; described in the present disclosure as a meaning including all digital devices or systems supplying data to a client [<b>0034</b>], i.e., the digital device is also referred to as a processor. The server may include a portal server providing a webpage or a web content, an advertising server providing advertising data, a content server providing a content, an SNS server providing a social network service (SNS), a service server or manufacturing server provided by a manufacturer, and the like, for example.</p><p id="p-0489" num="0434">Besides, the &#x201c;channel&#x201d; described in the present disclosure which means a path, a means, and the like for transmitting/receiving data and a broadcasting channel may be taken as an example of the &#x201c;channel&#x201d;. Here, the broadcasting channel is expressed as a term such as a physical channel, a virtual channel, a logical channel, etc., according to activation of digital broadcasting. The broadcasting channel may be referred to as a broadcasting network. As such, the broadcasting channel refers to a channel for providing a broadcasting content provided by a broadcasting station or accessing the broadcasting content by a receiver and since the broadcasting content which is primarily based on real-time broadcasting, the broadcasting channel is also referred to as a live channel. However, in recent years, a medium for broadcasting is further diversified and non-real time broadcasting is also activated in addition to the real-time broadcasting, and as a result, the live channel may be just appreciated as a term meaning the entirety of the broadcasting channel including the non-real time broadcasting in some cases in addition to the real-time broadcasting.</p><p id="p-0490" num="0435">In the present disclosure, in addition to the broadcasting channel, an &#x201c;arbitrary channel&#x201d; is further defined in association with the channel. The arbitrary channel may be provided together with a service guide such as an Electronic Program Guide (EPG) together with the broadcasting channel and the service guide, a Graphic User Interface (GUI), or an On-Screen Display OSD) screen may be configured/provided only with the arbitrary channel.</p><p id="p-0491" num="0436">Meanwhile, unlike a broadcasting channel having a channel number pre-promised between a transmitter and a receiver, the arbitrary channel is a channel arbitrarily allocated by the receiver and a channel number which is not basically duplicated with a channel number for expressing the broadcasting channel is allocated to the arbitrary channel. For example, when a specific broadcasting channel is tuned, the receiver receives the broadcasting content and a broadcasting signal for transmitting signaling information for the broadcasting content through the tuned channel. Here, the receiver parses channel information from the signaling information, and configures a channel browser, EPG, etc., based on the parsed channel information and provides the configured channel browser, EPG, etc., to a user. When the user makes a channel switch request through an input means, the receiver is a scheme to respond to the channel switch request.</p><p id="p-0492" num="0437">As such, since the broadcasting channel is contents pre-promised between the transmitter and the receiver, when the arbitrary channel is allocated duplicatively with the broadcasting channel, a confusion of the user is caused or there is a confusion possibility, and as a result, it is preferable not to duplicatively allocate the channel as described above. Meanwhile, since there is still a possibility of the confusion in a channel surfing process of the user even though the arbitrary channel number is not duplicatively allocated with the broadcasting channel as described above, allocating the arbitrary channel number by considering the confusion possibility is required. The reason is that the arbitrary channel according to the embodiment of the present disclosure may also be implemented to be accessed like the broadcasting channel similarly in response to the channel switch request of the user through the input means similarly to the conventional broadcasting channel. Accordingly, the arbitrary channel number may be defined and represented as a form with characters such as arbitrary channel-1, arbitrary channel-2, etc., rather than a number form like the broadcasting channel for convenience of an access to the arbitrary channel and convenience of distinguishment or identification from the broadcasting channel number. Meanwhile, in this case, even though the representation of the arbitrary channel number may be the form with the characters such as arbitrary channel-1, the arbitrary channel number may be recognized and implemented as the number form such as the number of the broadcasting channel internally in the receiver. Besides, the arbitrary channel number may be provided as the number form like the broadcasting channel and the channel number may be defined and represented by various schemes which may be distinguished from the broadcasting channel, such as video content channel-1, title-1, video-1, etc.</p><p id="p-0493" num="0438">The digital device executes a web browser for a web service to provide various forms of web pages to the user. Here, the web page also includes a web page including a video content and in the embodiment of the present disclosure, the video content is separated and processed separately or independently from the web page. In addition, the arbitrary channel number may be allocated to the separated video content and the separated video content may be provided through the service guide and the user may implement the separated video content to be output according to the channel switch request in the service guide or a broadcasting channel viewing process. Besides, even for the service such as the broadcasting content, the game, the application, etc., in addition to the web service, a predetermined content, an image, an audio, an item, etc., may be separated and processed independently from the broadcasting content, the game, or the application itself and the arbitrary channel number may be allocated for reproduction, processing, etc., and implemented as described above.</p><p id="p-0494" num="0439"><figref idref="DRAWINGS">FIG. <b>13</b></figref> is a diagram schematically illustrating one example of a service system including a digital device.</p><p id="p-0495" num="0440">The service system including the digital device includes a content provider (CP) <b>1310</b>, a service provider (SP) <b>1320</b>, a network provider (NP) <b>1330</b>, and a home network end user (HNED) (customer) <b>1340</b>. Here, the HNED <b>1340</b> is, for example, a client <b>1300</b>, i.e., the digital device. The content provider <b>1310</b> produces and provides various contents. As illustrated in <figref idref="DRAWINGS">FIG. <b>13</b></figref>, as the content provider <b>1310</b>, a terrestrial broadcaster, a cable system operator (SO) or multiple system operators (SO), a satellite broadcaster, various Internet broadcasters, private content providers (CPs), etc., may be exemplified. Meanwhile, the content provider <b>1310</b> provides various applications, etc., in addition to the broadcasting content.</p><p id="p-0496" num="0441">The service provider <b>1320</b> service-packages the content provided by the content provider <b>1310</b> and provides the content to the HNED <b>1340</b>. For example, the service provider <b>1320</b> of <figref idref="DRAWINGS">FIG. <b>13</b></figref> packages and provides a first terrestrial broadcast, a second terrestrial broadcast, the cable MSO, a satellite broadcast, various Internet broadcasts, applications, etc., to the HNED <b>1340</b>.</p><p id="p-0497" num="0442">The service provider <b>1320</b> provides the service to the client <b>1300</b> by a uni-cast or multi-cast scheme. Meanwhile, the service provider <b>1320</b> may transmit data to multiple pre-registered clients <b>1300</b> at once and to this end, the service provider <b>1320</b> may use an Internet Group Management Protocol (IGMP), etc.</p><p id="p-0498" num="0443">The content provider <b>1310</b> and the service provider <b>1320</b> may be the same or single entity. For example, the content provided by the content provider <b>1310</b> is service-packaged and provided to the HNED <b>1340</b> and a function of the service provider <b>1320</b> may be also performed together or vice versa.</p><p id="p-0499" num="0444">The network provider <b>1330</b> provides a network for data exchange between the content provider <b>1310</b> or/and the service provider <b>1320</b> and the client <b>1300</b>.</p><p id="p-0500" num="0445">The client <b>1300</b> may transmit/receive data by constructing a home network.</p><p id="p-0501" num="0446">Meanwhile, the content provider <b>1310</b> or/and the service provider <b>1320</b> in the service system may use a conditional access or content protection means for protection of the transmitted content. In this case, the client <b>1300</b> may use a processing means such as a cable card (point of deployment (POD)), downloadable CAS (DCAS), etc, in response to the conditional access or content protection.</p><p id="p-0502" num="0447">Besides, the client <b>1300</b> may use an interactive service through the network (or communication network). In this case, the client <b>1300</b> may still perform the function of the content provider and the conventional service provider <b>1320</b> may receive the function and transmit the received function to the client again.</p><p id="p-0503" num="0448"><figref idref="DRAWINGS">FIG. <b>14</b></figref> is a block diagram illustrated for describing one embodiment of a digital device. Here, <figref idref="DRAWINGS">FIG. <b>14</b></figref> may correspond to the client <b>1300</b> of <figref idref="DRAWINGS">FIG. <b>13</b></figref> and means the digital device.</p><p id="p-0504" num="0449">The digital device <b>1400</b> is configured to include a Network Interface <b>1401</b>, a TCP/IP Manager <b>1402</b>, a Service Delivery Manager <b>1403</b>, an SI decoder <b>1404</b>, a Demux <b>1405</b>, an Audio Decoder <b>1406</b>, a Video Decoder <b>1407</b>, a Display A/V and OSD Module <b>1408</b>, a Service Control Manager <b>1409</b>, a Service Discovery Manager <b>1410</b>, an SI &#x26; Metadata DB <b>1411</b>, a Metadata Manager <b>1412</b>, a service manager <b>1413</b>, a UI manager <b>1414</b>, and the like.</p><p id="p-0505" num="0450">The network interface <b>1401</b> receives or transmits Internet protocol (IP) packets through the network. In other words, the network interface <b>1401</b> receives the service, the content, etc., from the service provider <b>1720</b> through the network.</p><p id="p-0506" num="0451">The TCP/IP manager <b>1402</b> takes part in delivering IP packets received by the digital device <b>1400</b> and IP packets transmitted by the digital device <b>1400</b>, i.e., packets between a source and a destination. In addition, the TCP/IP manager <b>1402</b> classifies the received packet(s) to correspond to an appropriate protocol and outputs the classified packet(s) to the service delivery manager <b>1405</b>, the service discovery manager <b>1410</b>, the service control manager <b>1409</b>, the metadata manager <b>1412</b>, etc. The service delivery manager <b>1403</b> is responsible for the control of the received service data. For example, the service delivery manager <b>1403</b> may use an RTP/RTCP when controlling real-time streaming data. When transmitting the real-time streaming data by using the RTP, the service delivery manager <b>1403</b> parses the received data packet according to the RTP and transmits the parsed data packet to the DEMUX <b>1405</b> or store the transmitted data packet in the SI &#x26; metadata database <b>1411</b> according to the control of the service manager <b>1413</b>. In addition, the service delivery manager <b>1403</b> feeds back the network reception information to a server providing the service by using the RTCP. The DEMUX <b>1405</b> demultiplexes the received packet to audio, video, system information (SI) data, etc., and transmits the audio, video, system information (SI) data, etc., to the audio/video decoder <b>1406</b>/<b>1407</b> and the SI decoder <b>1404</b>, respectively.</p><p id="p-0507" num="0452">The SI decoder <b>1404</b> decodes service information such as Program Specific Information (PSI), Program and System Information Protocol (PSIP), Digital Video Broadcasting-Service Information (DVB-SI), etc., for example.</p><p id="p-0508" num="0453">Further, the SI decoder <b>1404</b> stores the decoded service information, for example, in the SI &#x26; metadata database <b>1411</b>. The stored service information may be read and used by the corresponding configuration by a request of the user, etc., for example.</p><p id="p-0509" num="0454">The audio/video decoder <b>1406</b>/<b>1407</b> decodes each audio data and video data demultiplexed by the DEMUX <b>1405</b>. The decoded audio data and video data are provided to the user through the display <b>1408</b>.</p><p id="p-0510" num="0455">The application manager may be configured to include the UI manager <b>1414</b> and the service manager <b>1413</b>, for example. The application manager may manage an overall state of the digital device <b>1400</b> and provide a user interface, and manage another manager.</p><p id="p-0511" num="0456">The UI manager <b>1414</b> provides the Graphic User Interface (GUI) for the user by using the On Screen Display (OSD) and receives a key input from the user and performs a device operation depending on the input. For example, when the UI manager <b>1414</b> receives the key input for channel selection from the user, the UI manager <b>1414</b> transmits the key input signal to the service manager <b>1413</b>.</p><p id="p-0512" num="0457">The service manager <b>1413</b> controls a manager associated with the service, such as the service delivery manager <b>1403</b>, the service discovery manager <b>1410</b>, the service control manager <b>1409</b>, the metadata manager <b>1412</b>, etc.</p><p id="p-0513" num="0458">Further, the service manager <b>1413</b> creates a channel map and selects the channel by using the channel map according to the key input received from the user interface manager <b>1414</b>. In addition, the service manager <b>1413</b> receives the service information of the channel from the SI decoder <b>1404</b> and sets an audio/video packet identifier (PID) of the selected channel to the DEMUX <b>1405</b>. The set PID is used for the demultiplexing process. Accordingly, the DEMUX <b>1405</b> filters audio data, video data, and SI data by using the PID.</p><p id="p-0514" num="0459">The service discovery manager <b>1410</b> provides information required for selecting a service provider providing the service. When receiving a signal for the channel selection from the service manager <b>1413</b>, the service discovery manager <b>1410</b> finds the service by using the information.</p><p id="p-0515" num="0460">The service control manager <b>1409</b> is responsible for selecting and controlling the service. For example, when the user selects a live broadcasting service such as the conventional broadcasting scheme, the service control manager <b>1409</b> uses the IGMP or RTSP and when the user selects a service such as Video on Demand (VOD), the service control manager <b>1409</b> performs the selection and the control of the service by using the RTSP. The RTSP may provide a trick mode for real-time streaming. Further, the service control manager <b>209</b> may initialize and manage a session through an IMS gateway <b>1450</b> by using an IP Multimedia Subsystem (IMS) and a Session Initiation Protocol (SIP). The protocols may be an embodiment and another protocol may be used according to an implementation example.</p><p id="p-0516" num="0461">The metadata manager <b>1412</b> manages metadata associated with the service and stores the metadata in the SI &#x26; metadata database <b>1411</b>.</p><p id="p-0517" num="0462">The SI &#x26; metadata database <b>1411</b> stores the service information decoded by the SI decoder <b>1404</b>, metadata managed by the metadata manager <b>1412</b>, and information required for selecting the service provider provided by the service discovery manager <b>1410</b>. Further, the SI &#x26; metadata database <b>1411</b> may store set-up data for the system, etc.</p><p id="p-0518" num="0463">The SI &#x26; metadata database <b>1411</b> may be implemented by using a non-volatile RAM (NVRAM) or a flash memory.</p><p id="p-0519" num="0464">Meanwhile, the IMS gateway <b>1450</b> is a gateway that collects functions required for accessing an IMS based IPTV service.</p><p id="p-0520" num="0465"><figref idref="DRAWINGS">FIG. <b>15</b></figref> is a block diagram illustrated for describing another embodiment of a digital device. In particular, <figref idref="DRAWINGS">FIG. <b>15</b></figref> is a block diagram of a mobile device as another embodiment of the digital device.</p><p id="p-0521" num="0466">Referring to <figref idref="DRAWINGS">FIG. <b>15</b></figref>, the mobile device <b>1500</b> may include a wireless communication unit <b>1510</b>, an audio/video (AN) input unit <b>1520</b>, a user input unit <b>1530</b>, a sensing unit <b>1540</b>, an output unit <b>1550</b>, a memory <b>1560</b>, an interface unit <b>1570</b>, a control unit <b>1580</b>, and a power supply unit <b>1590</b>. The components illustrated in <figref idref="DRAWINGS">FIG. <b>15</b></figref> are not required. Therefore, a mobile device having more components therethan or less components therethan may be implemented.</p><p id="p-0522" num="0467">The wireless communication unit <b>1510</b> may include one or more modules which enable wireless communication between the mobile device <b>1500</b> and the wireless communication system or between the mobile device and the network at which the mobile device is positioned. For example, the wireless communication unit <b>1510</b> may include a broadcast receiving module <b>1511</b>, a mobile communication module <b>1512</b>, a wireless Internet module <b>1513</b>, a short-range communication module <b>1514</b>, and a positional information module <b>1515</b>.</p><p id="p-0523" num="0468">The broadcast receiving module <b>1511</b> receives broadcast signals and/or broadcast related information from an external broadcast management server through the broadcasting channel. Here, the broadcasting channel may include a satellite channel and a terrestrial channel. The broadcast management server may be a server for generating and transmitting the broadcast signals and/or broadcast related information or a server for receiving previously generated broadcast signals and/or broadcast related information and transmitting the received broadcast signals and/or broadcast related information to the terminal. The broadcast signals may include a TV broadcast signal, a radio broadcast signal, and a data broadcast signal and include even a broadcast signal of a type in which the data broadcast signal is combined with the TV broadcast signal or the radio broadcast signal.</p><p id="p-0524" num="0469">The broadcast related information may mean information related to the broadcast channel, a broadcast program, or a broadcast service provider. The broadcast related information may be provided even through a mobile communication network. In this case, the broadcast related information may be received by the mobile communication module <b>1512</b>.</p><p id="p-0525" num="0470">The broadcast related information may exist as various forms, e.g., a form such as Electronic Program Guide (EPG) or Electronic Service Guide (ESG).</p><p id="p-0526" num="0471">For example, the broadcast receiving module <b>1511</b> may receive a digital broadcast signal by using a digital broadcasting system such as ATSC, Digital Video Broadcasting-Terrestrial (DVB-T), DVB-S(satellite). Media Forward Link Only (MediaFLO), DVB-H (handheld), Integrated Services Digital Broadcast-Terrestrial (ISDB-T), etc. Of course, the broadcast receiving module <b>1511</b> may be configured to be suitable for other broadcast systems as well as the digital broadcasting system.</p><p id="p-0527" num="0472">The broadcast signal and/or broadcast related information received through the broadcast receiving module <b>1511</b> may be stored in the memory <b>1560</b>.</p><p id="p-0528" num="0473">The mobile communication module <b>1512</b> transmits/receives at least one radio signal to at least one of a base station, an external terminal, and a server on a mobile communication network. The radio signal may include various types of data depending on transmitting/receiving a voice signal, a video communication signal, or a text/multimedia message.</p><p id="p-0529" num="0474">The wireless Internet module <b>1513</b> may include a module for wireless Internet access and may be internally or externally built in the mobile device <b>1500</b>. As the wireless Internet technology, wireless LAN (WLAN) (Wi-Fi), wireless broadband (Wibro), world interoperability for microwave access (Wimax), high speed downlink packet access (HSDPA), or the like, may be used.</p><p id="p-0530" num="0475">The short-range communication module <b>1514</b> represents a module for short-range communication. As short-range communication technology, Bluetooth, radio frequency identification (RFID), infrared data association (IrDA), ultra wideband (UWB), ZigBee, RS-232, RS-485, or the like may be used.</p><p id="p-0531" num="0476">The positional information module <b>315</b> as a module for obtaining positional information of the mobile device <b>1500</b> may include a Global Position System (GPS) module as an example.</p><p id="p-0532" num="0477">The A/V input unit <b>1520</b> which is used for inputting an audio signal or a video signal may include a camera <b>1521</b> and a microphone <b>1522</b>. The camera <b>1521</b> processes an image frame such as a still image or a moving picture obtained by an image sensor in a video call mode or a photographing mode. The processed image frame may be displayed on the display unit <b>1551</b>.</p><p id="p-0533" num="0478">The images frame processed by the camera <b>1521</b> may be stored in the memory <b>1560</b> or transmitted to the outside through the wireless connection unit <b>1510</b>. Two or more cameras <b>1521</b> may be provided according to a use environment.</p><p id="p-0534" num="0479">The microphone <b>1522</b> receives an external sound signal by a microphone in a call mode or a recording mode, a voice recognition mode, or the like, and processes the received external sound signal as electrical voice data. The processed voice data may be converted into a transmittable form and transmitted to a mobile communication base station through the mobile communication module <b>1512</b> in the case of the call mode. Various noise removal algorithms may be implemented in the microphone <b>1522</b> to remove noise generated in receiving the external sound signal.</p><p id="p-0535" num="0480">The user input unit <b>1530</b> generates input data for the user to control the operation of the terminal. The user input unit <b>1530</b> may include a keypad, a dome switch, a touch pad (resistive/capacitive), a jog wheel, a jog switch, and the like.</p><p id="p-0536" num="0481">The sensing unit <b>1540</b> generates a sensing signal for an operation control of the mobile device <b>1500</b> by sensing a current state of the mobile device <b>300</b>, such as an opening/closing state of the mobile device <b>1500</b>, a position of the mobile device <b>1500</b>, presence of a user contact, an orientation of the mobile device, acceleration/deceleration of the mobile device, etc. For example, when the mobile device <b>1500</b> is moved or inclined, the position or a tilt of the mobile device may be sensed. Further, whether the power supply unit <b>1590</b> supplies power, whether the interface unit <b>1570</b> is combined with the external device, and the like may also be sensed. Meanwhile, the sensing unit <b>1540</b> may include a proximity sensor <b>1541</b> including near field communication (NFC).</p><p id="p-0537" num="0482">The output unit <b>1550</b> which is used for generating an output related with sight, hearing, or touch may include a display <b>1551</b>, a sound output module <b>1552</b>, an alarm unit <b>1553</b>, and a haptic module <b>1554</b>.</p><p id="p-0538" num="0483">The display <b>1551</b> displays (outputs) information processed by the mobile device <b>1500</b>. For example, when the mobile device is in the call mode, the display <b>1551</b> displays a user interface (UI) or graphic user interface (GUI) associated with the call. When the mobile device <b>1500</b> is in the video call mode or the photographing mode, the display <b>1551</b> displays a photographed or/and received image or UI and GUI.</p><p id="p-0539" num="0484">The display <b>1551</b> may include at least one of a liquid crystal display (LCD), a thin film transistor-liquid crystal display (TFT LCD), an organic light-emitting diode (OLED), a flexible display, and a 3D display.</p><p id="p-0540" num="0485">Some displays among them may be configured as a transparent or light transmissive type to view the outside through the displays. This may be called a transparent display and a representative example of the transparent display includes a transparent OLED (TOLED), and the like. A rear structure of the display unit <b>1551</b> may also be configured as a light transmission structure. By such a structure, the user may see an object positioned behind a terminal body through a region occupied by the display unit <b>1551</b> of the terminal body.</p><p id="p-0541" num="0486">According to an implementation form of the mobile device <b>1500</b>, two or more displays <b>1551</b> may exist. For example, in the mobile device <b>1500</b>, the plurality of displays may be separated from each other or integrally disposed on one surface, and further, disposed on different surfaces, respectively.</p><p id="p-0542" num="0487">When the display <b>1551</b> and a sensor (hereinafter, referred to as &#x2018;touch sensor&#x2019;) form a mutual layer structure (hereinafter, referred to as &#x2018;touch screen&#x2019;), the display <b>1551</b> may be used as an input apparatus as well as the output apparatus. The touch sensor may take the form of, for example, a touch film, a touch sheet, a touch pad, or the like.</p><p id="p-0543" num="0488">The touch sensor may be configured to convert a change in pressure applied to a specific portion of the display unit <b>1551</b> or capacitance generated at the specific portion of the display unit <b>1551</b> into an electrical input signal. The touch sensor may be configured to detect touch pressure as well as a touched position and area.</p><p id="p-0544" num="0489">When there is a touch input for the touch sensor, a signal(s) corresponding to the touch input is(are) sent to a touch controller. The touch controller processes the signal(s) and thereafter, transmits data corresponding thereto to the controller <b>1580</b>. As a result, the controller <b>1580</b> may know which region of the display <b>1551</b> is touched.</p><p id="p-0545" num="0490">The proximity sensor <b>1541</b> may be disposed in an internal area of the mobile device covered by the touch screen or near the touch screen. The proximity sensor refers to a sensor that detects the presence or absence of an object approaching a predetermined detection surface or an object which exists nearby without mechanical contact using electromagnetic field force or infrared rays. The proximity sensor has a longer lifetime and higher utilization than the touch sensor.</p><p id="p-0546" num="0491">Examples of the proximity sensor include a transmission type photoelectric sensor, a direct reflection type photoelectric sensor, a mirror reflection type photoelectric sensor, a high frequency oscillation type proximity sensor, a capacitive proximity sensor, a magnetic proximity sensor, an infrared proximity sensor, and the like. When the touch screen is a capacitive sensor, the touch screen is configured to detect the proximity of the pointer by a change of an electric field depending on the proximity of the pointer. In this case, the touch screen (touch sensor) may be classified as the proximity sensor.</p><p id="p-0547" num="0492">Hereinafter, for easy description, the act of recognizing that the pointer is positioned on the touch screen while the pointer is not in contact with the touch screen is referred to as &#x201c;proximity touch&#x201d; and the act of actually touching the pointer on the screen is referred to as &#x201c;contact touch&#x201d;. The position where the pointer is proximately touched on the touch screen means a position where the pointer is vertically corresponding to the touch screen when the pointer is touched.</p><p id="p-0548" num="0493">The proximity sensor detects the proximity touch and a proximity touch pattern (e.g., a proximity touch distance, a proximity touch direction, a proximity touch speed, a proximity touch time, a proximity touch position, a proximity touch movement state, and the like). Information corresponding to the sensed proximity touch operation and the proximity touch pattern may be output on the touch screen.</p><p id="p-0549" num="0494">The sound output module <b>1552</b> may output audio data received from the wireless communication unit <b>1510</b> or stored in the memory <b>1560</b> in call signal receiving, the call mode or a recording mode, a voice recognition mode, a broadcast receiving mode, and the like. The sound output module <b>1552</b> may also output a sound signal related with a function (e.g., a call signal receiving sound, a message receiving sound, or the like) performed by the mobile device <b>1500</b>. The sound output module <b>1552</b> may include a receiver, a speaker, a buzzer, and the like.</p><p id="p-0550" num="0495">The alarm unit <b>1553</b> outputs a signal for notifying occurrence of an event of the mobile device <b>1500</b>. Examples of the event which occurs in the mobile device include call signal reception, message reception, key signal input, touch input, and the like. The alarm unit <b>1553</b> may also output another form other than a video signal or an audio signal, for example, a signal for notifying the occurrence of the event by vibration.</p><p id="p-0551" num="0496">The video signal or the audio signal may be output through the display unit <b>1551</b> or the sound output module <b>1552</b> so that the display <b>1551</b> and the display <b>1551</b> and the sound output module <b>1552</b> may be classified as a part of the alarm unit <b>153</b>.</p><p id="p-0552" num="0497">The haptic module <b>1554</b> generates various tactile effects that the user may feel. A typical example of the tactile effect generated by the haptic module <b>1554</b> is vibration. The intensity and pattern of the vibration generated by the tactile module <b>1554</b> is controllable. For example, different vibrations may be combined and output or sequentially output.</p><p id="p-0553" num="0498">In addition to the vibration, the haptic module <b>1554</b> may various tactile effects including effects by stimulus including pin arrangement vertically moving with respect to a contact skin surface, spraying force or suction force of the air through an injection port or a suction port, a touch on the skin surface, contact with an electrode, electrostatic force, and the like and an effect of reproducing a cold sensation using a heat absorbing or heatable element.</p><p id="p-0554" num="0499">The haptic module <b>1554</b> may be implemented not only to transmit the tactile effect through direct contact but also to allow the user to feel the tactile effect through the muscles of the finger or arm. At least two haptic modules <b>1554</b> may be provided according to a configuration aspect of the mobile device <b>1500</b>.</p><p id="p-0555" num="0500">The memory <b>1560</b> may store a program for a motion of the controller <b>1580</b> therein and temporarily store input/output data (e.g., a phone book, a message, a still image, a moving picture, or the like) therein. The memory <b>1560</b> may store data regarding various patterns of vibrations and sounds output in the touch input on the touch screen.</p><p id="p-0556" num="0501">The memory <b>1560</b> may include at least one type of storage medium of a flash memory type storage medium, a hard disk type storage medium, a multimedia card micro type storage medium, a card type memory (for example, an SD or XD memory, or the like), a random access memory (RAM), a static random access memory (SRAM), a read-only memory (ROM), an electrically erasable programmable read-only memory (EEPROM), a programmable read-only memory (PROM), a magnetic memory, a magnetic disk, and an optical disk. The mobile device <b>1500</b> may operate in connection with a web storage performing a storing function of the memory <b>1560</b> on the Internet.</p><p id="p-0557" num="0502">The interface unit <b>1570</b> serves as a passage with all external devices connected to the mobile device <b>1500</b>. The interface unit <b>1570</b> transmits data from the external device or receives power to deliver power to each component in the mobile device <b>1500</b> or transmits data in the mobile device <b>1500</b> to the external device. For example, a wireless/wired headset port, an external charger port, a wired/wireless data port, a memory card port, a port connecting a device with an identification module, an audio input/output (I/O) port, a video I/O port, an earphone port, and the like may be included in the interface unit <b>1570</b>.</p><p id="p-0558" num="0503">The identification module as a chip for storing various information for authenticating use rights of the external device <b>1500</b> may include a user identification module (UIM), a subscriber identity module (SIM), a universal subscriber identity module (USIM), and the like. Apparatuses (hereinafter referred to as &#x201c;identification apparatus&#x201d;) with the identification module may be manufactured in a smart card format. Therefore, the identification apparatus may be connected with the terminal <b>1500</b> via the port.</p><p id="p-0559" num="0504">The interface unit <b>1570</b> may becomes a passage through which the power from a cradle is supplied to the mobile terminal <b>1500</b> when the mobile terminal <b>1500</b> is connected to an external cradle or may be a passage through which various command signals input from the cradle by the user are delivered to the mobile terminal. The various command signals or the power input from the cradle may serve as a signal for recognizing that the mobile terminal is correctly mounted on the cradle.</p><p id="p-0560" num="0505">The controller <b>1580</b> generally controls all operations of the mobile device. For example, the controller <b>1580</b> performs related control and processing for voice call, data communication, video call, etc. The controller <b>1580</b> may include a multimedia module <b>1581</b> for reproducing multimedia. The multimedia module <b>1581</b> may be implemented in the controller <b>1580</b> or implemented apart from the controller <b>1580</b>. The controller <b>1580</b>, in particular, the multimedia module <b>1581</b> may include the encoding apparatus and/or the decoding apparatus.</p><p id="p-0561" num="0506">The controller <b>1580</b> may perform pattern recognition processing to recognize a write input or a drawing input performed on the touch screen as a text or an image.</p><p id="p-0562" num="0507">The power supply unit <b>1590</b> receives external power and internal power by a control of the controller <b>1580</b> to supply power required for operations of respective components.</p><p id="p-0563" num="0508">Various embodiments described herein may be implemented in a computer-readable recording medium or a recording medium readable by a device similar to the computer by using, for example, software, hardware, or a combination thereof.</p><p id="p-0564" num="0509">According to hardware implementation, the embodiment described herein may be implemented by using at least one of the application specific integrated circuits (ASICs), the digital signal processors (DSPs), the digital signal processing devices (DSPDs), the programmable logic devices (PLDs), the field programmable gate arrays (FPGAs), the processors, the controllers, the micro-controllers, the microprocessors, and the electric units for performing other functions. In some cases, the embodiments described in the specification may be implemented by the controller <b>1580</b> itself.</p><p id="p-0565" num="0510">According to software implementation, embodiments such as a procedure and a function described in the specification may be implemented by separate software modules. Each of the software modules may perform one or more functions and operations described in the specification. A software code may be implemented by a software application written by an appropriate program language. Here, the software code may be stored in the memory <b>1560</b> and executed by the controller <b>1580</b>.</p><p id="p-0566" num="0511"><figref idref="DRAWINGS">FIG. <b>16</b></figref> is a block diagram illustrating another embodiment of a digital device.</p><p id="p-0567" num="0512">Other examples of the digital device <b>1600</b> include a broadcast receiving module <b>1605</b>, an external device interface module <b>1635</b>, a storage module <b>1640</b>, a user input interface module <b>1650</b>, a controller <b>1670</b>, a display <b>1680</b>, an audio output module <b>1685</b>, a power supply module <b>1690</b> and an image capture module (not shown). Here, the broadcast receiving module <b>1605</b> may include at least one tuner <b>1610</b>, a demodulator <b>1620</b>, and a network interface module <b>1630</b>. However, in some cases, the broadcast receiving module <b>1605</b> may include the tuner <b>1610</b> and the demodulator <b>1620</b> but may not include the network interface module <b>1630</b>, or vice versa. In addition, although not shown, the broadcast receiving module <b>1605</b> may include a multiplexer to multiplex a signal demodulated by the demodulator <b>1620</b> via the tuner <b>1610</b> and a signal received through the network interface <b>1630</b>. In addition, although not shown, the broadcast receiving module <b>1625</b> may include a demultiplexer to demultiplex the multiplexed signal or to demultiplex the demodulated signal or a signal passing through the network interface module <b>1630</b>.</p><p id="p-0568" num="0513">The tuner <b>1610</b> receives an RF broadcast signal by tuning a channel selected by a user or all previously stored channels among radio frequency (RF) broadcast signals received through an antenna. In addition, the tuner <b>1610</b> converts the received RF broadcast signal into an intermediate frequency (IF) signal or a baseband signal.</p><p id="p-0569" num="0514">For example, if the received RF broadcast signal is a digital broadcast signal, the tuner <b>1610</b> converts the signal into a digital IF signal (DIF), and if the received RF broadcast signal is an analog broadcast signal, the tuner <b>1610</b> converts the signal into an analog baseband video or audio signal (CVBS/SIF). That is, the tuner <b>1610</b> may process both a digital broadcast signal or an analog broadcast signal. The analog baseband video or audio signal CVBS/SIF output from the tuner <b>1610</b> may be directly input to the controller <b>1670</b>.</p><p id="p-0570" num="0515">In addition, the tuner <b>1610</b> may receive an RF broadcast signal of a single carrier according to an advanced television system committee (ATSC) scheme or an RF broadcast signal of multiple carriers according to a digital video broadcasting (DVB) scheme.</p><p id="p-0571" num="0516">Meanwhile, the tuner <b>1610</b> may sequentially tune and receive the RF broadcast signals of all the stored broadcast channels through a channel memory function among the RF broadcast signals received through the antenna and convert them into intermediate frequency signals or baseband signals.</p><p id="p-0572" num="0517">The demodulator <b>1620</b> receives and demodulates a digital IF signal DIF converted by the tuner <b>1610</b>. For example, when the digital IF signal output from the tuner <b>1610</b> is an ATSC type, the demodulator <b>1620</b> performs 8-VSB (8-Vestigal Side Band) demodulation, for example. In addition, the demodulator <b>1620</b> may perform channel decoding. To this end, the demodulator <b>1620</b> may include a trellis decoder, a de-interleaver, a Reed-Solomon decoder, and the like to perform trellis decoding, deinterleaving, and Reed-Soloman decoding.</p><p id="p-0573" num="0518">For example, when the digital IF signal output from the tuner <b>1610</b> is a DVB type, the demodulator <b>1620</b> performs coded orthogonal frequency division modulation (COFDMA) demodulation, for example. In addition, the demodulator <b>1620</b> may perform channel decoding. To this end, the demodulator <b>1620</b> may include a convolution decoder, a deinterleaver, a Reed-Soloman decoder, and the like to perform convolutional decoding, deinterleaving, and Reed-Soloman decoding.</p><p id="p-0574" num="0519">The demodulator <b>1620</b> may output a stream signal TS after performing demodulation and channel decoding. In this case, the stream signal may be a signal multiplexed with a image signal, an audio signal, or a data signal. For example, the stream signal may be an MPEG-2 transport stream (TS) multiplexed with an MPEG-2 standard image signal, a Dolby AC-3 standard audio signal, and the like. Specifically, the MPEG-2 TS may include a header of 4 bytes and a payload of 184 bytes.</p><p id="p-0575" num="0520">Meanwhile, the demodulator <b>1620</b> described above may be provided separately according to the ATSC system and the DVB system. That is, the digital device may include an ATSC demodulator and a DVB demodulator separately.</p><p id="p-0576" num="0521">The stream signal output from the demodulator <b>1620</b> may be input to the controller <b>1670</b>. The controller <b>1670</b> may control demultiplexing, image/audio signal processing, and the like, and control output of audio through the display <b>1680</b> and the audio output module <b>1685</b>.</p><p id="p-0577" num="0522">The external device interface module <b>1635</b> provides an environment in which various external devices are interfaced to the digital device <b>1600</b>. To this end, the external device interface module <b>1635</b> may include an A/V input/output module (not shown) or a wireless communication module (not shown).</p><p id="p-0578" num="0523">The external device interface module <b>435</b> may be wiredly/wirelessly connected to an external device such as a digital versatile disk (DVD), a Blu-ray, a game device, a camera, a camcorder, a computer (laptop, tablet), a smartphone, a Bluetooth device, and a cloud. The external device interface module <b>1635</b> transmits an image, audio, or data (including image) signal input from the outside to the controller <b>1670</b> of the digital device through the connected external device. The controller <b>1670</b> may control the processed video, audio or data signal to be output to the connected external device. To this end, the external device interface module <b>1635</b> may further include an A/V input/output module (not shown) or a wireless communication module (not shown).</p><p id="p-0579" num="0524">The A/V input/output module may use a USB terminal, a CVBS (composite video banking sync) terminal, a component terminal, an S-video terminal (analog), a DVI digital visual interface (HDMI) terminal, a high definition multimedia interface (HDMI) terminal, an RGB terminal, a D-SUB terminal and the like.</p><p id="p-0580" num="0525">The wireless communication module may perform near field communication with another electronic device. The digital device <b>1600</b> may be connected to another electronic device via a network according to a communication protocol such as Bluetooth, radio frequency identification (RFID), infrared data association (IrDA), ultra wideband (UWB), ZigBee, and digital living network alliance (DLNA). It may be networked with other electronic devices according to a communication protocol.</p><p id="p-0581" num="0526">In addition, the external device interface module <b>1635</b> may be connected to various set top boxes through at least one of the various terminals described above to perform input/output operations with the set top box.</p><p id="p-0582" num="0527">Meanwhile, the external device interface module <b>1635</b> may receive an application or a list of applications in a neighboring external device and transmit the received application or application list to the controller <b>1670</b> or the storage <b>1640</b>.</p><p id="p-0583" num="0528">The network interface module <b>1630</b> provides an interface for connecting the digital device <b>1600</b> with a wired/wireless network including the internet. The network interface module <b>1630</b> may include, for example, an Ethernet terminal for connection with a wired network, and may use, for example a wireless local area network (WLAN) (Wi-Fi), Wibro (wireless broadband). Wimax (world interoperability for microwave access), and high speed downlink packet access (HSDPA) communication standard for connection with a wireless network.</p><p id="p-0584" num="0529">The network interface module <b>1630</b> may transmit or receive data with another user or another digital device through the connected network or another network linked to the connected network. In particular, the network interface module <b>1630</b> may transmit some content data stored in the digital device <b>1600</b> to another user who is registered in advance in the digital device <b>1600</b> or a selected user or a selected digital device among other digital devices.</p><p id="p-0585" num="0530">Meanwhile, the network interface module <b>1630</b> may access a predetermined web page through a connected network or another network linked to the connected network. That is, by accessing the predetermined web page through the network, the network interface module <b>1630</b> may send or receive data with the server. In addition, the network interface module <b>1630</b> may receive content or data provided by a content provider or a network operator. That is, the network interface module <b>1630</b> may receive content such as a movie, an advertisement, a game, a VOD, a broadcast signal, and related information provided from a content provider or a network provider through a network. In addition, the network interface module <b>1630</b> may receive the update information and the update file of firmware provided by the network operator. In addition, the network interface module <b>1630</b> may transmit data to the Internet or content provider or network operator.</p><p id="p-0586" num="0531">In addition, the network interface module <b>1630</b> may selectively receive a desired application from among applications that are open to the public through the network.</p><p id="p-0587" num="0532">The storage module <b>1640</b> may store a program for processing and controlling each signal in the controller <b>1670</b>, and may store a signal-processed video, audio, or data signal.</p><p id="p-0588" num="0533">In addition, the storage module <b>1640</b> may perform a function for temporarily storing an image, audio, or data signal input from the external device interface module <b>1635</b> or the network interface module <b>1630</b>. The storage module <b>1640</b> may store information on a predetermined broadcast channel through a channel memory function.</p><p id="p-0589" num="0534">The storage module <b>1640</b> may store an application or an application list input from the external device interface module <b>1635</b> or the network interface module <b>1630</b>.</p><p id="p-0590" num="0535">In addition, the storage module <b>1640</b> may store various platforms described below.</p><p id="p-0591" num="0536">The storage module <b>1640</b> may include at least one type storage medium among, for example, a flash memory type, a hard disk type, a multimedia card micro type, a card type memory (ex. SD or XD memory, etc.), a RAM, or a ROM (EEPROM, etc.). The digital device <b>1600</b> may reproduce and provide a content file (video file, still image file, music file, document file, application file, etc.) stored in the storage module <b>1640</b> to the user.</p><p id="p-0592" num="0537"><figref idref="DRAWINGS">FIG. <b>16</b></figref> illustrates an embodiment in which the storage module <b>1640</b> is provided separately from the controller <b>1670</b>, but the scope of the embodiments of the present disclosure is not limited thereto. That is, the storage <b>1640</b> may be included in the controller <b>1670</b>.</p><p id="p-0593" num="0538">The user input interface module <b>1650</b> transmits a signal input by the user to the controller <b>1670</b> or transmits a signal of the controller <b>1670</b> to the user.</p><p id="p-0594" num="0539">For example, the user input interface module <b>1650</b> controls power on/off, channel selection, screen setting, etc. by a control signal received from the remote controller <b>700</b> according to various communication methods such as an RF communication method and an infrared (IR) communication method, or may process and transmit a control signal from the controller <b>1670</b> to the remote controller <b>1695</b>.</p><p id="p-0595" num="0540">In addition, the user input interface module <b>1650</b> may transmit a control signal input from a local key (not shown) such as a power key, a channel key, a volume key, and a set value to the controller <b>1670</b>.</p><p id="p-0596" num="0541">The user input interface module <b>1650</b> may transmit a control signal input from a sensing module (not shown) that senses a user's gesture to the controller <b>1670</b> or may transmit a signal of the controller <b>1670</b> to the sensing module (not shown). Here, the sensing module may include a touch sensor, a voice sensor, a position sensor, an operation sensor, and the like.</p><p id="p-0597" num="0542">The controller <b>1670</b> demultiplexes a stream input through the tuner <b>1610</b>, the demodulator <b>1620</b>, or the external device interface <b>1635</b>, or processes a demultiplexed signal to generate and output a signal for video or audio output. The controller <b>1670</b> may include the above-described encoding apparatus and/or decoding apparatus.</p><p id="p-0598" num="0543">The image signal processed by the controller <b>1670</b> may be input to the display <b>1680</b> and displayed as an image corresponding to the image signal. In addition, the image signal processed by the controller <b>1670</b> may be input to the external output device through the external device interface <b>1635</b>.</p><p id="p-0599" num="0544">The audio signal processed by the controller <b>1670</b> may be output to the audio output module <b>1685</b>. In addition, the audio signal processed by the controller <b>1670</b> may be input to the external output device through the external device interface <b>1635</b>.</p><p id="p-0600" num="0545">Although not shown in <figref idref="DRAWINGS">FIG. <b>16</b></figref>, the controller <b>1670</b> may include a demultiplexer, an image processor, and the like.</p><p id="p-0601" num="0546">The controller <b>1670</b> may control overall operations of the digital device <b>1600</b>. For example, the controller <b>1670</b> may control the tuner <b>1610</b> to control tuning of an RF broadcast corresponding to a channel selected by a user or a previously stored channel.</p><p id="p-0602" num="0547">The controller <b>1670</b> may control the digital device <b>1600</b> by a user command or an internal program input through the user input interface <b>1650</b>. In particular, the controller <b>1670</b> may access the network so that the user may download a desired application or application list into the digital device <b>1600</b>.</p><p id="p-0603" num="0548">For example, the controller <b>1670</b> controls the tuner <b>1610</b> to input a signal of a selected channel according to a predetermined channel selection command received through the user input interface <b>1650</b>. The controller <b>1610</b> processes the video, audio or data signal of the selected channel. The controller <b>1670</b> allows the channel information selected by the user to be output through the display <b>1680</b> or the audio output module <b>1685</b> together with the processed video or audio signal.</p><p id="p-0604" num="0549">As another example, the controller <b>1670</b> may allow an image signal or audio signal from an external device, e.g., a camera or a camcorder, input though the external device interface module <b>1635</b> to be output through the display <b>1680</b> or the audio output module <b>1685</b> according to an external device image playback command received through the user input interface <b>1650</b>.</p><p id="p-0605" num="0550">The controller <b>1670</b> may control the display <b>1680</b> to display an image. For example, the controller <b>1670</b> may control the display <b>1680</b> to display a broadcasting image input through the tuner <b>1610</b>, an external input image input through the external device interface module <b>1635</b>, an image input through a network interface module, or an image stored in the storage module <b>1640</b>. In this case, the image displayed on the display <b>1680</b> may be a still image or video and may be a 2D image or a 3D image.</p><p id="p-0606" num="0551">In addition, the controller <b>1670</b> may control to reproduce the content. In this case, the content may be content stored in the digital device <b>1600</b>, received broadcast content, or external input content input from the outside. The content may be at least one of a broadcasting image, an external input image, an audio file, a still image, a connected web screen, and a document file.</p><p id="p-0607" num="0552">Meanwhile, the controller <b>1670</b> may control to display an application or a list of applications that may be downloaded from the digital device <b>1600</b> or from an external network when entering the application view item.</p><p id="p-0608" num="0553">The controller <b>1670</b> may control to install and run an application downloaded from an external network, along with various user interfaces. In addition, the controller <b>1670</b> may control an image related to an application to be executed by a user selection to be displayed on the display <b>1680</b>.</p><p id="p-0609" num="0554">Although not shown in the drawing, a channel browsing processor may be further provided to generate a thumbnail image corresponding to a channel signal or an external input signal.</p><p id="p-0610" num="0555">The channel browsing processor may receive a stream signal TS output from the demodulator <b>1620</b> or a stream signal output from the external device interface <b>1635</b>, and extract an image from the input stream signal to generate a thumbnail image.</p><p id="p-0611" num="0556">The generated thumbnail image may be coded as it is or input to the controller <b>1670</b>. In addition, the generated thumbnail image may be coded in a stream form and input to the controller <b>1670</b>. The controller <b>1670</b> may display a thumbnail list including a plurality of thumbnail images on the display <b>1680</b> using the input thumbnail image. Meanwhile, the thumbnail images in the thumbnail list may be updated sequentially or simultaneously. Accordingly, the user may easily recognize the contents of the plurality of broadcast channels.</p><p id="p-0612" num="0557">The display <b>1680</b> converts an image signal, a data signal, an OSD signal processed by the controller <b>1670</b> or an image signal, data signal, etc. received from the external device interface module <b>1635</b> into R, G. and B signals to generate a drive signal.</p><p id="p-0613" num="0558">The display <b>1680</b> may be a PDP, an LCD, an OLED, a flexible display, a 3D display, or the like.</p><p id="p-0614" num="0559">The display <b>480</b> may be configured as a touch screen and used as an input device in addition to the output device.</p><p id="p-0615" num="0560">The audio output module <b>1685</b> receives a signal processed by the controller <b>1670</b>, for example, a stereo signal, a 3.1 channel signal, or a 5.1 channel signal, and outputs an audio signal. The voice output module <b>485</b> may be implemented as various types of speakers.</p><p id="p-0616" num="0561">Meanwhile, in order to detect a user's gesture, as described above, a sensing module (not shown) including at least one of a touch sensor, a voice sensor, a position sensor, and a motion sensor may be further provided in the digital device <b>1600</b>. A signal detected by the sensing module (not shown) may be transmitted to the controller <b>1670</b> through the user input interface module <b>1650</b>.</p><p id="p-0617" num="0562">Meanwhile, an image capture module (not shown) for capturing an image the user may be further provided. Image information captured by the image capture module (not shown) may be input to the controller <b>1670</b>.</p><p id="p-0618" num="0563">The controller <b>1670</b> may detect the user's gesture by combining the image captured by the image capture module (not shown) or the detected signal from the sensing module (not shown).</p><p id="p-0619" num="0564">The power supply module <b>1690</b> supplies corresponding power throughout the digital device <b>1600</b>.</p><p id="p-0620" num="0565">In particular, the power supply module <b>1690</b> may supply power to the controller <b>1670</b> which may be implemented in the form of a system-on-chip (SOC), a display <b>1680</b> for displaying an image, and an audio output module <b>1685</b> for audio output.</p><p id="p-0621" num="0566">To this end, the power supply module <b>1690</b> may include a converter (not shown) for converting AC power into DC power. Meanwhile, for example, when the display <b>1680</b> is implemented as a liquid crystal panel having a plurality of backlight lamps, an inverter (not shown) capable of performing PWM operation may be further provided for brightness varying or dimming.</p><p id="p-0622" num="0567">The remote controller <b>1695</b> transmits a user input to the user input interface module <b>1650</b>. To this end, the remote controller <b>700</b> may use Bluetooth, RF (Radio Frequency) communication, infrared (IR) communication. UWB (Ultra Wideband), ZigBee (ZigBee) method and the like.</p><p id="p-0623" num="0568">In addition, the remote controller <b>1695</b> may receive an image, an audio or a data signal output from the user input interface module <b>1650</b>, display it on the remote controller <b>700</b> or output a sound or vibration.</p><p id="p-0624" num="0569">The digital device <b>1600</b> may be a digital broadcast receiver capable of processing a fixed or mobile ATSC or DVB digital broadcast signal.</p><p id="p-0625" num="0570">In addition, the illustrated components of the digital device according to an embodiment of the present disclosure may be omitted or the digital device may further include some components which are not illustrated as necessary. Meanwhile, unlike the above, the digital device may not include the tuner and the demodulator and may receive and play content through a network interface module or an external device interface module.</p><p id="p-0626" num="0571"><figref idref="DRAWINGS">FIG. <b>17</b></figref> is a block diagram illustrating an embodiment of a specific configuration of the controller of <figref idref="DRAWINGS">FIG. <b>14</b></figref> to <figref idref="DRAWINGS">FIG. <b>16</b></figref>.</p><p id="p-0627" num="0572">An example of the controller may include a demultiplexer <b>1710</b>, an image processor <b>1720</b>, an on-screen display (OSD) generator <b>1740</b>, a mixer <b>1750</b>, a frame rate converter (FRC) <b>1755</b>, and a formatter <b>1760</b>. In addition, although not shown, the controller may further include a voice processor and a data processor.</p><p id="p-0628" num="0573">The demultiplexer <b>1710</b> demultiplexes an input stream. For example, the demultiplexer <b>1710</b> may demultiplex input MPEG-2 TS into video, audio, and data signals. Here, the stream signal input to the demultiplexer <b>1710</b> may be a stream signal output from a tuner, a demodulator, or an external device interface module.</p><p id="p-0629" num="0574">The image processor <b>1720</b> performs image processing of the demultiplexed image signal. To this end, the image processor <b>1720</b> may include an image decoder <b>1725</b> and a scaler <b>1735</b>.</p><p id="p-0630" num="0575">The image decoder <b>1725</b> decodes the demultiplexed image signal, and the scaler <b>1735</b> scales resolution of the decoded image signal so that the display may output the same.</p><p id="p-0631" num="0576">The image decoder <b>1725</b> may support various standards. For example, the image decoder <b>1725</b> performs the function of the MPEG-2 decoder when the image signal is coded in the MPEG-2 standard, and the image decoder <b>1725</b> performs a function of the corresponding decoder when the image signal is coded based on a digital multimedia broadcasting (DMB) scheme, H.26&#xd7; (ex. H.265, H.266, H.267, etc.) or EVC, etc.</p><p id="p-0632" num="0577">Meanwhile, the image signal decoded by the video processor <b>1720</b> is input to the mixer <b>1750</b>.</p><p id="p-0633" num="0578">The OSD generator <b>1740</b> generates OSD data according to a user input or itself. For example, the OSD generator <b>1740</b> generates data for displaying various data in the form of a graphic or text on the screen of the display <b>680</b> based on a control signal of the user input interface. The generated OSD data includes various data such as a user interface screen of a digital device, various menu screens, widgets, icons, viewing rate information, and the like.</p><p id="p-0634" num="0579">The OSD generator <b>1740</b> may generate data for displaying broadcast information based on subtitles or EPGs of a broadcasting image.</p><p id="p-0635" num="0580">The mixer <b>1750</b> mixes the OSD data generated by the OSD generator <b>1740</b> and the image signal processed by the image processor and provides the same to the formatter <b>1760</b>. Since the decoded image signal and the OSD data are mixed, the OSD is overlaid and displayed on the broadcasting image or the external input image.</p><p id="p-0636" num="0581">The frame rate converter (FRC) <b>555</b> converts a frame rate of an input image. For example, the frame rate converter <b>1755</b> may convert a frame rate of an input 60 Hz image into a frame rate of, for example, 120 Hz or 240 Hz according to an output frequency of the display. As described above, there may be various methods of converting the frame rate. For example, w % ben converting the frame rate from 60 Hz to 120 Hz, the frame rate converter <b>1755</b> may insert the same first frame between the first frame and a second frame or insert a third frame predicted from the first frame and the second frame. As another example, when converting the frame rate from 60 Hz to 240 Hz, the frame rate converter <b>1755</b> may insert three more identical or predicted frames between existing frames. Meanwhile, when no separate frame conversion is performed, the frame rate converter <b>1755</b> may be bypassed.</p><p id="p-0637" num="0582">The formatter <b>1760</b> changes the output of the input frame rate converter <b>1755</b> to match an output format of the display. For example, the formatter <b>1760</b> may output R, G, B data signals, and the R, G, B data signals may be output as low voltage differential signaling (LVDS) or mini-LVDS. In addition, when the output of the input frame rate converter <b>1755</b> is a 3D image signal, the formatter <b>1760</b> may support a 3D service through the display by configuring and outputting the 3D form according to the output format of the display.</p><p id="p-0638" num="0583">The voice processor (not shown) in the controller may perform voice processing of a demultiplexed audio signal. The voice processor (not shown) may support processing of various audio formats. For example, even when an audio signal is encoded in a format such as MPEG-2, MPEG-4, AAC, HE-AAC, AC-3, BSAC, EVS, etc., the voice processor may include a decoder corresponding thereto to process the same.</p><p id="p-0639" num="0584">Also, the voice processor (not shown) in the controller may process base, treble, volume control, and the like.</p><p id="p-0640" num="0585">The data processor (not shown) in the controller may perform data processing of the demultiplexed data signal. For example, even when the demultiplexed data signal is coded, the data processor may decode the demultiplexed data signal. Here, the coded data signal may be EPG information including broadcast information such as a start time and an end time of a broadcast program broadcast in each channel.</p><p id="p-0641" num="0586">Meanwhile, the above-described digital device is an example according to an embodiment of the present document, each component may be integrated, added, or omitted depending on the specifications of the digital device that is actually implemented. That is, as needed, two or more components may be combined into one component or one component may be subpartitioned into two or more components. In addition, the function performed in each block is for explaining an embodiment of the present document, the specific operation or device does not limit the scope of the embodiment of the present document.</p><p id="p-0642" num="0587">Meanwhile, the digital device may be an image signal processing device that performs signal processing of an image stored in the device or an input image. As another example of the image signal processing device, a set-top box (STB) excluding the display <b>1680</b> and the audio output module <b>1685</b> shown in <figref idref="DRAWINGS">FIG. <b>16</b></figref>, the above-described DVD player, a Blu-ray player, a game machine, a computer, and the like may be further exemplified.</p><p id="p-0643" num="0588"><figref idref="DRAWINGS">FIG. <b>18</b></figref> illustrates an example in which a screen of a digital device simultaneously displays a main image and a sub-image according to an embodiment.</p><p id="p-0644" num="0589">According to an embodiment, the digital device may simultaneously display a main image <b>1810</b> and a sub-image <b>1820</b> on the screen <b>1800</b>. The main image <b>1810</b> may be called a first image, and the sub-image <b>1820</b> may be called a second image. The main image <b>1810</b> and the sub-image <b>1820</b> may include a video, a still image, an electronic program guide (EPG), a graphical user interface (GUI), an on-screen display (OSD), and the like, but are not limited thereto. The main image <b>1810</b> may refer to an image which is displayed simultaneously with the sub-image <b>1820</b> on the screen <b>1800</b> of the electronic device and which is relatively smaller in size than the screen <b>1800</b> of the electronic device. In <figref idref="DRAWINGS">FIG. <b>18</b></figref>, the main image <b>1810</b> is displayed on the top left of the screen <b>1800</b> of the digital device. However, the position where the main image <b>1810</b> is displayed is not limited thereto and it may be displayed at any location within the screen <b>1800</b> of the digital device.</p><p id="p-0645" num="0590">The main image <b>1810</b> and the sub-image <b>1820</b> may be directly or indirectly related to each other. For example, the main image <b>1810</b> may be a streaming video, and the sub-image <b>1820</b> may be a GUI that sequentially displays thumbnails of videos including information similar to the streaming video. As another example, the main image <b>1810</b> may be a broadcasting image and the sub-image <b>1820</b> may be an EPG. As another example, the main image <b>1810</b> may be a broadcasting image, and the sub-image <b>1820</b> may be a GUI. Examples of the main image <b>1810</b> and the sub-image <b>1820</b> are not limited thereto.</p><p id="p-0646" num="0591">In an embodiment, the main image <b>1810</b> may be a broadcasting image received through a broadcasting channel and the sub-image <b>1820</b> may be information related to a broadcasting image received through a broadcasting channel. The information related to the broadcasting image received through the broadcast channel may include, for example, EPG information including a comprehensive channel schedule, detailed information of a broadcast program, information on a broadcast program review, and the like, but is not limited thereto.</p><p id="p-0647" num="0592">In another embodiment, the main image <b>1810</b> may be a broadcasting image received through a broadcast channel and the sub-image <b>1820</b> may be an image generated based on information previously stored in a digital device. An image generated based on information previously stored in a digital device may include, for example, a basic UI (user interface), basic channel information, an image resolution manipulation UI, a sleep reservation UI, and the like of the EPG but is not limited thereto.</p><p id="p-0648" num="0593">In another embodiment, the main image <b>1810</b> may be a broadcasting image received through the broadcast channel and the sub-image <b>1820</b> may be information related to a broadcasting image received through a network. The information related to the broadcasting image received through the network may be, for example, information obtained through a search engine based on the network. More specifically, for example, information related to a character currently being displayed on the main image <b>1810</b> may be obtained through a search engine based on a network.</p><p id="p-0649" num="0594">However, the example is not limited thereto, and the information related to the broadcasting image, which is received through the network, may be obtained by using, for example, an artificial intelligence (Ai) system. More specifically, for example, an estimated-location in a map of a place currently being displayed on the main image <b>1810</b> may be obtained using deep-learning based on a network and the digital device may receive information on the estimated location in the map of the place currently displayed on the main image <b>1810</b> through a network.</p><p id="p-0650" num="0595">The digital device according to an embodiment may receive at least one of image information of the main image <b>1810</b> and image information of the sub-image <b>1820</b> from the outside. The image information of the main image <b>1810</b> may include, for example, a broadcasting signal received through a broadcasting channel, source code information of the main image <b>1810</b>, and IP packet information of the image <b>1810</b> received through the network, but is not limited thereto. Similarly, the image information of the sub-image <b>1820</b> may include, for example, a broadcast signal received through the broadcast channel, source code information of the sub-image <b>1820</b>, and IP packet information of the sub-image <b>1820</b> received through the network, but is not limited thereto. The digital device may decode the image information of the main image <b>1810</b> or the image information of the sub-image <b>1820</b> received from the outside and use the same. However, in some cases, the digital device may internally store image information of the main video <b>1810</b> or image information of the sub-image <b>1820</b>.</p><p id="p-0651" num="0596">The digital device may display the main image <b>1810</b> and the sub-image <b>1820</b> on the screen <b>1800</b> of the digital device based on the image information of the main image <b>1810</b> and the information related to the sub-image <b>1820</b>.</p><p id="p-0652" num="0597">In an example, the decoding apparatus <b>300</b> of the digital device may include a main image decoding apparatus and a sub-image decoding apparatus, and the main image decoding apparatus and the sub-image decoding apparatus each decode the image information of the main image <b>1810</b> and the image information of the sub-image <b>1820</b>, respectively. The renderer may include a main image renderer (first renderer) and a sub-image renderer (second renderer), and the main image renderer may display the main image <b>1810</b> in a first ion region of the screen <b>1800</b> of the digital device based on the information decoded by the main image decoding apparatus and the sub-image renderer may display the sub-image <b>1820</b> in a second region of the screen <b>1800</b> of the digital device based on the information decoded by the sub-image decoding apparatus.</p><p id="p-0653" num="0598">In another example, the decoding apparatus <b>300</b> of the digital device may decode the image information of the main image <b>1810</b> and the image information of the sub-image <b>1820</b>. Based on the information decoded by the decoding apparatus <b>200</b>, the renderer may process the main image <b>1810</b> and the sub-image <b>1820</b> together so that they are simultaneously displayed on the screen <b>1800</b> of the digital device.</p><p id="p-0654" num="0599">That is, according to this document, the digital device may provide a video service processing method. The image service processing method may include receiving image information, decoding a (main) image based on the image information, rendering or displaying the decoded image in a first region of the display, and rendering or displaying a sub-image in a second region of the display. In this case, the decoding of the first image may follow the decoding procedure of the decoding apparatus <b>300</b> according to <figref idref="DRAWINGS">FIGS. <b>0</b>.<b>3</b>-<b>1</b></figref>. For example, as described above, the decoding of the first image may include deriving prediction samples for a current block based on inter or intra prediction, deriving residual samples for the current block based on the received residual information (optional), and generating reconstructed samples based on the prediction samples and/or the residual samples. Additionally, the decoding of the first image may include performing an in-loop filtering procedure on the reconstructed picture including the reconstructed samples.</p><p id="p-0655" num="0600">For example, the sub-image may be an electronic program guide (EPG), an on screen display (OSD), or a graphical user interface (GUI). For example, the image information may be received through a broadcast network, and the information on the sub-image may be received through the broadcast network. For example, the image information may be received through a communication network, and the information on the sub-image may be received through the communication network. For example, the image information may be received through a broadcasting network, and the information on the sub-image may be received through a communication network. For example, the image information may be received through a broadcasting network or a communication network, and the information on the sub-image may be stored in a storage medium in the digital device.</p><?detailed-description description="Detailed Description" end="tail"?></description><us-math idrefs="MATH-US-00001" nb-file="US20230007269A1-20230105-M00001.NB"><img id="EMI-M00001" he="14.14mm" wi="76.20mm" file="US20230007269A1-20230105-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00002" nb-file="US20230007269A1-20230105-M00002.NB"><img id="EMI-M00002" he="6.01mm" wi="76.20mm" file="US20230007269A1-20230105-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00003" nb-file="US20230007269A1-20230105-M00003.NB"><img id="EMI-M00003" he="6.69mm" wi="76.20mm" file="US20230007269A1-20230105-M00003.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00004 MATH-US-00004-2" nb-file="US20230007269A1-20230105-M00004.NB"><img id="EMI-M00004" he="47.58mm" wi="76.20mm" file="US20230007269A1-20230105-M00004.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00005" nb-file="US20230007269A1-20230105-M00005.NB"><img id="EMI-M00005" he="3.13mm" wi="76.20mm" file="US20230007269A1-20230105-M00005.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00006" nb-file="US20230007269A1-20230105-M00006.NB"><img id="EMI-M00006" he="15.83mm" wi="76.20mm" file="US20230007269A1-20230105-M00006.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-math idrefs="MATH-US-00007" nb-file="US20230007269A1-20230105-M00007.NB"><img id="EMI-M00007" he="5.67mm" wi="76.20mm" file="US20230007269A1-20230105-M00007.TIF" alt="embedded image " img-content="math" img-format="tif"/></us-math><us-claim-statement>What is claimed is:</us-claim-statement><claims id="claims"><claim id="CLM-00001" num="00001"><claim-text><b>1</b>. An image decoding method performed by a decoding apparatus, the image decoding method comprising:<claim-text>obtaining image information including prediction mode information and residual information from a bitstream;</claim-text><claim-text>deriving an L0 motion vector and an L1 motion vector of a current block based on the prediction mode information;</claim-text><claim-text>deriving a refined L0 motion vector and a refined L1 motion vector based on the L0 motion vector and the L1 motion vector by applying a decoder-side motion vector refinement (DMVR) to the current block based on DMVR flag information;</claim-text><claim-text>deriving prediction samples for the current block based on the refined L0 motion vector and the refined L1 motion vector;</claim-text><claim-text>deriving residual samples for the current block based on the residual information; and</claim-text><claim-text>generating reconstructed samples for the current block based on the prediction samples and the residual samples,</claim-text><claim-text>wherein the DMVR flag information is related to whether to apply DMVR to the current block, and</claim-text><claim-text>wherein based on a case where bi-prediction performed based on an L0 reference picture and an L1 reference picture is applied to the current block, a case where a value of L0 luma weight prediction flag information and a value of L1 luma weight prediction flag information are both equal to 0, a case where a value of L0 chroma weight prediction flag information and a value of L1 chroma weight prediction flag information are both equal to 0, a case where a value of bi-prediction weight index information is equal to 0, and a case where a height of the current block is greater than or equal to 8, the DMVR flag information related to applying the DMVR to the current block is derived.</claim-text></claim-text></claim><claim id="CLM-00002" num="00002"><claim-text><b>2</b>. The image decoding method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein based on at least one of a case where the bi-prediction performed based on the L0 reference picture and the L1 reference picture is not applied to the current block, a case where at least one of the value of the L0 luma weight prediction flag information and the value of the L1 luma weight prediction flag information, the value of the L0 chroma weight prediction flag information and the value of the L1 chroma weight prediction flag information, or the value of bi-prediction weight index information is not equal to 0, or a case where the height of the current block is less than 8, the DMVR flag information related to not applying the DMVR to the current block.</claim-text></claim><claim id="CLM-00003" num="00003"><claim-text><b>3</b>. The image decoding method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein based on a case where a prediction mode in which an inter prediction and an intra prediction are combined is not applied to the current block, the DMVR flag information related to applying the DMVR to the current block is derived.</claim-text></claim><claim id="CLM-00004" num="00004"><claim-text><b>4</b>. The image decoding method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein a case that the value of the L0 luma weight prediction flag information is equal to 0 represents that a weight factor of an L0 prediction for a luma component is not present, and a case that the value of the L1 luma weight prediction flag information is equal to 0 represents that a weight factor of an L1 prediction for the luma component of an L1 prediction is not present,<claim-text>wherein a case that the value of the L0 chroma weight prediction flag information is equal to 0 represents that a weight factor of an L0 prediction for a chroma component is not present, and a case that the value of the L1 chroma weight prediction flag information is equal to 0 represents that a weight factor of an L1 prediction for a chroma component is not present, and</claim-text><claim-text>wherein a case that the value of the bi-prediction weight index information is equal to 0 represents a default case in which different weights are not applied to the L0 prediction and the L1 prediction.</claim-text></claim-text></claim><claim id="CLM-00005" num="00005"><claim-text><b>5</b>. The image decoding method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the deriving of the refined L0 motion vector and the refined L1 motion vector comprises:<claim-text>deriving a minimum sum of absolute differences (SAD) based on L0 prediction samples derived based on the L0 motion vector and L1 prediction samples derived based on the L1 motion vector, and</claim-text><claim-text>deriving the refined L0 motion vector for the L0 motion vector and the refined L1 motion vector for the L1 motion vector based on a sample position corresponding to the minimum SAD.</claim-text></claim-text></claim><claim id="CLM-00006" num="00006"><claim-text><b>6</b>. The image decoding method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:<claim-text>determining whether a merge mode is applied to the current block; and</claim-text><claim-text>obtaining merge index information based on a case where the merge mode is applied to the current block,</claim-text><claim-text>wherein the L0 motion vector and the L1 motion vector are derived from a neighboring block indicated by the merge index information among neighboring blocks of the current block.</claim-text></claim-text></claim><claim id="CLM-00007" num="00007"><claim-text><b>7</b>. An image encoding method performed by an encoding apparatus, the image encoding method comprising:<claim-text>deriving an L0 motion vector and an L1 motion vector of a current block;</claim-text><claim-text>deriving a refined L0 motion vector and a refined L1 motion vector based on the L0 motion vector and the L1 motion vector by applying a decoder-side motion vector refinement (DMVR) to the current block, based on DMVR flag information;</claim-text><claim-text>deriving prediction samples for the current block based on the refined L0 motion vector and the refined L1 motion vector:</claim-text><claim-text>deriving residual samples based on the prediction samples; and</claim-text><claim-text>encoding image information including information on the residual samples,</claim-text><claim-text>wherein the DMVR flag information is related to whether to apply DMVR to the current block, and</claim-text><claim-text>wherein based on a case where bi-prediction performed based on an L0 reference picture and an L1 reference picture is applied to the current block, a case where a value of L0 luma weight prediction flag information and a value of L1 luma weight prediction flag information are both equal to 0, a case where a value of L0 chroma weight prediction flag information and a value of L1 chroma weight prediction flag information are both equal to 0, a case where a value of bi-prediction weight index information is equal to 0, and a case where a height of the current block is greater than or equal to 8, the DMVR flag information related to applying the DMVR to the current block is derived.</claim-text></claim-text></claim><claim id="CLM-00008" num="00008"><claim-text><b>8</b>. The image encoding method of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein based on at least one of a case where the bi-prediction performed based on the L0 reference picture and the L1 reference picture is not applied to the current block, a case where at least one of the value of the L0 luma weight prediction flag information and the value of the L1 luma weight prediction flag information, the value of the L0 chroma weight prediction flag information and the value of the L1 chroma weight prediction flag information, or the value of bi-prediction weight index information is not equal to 0, or a case where the height of the current block is less than 8, the DMVR flag information related to not applying the DMVR to the current block.</claim-text></claim><claim id="CLM-00009" num="00009"><claim-text><b>9</b>. The image encoding method of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein based on a case where a prediction mode in which an inter prediction and an intra prediction are combined is not applied to the current block, the DMVR flag information related to applying the DMVR to the current block is derived.</claim-text></claim><claim id="CLM-00010" num="00010"><claim-text><b>10</b>. The image encoding method of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein a case that the value of the L0 luma weight prediction flag information is equal to 0 represents that a weight factor of an L0 prediction for a luma component is not present, and a case that the value of the L1 luma weight prediction flag information is equal to 0 represents that a weight factor of an L1 prediction for the luma component of an L1 prediction is not present,<claim-text>wherein a case that the value of the L0 chroma weight prediction flag information is equal to 0 represents that a weight factor of an L0 prediction for a chroma component of an L0 prediction is not present, and a case that the value of the L1 chroma weight prediction flag information is equal to 0 represents that a weight factor of an L1 prediction for the chroma component of an L1 prediction is not present, and</claim-text><claim-text>wherein a case that the value of the bi-prediction weight index information is equal to 0 represents a default case in which different weights are not applied to the L0 prediction and the L1 prediction.</claim-text></claim-text></claim><claim id="CLM-00011" num="00011"><claim-text><b>11</b>. A non-transitory computer-readable storage medium storing a bitstream generated by a method, the method comprising:<claim-text>deriving an L0 motion vector and an L1 motion vector of a current block;</claim-text><claim-text>deriving decoder-side motion vector refinement (DMVR) flag information related to indicating whether to apply DMVR to the current block;</claim-text><claim-text>deriving a refined L0 motion vector and a refined L1 motion vector based on the L0 motion vector and the L1 motion vector by applying the DMVR a decoder-side motion vector refinement (DMVR) to the current block, based on the DMVR flag information related to applying the DMVR to the current block;</claim-text><claim-text>deriving prediction samples for the current block based on the refined L0 motion vector and the refined L1 motion vector;</claim-text><claim-text>deriving residual samples based on the prediction samples; and</claim-text><claim-text>encoding image information including information on the residual samples,</claim-text><claim-text>wherein the DMVR flag information is related to whether to apply DMVR to the current block, and</claim-text><claim-text>wherein based on a case where bi-prediction performed based on an L0 reference picture and an L1 reference picture is applied to the current block, a case where a value of L0 luma weight prediction flag information and a value of L1 luma weight prediction flag information are both equal to 0, a case where a value of L0 chroma weight prediction flag information and a value of L1 chroma weight prediction flag information are both equal to 0, a case where a value of bi-prediction weight index information is equal to 0, and a case where a height of the current block is greater than or equal to 8, the DMVR flag information related to applying the DMVR to the current block is derived.</claim-text></claim-text></claim></claims></us-patent-application>