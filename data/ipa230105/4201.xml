<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230004202A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230004202</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17745895</doc-number><date>20220517</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><priority-claims><priority-claim sequence="01" kind="national"><country>CN</country><doc-number>202110749886.X</doc-number><date>20210702</date></priority-claim></priority-claims><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>G</section><class>06</class><subclass>F</subclass><main-group>1</main-group><subgroup>26</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>G</section><class>06</class><subclass>F</subclass><main-group>1</main-group><subgroup>266</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc></classifications-cpc><invention-title id="d2e61">Dongle and method for controlling power delivery</invention-title><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>Realtek Semiconductor Corp.</orgname><address><city>HsinChu</city><country>TW</country></address></addressbook><residence><country>TW</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>YI</last-name><first-name>LIU</first-name><address><city>Suzhou City</city><country>CN</country></address></addressbook></inventor><inventor sequence="01" designation="us-only"><addressbook><last-name>ZHU</last-name><first-name>DANDAN</first-name><address><city>Suzhou City</city><country>CN</country></address></addressbook></inventor><inventor sequence="02" designation="us-only"><addressbook><last-name>DENG</last-name><first-name>YUAN</first-name><address><city>Suzhou City</city><country>CN</country></address></addressbook></inventor><inventor sequence="03" designation="us-only"><addressbook><last-name>ZHANG</last-name><first-name>CONGYU</first-name><address><city>Suzhou City</city><country>CN</country></address></addressbook></inventor><inventor sequence="04" designation="us-only"><addressbook><last-name>Lin</last-name><first-name>Neng-Hsien</first-name><address><city>HsinChu</city><country>TW</country></address></addressbook></inventor><inventor sequence="05" designation="us-only"><addressbook><last-name>Wu</last-name><first-name>Tsung-Tao</first-name><address><city>HsinChu</city><country>TW</country></address></addressbook></inventor><inventor sequence="06" designation="us-only"><addressbook><last-name>Hsu</last-name><first-name>Fan-Hau</first-name><address><city>HsinChu</city><country>TW</country></address></addressbook></inventor></inventors></us-parties><assignees><assignee><addressbook><orgname>Realtek Semiconductor Corp.</orgname><role>03</role><address><city>HsinChu</city><country>TW</country></address></addressbook></assignee></assignees></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">A dongle coupled between a power supplying device for supplying power and a power receiving device for receiving power includes a downstream facing port (DFP), an upstream facing port (UFP) and a controller. The controller is arranged to control deliveries of the power and messages between the power supplying device and the power receiving device. In response to a first power request message received from the power receiving device, the controller is arranged to determine whether a power type request by the power receiving device is Programmable Power Supply (PPS) according to the first power request message. When determining that the power type request by the power receiving device is PPS, the controller is arranged to start first waiting timer, and when the first waiting timer expires, the controller is arranged to send a request accept message to the power receiving device through the UFP.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="36.41mm" wi="158.75mm" file="US20230004202A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="241.47mm" wi="108.63mm" orientation="landscape" file="US20230004202A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="249.94mm" wi="168.32mm" file="US20230004202A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="239.78mm" wi="162.05mm" file="US20230004202A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="247.99mm" wi="163.49mm" orientation="landscape" file="US20230004202A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0001" level="1">BACKGROUND OF THE INVENTION</heading><heading id="h-0002" level="1">1. Field of the Invention</heading><p id="p-0002" num="0001">The invention relates to a dongle, more particular to a dongle capable of supporting Power Delivery (PD) of Programmable Power Supply (PPS).</p><heading id="h-0003" level="1">2. Description of the Prior Art</heading><p id="p-0003" num="0002">Programmable Power Supply (PPS) is a new standard for power delivery, which makes the power supplying device (that is, the source) to be able to dynamically adjust output voltage and current based on the power negotiation result between the power receiving device (that is, the sink) and the power supplying device every ten seconds. The range of the transmitted voltage specified by the PPS standard is 3-21 volts (V), and the voltage adjustment step is 0.02V. Besides improving charging efficiency, the PPS standard further reduces the heat generation at the power receiving device during the charge.</p><p id="p-0004" num="0003">With the function of the consumer electronic products (e.g. the mobile phones) becoming more powerful, the time that the users hold and use the consumer electronic products is increased and the power consumption speed of the consumer electronic products is getting faster. As a result, the needs for fast charging the consumer electronic products become strong.</p><p id="p-0005" num="0004">In view of this, there is a need to develop more devices that are capable of supporting fast charging. A dongle that is capable of supporting power delivery of PPS is required so as to meet the needs in the market.</p><heading id="h-0004" level="1">SUMMARY OF THE INVENTION</heading><p id="p-0006" num="0005">The objective of the invention is to develop the associated method of controlling power delivery for a dongle capable of supporting power delivery of PPS.</p><p id="p-0007" num="0006">According to an embodiment of the invention, a dongle coupled between a power supplying device which supplies power and a power receiving device which receives the power. The dongle comprises a downstream facing port (DFP), arranged to be coupled to the power supplying device, an upstream facing port (UFP) arranged to be coupled to the power receiving device, and a controller coupled to the DFP and the UFP and arranged to control deliveries of the power and messages between the power supplying device and the power receiving device. In response to a first power request message received from the power receiving device, the controller is arranged to determine whether a power type request by the power receiving device is Programmable Power Supply (PPS) according to the first power request message. If the power type request by the power receiving device is PPS, the controller is arranged to start a first waiting timer, and when the first waiting timer expires, the controller is arranged to send a request accept message to the power receiving device through the UFP.</p><p id="p-0008" num="0007">According to another embodiment of the invention, a method for controlling power delivery between a power supplying device arranged to supply power and a power receiving device arranged to receive the power comprises: determine whether a power type request by the power receiving device is Programmable Power Supply (PPS) according to a first power request message received from the power receiving device; starting a first waiting timer if the power type request by the power receiving device is PPS; and sending a request accept message to the power receiving device when the first waiting timer expires.</p><p id="p-0009" num="0008">These and other objectives of the present invention will no doubt become obvious to those of ordinary skill in the art after reading the following detailed description of the preferred embodiment that is illustrated in the various figures and drawings.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0005" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p-0010" num="0009"><figref idref="DRAWINGS">FIG. <b>1</b></figref> is an exemplary block diagram of a power delivery system according to an embodiment of the invention.</p><p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. <b>2</b></figref> shows a flow chart of a method for controlling power delivery according to an embodiment of the invention.</p><p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. <b>3</b></figref> shows a flow chart of a method for controlling power delivery between the power receiving device and the power supplying device according to another embodiment of the invention.</p><p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. <b>4</b></figref> shows a flow chart of a method for controlling power delivery between the power receiving device and the power supplying device according to yet another embodiment of the invention.</p><p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is a schematic diagram showing the processing flows when the amount of change in the requested voltage of a power receiving device in the power delivery system is not greater than a predetermined value according to an embodiment of the invention.</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><heading id="h-0006" level="1">DETAILED DESCRIPTION</heading><p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. <b>1</b></figref> is an exemplary block diagram of a power delivery system according to an embodiment of the invention. The power delivery system may comprise a dongle <b>100</b>, a power supplying device <b>200</b> and a power receiving device <b>300</b>. The power supplying device <b>200</b> may also be referred to as a source for supplying power in the power delivery system. The power receiving device <b>300</b> may also be referred to as a sink or a sink device for receiving power in the power delivery system. The dongle <b>100</b> is coupled between the power supplying device <b>200</b> and the power receiving device <b>300</b> for controlling the delivery of power and the delivery of messages between the power supplying device <b>200</b> and the power receiving device <b>300</b>.</p><p id="p-0016" num="0015">The dongle <b>100</b> may at least include a controller <b>110</b>, a Downstream Facing Port (DFP) <b>120</b> arranged to be coupled to the power supplying device <b>200</b>, and an Upstream Facing Port (UFP) <b>130</b> arranged to be coupled to the power receiving device <b>300</b>. The controller <b>110</b> is coupled to the DFP <b>120</b> and UFP <b>130</b>, and is arranged to control the delivery of power and messages between the power supplying device <b>200</b> and the power receiving device <b>300</b>. As an example, the dongle <b>100</b> may evaluate the content of the received power request and bypass the received power and message between the power supplying device <b>200</b> and the power receiving device <b>300</b>. In addition, the controller <b>110</b> may maintain a state machine respectively for the DFP <b>120</b> and UFP <b>130</b>, so as to control the operations of the DFP <b>120</b> and UFP <b>130</b>.</p><p id="p-0017" num="0016">According to an embodiment of the invention, the dongle <b>100</b> may be a Universal Serial Bus (USB) Type C dongle, and may support the power delivery (PD) of Programmable Power Supply (PPS). In an embodiment of the invention, the dongle <b>100</b> may also be combined or integrated with the power supplying device <b>200</b> to form a power supplying device supporting PPS, as an example, the dongle <b>100</b> may be connected to the power supplying device <b>200</b> through the DFP <b>120</b> to form an adapter or a charger supporting PPS, and may output power that supports PPS or complies with the PPS standards through the UFP <b>130</b>.</p><p id="p-0018" num="0017">According to an embodiment of the invention, in a situation where the DFP <b>120</b> and UFP <b>130</b> are respectively connected to the power supplying device <b>200</b> and the power receiving device <b>300</b>, when the dongle <b>100</b> is sourced with power, an initialization procedure may be performed, and the initialization procedure may comprise the operations of sequentially establishing a Type C link and establishing a PPS PD link between the power supplying device <b>200</b> and DFP <b>120</b>, and a PPS PD link between the power receiving device <b>300</b> and UFP <b>130</b> respectively.</p><p id="p-0019" num="0018">After the PD link is established, the power receiving device <b>300</b> may start sending power requests to the UFP <b>130</b>, and the power requests will be passed to the power supplying device <b>200</b> by the dongle <b>100</b>.</p><p id="p-0020" num="0019">In response to a received power request, the controller <b>110</b> of the dongle <b>100</b> may first evaluate whether the power requested by the power receiving device <b>300</b> is available power (that is, whether the dongle <b>100</b> is able to supply the power requested by the power receiving device <b>300</b>). As an example, whether the power requested by the power receiving device <b>300</b> is available power may be determined according to the specifications of the configured hardware of the dongle <b>100</b> and the contents of the software and firmware programs. If the determination result shows yes, the power request is further passed to the power supplying device <b>200</b>. If the determination result shows no, the dongle <b>100</b> may ignore the received power request or may issue a request reject message to the power receiving device <b>300</b>.</p><p id="p-0021" num="0020">Based on the PPS standards, when the amount of power change requested by the power receiving device <b>300</b> is less than 500 millivolts (mV), the power supplying device <b>200</b> must complete the power adjustment within 25 milliseconds (ms) after replying a request accept message, and send a power ready message to the power receiving device <b>300</b>. However, in the normal situation where an intermediate device, such as a dongle, is coupled between the power supplying device <b>200</b> and the power receiving device <b>300</b> in the power delivery system, such a dongle is usually unable meet the requirement of completing the task of power adjustment within 25 milliseconds. The reason that a general dongle fails to meet the requirement is that, after evaluating the power requested by the power receiving device is an available power, such general dongle will immediately reply a request accept message to the power receiving device <b>300</b>, and then pass the power request to the power supplying device <b>200</b>. In response to the received power request, the power supplying device <b>200</b> must start to adjust the power after evaluating the request and send a power ready message after the power adjustment is completed. However, the overall procedure is very time consuming so that a general dongle is considered unable to meet the requirement of completing the task of power adjustment within 25 milliseconds.</p><p id="p-0022" num="0021">To solve the problems, one or more delays are properly added in the power delivery procedure of the proposed dongle <b>100</b>, for controlling the power delivery between the power supplying device and the power receiving device, and make the overall power delivery procedure be in compliance with PPS standards.</p><p id="p-0023" num="0022">According to an embodiment of the invention, as described above, after the PD link is established, the power receiving device <b>300</b> may send a first power request message to the power supplying device <b>200</b> through the dongle <b>100</b>. In response to the first power request message received from the power receiving device <b>300</b>, the controller <b>110</b> may first evaluate whether the power requested by the power receiving device <b>300</b> is available power as described above. The power request message may comprise information regarding the voltage level, the current level and the power type requested by the power receiving device <b>300</b>. When the power requested by the power receiving device <b>300</b> is not available, the dongle <b>100</b> may ignore the received power request or may issue a request reject message to the power receiving device <b>300</b>. It is to be noted that for simplicity, the embodiments are all provided on the basis that the power requested by the power receiving device <b>300</b> is available (i.e., can be supplied by the dongle <b>100</b>).</p><p id="p-0024" num="0023">When the power requested by the power receiving device <b>300</b> is available power, the dongle <b>100</b> may further determine whether a power type request by the power receiving device <b>300</b> is PPS according to the content (e.g., parameters) of the first power request message. When determining that the power type request by the power receiving device is not PPS, the controller <b>110</b> is arranged to directly send a request accept message to the power receiving device <b>300</b> through the UFP <b>130</b> for responding to the first power request message, and provide the first power request message to the power supplying device <b>200</b> through the DFP <b>120</b>. On the other hand, when determining that the power type request by the power receiving device is PPS, the controller <b>110</b> is arranged to start a first waiting timer, so as to delay the time of sending the request accept message. The controller <b>110</b> is arranged to drive the DFP <b>120</b> during the waiting period (for the first waiting time corresponding to the first waiting timer), so as to send the first power request message to the power supplying device <b>200</b> through the DFP <b>120</b>. In an embodiment of the invention, before the first waiting timer expires, the controller is arranged to temporarily not deliver a request accept message to the power receiving device <b>300</b> through the UFP <b>130</b>, but will bypass the first power request message to the power supplying device <b>200</b> through the DFP <b>120</b>. According to an embodiment of the invention, when the first waiting timer expires, the controller <b>110</b> is arranged to send a request accept message to the power receiving device <b>300</b> through the UFP <b>130</b> for responding to the first power request message.</p><p id="p-0025" num="0024">According to another embodiment of the invention, when it is determined that the power type requested by the power receiving device <b>300</b> is PPS, the controller <b>110</b> is further arranged to determine an amount of change in requested voltage (i.e., an amount of change in requested power) based on the first power request message and a previously received power request message (i.e., the power request message previously from the power receiving device <b>300</b>), and determine whether the amount of change in requested voltage is greater than a predetermined value. In the embodiments of the invention, the predetermined value may be defined according to the PPS standards. As an example, the predetermined value may set to, but not limited to, 500 millivolts (mV). When determining that the amount of change in requested voltage is greater than the predetermined value, the controller <b>110</b> may directly send the request accept message to the power receiving device <b>300</b> through the UFP <b>130</b> for responding to the first power request message, and send the first power request message to the power supplying device <b>200</b> through the DFP <b>120</b>.</p><p id="p-0026" num="0025">When determining that the amount of change in requested voltage is not greater than the predetermined value, the controller <b>110</b> is arranged to start the first waiting timer for delaying the transmitting time of the request accept message, and drive the DFP <b>120</b> during the waiting period (for the first waiting time corresponding to the first waiting timer) so as to send the first power request message to the power supplying device <b>200</b> through the DFP <b>120</b>. In the embodiments of the invention, before the first waiting timer expires, the controller <b>110</b> is arranged to temporarily not send a request accept message to the power receiving device <b>300</b> through the UFP <b>130</b>, but provide the first power request message to the power supplying device <b>200</b> through the DFP <b>120</b>. When the first waiting timer expires, the controller <b>110</b> is arranged to send the request accept message to the power receiving device <b>300</b> through the UFP <b>130</b> for responding to the first power request message.</p><p id="p-0027" num="0026">According to an embodiment of the invention, the first waiting timer may be set to the time required for the power supplying device <b>200</b> to reply a request accept message in response to a power request message. To be more specific, according to an embodiment of the invention, after the PD link is established, the controller <b>110</b> may actively send a power request message to the power supplying device <b>200</b> and may start to count the time that the power supply device <b>200</b> receives the power request message and sends back a request accept message, so as to obtain the time required for the power supplying device <b>200</b> to reply a request accept message in response to a power request message. The controller <b>110</b> may set the first waiting timer based on the obtained result.</p><p id="p-0028" num="0027">Generally, when the power supplying device <b>200</b> receives a power request message, the power supplying device <b>200</b> may also evaluate whether the power requested by the sink device is available power, and may send a request accept message to the sink device to respond to this power request message after determining that the power requested by the sink device is available power, and may start to perform power adjustment based on the requested power. After the power adjustment is completed, the power supplying device <b>200</b> may send a power ready message to the sink device to inform that the power is ready, and start to supply the power requested by the sink device.</p><p id="p-0029" num="0028">In the embodiments of the invention, when the power type requested by the power receiving device <b>300</b> is PPS and the amount of change in requested voltage is not greater than a predetermined value, the dongle <b>100</b> will delay the time to send the request accept message, e.g., to the time when the first waiting timer expires. In this manner, the time it takes for the power supplying device <b>200</b> to evaluate the power and reply the request accept message will be excluded from the 25 milliseconds specified by the PPS standard, which helps the combination of the dongle <b>100</b> and the power supplying device <b>200</b> to meet the requirements of completing such power adjustment within 25 milliseconds.</p><p id="p-0030" num="0029">In addition, generally, the dongle may be equipped with a voltage detection circuit, such as an analog-to-digital conversion circuit, for detecting whether the level of the power currently supplied by the power supplying device <b>200</b> meets the demand of the power receiving device <b>300</b>. However, since the voltage adjustment step defined by the PPS standard is 0.02V, which is smaller than the resolution or accuracy of the voltage detection circuit configured inside a general dongle for voltage detection (note that the resolution or accuracy of the voltage detection circuit depends on the hardware specifications of the dongle), the timing requirements of PD in the PPS standards may be violated. To avoid violating the time specified by the PPS standards, during the procedure of fine-tuning or trimming the voltage requested by the power receiving device <b>300</b>, the controller inside the dongle may directly trigger a Power Good Interrupt such that the Vbus of the dongle configured to delivery power will be set in a ready state and will deliver the power ready message in advance of the actual power adjustment supposed to be performed by the power supplying device.</p><p id="p-0031" num="0030">To solve this problem, according to an embodiment of the invention, when the aforementioned first waiting timer is expired, or after the controller <b>110</b> sends the request accept message to the power receiving device <b>300</b> through the UFP <b>130</b>, the controller <b>110</b> may be arranged to start a second waiting timer, and when the second waiting timer expires, the controller <b>110</b> is arranged to determine whether the DFP <b>120</b> has received a power ready message from the power supplying device <b>200</b>. When it is determined that the DFP <b>120</b> has received the power ready message from the power supplying device <b>200</b>, the controller is arranged to send the power ready message to the power receiving device <b>300</b> through the UFP <b>130</b>. If the DFP <b>120</b> has not received the power ready message from the power supplying device <b>200</b> before the second waiting timer is expired, the power supplying device <b>200</b> is unable to complete the power adjustment task within the time specified by the standard and the PD link has to be reestablished. Therefore, the controller <b>110</b> may initiate a reset procedure to reestablish a power delivery link with the power supplying device or the power receiving device. According to an embodiment of the invention, operations in the reset procedure may be similar to that of the aforementioned initialization procedure. As an example, the controller <b>110</b> may re-perform whole or a part of operations in the initialization procedure. In this manner, the problem of insufficient resolution or accuracy of the voltage detection circuit is solved, and the PD operations of the dongle meet the PD timing requirements specified in the PPS standards as well.</p><p id="p-0032" num="0031">According to an embodiment of the invention, the second waiting timer may be set to 25 ms to comply with the limitation of the time for power adjustment specified in the PPS standards. However, the invention is not limited to set the second waiting timer to 25 ms. As an example, the second waiting timer may be properly designed based on the requirements of the power delivery system. According to an embodiment of the invention, the second waiting timer may be set to the time required for the power supplying device <b>200</b> to perform power adjustment in response to a power request message. To be more specific, according to an embodiment of the invention, after the PD link is established, the controller <b>110</b> may actively send a power request message to the power supplying device <b>200</b> and may start to count the time required for the power supplying device <b>200</b> to perform power adjustment, so as to obtain the time required for the power supplying device <b>200</b> to perform power adjustment in response to a power request message and set the second waiting timer based on the obtained result, or the controller <b>110</b> may count the time from the power supplying device <b>200</b> replying a request accept message in response to the power request message to the power supplying device <b>200</b> sending a power ready message, so as to obtain the time required for the power supplying device <b>200</b> to perform power adjustment (which is started from the power supplying device <b>200</b> replying the request accept message), and the controller <b>110</b> may set the second waiting timer based on the time required for the power supplying device <b>200</b> to perform power adjustment.</p><p id="p-0033" num="0032">Besides the first waiting timer and the second waiting timer, according to an embodiment of the invention, for meeting the keep alive requirement specified by the PPS standards even when the power supplying device <b>200</b> and the power receiving device <b>300</b> are indirectly connected through the dongle <b>100</b>, the controller <b>110</b> may respectively set a corresponding timer for the DFP <b>120</b> and the UPF <b>130</b> of the dongle, and make the DFP <b>120</b> and the UPF <b>130</b> to respectively act as a sink device and a source, so as to assist the power supplying device <b>200</b> and the power receiving device <b>300</b> to maintain the PPS PD connection.</p><p id="p-0034" num="0033">According to an embodiment of the invention, after the PD link is established, the controller <b>110</b> is further arranged to start a third waiting timer, and when the third waiting timer expires, the controller <b>110</b> is arranged to determine whether the UFP <b>130</b> has received any power request message from the power receiving device <b>300</b>. When determination result shows yes, it means that the power receiving device <b>300</b> is still keeping the PD link and the controller <b>110</b> may perform the associated processing in response to the received power request message. As an example, processing the received power request message as described in the aforementioned embodiments. When determination result shows no, that is, when determining that the UFP <b>130</b> has not received any power request message from the power receiving device <b>300</b> before the third waiting timer is expired, it means that the UFP <b>130</b> is now disconnected, and the controller <b>110</b> may initiate a reset procedure to reestablish a power delivery link with the power receiving device <b>300</b>. It is to be noted that, in the embodiments of the invention, the controller <b>110</b> may repeatedly restart the third waiting timer and perform the determination and the associated operations as discussed above every time when the third waiting timer expires, for making the power receiving device <b>300</b> to meet the keep alive requirement specified by the PPS standards.</p><p id="p-0035" num="0034">According to an embodiment of the invention, the third waiting timer may be set to 12-15 seconds to comply with the requirements specified in the PPS standards. However, the invention is not limited to set the third waiting timer to 12-15 seconds. As an example, the third waiting timer may be properly designed based on the requirements of the power delivery system.</p><p id="p-0036" num="0035">In addition, according to an embodiment of the invention, after the PD link is established, the controller <b>110</b> is further arranged to start a fourth waiting timer, and when the fourth waiting timer expires, the controller <b>110</b> is arranged to determine whether a power request message or a communication message has been sent to the power supplying device <b>200</b> before the fourth waiting timer expires. When determination result shows yes, it means that both the power receiving device <b>300</b> and the power supplying device <b>200</b> are still communicating with each other and the controller <b>110</b> may perform the associated processing in response to the received message. When determination result shows no, it means that none of the power request message and the communication message being sent to the power supplying device <b>200</b> through the dongle <b>100</b> before the fourth waiting timer expires, and the controller <b>110</b> may actively generate a power request message and send it to the power supplying device <b>200</b> through the DFP <b>120</b>, so as to keep the PD link with the power supplying device <b>200</b>. It is to be noted that, in the embodiments of the invention, the controller <b>110</b> may repeatedly restart the fourth waiting timer and perform the determination and the associated operations as discussed above every time when the fourth waiting timer expires, for making the power receiving device <b>300</b> to meet the keep alive requirement specified by the PPS standards.</p><p id="p-0037" num="0036">According to an embodiment of the invention, the fourth waiting timer may be set to 10 seconds to comply with the requirements specified in the PPS standards. However, the invention is not limited to set the fourth waiting timer to 10 seconds. As an example, the fourth waiting timer may be properly designed based on the requirements of the power delivery system.</p><p id="p-0038" num="0037"><figref idref="DRAWINGS">FIG. <b>2</b></figref> shows a flow chart of a method for controlling power delivery according to an embodiment of the invention. The method comprises the following steps performed by the controller <b>110</b>:</p><p id="p-0039" num="0038">Step S<b>202</b>: a power request message is received from a power receiving device.</p><p id="p-0040" num="0039">Step S<b>204</b>: whether a power type requested by the power receiving device is PPS is determined according to the received power request message. When determination result shows yes, step S<b>206</b> is performed. When determination result shows no, step S<b>210</b> is performed. It is to be noted that as discussed above, this embodiment is provided on the basis that the power requested by the power receiving device is available power for the dongle.</p><p id="p-0041" num="0040">Step S<b>206</b>: an amount of change in requested voltage is determined based on the power request message and a previously received power request message and whether the amount of change in requested voltage is smaller than or equal to a predetermined value is determined. When determination result shows yes, step S<b>208</b> is performed. When determination result shows no, step S<b>210</b> is performed. It is to be noted that in another embodiment of the invention, the determination in step S<b>206</b> may also be skipped. That is, when determination result in step S<b>204</b> shows yes, step S<b>208</b> is performed.</p><p id="p-0042" num="0041">Step S<b>208</b>: a first waiting timer is started and the power request message is sent to the power supplying device at the same time; when the first waiting timer expires, the request accept message is sent to the power receiving device and a second waiting timer is started. When the second waiting timer expires, step S<b>212</b> is performed.</p><p id="p-0043" num="0042">Step S<b>210</b>: the request accept message is directly sent to the power receiving device and the power request message is sent to the power supplying device. Then, the controller may wait for the power ready message sent by the power supplying device after the power adjustment is completed and perform step S<b>214</b> when the ready message is received.</p><p id="p-0044" num="0043">Step S<b>212</b>: whether a power ready message has been received from the power supplying device is determined when the second waiting timer expires. When determination result shows yes, step S<b>214</b> is performed. When determination result shows no, step S<b>216</b> is performed.</p><p id="p-0045" num="0044">Step S<b>214</b>: the power ready message is sent to the power receiving device.</p><p id="p-0046" num="0045">Step S<b>216</b>: a reset procedure is initiated to reestablish a power delivery link. When the power delivery link is reestablished, the controller may wait for the power request message from the power receiving device and re-perform step S<b>202</b>.</p><p id="p-0047" num="0046"><figref idref="DRAWINGS">FIG. <b>3</b></figref> shows a flow chart of a method for controlling power delivery between the power receiving device and the power supplying device according to another embodiment of the invention. This method may be applied for the power receiving device <b>300</b> as shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref> to meet the keep alive requirement specified by the PPS standard and may be performed at the same time with the method illustrated in <figref idref="DRAWINGS">FIG. <b>2</b></figref>. The method comprises the following steps performed by the controller <b>110</b>:</p><p id="p-0048" num="0047">Step S<b>302</b>: a third waiting timer is started after the PD link is established. When the third waiting timer expires, step S<b>304</b> is performed.</p><p id="p-0049" num="0048">Step S<b>304</b>: whether any power request message has been received by the UFP from the power receiving device is determined. When determination result shows yes, step S<b>306</b> is performed. When determination result shows no, step S<b>308</b> is performed.</p><p id="p-0050" num="0049">Step S<b>306</b>: associated processing is performed in response to the received power request message and then step S<b>302</b> is returned to restart the third waiting timer.</p><p id="p-0051" num="0050">Step S<b>308</b>: a reset procedure is initiated to reestablish a power delivery link, and when the power delivery link is reestablished, step S<b>302</b> is returned to restart the third waiting timer.</p><p id="p-0052" num="0051"><figref idref="DRAWINGS">FIG. <b>4</b></figref> shows a flow chart of a method for controlling power delivery between the power receiving device and the power supplying device according to yet another embodiment of the invention. This method may be applied for the power supplying device <b>200</b> as shown in <figref idref="DRAWINGS">FIG. <b>1</b></figref> to meet the keep alive requirement specified by the PPS standard and may be performed at the same time with the method illustrated in <figref idref="DRAWINGS">FIG. <b>2</b></figref>. The method comprises the following steps performed by the controller <b>110</b>:</p><p id="p-0053" num="0052">Step S<b>402</b>: a fourth waiting timer is started after the PD link is established. When the fourth waiting timer expires, step S<b>404</b> is performed.</p><p id="p-0054" num="0053">Step S<b>404</b>: whether a power request message or a communication message has been sent to the power supplying device before the fourth waiting timer expires is determined. When determination result shows yes, step S<b>406</b> is performed. When determination result shows no, step S<b>408</b> is performed.</p><p id="p-0055" num="0054">Step S<b>406</b>: associated processing is performed in response to the received message and step S<b>402</b> is returned to restart the fourth waiting timer.</p><p id="p-0056" num="0055">Step S<b>408</b>: power request message is generated and sent to the power supplying device through the DFP <b>120</b> for keeping the PD link with the power supplying device <b>200</b>. Then, step S<b>402</b> is returned to restart the fourth waiting timer.</p><p id="p-0057" num="0056"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is a schematic diagram showing the processing flows when the amount of change in the requested voltage of a power receiving device in the power delivery system is not greater than a predetermined value according to an embodiment of the invention. The upper portion of <figref idref="DRAWINGS">FIG. <b>5</b></figref> shows the delivery of the message in the power delivery system, and also shows the corresponding operations performed by the power receiving device, the UFP, the DFP and the power supplying device in response to the received message. The lower portion of <figref idref="DRAWINGS">FIG. <b>5</b></figref> shows the transition of power, voltage and current between the UFP and UFP.</p><p id="p-0058" num="0057">As shown in <figref idref="DRAWINGS">FIG. <b>5</b></figref>, after the power receiving device issues a power request message, the UFP of a dongle (as an example, the UFP strategy engine controlled by the controller <b>110</b>, or the controller <b>110</b> itself) may evaluate the power request and start a waiting timer tPpsDelayAccept, and also drive the DFP (as an example, the DFP strategy engine controlled by the controller <b>110</b>, or the controller <b>110</b> itself) at the same time to send the power request message to the power supplying device. Upon receiving the power request message, the power supplying device may evaluate the power request and issue a request accept message or an evaluate accept message after the evaluation. The DFP receives the request accept message or the evaluate accept message issued by the power supplying device. On the other hand, when the waiting timer tPpsDelayAccept expires, the UFP sends the request accept message to the power receiving device, and the power receiving device may further evaluate the request accept message after receiving the request accept message.</p><p id="p-0059" num="0058">According to an embodiment of the invention, length of the waiting timer tPpsDelayAccept may be adjusted according to the time required for the power supplying device to reply a request accept message in response to a power request message. In addition, the time for the UFP to send the request accept message to the power receiving device may be earlier or later than the time when the DFP receives the request accept message or the evaluate accept message issued by the power supplying device.</p><p id="p-0060" num="0059">After the request accept message is sent to the power receiving device, the UFP may start another waiting timer tPpsSrcTransSmall. Meanwhile, the power supplying device may start performing power adjustment after sending the request accept message and may send a power ready message when the power adjustment is completed. When the waiting timer tPpsSrcTransSmall expires, the controller may determine whether the DFP has received the power ready message from the power supplying device. When determining that the DFP has not received the power ready message from the power supplying device, the controller may initiate a reset procedure to reestablish a power delivery link. When determining that the DFP has received the power ready message from the power supplying device, the UFP may then send the power ready message to the power receiving device. After receiving the power ready message, the power receiving device may evaluate the power ready message.</p><p id="p-0061" num="0060">According to an embodiment of the invention, length of the waiting timer tPpsSrcTransSmall may be set based on the time required for the power supplying device to send a power ready message after replying the request accept message.</p><p id="p-0062" num="0061">As shown in the lower portion of <figref idref="DRAWINGS">FIG. <b>5</b></figref>, the UFP power may experience the transition interval due to the power adjustment from the old power to the new power of the power supplying device. The voltage at the Vbus for delivery power transits from old voltage (Vold) gradually to the new voltage (Vnew) as the curve of the UFP voltage shown in <figref idref="DRAWINGS">FIG. <b>5</b></figref>. In addition, the current at the power receiving device transits from old current (Iold) gradually to the new current (Inew) as well.</p><p id="p-0063" num="0062">With the proposed dongle and the associated method for controlling power delivery, a dongle capable of supporting power delivery of PPS is implemented and the problems encountered when a general dongle is used for PPS power delivery can be effectively solved.</p><p id="p-0064" num="0063">Those skilled in the art will readily observe that numerous modifications and alterations of the device and method may be made while retaining the teachings of the invention. Accordingly, the above disclosure should be construed as limited only by the metes and bounds of the appended claims.</p><?detailed-description description="Detailed Description" end="tail"?></description><us-claim-statement>What is claimed is:</us-claim-statement><claims id="claims"><claim id="CLM-00001" num="00001"><claim-text><b>1</b>. A dongle, coupled between a power supplying device for supplying power and a power receiving device for receiving the power, comprising:<claim-text>a downstream facing port (DFP), arranged to be coupled to the power supplying device;</claim-text><claim-text>an upstream facing port (UFP), arranged to be coupled to the power receiving device; and</claim-text><claim-text>a controller, coupled to the DFP and the UFP and arranged to control deliveries of the power and messages between the power supplying device and the power receiving device,</claim-text><claim-text>wherein in response to a first power request message received from the power receiving device, the controller is arranged to determine whether a power type request by the power receiving device is Programmable Power Supply (PPS) according to the first power request message, and</claim-text><claim-text>when determining that the power type request by the power receiving device is PPS, the controller is arranged to start a first waiting timer, and when the first waiting timer expires, the controller is arranged to send a request accept message to the power receiving device through the UFP.</claim-text></claim-text></claim><claim id="CLM-00002" num="00002"><claim-text><b>2</b>. The dongle of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein before the first waiting timer expires, the controller is arranged not to send the request accept message to the power receiving device through the UFP.</claim-text></claim><claim id="CLM-00003" num="00003"><claim-text><b>3</b>. The dongle of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein when determining that the power type request by the power receiving device is not PPS, the controller is arranged to directly send the request accept message to the power receiving device through the UFP.</claim-text></claim><claim id="CLM-00004" num="00004"><claim-text><b>4</b>. The dongle of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein in response to the first power request message received from the power receiving device, the controller is further arranged to provide the first power request message to the power supplying device through the DFP.</claim-text></claim><claim id="CLM-00005" num="00005"><claim-text><b>5</b>. The dongle of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein when determining that the power type request by the power receiving device is PPS, the controller is further arranged to determine an amount of change in requested voltage based on the first power request message and a previously received power request message and determine whether the amount of change in requested voltage is greater than a predetermined value, wherein when determining that the amount of change in requested voltage is greater than the predetermined value, the controller is arranged to directly send the request accept message to the power receiving device through the UFP, and when determining that the amount of change in requested voltage is not greater than the predetermined value, the controller is arranged to start the first waiting timer and send the request accept message to the power receiving device through the UFP when the first waiting timer expires.</claim-text></claim><claim id="CLM-00006" num="00006"><claim-text><b>6</b>. The dongle of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein when the first waiting timer expires, the controller is further arranged to start a second waiting timer and when the second waiting timer expires, the controller is arranged to determine whether the DFP has received a power ready message from the power supplying device, and when determining that the DFP has not received the power ready message from the power supplying device, the controller is arranged to initiate a reset procedure to reestablish a power delivery link with at least one of the power supplying device and the power receiving device.</claim-text></claim><claim id="CLM-00007" num="00007"><claim-text><b>7</b>. The dongle of <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein when determining that the DFP has received the power ready message from the power supplying device, the controller is arranged to send the power ready message to the power receiving device through the UFP.</claim-text></claim><claim id="CLM-00008" num="00008"><claim-text><b>8</b>. The dongle of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the controller is further arranged to start a third waiting timer, and when the third waiting timer expires, the controller is arranged to determine whether the UFP has received a second power request message from the power receiving device, and when determining that the UFP has not received the second power request message from the power receiving device, the controller is arranged to initiate a reset procedure to reestablish a power delivery link with the power receiving device.</claim-text></claim><claim id="CLM-00009" num="00009"><claim-text><b>9</b>. The dongle of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the controller is further arranged to start a fourth waiting timer, and when the fourth waiting timer expires, the controller is arranged to determine whether a power request message or a communication message has been sent to the power supplying device before the fourth waiting timer expires, and when determining that none of the power request message and the communication message has been sent to the power supplying device before the fourth waiting timer expires, the controller is arranged to send a third power request message to the power supplying device through the DFP.</claim-text></claim><claim id="CLM-00010" num="00010"><claim-text><b>10</b>. A method for controlling power delivery between a power supplying device and a power receiving device, wherein the power supplying device is arranged to supply power and the power receiving device is arranged to receive the power, and the method comprises:<claim-text>determine whether a power type request by the power receiving device is Programmable Power Supply (PPS) according to a first power request message received from the power receiving device;</claim-text><claim-text>starting a first waiting timer when determining that the power type request by the power receiving device is PPS; and</claim-text><claim-text>sending a request accept message to the power receiving device when the first waiting timer expires.</claim-text></claim-text></claim><claim id="CLM-00011" num="00011"><claim-text><b>11</b>. The method of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein when determining that the power type request by the power receiving device is not PPS, the method further comprises:<claim-text>directly sending the request accept message to the power receiving device.</claim-text></claim-text></claim><claim id="CLM-00012" num="00012"><claim-text><b>12</b>. The method of <claim-ref idref="CLM-00010">claim 10</claim-ref>, further comprising:<claim-text>providing the first power request message to the power supplying device in response to the first power request message received from the power receiving device.</claim-text></claim-text></claim><claim id="CLM-00013" num="00013"><claim-text><b>13</b>. The method of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein when determining that the power type request by the power receiving device is PPS, the method further comprises:<claim-text>determining an amount of change in requested voltage based on the first power request message and a previously received power request message and determining whether the amount of change in requested voltage is greater than a predetermined value;</claim-text><claim-text>directly sending the request accept message to the power receiving device when determining that the amount of change in requested voltage is greater than the predetermined value; and</claim-text><claim-text>performing steps of starting the first waiting timer and sending the request accept message to the power receiving device when the first waiting timer expires when determining that the amount of change in requested voltage is not greater than the predetermined value.</claim-text></claim-text></claim><claim id="CLM-00014" num="00014"><claim-text><b>14</b>. The method of <claim-ref idref="CLM-00011">claim 11</claim-ref>, further comprising:<claim-text>starting a second waiting timer when the first waiting timer expires;</claim-text><claim-text>determining whether a power ready message has been received from the power supplying device when the second waiting timer expires; and</claim-text><claim-text>initiating a reset procedure to reestablish a power delivery link with at least one of the power supplying device and the power receiving device when determining that the power ready message has not been received from the power supplying device.</claim-text></claim-text></claim><claim id="CLM-00015" num="00015"><claim-text><b>15</b>. The method of <claim-ref idref="CLM-00014">claim 14</claim-ref>, further comprising:<claim-text>sending the power ready message to the power receiving device when determining that the power ready message has been received from the power supplying device.</claim-text></claim-text></claim><claim id="CLM-00016" num="00016"><claim-text><b>16</b>. The method of <claim-ref idref="CLM-00010">claim 10</claim-ref>, further comprising:<claim-text>starting a third waiting timer;</claim-text><claim-text>determining whether a second power request message has been received from the power receiving device when the third waiting timer expires; and</claim-text><claim-text>initiating a reset procedure to reestablish a power delivery link with the power receiving device when determining that the second power request message has not been received from the power receiving device.</claim-text></claim-text></claim><claim id="CLM-00017" num="00017"><claim-text><b>17</b>. The method of <claim-ref idref="CLM-00010">claim 10</claim-ref>, further comprising:<claim-text>starting a fourth waiting timer;</claim-text><claim-text>determining whether a power request message or a communication message has been sent to the power supplying device before the fourth waiting timer expires; and</claim-text><claim-text>generating a third power request message and sending the third power request message to the power supplying device when determining that none of the power request message and the communication message has been sent to the power supplying device before the fourth waiting timer expires.</claim-text></claim-text></claim></claims></us-patent-application>