<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE us-patent-application SYSTEM "us-patent-application-v46-2022-02-17.dtd" [ ]><us-patent-application lang="EN" dtd-version="v4.6 2022-02-17" file="US20230007019A1-20230105.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20221221" date-publ="20230105"><us-bibliographic-data-application lang="EN" country="US"><publication-reference><document-id><country>US</country><doc-number>20230007019</doc-number><kind>A1</kind><date>20230105</date></document-id></publication-reference><application-reference appl-type="utility"><document-id><country>US</country><doc-number>17783645</doc-number><date>20200115</date></document-id></application-reference><us-application-series-code>17</us-application-series-code><classifications-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>L</subclass><main-group>9</main-group><subgroup>40</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr><classification-ipcr><ipc-version-indicator><date>20060101</date></ipc-version-indicator><classification-level>A</classification-level><section>H</section><class>04</class><subclass>L</subclass><main-group>41</main-group><subgroup>16</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source></classification-ipcr></classifications-ipcr><classifications-cpc><main-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>L</subclass><main-group>63</main-group><subgroup>1416</subgroup><symbol-position>F</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></main-cpc><further-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>L</subclass><main-group>63</main-group><subgroup>0263</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc><classification-cpc><cpc-version-indicator><date>20130101</date></cpc-version-indicator><section>H</section><class>04</class><subclass>L</subclass><main-group>41</main-group><subgroup>16</subgroup><symbol-position>L</symbol-position><classification-value>I</classification-value><action-date><date>20230105</date></action-date><generating-office><country>US</country></generating-office><classification-status>B</classification-status><classification-data-source>H</classification-data-source><scheme-origination-code>C</scheme-origination-code></classification-cpc></further-cpc></classifications-cpc><invention-title id="d2e43">RELAY DEVICE AND RELAY METHOD</invention-title><us-parties><us-applicants><us-applicant sequence="00" app-type="applicant" designation="us-only" applicant-authority-category="assignee"><addressbook><orgname>Mitsubishi Electric Corporation</orgname><address><city>Tokyo</city><country>JP</country></address></addressbook><residence><country>JP</country></residence></us-applicant></us-applicants><inventors><inventor sequence="00" designation="us-only"><addressbook><last-name>MINAMI</last-name><first-name>Tatsunori</first-name><address><city>Tokyo</city><country>JP</country></address></addressbook></inventor><inventor sequence="01" designation="us-only"><addressbook><last-name>YAMAGUCHI</last-name><first-name>Teruyoshi</first-name><address><city>Tokyo</city><country>JP</country></address></addressbook></inventor></inventors></us-parties><assignees><assignee><addressbook><orgname>Mitsubishi Electric Corporation</orgname><role>03</role><address><city>Tokyo</city><country>JP</country></address></addressbook></assignee></assignees><pct-or-regional-filing-data><document-id><country>WO</country><doc-number>PCT/JP2020/001045</doc-number><date>20200115</date></document-id><us-371c12-date><date>20220609</date></us-371c12-date></pct-or-regional-filing-data></us-bibliographic-data-application><abstract id="abstract"><p id="p-0001" num="0000">A relay device includes a first input/output unit (<b>111</b>), a second input/output unit (<b>112</b>), a security monitoring unit (<b>121</b>) that determines whether or not a packet input to the first input/output unit (<b>111</b>) or the second input/output unit (<b>112</b>) is normal, and a relay unit (<b>113</b>) that outputs a packet determined to be normal by the security monitoring unit (<b>121</b>) from the first input/output unit (<b>111</b>) or the second input/output unit (<b>112</b>); the security monitoring unit (<b>121</b>) uses a whitelist to perform whitelist-based attack detection to determine whether or not a packet is normal, and uses a learning model learned through machine learning to perform machine-learning-based attack detection on a packet that is not determined to be normal through the whitelist-based attack detection, to determine whether or not the packet is normal.</p></abstract><drawings id="DRAWINGS"><figure id="Fig-EMI-D00000" num="00000"><img id="EMI-D00000" he="135.13mm" wi="141.48mm" file="US20230007019A1-20230105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00001" num="00001"><img id="EMI-D00001" he="155.11mm" wi="143.51mm" file="US20230007019A1-20230105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00002" num="00002"><img id="EMI-D00002" he="212.94mm" wi="164.42mm" file="US20230007019A1-20230105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00003" num="00003"><img id="EMI-D00003" he="145.63mm" wi="118.87mm" file="US20230007019A1-20230105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00004" num="00004"><img id="EMI-D00004" he="224.37mm" wi="138.43mm" file="US20230007019A1-20230105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00005" num="00005"><img id="EMI-D00005" he="218.61mm" wi="113.79mm" orientation="landscape" file="US20230007019A1-20230105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00006" num="00006"><img id="EMI-D00006" he="224.03mm" wi="147.24mm" orientation="landscape" file="US20230007019A1-20230105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00007" num="00007"><img id="EMI-D00007" he="182.20mm" wi="118.79mm" file="US20230007019A1-20230105-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00008" num="00008"><img id="EMI-D00008" he="223.77mm" wi="147.07mm" orientation="landscape" file="US20230007019A1-20230105-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00009" num="00009"><img id="EMI-D00009" he="232.07mm" wi="145.97mm" file="US20230007019A1-20230105-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00010" num="00010"><img id="EMI-D00010" he="172.13mm" wi="118.70mm" file="US20230007019A1-20230105-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure><figure id="Fig-EMI-D00011" num="00011"><img id="EMI-D00011" he="229.28mm" wi="147.15mm" orientation="landscape" file="US20230007019A1-20230105-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/></figure></drawings><description id="description"><?summary-of-invention description="Summary of Invention" end="lead"?><heading id="h-0001" level="1">TECHNICAL FIELD</heading><p id="p-0002" num="0001">The disclosure relates to a relay device and a relay method.</p><heading id="h-0002" level="1">BACKGROUND ART</heading><p id="p-0003" num="0002">Conventional network-based attack detection for control systems includes whitelist-based attack detection that uses preliminarily defined detection rules for detecting packets that do not require caution and determines packets that do not fall under the rules as attacks (for example, refer to Patent Literature 1).</p><heading id="h-0003" level="1">PRIOR ART REFERENCE</heading><heading id="h-0004" level="1">Patent Reference</heading><p id="p-0004" num="0003">Patent Literature 1: Japanese Patent Application Publication No. 2001-034553</p><heading id="h-0005" level="1">SUMMARY OF THE INVENTION</heading><heading id="h-0006" level="1">Problem to be Solved by the Invention</heading><p id="p-0005" num="0004">For conventional whitelist-based attack detection, detection rules need to be designed even for packets that are rarely transmitted. In some cases, such a design requires a large number of detection rules to be written, and this may lead to increased creation costs and decreased performance.</p><p id="p-0006" num="0005">Accordingly, it is an object of the disclosure to prevent an increase in the creation cost of detection rules.</p><heading id="h-0007" level="1">Means of Solving the Problem</heading><p id="p-0007" num="0006">A relay device according to an aspect of the disclosure includes a first input/output unit connected to a first network; a second input/output unit connected to a second network; a monitoring unit configured to determine whether or not a packet input to the first input/output unit or the second input/output unit is normal; and a relay unit configured to output a packet determined to be normal by the monitoring unit to the first input/output unit or the second input/output unit, wherein the monitoring unit uses a whitelist to perform whitelist-based attack detection to determine whether or not the packet input to the first input/output unit or the second input/output unit is normal and uses a learning model learned through machine learning to perform machine-learning-based attack detection on a packet not determined to be normal through the whitelist-based attack detection, to determine whether or not the packet is normal, the whitelist being a list of detection rules indicating elements that allow determination of normality of the packet out of elements of a feature of the packet.</p><p id="p-0008" num="0007">A relay method according to an aspect of the disclosure includes inputting a packet to a first input/output unit connected to a first network or a second input/output unit connected to a second network; determining whether or not a packet input to the first input/output unit or the second input/output unit is normal; and outputting a packet determined to be normal from the first input/output unit or the second input/output unit, wherein, when the packet input to the first input/output unit or the second input/output unit is to be determined to be normal or not, a whitelist is used to perform whitelist-based attack detection to determine whether or not the packet input to the first input/output unit or the second input/output unit is normal, and a learning model learned through machine learning is used to perform machine-learning-based attack detection to determine whether or not a packet not determined to be normal through the whitelist-based attack detection is normal, the whitelist being a list of detection rules indicating elements that allow determination of normality out of elements of a feature of the packet.</p><heading id="h-0008" level="1">Effects of the Invention</heading><p id="p-0009" num="0008">According to one or more aspects of the disclosure, an increase in the creation cost of detection rules can be prevented.</p><?summary-of-invention description="Summary of Invention" end="tail"?><?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?><description-of-drawings><heading id="h-0009" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading><p id="p-0010" num="0009"><figref idref="DRAWINGS">FIG. <b>1</b></figref> is a block diagram schematically illustrating the configuration of a network system including a detection-rule generating device according to first to third embodiments.</p><p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a block diagram schematically illustrating the functions of the detection-rule generating device according to the first and second embodiments.</p><p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. <b>3</b></figref> is a block diagram illustrating a hardware configuration example.</p><p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. <b>4</b></figref> is a flowchart illustrating the processing executed when the detection-rule generating device according to the first embodiment selects detection rules.</p><p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is a schematic diagram for explaining the outline of the processing of generating pre-selection detection rules by a detection-rule generating unit.</p><p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is a schematic diagram for explaining example processing executed when a detection-rule selecting unit selects detection rules in the first embodiment.</p><p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. <b>7</b></figref> is a flowchart illustrating processing executed when the detection-rule generating device according to the second embodiment selects detection rules.</p><p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. <b>8</b></figref> is a schematic diagram for explaining example processing executed when a detection-rule selecting unit selects detection rules in the second embodiment.</p><p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. <b>9</b></figref> is a block diagram schematically illustrating the functions of a detection-rule generating device according to a third embodiment.</p><p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. <b>10</b></figref> is a flowchart illustrating processing executed when the detection-rule generating device according to the third embodiment updates the selected detection rules.</p><p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. <b>11</b></figref> is a schematic diagram for explaining example processing executed when a detection-rule selecting unit updates post-selection detection rules in the third embodiment.</p></description-of-drawings><?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?><?detailed-description description="Detailed Description" end="lead"?><heading id="h-0010" level="1">MODE FOR CARRYING OUT THE INVENTION</heading><heading id="h-0011" level="1">First Embodiment</heading><p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. <b>1</b></figref> is a block diagram schematically illustrating the configuration of a network system <b>100</b> including a relay device or a detection-rule generating device <b>110</b> according to the first embodiment.</p><p id="p-0022" num="0021">The network system <b>100</b> includes a personal computer (PC) <b>101</b>, a router <b>102</b>, a detection-rule generating device <b>110</b>, air conditioning equipment <b>103</b>, lighting equipment <b>104</b>, and security equipment <b>105</b>.</p><p id="p-0023" num="0022">The PC <b>101</b> is connected to a first network or the Internet <b>106</b> via the router <b>102</b>. The Internet <b>106</b> is a global network.</p><p id="p-0024" num="0023">The detection-rule generating device <b>110</b> is connected to the Internet <b>106</b> and a second network or a local area network (LAN) <b>107</b>.</p><p id="p-0025" num="0024">The air conditioning equipment <b>103</b>, the lighting equipment <b>104</b>, and the security equipment <b>105</b>, which are operation target devices to be operated by the PC <b>101</b>, are connected to the LAN <b>107</b>, but the operation target devices are not limited to such equipment. Note that the operation target devices connected to the LAN <b>107</b> constitutes an operation target system <b>108</b>.</p><p id="p-0026" num="0025">The PC <b>101</b> is an operation device used for operating the operation target equipment in the operation target system <b>108</b>.</p><p id="p-0027" num="0026">The router <b>102</b> is a relay device that relays data between a LAN (not illustrated) to which the PC <b>101</b> is connected and the Internet <b>106</b>.</p><p id="p-0028" num="0027">The detection-rule generating device <b>110</b> functions as a relay device that relays data between the Internet <b>106</b> and the LAN <b>107</b>. For example, the detection-rule generating device <b>110</b> relays packets from the Internet <b>106</b> to the LAN <b>107</b>.</p><p id="p-0029" num="0028">In doing so, the detection-rule generating device <b>110</b> collects the packets transmitted from the PC <b>101</b> via the router <b>102</b> and the Internet <b>106</b> for a predetermined period to generate detection rules, and applies the generated detection rules to the detection-rule generating device <b>110</b> or another network-based attack detection device. Here, the predetermined period is also referred to as a first period.</p><p id="p-0030" num="0029">The air conditioning equipment <b>103</b> regulates air conditioning within the organization provided with the LAN <b>107</b>.</p><p id="p-0031" num="0030">The lighting equipment <b>104</b> lights up a room in the organization provided with the LAN <b>107</b>.</p><p id="p-0032" num="0031">The security equipment <b>105</b> is a monitoring camera or the like in the organization provided with the LAN <b>107</b>.</p><p id="p-0033" num="0032"><figref idref="DRAWINGS">FIG. <b>2</b></figref> is a block diagram schematically illustrating the functions of the detection-rule generating device <b>110</b>.</p><p id="p-0034" num="0033">The detection-rule generating device <b>110</b> includes a first input/output unit <b>111</b>, a second input/output unit <b>112</b>, a relay unit <b>113</b>, a detection-rule generating unit <b>114</b>, a pre-selection rule storage unit <b>115</b>, a communication statistic calculating unit <b>116</b>, a detection-rule statistic calculating unit <b>117</b>, a detection-rule efficiency calculating unit <b>118</b>, a detection-rule selecting unit <b>119</b>, a post-selection rule storage unit <b>120</b>, and a security monitoring unit <b>121</b>.</p><p id="p-0035" num="0034">The first input/output unit <b>111</b> is connected to the Internet <b>106</b> and communicates through the Internet <b>106</b>.</p><p id="p-0036" num="0035">The second input/output unit <b>112</b> is connected to the LAN <b>107</b> and communicates through the LAN <b>107</b>.</p><p id="p-0037" num="0036">The relay unit <b>113</b> feeds the packets received by the first input/output unit <b>111</b> or the second input/output unit <b>112</b> to the security monitoring unit <b>121</b>, and relays the packets determined to be normal by the security monitoring unit <b>121</b> so that the normal packets can be output from the first input/output unit <b>111</b> or the second input/output unit <b>112</b>.</p><p id="p-0038" num="0037">Moreover, the relay unit <b>113</b> feeds the packets received by the first input/output unit <b>111</b> to the detection-rule generating unit <b>114</b> and the communication statistic calculating unit <b>116</b> for a predetermined period in response to an instruction from an operator or the like of the detection-rule generating device <b>110</b>.</p><p id="p-0039" num="0038">The detection-rule generating unit <b>114</b> generates detection rules based on the packets fed from the relay unit <b>113</b>. The detection-rule generating unit <b>114</b> stores the generated detection rules in the pre-selection rule storage unit <b>115</b> as pre-selection detection rules.</p><p id="p-0040" num="0039">The pre-selection rule storage unit <b>115</b> stores the pre-selection detection rules.</p><p id="p-0041" num="0040">Here, the pre-selection detection rules are all detection rule candidates for selecting the detection rules to be included in a whitelist used in whitelist-based attack detection.</p><p id="p-0042" num="0041">The communication statistic calculating unit <b>116</b> calculates, from the packets fed from the relay unit <b>113</b>, a communication statistical value that is the statistical value of communication for each element of one predetermined feature. The communication statistical value indicates, for each element, a scale of packets containing the corresponding element. For example, a communication volume ratio is calculated as the communication statistical value. The communication volume ratio is the ratio of the number of packets involving a corresponding element to the number of packets fed from the relay unit <b>113</b>. The calculated communication statistical value is fed to the detection-rule efficiency calculating unit <b>118</b>.</p><p id="p-0043" num="0042">The detection-rule statistic calculating unit <b>117</b> calculates, from the pre-selection detection rules stored in the pre-selection rule storage unit <b>115</b>, a detection rule statistical value that is a statistical value of detection rules for each element of one predetermined feature. The detection rule statistical value indicates, for each element, a scale of detection rules involving the element. For example, a detection rule number or the detection rule number ratio is calculated as the detection rule statistical value. The detection rule number is the number of detection rules involving a corresponding element included in the pre-selection detection rules. The detection rule number ratio is the ratio of the number of detection rules involving a corresponding element to the number of pre-selection detection rules. The calculated detection rule statistical value is fed to the detection-rule efficiency calculating unit <b>118</b>.</p><p id="p-0044" num="0043">The detection-rule efficiency calculating unit <b>118</b> calculates, from the communication statistical value and the detection rule statistical value, a detection rule efficiency value for each element of one predetermined feature. Here, the detection rule efficiency value is a value for evaluating the communication frequency of the detection rules; the detection rule efficiency is determined to be high when packets having a high communication frequency are detected with a small detection rule number. For example, the detection rule efficiency value is a value obtained by dividing the communication statistical value by the detection rule statistical value for each element. Specifically, the detection rule efficiency value is calculated as (communication volume ratio) (detection rule number) or (communication volume ratio) (detection rule number ratio). The calculated detection rule efficiency values are fed to the detection-rule selecting unit <b>119</b>.</p><p id="p-0045" num="0044">The detection-rule selecting unit <b>119</b> is a selecting unit that selects the detection rules to be included in the whitelist from the pre-selection detection rules stored in the pre-selection rule storage unit <b>115</b>. For example, the detection-rule selecting unit <b>119</b> uses the detection rule efficiency values calculated by the detection-rule efficiency calculating unit <b>118</b> to select the detection rules having high detection rule efficiencies from the pre-selection detection rules stored in the pre-selection rule storage unit <b>115</b> as the detection rules to be left in a whitelist. The detection-rule selecting unit <b>119</b> then stores the selected detection rules in the post-selection rule storage unit <b>120</b> as post-selection detection rules.</p><p id="p-0046" num="0045">The post-selection rule storage unit <b>120</b> stores post-selection detection rules. The post-selection detection rules are detection rules left in a whitelist.</p><p id="p-0047" num="0046">The security monitoring unit <b>121</b> is a monitoring unit that determines whether or not a packet received by the first input/output unit <b>111</b> or the second input/output unit <b>112</b> is normal.</p><p id="p-0048" num="0047">For example, the security monitoring unit <b>121</b> uses a whitelist, which is a list of detection rules indicating elements that allows the determination of normality out of the elements of a feature included in the packets, to perform whitelist-based attack detection for determining whether the packets input to the first input/output unit <b>111</b> or the second input/output unit <b>112</b> are normal. The security monitoring unit <b>121</b> then uses a learning model learned through machine learning to perform machine-learning-based attack detection for determining whether or not a packet is normal on the packets that have not been determined to be normal through the whitelist-based attack detection.</p><p id="p-0049" num="0048">Specifically, the security monitoring unit <b>121</b> executes whitelist-based attack detection on the packets fed from the relay unit <b>113</b> while using the post-selection detection rules stored in the post-selection rule storage unit <b>120</b> as a whitelist.</p><p id="p-0050" num="0049">When a packet fed from the relay unit <b>113</b> does not fall under the detection rules included in the whitelist, the security monitoring unit <b>121</b> executes, on the packet, machine-learning-based attack detection in which feature values of normal packets are preliminary learned from past data and packets deviating from the learned feature values are detected as attacks.</p><p id="p-0051" num="0050">The whitelist-based attack detection and the machine-learning-based attack detection may be those of known techniques, and thus detailed descriptions thereof will be omitted here.</p><p id="p-0052" num="0051"><figref idref="DRAWINGS">FIG. <b>3</b></figref> is a block diagram illustrating a hardware configuration example of the detection-rule generating device <b>110</b>.</p><p id="p-0053" num="0052">The detection-rule generating device <b>110</b> includes a first communication interface (I/F) <b>130</b>, a second communication I/F <b>131</b>, an auxiliary memory <b>132</b>, a main memory <b>133</b>, and a CPU <b>134</b>.</p><p id="p-0054" num="0053">The first communication I/F <b>130</b> communicates with the Internet <b>106</b>.</p><p id="p-0055" num="0054">The second communication I/F <b>131</b> communicates with the LAN <b>107</b>.</p><p id="p-0056" num="0055">The auxiliary memory <b>132</b> stores information and programs necessary for the detection-rule generating device <b>110</b>. For example, the auxiliary memory <b>132</b> stores the programs executed by the CPU <b>134</b>. The auxiliary memory <b>132</b> also stores the calculation results of the CPU <b>134</b>.</p><p id="p-0057" num="0056">The main memory <b>133</b> provides a work area for the CPU <b>134</b>. For example, the CPU <b>134</b> reads out a program stored in the auxiliary memory <b>132</b> into the main memory <b>133</b> and executes the program. The CPU <b>134</b> loads the packets received by the first communication I/F <b>130</b> to the main memory <b>133</b>.</p><p id="p-0058" num="0057">The CPU <b>134</b> reads out a program stored in the auxiliary memory <b>132</b> into the main memory <b>133</b> and executes the program to execute the processing by the detection-rule generating device <b>110</b>. For example, the CPU <b>202</b> performs calculation for generating detection rules based on the packets loaded from the communication I/F <b>201</b> to the main memory <b>133</b>.</p><p id="p-0059" num="0058">For example, the first input/output unit <b>111</b> can be implemented by the first communication I/F <b>130</b>, and the second input/output unit <b>112</b> can be implemented by the second communication I/F <b>131</b>.</p><p id="p-0060" num="0059">The pre-selection rule storage unit <b>115</b> and the post-selection rule storage unit <b>120</b> can be implemented by the auxiliary memory <b>132</b>.</p><p id="p-0061" num="0060">The relay unit <b>113</b>, the detection-rule generating unit <b>114</b>, the communication statistic calculating unit <b>116</b>, the detection-rule statistic calculating unit <b>117</b>, the detection-rule efficiency calculating unit <b>118</b>, the detection-rule selecting unit <b>119</b>, and the security monitoring unit <b>121</b> can be implemented by the CPU <b>202</b>.</p><p id="p-0062" num="0061">The above-described programs may be provided via a network or may be recorded and provided on a recording medium. That is, such programs may be provided as, for example, program products.</p><p id="p-0063" num="0062"><figref idref="DRAWINGS">FIG. <b>4</b></figref> is a flowchart illustrating the processing executed when the detection-rule generating device <b>110</b> according to the first embodiment selects detection rules.</p><p id="p-0064" num="0063">First, the relay unit <b>113</b> feeds the packets received by the first input/output unit <b>111</b> during a predetermined period to the detection-rule generating unit <b>114</b> and the communication statistic calculating unit <b>116</b> (step S<b>10</b>). Note that it is presumed that the packets received in this stage do not include attack packets.</p><p id="p-0065" num="0064">The communication statistic calculating unit <b>116</b> then calculates a communication statistical value for each element of a predetermined feature, from the packets fed from the relay unit <b>113</b> (step S<b>11</b>). The communication statistical value calculated here is fed to the detection-rule efficiency calculating unit <b>118</b>. Here, as will be described later, each of the various BACnet communication commands is used to calculate the ratio of the number of packets containing the corresponding command to the number of packets received in a predetermined period as a communication statistical value.</p><p id="p-0066" num="0065">The detection-rule generating unit <b>114</b> generates pre-selection detection rules that are candidates to be adopted as a whitelist, on the basis of the packets fed from the relay unit <b>113</b> (step S<b>12</b>).</p><p id="p-0067" num="0066"><figref idref="DRAWINGS">FIG. <b>5</b></figref> is a schematic diagram for explaining the outline of the processing of generating pre-selection detection rules by the detection-rule generating unit <b>114</b>.</p><p id="p-0068" num="0067">Here, Building Automation and Control networking protocol (BACnet) communication packets will be described as an example.</p><p id="p-0069" num="0068">The detection-rule generating unit <b>114</b> extracts a feature from the packets fed from the relay unit <b>113</b>. In the example of <figref idref="DRAWINGS">FIG. <b>5</b></figref>, the detection-rule generating unit <b>114</b> extracts, from the BACnet communication packets, the source IP, the destination IP, the BACnet communication command, and the BACnet communication device ID as features.</p><p id="p-0070" num="0069">Note that in the table illustrated in <figref idref="DRAWINGS">FIG. <b>5</b></figref>, the first packet in the &#x201c;No.&#x201d; column indicates a detection rule for a who-Is command, which is a command element. The second to fourth packets in the &#x201c;No.&#x201d; column are detection rules for an i-Am command, which is a command element. Thus, the detection rule number for a who-Is command is one, and the detection rule number for an i-Am command is three. Pre-selection detection rules are generated on the basis of the elements of predetermined features out of the features extracted in this way. The generated pre-selection detection rules are stored in the pre-selection rule storage unit <b>115</b>.</p><p id="p-0071" num="0070">Returning to <figref idref="DRAWINGS">FIG. <b>4</b></figref>, the detection-rule statistic calculating unit <b>117</b> calculates, from the pre-selection detection rules stored in the pre-selection rule storage unit <b>115</b>, detection rule statistical values for the respective elements of the predetermined features (step S<b>13</b>). The calculated detection rule statistical values are fed to the detection-rule efficiency calculating unit <b>118</b>.</p><p id="p-0072" num="0071">The detection-rule efficiency calculating unit <b>118</b> uses the communication statistical values for the respective elements fed from the communication statistic calculating unit <b>116</b> and the detection rule statistical values for the respective elements fed from the detection-rule statistic calculating unit <b>117</b>, to calculate detection rule efficiency values for the respective elements of the predetermined features (step S<b>14</b>). The calculated detection rule efficiency values are fed to the detection-rule selecting unit <b>119</b>.</p><p id="p-0073" num="0072">The detection-rule selecting unit <b>119</b> specifies a detection rule efficiency value not yet specified in the detection rule efficiency values for the respective elements fed from the detection-rule efficiency calculating unit <b>118</b> (step S<b>15</b>).</p><p id="p-0074" num="0073">The detection-rule selecting unit <b>119</b> then determines whether or not the specified detection rule efficiency value is equal to or higher than a threshold (step S<b>16</b>). If the specified detection rule efficiency value is equal to or higher than the threshold (Yes in step S<b>16</b>), the processing proceeds to step S<b>17</b>, and if the specified detection rule efficiency is lower than the threshold (No in step S<b>16</b>), the processing proceeds to step S<b>18</b>.</p><p id="p-0075" num="0074">In step S<b>17</b>, the detection rule involving an element having a detection rule efficiency value equal to or higher than the threshold is selected as a detection rule to be left in the whitelist. The processing then proceeds to step S<b>18</b>.</p><p id="p-0076" num="0075">In step S<b>18</b>, it is determined whether or not a detection rule efficiency value not specified in step S<b>15</b> remains in the detection rule efficiencies for the respective elements of the predetermined features. If there is an unspecified detection rule efficiency value (Yes in step S<b>18</b>), the processing returns to step S<b>15</b>, and if there is no unspecified detection rule efficiency value (No in step S<b>18</b>), the processing ends.</p><p id="p-0077" num="0076"><figref idref="DRAWINGS">FIG. <b>6</b></figref> is a schematic diagram for explaining example processing executed when the detection-rule selecting unit <b>119</b> selects detection rules.</p><p id="p-0078" num="0077">In the example processing, BACnet protocols are extracted from packet dump data of the packets received by the detection-rule generating device <b>110</b>, and processing is executed on the basis of BACnet communication packets.</p><p id="p-0079" num="0078">Various commands flow through BACnet communication. In this example, BACnet commands are the elements of a predetermined feature.</p><p id="p-0080" num="0079">Pre-selection detection rules are generated with the packets received in a predetermined period by a detection-rule generating device <b>110</b>, and the detection rule number or the number of detection rules involving corresponding commands and the detection rule number ratio or the ratio of the detection rule number to the number of total detection rules are calculated for each command. Here, the detection rule number ratio is the detection rule statistical value.</p><p id="p-0081" num="0080">Then, the communication volume ratio or the ratio of the communication volume for each command is calculated as the communication statistical value for the packets.</p><p id="p-0082" num="0081">The communication volume ratio is divided by the detection rule number ratio to calculate the detection rule efficiency value. When the detection rule efficiency value calculated as in the above is equal to or higher than a threshold (here, the threshold is 1.00), the detection-rule selecting unit <b>119</b> selects the detection rule involving the corresponding command as a detection rule to be left in the whitelist.</p><p id="p-0083" num="0082">According to the first embodiment as described above, since the detection rules having a detection rule efficiency value equal to or higher than a threshold are left in a whitelist, detection rules having high efficiency can be included in a whitelist. Thus, the packets that do not fall under the detection rules in the whitelist can be used for machine learning, so that the total processing time required for attack detection can be suppressed.</p><p id="p-0084" num="0083">Since the detection rule efficiency value is calculated for each element, the storage area for storing the communication volume ratio, etc. can be reduced.</p><p id="p-0085" num="0084">The detection-rule generating device <b>110</b> according to the first embodiment is applicable not only to a BA system performing BACnet communication as described above, but also to a control system in general in which stipulated packets are transmitted, such as a plant control system. Alternatively, the detection rules may be generated by a device other than the detection-rule generating device <b>110</b>. The device that generates the detection rules may or may not be included in the network system <b>100</b>.</p><p id="p-0086" num="0085">In the first embodiment described above, the detection rule efficiency value is calculated for each element, but, alternatively, the detection rule efficiency may be calculated for each detection rule.</p><p id="p-0087" num="0086">For example, the communication volume ratio may be the ratio of the number of packets involving a corresponding detection rule to the number of packets fed from the relay unit <b>113</b>. The detection rule number may be the number of corresponding detection rules in the pre-selection detection rules. The detection rule number ratio may be the ratio of the number of corresponding detection rules to the number of pre-selection detection rules.</p><heading id="h-0012" level="1">Second Embodiment</heading><p id="p-0088" num="0087">As illustrated in <figref idref="DRAWINGS">FIG. <b>1</b></figref>, a network system <b>200</b> including a detection-rule generating device <b>210</b> according to the second embodiment includes a PC <b>101</b>, a router <b>102</b>, a detection-rule generating device <b>210</b>, air conditioning equipment <b>103</b>, lighting equipment <b>104</b>, and security equipment <b>105</b>.</p><p id="p-0089" num="0088">The PC <b>101</b>, the router <b>102</b>, the air conditioning equipment <b>103</b>, the lighting equipment <b>104</b>, and the security equipment <b>105</b> of the network system <b>200</b> according to the second embodiment are the same as the PC <b>101</b>, the router <b>102</b>, the air conditioning equipment <b>103</b>, the lighting equipment <b>104</b>, and the security equipment <b>105</b>, respectively, of the network system <b>100</b> according to the first embodiment.</p><p id="p-0090" num="0089">As illustrated in <figref idref="DRAWINGS">FIG. <b>2</b></figref>, the detection-rule generating device <b>210</b> according to the second embodiment includes a first input/output unit <b>111</b>, a second input/output unit <b>112</b>, a relay unit <b>113</b>, a detection-rule generating unit <b>114</b>, a pre-selection rule storage unit <b>115</b>, a communication statistic calculating unit <b>116</b>, a detection-rule statistic calculating unit <b>117</b>, a detection-rule efficiency calculating unit <b>118</b>, a detection-rule selecting unit <b>219</b>, a post-selection rule storage unit <b>120</b>, and a security monitoring unit <b>121</b>.</p><p id="p-0091" num="0090">The first input/output unit <b>111</b>, the second input/output unit <b>112</b>, the relay unit <b>113</b>, the detection-rule generating unit <b>114</b>, the pre-selection rule storage unit <b>115</b>, the communication statistic calculating unit <b>116</b>, the detection-rule statistic calculating unit <b>117</b>, the detection-rule efficiency calculating unit <b>118</b>, the post-selection rule storage unit <b>120</b>, and the security monitoring unit <b>121</b> of the detection-rule generating device <b>210</b> according to the second embodiment are the same as the first input/output unit <b>111</b>, the second input/output unit <b>112</b>, the relay unit <b>113</b>, the detection-rule generating unit <b>114</b>, the pre-selection rule storage unit <b>115</b>, the communication statistic calculating unit <b>116</b>, the detection-rule statistic calculating unit <b>117</b>, the detection-rule efficiency calculating unit <b>118</b>, the post-selection rule storage unit <b>120</b>, and the security monitoring unit <b>121</b>, respectively, of the detection-rule generating device <b>110</b> according to the first embodiment.</p><p id="p-0092" num="0091">The detection-rule selecting unit <b>219</b> selects detection rules having a high detection rule efficiency value as detection rules to be left in a whitelist from the pre-selection detection rules stored in the pre-selection rule storage unit <b>115</b>. In the first embodiment, the detection-rule selecting unit <b>119</b> selects detection rules having a high detection rule efficiency value through comparison with a threshold, but in the second embodiment, the detection-rule selecting unit <b>219</b> ranks the elements of a predetermined feature of the pre-selection detection rules in descending order of detection rule efficiency. The detection-rule selecting unit <b>219</b> then selects the detection rules to be left in the whitelist from the pre-selection detection rules in descending order of the rank of the element.</p><p id="p-0093" num="0092">The detection-rule selecting unit <b>219</b> then stores the selected detection rules in the post-selection rule storage unit <b>120</b> as post-selection detection rules.</p><p id="p-0094" num="0093"><figref idref="DRAWINGS">FIG. <b>7</b></figref> is a flowchart illustrating the processing executed when the detection-rule generating device <b>210</b> according to the second embodiment selects detection rules.</p><p id="p-0095" num="0094">Among the steps included in the flowchart illustrated in <figref idref="DRAWINGS">FIG. <b>7</b></figref>, the steps that are the same as those in <figref idref="DRAWINGS">FIG. <b>4</b></figref> are denoted by the same reference numerals as those in <figref idref="DRAWINGS">FIG. <b>4</b></figref>, and detailed descriptions thereof will be omitted.</p><p id="p-0096" num="0095">The processing of steps S<b>10</b> to S<b>14</b> in <figref idref="DRAWINGS">FIG. <b>7</b></figref> is the same as the processing of steps S<b>10</b> to S<b>14</b> in <figref idref="DRAWINGS">FIG. <b>4</b></figref>. However, in <figref idref="DRAWINGS">FIG. <b>7</b></figref>, the processing proceeds to step S<b>25</b> after the processing of step S<b>14</b>.</p><p id="p-0097" num="0096">In step S<b>25</b>, the detection-rule selecting unit <b>219</b> ranks the elements fed from the detection-rule efficiency calculating unit <b>118</b> in descending order of detection rule efficiency value.</p><p id="p-0098" num="0097">Next, the detection-rule selecting unit <b>219</b> calculates, through a predetermined method, a threshold of the detection rule number suitable for being processed through the whitelist-based attack detection, and selects the detection rules to be left in the whitelist from the pre-selection detection rules involving high ranking elements in descending order of rank (step S<b>26</b>). Note that the threshold may be preliminarily determined.</p><p id="p-0099" num="0098"><figref idref="DRAWINGS">FIG. <b>8</b></figref> is a schematic diagram for explaining example processing executed when the detection-rule selecting unit <b>119</b> selects detection rules.</p><p id="p-0100" num="0099">In the example processing, BACnet protocols are extracted from packet dump data of the packets received by the detection-rule generating device <b>210</b>, and processing is executed on the basis of BACnet communication packets.</p><p id="p-0101" num="0100">Pre-selection detection rules are generated with the packets received in a predetermined period by a detection-rule generating device <b>210</b>, and the detection rule number or the number of detection rules involving corresponding commands and the detection rule number ratio or the ratio of the detection rule number to the number of total detection rules are calculated for each command. Here, the detection rule number ratio is the detection rule statistical value.</p><p id="p-0102" num="0101">Then, the communication volume ratio or the ratio of the communication volume for each command is calculated as the communication statistical value from the packets.</p><p id="p-0103" num="0102">The communication volume ratio is divided by the detection rule number ratio to calculate the detection rule efficiency value.</p><p id="p-0104" num="0103">In the example illustrated in <figref idref="DRAWINGS">FIG. <b>8</b></figref>, the detection-rule selecting unit <b>219</b> ranks the commands in descending order of detection rule efficiency value calculated by the detection-rule efficiency calculating unit <b>118</b>.</p><p id="p-0105" num="0104">The detection-rule selecting unit <b>219</b> selects pre-selection detection rules involving the commands in descending order of rank of the commands.</p><p id="p-0106" num="0105">The detection-rule selecting unit <b>219</b> selects a number of detection rules that satisfies a threshold (which in this case is, for example, 4500). In the example illustrated in <figref idref="DRAWINGS">FIG. <b>8</b></figref>, the number of selected detection rules reaches &#x201c;3160&#x201d; when the detection rules involving the command &#x201c;writePropertyMultiple(REQ)&#x201d; ranking at ninth are selected. In this case, if the detection rules involving the command &#x201c;readRange(ACK)&#x201d; ranking at tenth are selected, the number of selected detection rules reaches &#x201c;8160&#x201d; and exceeds the threshold; thus, the detection-rule selecting unit <b>219</b> selects the detection rules involving the subsequent command &#x201c;writePropertyMultiple(REQ)&#x201d; ranking at eleventh.</p><p id="p-0107" num="0106">Here, if selecting detection rules involving an element of a certain rank causes the threshold to be exceeded, the detection-rule selecting unit <b>219</b> lowers the rank so that the number of selected detection rules may be maximized within the threshold. However, the second embodiment is not limited to such an example. For example, if selecting detection rules involving an element of a certain rank causes the threshold to be exceeded, the detection-rule selecting unit <b>219</b> may end the selection of detection rules at the preceding rank.</p><p id="p-0108" num="0107">According to the second embodiment as described above, since the detection rules are selected up to a number close to the predetermined threshold, the number of detection rules left in a whitelist can be suppressed.</p><p id="p-0109" num="0108">Note that in the second embodiment, a detection rule efficiency value may be calculated for each detection rule as in the first embodiment.</p><heading id="h-0013" level="1">Third Embodiment</heading><p id="p-0110" num="0109">As illustrated in <figref idref="DRAWINGS">FIG. <b>1</b></figref>, a network system <b>300</b> including a detection-rule generating device <b>310</b> according to the third embodiment includes a PC <b>101</b>, a router <b>102</b>, a detection-rule generating device <b>310</b>, air conditioning equipment <b>103</b>, lighting equipment <b>104</b>, and security equipment <b>105</b>.</p><p id="p-0111" num="0110">The PC <b>101</b>, the router <b>102</b>, the air conditioning equipment <b>103</b>, the lighting equipment <b>104</b>, and the security equipment <b>105</b> of the network system <b>300</b> according to the third embodiment are the same as the PC <b>101</b>, the router <b>102</b>, the air conditioning equipment <b>103</b>, the lighting equipment <b>104</b>, and the security equipment <b>105</b>, respectively, of the network system <b>100</b> according to the first embodiment.</p><p id="p-0112" num="0111"><figref idref="DRAWINGS">FIG. <b>9</b></figref> is a block diagram schematically illustrating the functions of the detection-rule generating device <b>310</b> according to the third embodiment.</p><p id="p-0113" num="0112">The detection-rule generating device <b>310</b> includes a first input/output unit <b>111</b>, a second input/output unit <b>112</b>, a relay unit <b>313</b>, a detection-rule generating unit <b>314</b>, a pre-selection rule storage unit <b>315</b>, a communication statistic calculating unit <b>316</b>, a detection-rule statistic calculating unit <b>317</b>, a detection-rule efficiency calculating unit <b>318</b>, a detection-rule selecting unit <b>319</b>, a post-selection rule storage unit <b>320</b>, a security monitoring unit <b>121</b>, a detection-rule adding unit <b>322</b>, and a communication-statistic storage unit <b>323</b>.</p><p id="p-0114" num="0113">The first input/output unit <b>111</b>, the second input/output unit <b>112</b>, and the security monitoring unit <b>121</b> of the detection-rule generating device <b>310</b> according to the third embodiment are the same as the first input/output unit <b>111</b>, the second input/output unit <b>112</b>, and the security monitoring unit <b>121</b>, respectively, of the detection-rule generating device <b>110</b> according to the first embodiment.</p><p id="p-0115" num="0114">The relay unit <b>313</b> performs the same processing as that of the first embodiment, and after the detection, rules to be left in the whitelist are selected, feeds the packets received by the first input/output unit <b>111</b> to the detection-rule generating unit <b>314</b> and the communication statistic calculating unit <b>316</b> during a predetermined period, for example, in response to an instruction from an operator or the like of the detection-rule generating device <b>310</b>. Here, the predetermined period is also referred to as a second period.</p><p id="p-0116" num="0115">The detection-rule generating unit <b>314</b> performs the same processing as that of the first embodiment, and generates detection rules from the packets fed from the relay unit <b>313</b> after the detection rules to be left in the whitelist are selected. Once the detection rules to be left in the whitelist are selected, the detection-rule generating unit <b>314</b> feeds the generated detection rules to the detection-rule adding unit <b>322</b>.</p><p id="p-0117" num="0116">The detection-rule adding unit <b>322</b> adds the detection rules fed from the detection-rule generating unit <b>314</b> to the pre-selection rule storage unit <b>315</b>. For example, the detection-rule adding unit <b>322</b> stores the detection rules fed from the detection-rule generating unit <b>314</b> in the pre-selection rule storage unit <b>315</b> as pre-selection detection rules without overlap with the pre-selection detection rules already stored in the pre-selection rule storage unit <b>315</b>. Here, the pre-selection detection rules after the addition of the detection rules by the detection-rule adding unit <b>322</b> are also referred to as additional pre-selection detection rules.</p><p id="p-0118" num="0117">The pre-selection rule storage unit <b>315</b> stores the pre-selection detection rules or the additional pre-selection detection rules.</p><p id="p-0119" num="0118">Before the detection rules to be left in the whitelist are selected, the communication statistic calculating unit <b>316</b> calculates, from the packets fed from the relay unit <b>313</b>, communication statistical values, which are statistical values for the communication of the respective elements of a predetermined feature, in the same manner as in the first embodiment. The communication statistic calculating unit <b>316</b> feeds the calculated communication statistical values to the detection-rule efficiency calculating unit <b>318</b> while storing them in the communication-statistic storage unit <b>323</b>.</p><p id="p-0120" num="0119">After selection of the detection rules to be left in the whitelist, the communication statistic calculating unit <b>316</b> calculates, from the packets fed from the relay unit <b>313</b>, the communication statistical values, which are statistical values for communication of the respective elements of a predetermined feature, and adds the calculated communication statistical values to the communication statistical values stored in the communication-statistic storage unit <b>323</b>. The communication statistic calculating unit <b>316</b> feeds the combined communication statistical values to the detection-rule efficiency calculating unit <b>318</b> and stores the calculated communication statistical values in the communication-statistic storage unit <b>323</b>.</p><p id="p-0121" num="0120">The detection-rule statistic calculating unit <b>317</b> performs the same processing as that of the first embodiment, and after selection of the detection rules to be left in the whitelist, calculates detection rule statistical values, which are statistical values of detection rules for the respective elements of a predetermined feature, from the additional pre-selection detection rules stored in the pre-selection rule storage unit <b>315</b>. Here, the calculated detection rule statistical values are also referred to as updated detection rule statistical values.</p><p id="p-0122" num="0121">The detection-rule efficiency calculating unit <b>318</b> performs the same processing as that of the first embodiment, and after selection of the detection rules to be left in the whitelist, calculates updated detection rule efficiency values, which are the detection rule efficiencies of the respective elements of a predetermined feature, from the combined communication statistical values and the updated detection rule statistical values. The calculated updated detection rule efficiency values are fed to the detection-rule selecting unit <b>319</b>.</p><p id="p-0123" num="0122">The detection-rule selecting unit <b>319</b> performs the same processing as that of the first or second embodiment, and after selection of the detection rules to be left in the whitelist, selects detection rules having high updated detection rule efficiency values as the detection rules to be left in the whitelist, from the additional pre-selection detection rules stored in the pre-selection rule storage unit <b>315</b>. The selection method may be the same as of the first or second embodiment. The detection-rule selecting unit <b>319</b> then stores the selected detection rules in the post-selection rule storage unit <b>320</b> as post-selection detection rules. The post-selection detection rules stored here may also be referred to as updated post-selection detection rules.</p><p id="p-0124" num="0123">Subsequently, the security monitoring unit <b>121</b> executes whitelist-based attack detection by using the updated post-selection detection rules stored in the post-selection rule storage unit <b>320</b> as a whitelist on the packets fed from the relay unit <b>113</b>.</p><p id="p-0125" num="0124">Note that the communication-statistic storage unit <b>323</b> can be implemented by the auxiliary memory <b>132</b> illustrated in <figref idref="DRAWINGS">FIG. <b>3</b></figref>.</p><p id="p-0126" num="0125">The detection-rule adding unit <b>322</b> can be implemented by the CPU <b>202</b> illustrated in <figref idref="DRAWINGS">FIG. <b>3</b></figref>.</p><p id="p-0127" num="0126"><figref idref="DRAWINGS">FIG. <b>10</b></figref> is a flowchart illustrating the processing executed when the detection-rule generating device <b>310</b> according to the third embodiment updates selected detection rules.</p><p id="p-0128" num="0127">First, the relay unit <b>313</b> feeds the packets received by the first input/output unit <b>111</b> during a predetermined period to the detection-rule generating unit <b>314</b> and the communication statistic calculating unit <b>316</b> (step S<b>30</b>).</p><p id="p-0129" num="0128">The communication statistic calculating unit <b>316</b> then calculates the communication statistical values for the respective elements of a predetermined feature from the packets fed from the relay unit <b>113</b>, and adds the calculated communication statistical values to the communication statistical values stored in the communication-statistic storage unit <b>323</b> (step S<b>31</b>). The combined communication statistical values combined here are fed to the detection-rule efficiency calculating unit <b>318</b> and stored in the communication-statistic storage unit <b>323</b>.</p><p id="p-0130" num="0129">The detection-rule generating unit <b>314</b> generates detection rules on the basis of the packets fed from the relay unit <b>313</b> (step S<b>32</b>). The generated detection rules are fed to the detection-rule adding unit <b>322</b>.</p><p id="p-0131" num="0130">The detection-rule adding unit <b>322</b> adds the detection rules fed from the detection-rule generating unit <b>314</b> to the pre-selection rule storage unit <b>315</b> so as not to overlap with the pre-selection detection rules already stored in the pre-selection rule storage unit <b>315</b> (step S<b>33</b>).</p><p id="p-0132" num="0131">The detection-rule statistic calculating unit <b>317</b> calculates, from the additional pre-selection detection rules stored in the pre-selection rule storage unit <b>315</b>, detection rule statistical values for the respective elements of a predetermined feature as updated detection rule statistical values (step S<b>34</b>). The calculated updated detection rule statistical values are fed to the detection-rule efficiency calculating unit <b>318</b>.</p><p id="p-0133" num="0132">The detection-rule efficiency calculating unit <b>318</b> uses the combined communication statistical values fed from the communication statistic calculating unit <b>316</b> and the updated detection rule statistical values fed from the detection-rule statistic calculating unit <b>317</b>, to calculate the updated detection rule efficiency values, which are the detection rule efficiencies for the respective elements of a predetermined feature (step S<b>35</b>). The calculated updated detection rule efficiency values are fed to the detection-rule selecting unit <b>319</b>.</p><p id="p-0134" num="0133">The detection-rule selecting unit <b>319</b> uses the updated detection rule efficiency values fed from the detection-rule efficiency calculating unit <b>318</b> to select, from the additional pre-selection detection rules stored in the pre-selection rule storage unit <b>315</b>, the detection rules to be left in the whitelist as updated post-selection detection rules (step S<b>36</b>). In this selection method, as in the first embodiment, the updated detection rule efficiency values may be compared with a threshold, and as in the second embodiment, the detection rules may be selected in descending order of updated detection rule efficiencies.</p><p id="p-0135" num="0134"><figref idref="DRAWINGS">FIG. <b>11</b></figref> is a schematic diagram for explaining example processing executed when the detection-rule selecting unit <b>319</b> updates the post-selection detection rules.</p><p id="p-0136" num="0135">In the example processing, BACnet protocols are extracted from packet dump data of the packets received by the detection-rule generating device <b>310</b>, and processing is executed on the basis of BACnet communication packets.</p><p id="p-0137" num="0136">The detection rules generated from the packets received by the detection-rule generating device <b>310</b> in a predetermined period are added to the pre-selection detection rules, and the detection rule number or the number of detection rules involving corresponding commands and the detection rule number ratio or the ratio of the detection rule number to the number of total detection rules are calculated for each command. Here, the detection rule number ratio is an updated detection rule statistical value.</p><p id="p-0138" num="0137">Then, the communication volume ratio, which is the ratio of the communication volume for each command, is calculated as a communication statistical value from the packets and added to the corresponding communication statistical value already stored.</p><p id="p-0139" num="0138">The combined communication volume ratio is divided by the updated detection rule number ratio to calculate the updated detection rule efficiency value.</p><p id="p-0140" num="0139">The detection-rule selecting unit <b>319</b> selects the additional pre-selection detection rules involving commands having high updated detection rule efficiency values.</p><p id="p-0141" num="0140">As described above, according to the third embodiment, even after a detection rule is selected once, a suitable detection rule can be selected again by adding a new packet. Therefore, the accuracy of the whitelist can be improved.</p><p id="p-0142" num="0141">Note that in the third embodiment, the updated detection rule efficiency value may be calculated for each detection rule as in the first embodiment.</p><heading id="h-0014" level="1">DESCRIPTION OF REFERENCE CHARACTERS</heading><p id="p-0143" num="0142"><b>100</b>, <b>200</b>, <b>300</b> network system; <b>101</b> PC; <b>102</b> router; <b>103</b> air conditioning equipment; <b>104</b> lighting equipment; <b>105</b> security equipment; <b>106</b> Internet; <b>107</b> LAN; <b>110</b>, <b>210</b>, <b>310</b> detection-rule generating device; <b>111</b> first input/output unit; <b>112</b> second input/output unit; <b>113</b>, <b>313</b> relay unit; <b>114</b>, <b>314</b> detection-rule generating unit; <b>115</b>, <b>315</b> pre-selection rule storage unit; <b>116</b>, <b>316</b> communication statistic calculating unit; <b>117</b>, <b>317</b> detection-rule statistic calculating unit; <b>118</b>, <b>318</b> detection-rule efficiency calculating unit; <b>119</b>, <b>219</b>, <b>319</b> detection-rule selecting unit; <b>120</b>, <b>320</b> post-selection rule storage unit; <b>121</b> security monitoring unit; <b>322</b> detection-rule adding unit; <b>323</b> communication-statistic storage unit.</p><?detailed-description description="Detailed Description" end="tail"?></description><claims id="claims"><claim id="CLM-00001" num="00001"><claim-text><b>1</b>. A relay device comprising:<claim-text>a first communication interface connected to a first network;</claim-text><claim-text>a second communication interface connected to a second network;</claim-text><claim-text>a processor to execute a program; and</claim-text><claim-text>a memory to store the program which, when executed by the processor, performs processes of,</claim-text><claim-text>determining whether or not a packet input to the first communication interface or the second communication interface is normal; and</claim-text><claim-text>outputting a packet determined to be normal to the first communication interface or the second communication interface,</claim-text><claim-text>wherein the processor uses a whitelist to perform whitelist-based attack detection to determine whether or not the packet input to the first communication interface or the second communication interface is normal and uses a learning model learned through machine learning to perform machine-learning-based attack detection to determine whether or not a packet not determined to be normal through the whitelist-based attack is normal, the whitelist being a list of detection rules indicating elements that allow determination of normality of the packet out of elements of a feature of the packet.</claim-text></claim-text></claim><claim id="CLM-00002" num="00002"><claim-text><b>2</b>. The relay device according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the processor further performs processes of,<claim-text>generating a plurality of detection rules as a plurality of pre-selection detection rules, from a plurality of packets input to the first communication interface during a predetermined first period; and</claim-text><claim-text>selecting a detection rule to be included in the whitelist, from the plurality of pre-selection detection rules.</claim-text></claim-text></claim><claim id="CLM-00003" num="00003"><claim-text><b>3</b>. The relay device according to <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein the processor further performs processes of,<claim-text>calculating, from the plurality of pre-selection detection rules, for each element of a predetermined feature, a detection rule statistical value indicating a scale of detection rules involving a corresponding element in the plurality of pre-selection detection rules;</claim-text><claim-text>calculating, for each element of the predetermined feature, a communication statistical value indicating a scale of packets involving the corresponding element in the plurality of packets; and</claim-text><claim-text>calculating, for each element of the predetermined feature, a detection rule efficiency value obtained by dividing the communication statistical value by the detection rule statistical value,</claim-text><claim-text>wherein the processor performs the selection by using the detection rule efficiency value.</claim-text></claim-text></claim><claim id="CLM-00004" num="00004"><claim-text><b>4</b>. The relay device according to <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein the detection rule statistical value is a ratio of detection rules involving the corresponding element to the plurality of pre-selection detection rules or the number of detection rules involving the corresponding element.</claim-text></claim><claim id="CLM-00005" num="00005"><claim-text><b>5</b>. The relay device according to <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein the communication statistical value is a ratio of packets involving the corresponding element to the plurality of packets.</claim-text></claim><claim id="CLM-00006" num="00006"><claim-text><b>6</b>. The relay device according to <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein the processor further performs processes of,<claim-text>calculating, for each detection rule included in the plurality of pre-selection detection rules, a detection rule statistical value indicating a scale of corresponding detection rules in the plurality of pre-selection detection rules;</claim-text><claim-text>calculating, for each detection rule included in the plurality of pre-selection detection rules, a communication statistical value indicating a scale of corresponding detection rules in the plurality of packets; and</claim-text><claim-text>calculating, for each element of the predetermined feature, a detection rule efficiency value obtained by dividing the communication statistical value by the detection rule statistical value,</claim-text><claim-text>wherein the processor performs the selection by using the detection rule efficiency value.</claim-text></claim-text></claim><claim id="CLM-00007" num="00007"><claim-text><b>7</b>. The relay device according to <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein the detection rule statistical value is a ratio of the corresponding detection rules to the plurality of pre-selection detection rules or the number of corresponding detection rules in the plurality of pre-selection detection rules.</claim-text></claim><claim id="CLM-00008" num="00008"><claim-text><b>8</b>. The relay device according to <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein the communication statistical value is a ratio of packets involving the corresponding detection rules to the plurality of packets.</claim-text></claim><claim id="CLM-00009" num="00009"><claim-text><b>9</b>. The relay device according to <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein the processor performs the selection by comparing the detection rule efficiency value with a predetermined threshold.</claim-text></claim><claim id="CLM-00010" num="00010"><claim-text><b>10</b>. The relay device according to <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein the processor performs the selection in descending order of the detection rule efficiency values.</claim-text></claim><claim id="CLM-00011" num="00011"><claim-text><b>11</b>. The relay device according to <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein,<claim-text>the processor generates a plurality of detection rules from a plurality of packets input to the first communication interface during a predetermined second period and generates a plurality of additional pre-selection detection rules by adding the plurality of detection rules to the plurality of pre-selection detection rules without overlap, and</claim-text><claim-text>selects a detection rule to be included in the whitelist from the plurality of additional pre-selection detection rules.</claim-text></claim-text></claim><claim id="CLM-00012" num="00012"><claim-text><b>12</b>. A relay method comprising:<claim-text>inputting a packet to a first communication interface connected to a first network or a second communication interface connected to a second network;</claim-text><claim-text>determining whether or not a packet input to the first communication interface or the second communication interface is normal; and</claim-text><claim-text>outputting a packet determined to be normal from the first communication interface or the second communication interface,</claim-text><claim-text>wherein, when the packet input to the first communication interface or the second communication interface is to be determined to be normal or not, a whitelist is used to perform whitelist-based attack detection to determine whether or not the packet input to the first communication interface or the second communication interface is normal, and a learning model learned through machine learning is used to perform machine-learning-based attack detection to determine whether or not a packet not determined to be normal through the whitelist-based attack detection is normal, the whitelist being a list of detection rules indicating elements that allow determination of normality out of elements of a feature of the packet.</claim-text></claim-text></claim><claim id="CLM-00013" num="00013"><claim-text><b>13</b>. The relay device according to <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the communication statistical value is a ratio of packets involving the corresponding element to the plurality of packets.</claim-text></claim><claim id="CLM-00014" num="00014"><claim-text><b>14</b>. The relay device according to <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the communication statistical value is a ratio of packets involving the corresponding detection rules to the plurality of packets.</claim-text></claim><claim id="CLM-00015" num="00015"><claim-text><b>15</b>. The relay device according to <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein the processor performs the selection by comparing the detection rule efficiency value with a predetermined threshold.</claim-text></claim><claim id="CLM-00016" num="00016"><claim-text><b>16</b>. The relay device according to <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein the processor performs the selection in descending order of the detection rule efficiency values.</claim-text></claim></claims></us-patent-application>